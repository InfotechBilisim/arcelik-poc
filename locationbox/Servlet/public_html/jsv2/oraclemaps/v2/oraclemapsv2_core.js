(function(c,b){var a={version:"12.2.1.3.0",build:"12.2.1.3.0-730-g2dc6602"};a.$=a.$||jQuery;a.RTree=a.RTree||RTree;a.Hammer=a.Hammer||Hammer;a.layer=a.layer||{};a.filter=a.filter||{};a.style=a.style||{};a.util=a.util||{};a.wmts=a.wmts||{};a.proj=a.proj||{};a.event=a.event||{};a.geometry=a.geometry||{};a.universe=a.universe||{};a.visualfilter=a.visualfilter||{};a.infowindow=a.infowindow||{};a.tool=a.tool||{};a.control=a.control||{};a.template=a.template||{};a.lbs=a.lbs||{};a.edit=a.edit||{};a.server=
a.server||{};a.Class=a.Class||function(){};(function(){if(!a.Class.extend){var e=!1;a.Class.extend=function(d){function f(){!e&&this.initialize&&this.initialize.apply(this,arguments)}var g=this.prototype;e=!0;var h=new this;e=!1;d.mixin&&(a.util.MiscUtil.mixin(h,d.mixin),delete d.mixin);var l=null,t=null,F;for(F in d)l=d[F],t=g[F],"function"===typeof l&&"function"===typeof t&&l!==t&&(l.base=t),h[F]=l;f.prototype=h;f.prototype.constructor=f;f.extend=arguments.callee;return f}}})();a.setJQuery=function(e){a.$=
e};a.setRTree=function(e){a.RTree=e};a.setHammer=function(e){a.Hammer=e};a.notNull=function(a){return"undefined"!==typeof a&&null!==a};a.isNotNull=a.notNull;a.isNull=function(a){return"undefined"===typeof a||null===a};a.isUndefined=a.isNull;(function(a){var d=navigator.userAgent.toLowerCase(),f=/webkit/.test(d),g="undefined"!==typeof orientation?!0:!1,h=/android/.test(d),l=/chrome/.test(d),t=/firefox/.test(d),F=/(mozilla)(?:.*? rv:([\w.]+))?/.test(d),I=/(opera)(?:.*version)?[ \/]([\w.]+)/.test(d),
P=/(msie) ([\w.]+)/.test(d);a.browser={msie:P,msie6:P&&!c.XMLHttpRequest,mozilla:F,webkit:f,safari:f,firefox:t,webkit3d:f&&"WebKitCSSMatrix"in c&&"m11"in new c.WebKitCSSMatrix,chrome:l,gecko:-1!==d.indexOf("gecko"),opera:I,android:h,mobileWebkit:g&&f,mobileOpera:g&&I,mobile:g,touchSupported:"ontouchstart"in c||c.DocumentTouch&&document instanceof DocumentTouch};a.browser.android&&(a.browser.androidVersion=parseFloat((d.match(/.+(?:android)[\/: ]([\d.]+)/)||[0,0])[1]))})(a);a.MapContext=function(e){var d=
e.getMapContextToken();return{getUniverse:function(){return d.universe},getPreviousZoomLevel:function(){return d.previousZoomLevel},getZoomLevel:function(){return d.zoomLevel},getPreviousCenterPoint:function(){return d.previousCenterPoint},getCenterPoint:function(){return d.centerPoint},getTransform:function(){if(!d.transform){var e=d.universe.getZoomLevels()[d.zoomLevel],g=this.getDeviceWidth()*e.resolution,e=this.getDeviceHeight()*e.resolution*e.stretchRatio,g={x:d.centerPoint.getX()-g/2,y:d.centerPoint.getY()-
e/2,w:g,h:e},e={x:0,y:0,w:this.getDeviceWidth(),h:this.getDeviceHeight()};d.transform=new a.util.ScreenTransform(g,e)}return d.transform},getDeviceWindow:function(){return d.deviceWindow},getDeviceWidth:function(){return d.deviceWindow.w},getDeviceHeight:function(){return d.deviceWindow.h},getQueryWindow:function(){var e=d.universe.getZoomLevels()[d.zoomLevel],g=d.centerPoint.getX(),h=d.centerPoint.getY();return new a.geometry.Rectangle(g-d.deviceWindow.w*e.resolution/2,h-d.deviceWindow.h*e.resolution*
e.stretchRatio/2,g+d.deviceWindow.w*e.resolution/2,h+d.deviceWindow.h*e.resolution*e.stretchRatio/2,d.universe.getSRID())},getGraphics:function(){return d.graphics},getRoundMapCenterPoint:function(){return d.roundMapCenterPoint},getWholeMapNum:function(){var a=d.universe.getZoomLevels()[d.zoomLevel],g=d.centerPoint.getX(),h=d.universe.getMapBounds().getWidth(),a=Math.ceil((g+d.deviceWindow.w/2*a.resolution-(g-d.deviceWindow.w/2*a.resolution))/h);!1===e.wraparound&&(a=1);return a},getBaseWholeMapIndex:function(){var a=
d.universe.getZoomLevels()[d.zoomLevel],e=d.centerPoint.getX(),h=d.universe.getMapBounds().getWidth(),a=e-d.deviceWindow.w/2*a.resolution,e=this.getWholeMapNum();if(1===e)return 0;for(var l=0,t=0;t<e;t++)a+h*t>=-h/2&&a+h*t<=h/2&&(l=t);return l}}};a.Messages={};a.Messages.getErrorMessage=function(e){var d=a.Messages[e];return d?e+": "+d:e};a.Messages.getString=function(e){var d=a.Messages[e];return d?d:e};a.Messages.fetched=!1;a.Messages.timeoutCount=0;a.$.i18n.map.MAPVIEWER_9001="Map tile layer not found. Check map tile layer name and/or data source name.";
a.$.i18n.map.MAPVIEWER_9002="Register theme failed.";a.$.i18n.map.MAPVIEWER_9003="Error when loading Nokia map lib.";a.$.i18n.map.MAPVIEWER_9004="Please provide TomTom map API key.";a.$.i18n.map.MAPVIEWER_9005="Feature ID is already used, please pick a new ID.";a.$.i18n.map.MAPVIEWER_9006="Error occurred when sending request to data server.";a.$.i18n.map.MAPVIEWER_9007="Cannot get data from data server.";a.$.i18n.map.MAPVIEWER_9008="Error occurred when getting RSS feed";a.$.i18n.map.MAPVIEWER_9009=
"Error occurred when sending request to map cache server.";a.$.i18n.map.MAPVIEWER_9010="Unsupported editing geometry.";a.$.i18n.map.MAPVIEWER_9011="A line needs at least 2 shape points.";a.$.i18n.map.MAPVIEWER_9012="A polygon needs at least 3 shape points.";a.$.i18n.map.MAPVIEWER_9013="Error occurred when parsing JSON format data.";a.$.i18n.map.MAPVIEWER_9014="Error occurred when sending HTTP request.";a.$.i18n.map.MAPVIEWER_9015="Not a valid line or polygon type.";a.$.i18n.map.MAPVIEWER_9016="Error occurred when calculating length in server side.";
a.$.i18n.map.MAPVIEWER_9017="Not a geodetic point.";a.$.i18n.map.MAPVIEWER_9018="One or more parameter is missing or invalid.";a.$.i18n.map.MAPVIEWER_9019="Geometry SRID is null.";a.$.i18n.map.MAPVIEWER_9020="Invalid URL.";a.$.i18n.map.MAPVIEWER_9021="Cannot undo.";a.$.i18n.map.MAPVIEWER_9022="Cannot redo.";a.$.i18n.map.MAPVIEWER_9023="Cannot load style.";a.$.i18n.map.MAPVIEWER_9024="Either a base marker or a set of marker styles must be specified.";a.$.i18n.map.MAPVIEWER_9025="Must specify either a baseColor or a pair of fromColor and toColor.";
a.$.i18n.map.MAPVIEWER_9026="Invalid classification specified.";a.$.i18n.map.MAPVIEWER_9027="Generating buckets.";a.$.i18n.map.MAPVIEWER_9028="Buckets exist, but classification is not 'custom'.";a.$.i18n.map.MAPVIEWER_9029="No styles found in the options.";a.$.i18n.map.MAPVIEWER_9030="Styles and buckets must be arrays of the same length.";a.$.i18n.map.MAPVIEWER_9031="Cannot switch tile layer.";a.$.i18n.map.MAPVIEWER_9032="Error when calling event listener.";a.$.i18n.map.MAPVIEWER_9033="SRID is different.";
a.$.i18n.map.MAPVIEWER_9034="No valid URL in selected text.";a.$.i18n.map.MAPVIEWER_9036="A subclass must implement the method: start";a.$.i18n.map.MAPVIEWER_9037="A subclass must implement the method: clear";a.$.i18n.map.MAPVIEWER_9038="Please select exactly one polygon feature first.";a.$.i18n.map.MAPVIEWER_9039="Invalid zoom level number.";a.$.i18n.map.MAPVIEWER_9040="You are running in SVG mode. To get map image, please include canvg.js(http://code.google.com/p/canvg/), or switch to canvas mode.";
a.$.i18n.map.MAPVIEWER_9041="localStorage is not supported in your browser.";a.$.i18n.map.MAPVIEWER_9042="Must specify style attributes for bucket style.";a.$.i18n.map.MAPVIEWER_9043="Cannot load NSDP data from the specified URL.";a.$.i18n.map.MAPVIEWER_9044="Cannot find the tiles folder. ";a.$.i18n.map.MAPVIEWER_9045="The end point should not be the same with the start point.";a.$.i18n.map.MAPVIEWER_9046="Not a valid geometry for this method.";a.$.i18n.map.MAPVIEWER_9047="Error occurred when calculating area in server side.";
a.$.i18n.map.MAPVIEWER_9048="Toolbar ID is already used, please pick a new ID.";a.$.i18n.map.MAPVIEWER_9049="Cannot load bounding box from vector layer.";a.$.i18n.map.MAPVIEWER_9050="Invalid map container div";a.$.i18n.map.MAPVIEWER_WB_TTILE="Add Text";a.$.i18n.map.MAPVIEWER_WB_TEXT="Text";a.$.i18n.map.MAPVIEWER_WB_X="Orientation value X axis";a.$.i18n.map.MAPVIEWER_WB_Y="Y axis";a.$.i18n.map.MAPVIEWER_WB_BOLD="Bold";a.$.i18n.map.MAPVIEWER_WB_ITALIC="Italic";a.$.i18n.map.MAPVIEWER_WB_ALIGN_LEFT="left align format";
a.$.i18n.map.MAPVIEWER_WB_ALIGN_CENTER="center align format";a.$.i18n.map.MAPVIEWER_WB_ALIGN_RIGHT="right align format";a.$.i18n.map.MAPVIEWER_WB_VALIGN_TOP="top align vertical format";a.$.i18n.map.MAPVIEWER_WB_VALIGN_CENTER="center align vertical format";a.$.i18n.map.MAPVIEWER_WB_VALIGN_BOTTOM="bottom align vertical format";a.$.i18n.map.MAPVIEWER_WB_OK="OK";a.$.i18n.map.MAPVIEWER_WB_PREVIEW="Preview";a.$.i18n.map.MAPVIEWER_LC_TITLE="Vector layer list";a.$.i18n.map.MAPVIEWER_TB_TIP_CLEAR="clear";
a.$.i18n.map.MAPVIEWER_TB_TIP_CIRCLE="circle";a.$.i18n.map.MAPVIEWER_TB_TIP_RECTANGLE="rectangle";a.$.i18n.map.MAPVIEWER_TB_TIP_REDLINE="redline";a.$.i18n.map.MAPVIEWER_TB_TIP_DISTANCE="distance";a.$.i18n.map.MAPVIEWER_TB_TIP_ZOOM="zoom";a.$.i18n.map.MAPVIEWER_SB_KILOMETERS="km";a.$.i18n.map.MAPVIEWER_SB_METERS="m";a.$.i18n.map.MAPVIEWER_SB_MILES="mi";a.$.i18n.map.MAPVIEWER_SB_FEET="ft";a.$.i18n.map.MAPVIEWER_SB_CENTIMETER="cm";a.$.i18n.map.MAPVIEWER_SB_YARD="yd";a.$.i18n.map.MAPVIEWER_SB_TOTAL_DISTANCE=
"Total Distance";a.$.i18n.map.MAPVIEWER_SB_SUB_DISTANCE="Sub Distance";a.CursorTypes={AUTO:"AUTO",MOVE:"MOVE",POINTER:"POINTER",DEFAULT:"DEFAULT",TEXT:"TEXT",WAIT:"WAIT",NONE:"NONE",CUSTOM:"CUSTOM"};a.LayerTypes={TILE:0,VECTOR:1,EXTERNAL:2,DYNAMIC_TILE:3,WMTS_TILE:4};a.LineCaps={BUTT:"BUTT",ROUND:"ROUND",SQUARE:"SQUARE"};a.LineJoins={MITER:"MITER",ROUND:"ROUND",BEVEL:"BEVEL"};a.GeomTypes={POINT:"Point",MULTIPOINT:"MultiPoint",ORIENTEDPOINT:"OrientedPoint",ORIENTEDMULTIPOINT:"OrientedMultiPoint",LINESTRING:"LineString",
MULTILINESTRING:"MultiLineString",POLYGON:"Polygon",MULTIPOLYGON:"MultiPolygon",CIRCLE:"Circle",RECTANGLE:"Rectangle",GEOMETRYCOLLECTION:"GeometryCollection"};a.Text={FONTSTYLE_NORMAL:"NORMAL",FONTSTYLE_ITALIC:"ITALIC",FONTWEIGHT_NORMAL:"NORMAL",FONTWEIGHT_BOLD:"BOLD",HORIZONTALALIGN_LEFT:"LEFT",HORIZONTALALIGN_CENTER:"CENTER",HORIZONTALALIGN_RIGHT:"RIGHT",VERTICALALIGN_TOP:"TOP",VERTICALALIGN_CENTER:"CENTERV",VERTICALALIGN_BOTTOM:"BOTTOM"};a.PaintTypes={NO_PAINT:0};a.gv=a.gv||{};a.gv.proxyPath="/mapviewer/proxy";
a.gv.setProxyPath=function(e){e&&(a.gv.proxyPath=e)};a.gv.getProxyPath=function(){return a.gv.proxyPath};a.gv.proxyEnabled=!1;a.gv.enableProxy=function(e){null!==e&&(a.gv.proxyEnabled=e)};a.gv.isProxyEnabled=function(){return a.gv.proxyEnabled};a.gv._baseURL=document.location.protocol+"//"+document.location.host+"/mapviewer";a.gv.localbaseURL=function(){return a.gv._baseURL};a.gv.setBaseMapViewerURL=function(e){e&&e.indexOf("/mapviewer")&&0===e.indexOf("http")&&(a.gv._baseURL=e)};a.gv.getBaseMapViewerURL=
function(){return a.gv._baseURL};a.gv.defaultDataSource=null;a.gv._resPath=document.location.protocol+"//"+document.location.host+"/mapviewer/jslib/v2/images/";a.gv._cssResPath=document.location.protocol+"//"+document.location.host+"/mapviewer/jslib/v2/css/";a.gv._protoPath=document.location.protocol+"//"+document.location.host+"/mapviewer/jslib/v2/protobuf/";a.gv.getImgResourcePath=function(){return a.gv._resPath};a.gv.resourcePath=a.gv.getImgResourcePath;a.gv.getCSSResourcePath=function(){return a.gv._cssResPath};
a.gv.getProtoResourcePath=function(){return a.gv._protoPath};a.gv.cssResourcePath=a.gv.getCSSResourcePath;a.gv.setResourcePath=function(e){e&&(0>e.indexOf("/",e.length-1)&&(e+="/"),a.gv._cssResPath=e+"css/",a.gv._resPath=e+"images/",a.gv._protoPath=e+"protobuf/",a.gv.messagePath=e+"messages/",a.control.MapDecoration.setIconsPath(),a.tool.WhiteBoardTool&&a.tool.WhiteBoardTool.setIconsPath())};a.gv._secureHttp=document.location.protocol;"file:"===a.gv._secureHttp&&(a.gv._secureHttp="http:");a.gv.secureHttp=
function(){return a.gv._secureHttp};a.gv.setSecureHttp=function(e){a.gv._secureHttp=e?"https:":"http:"};a.gv.useSecureHTTP=function(e){a.gv._secureHttp=e?"https:":"http:"};a.gv.isSecureHTTPEnabled=function(){return"https:"===a.gv._secureHttp};a.gv.CacheConfig=Array(30);a.gv.infoWindowWidth=180;a.gv.infoWindowHeight=100;a.gv.infoWindowTabsWidth=240;a.gv.infoWindowTabsHeight=130;a.gv.decorationCollapseButtonSizeTouch=24;a.gv.decorationCollapseButtonSizeNoTouch=18;a.gv.unitFactors={SQ_MM:1E-6,SQ_KILOMETER:1E6,
SQ_CENTIMETER:1E-4,SQ_MILLIMETER:1E-6,SQ_CH:404.6856,SQ_FT:.09290304,SQ_IN:6.4516E-4,SQ_LI:.04046856,SQ_CHAIN:404.6856,SQ_FOOT:.09290304,SQ_INCH:6.4516E-4,SQ_LINK:.04046856,SQ_MILE:2589988,SQ_ROD:25.29285,SQ_SURVEY_FOOT:.09290341,SQ_YARD:.8361274,ACRE:4046.856,HECTARE:1E4,PERCH:25.29285,ROOD:1011.714,M:1,METER:1,METRE:1,KM:1E3,KILOMETER:1E3,CM:.01,CENTIMETER:.01,MM:.001,MILLIMETER:.001,MILE:1609.344,NAUT_MILE:1852,SURVEY_FOOT:.3048006096012,FOOT:.3048,"U.S FOOT":.3048,FEET:.3048,INCH:.0254,YARD:.9144,
CHAIN:20.1168,ROD:5.0292,LINK:.201166195,MOD_USFT:.304812253,CL_FT:.304797265,IND_FT:.304799518,LINK_BEN:.201167651,LINK_SRS:.201167651,CHN_BEN:20.1167825,CHN_SRS:20.1167651,IND_YARD:.914398554,SRS_YARD:.914398415,FATHOM:1.8288,SQ_M:1,SQ_METER:1,SQ_KM:1E6,SQ_CM:1E-4};a.gv.toolButtonW=14;a.gv.toolButtonH=14;a.gv.DPI=96;a.gv.getUnitFactor=function(e){if(e)e=e.toUpperCase();else return 0;return a.gv.unitFactors[e]?a.gv.unitFactors[e]:0};a.gv.defaultMarkerStyleWidth=15;a.gv.defaultMarkerStyleHeight=15;
a.gv.defaultMarkerStyle={fill:"#ff2244",stroke:"#ff2244",strokeThickness:1,fillOpacity:.5};a.gv.loadingIcon="o_loading.gif";a.gv.defaultTextStyleConfig={fontSize:12,fill:"#ff0000"};a.gv.labelDisplayOrder=["R","L","B","T"];a.gv.orientedLabelDisplayOrder=["R","L"];a.gv.mapInstanceId=0;a.gv.enableSelfDestroy=!0;a.gv.mapInstances=[];a.gv.mvKeyMap=[];a.gv.clearMapInstanceByDiv=function(e){for(var d=a.gv.mapInstances,f=d.length,g=0;g<f;g++){var h=d[g];if(h&&h.$containerDiv){var l=h.$containerDiv[0];if(l===
e)h.destroyMap();else{for(var t=!1;l&&l.parentNode;)if(l=l.parentNode,l===document.body){t=!0;break}t||h.destroyMap()}}}};a.gv.addMapInstance=function(e,d){a.gv.enableSelfDestroy&&a.gv.clearMapInstanceByDiv(d);a.gv.mapInstances.push(e)};a.gv.addCSTransformFunction=function(e,d,f){a.util.CSTransformUtil.addCSTransformFunction(e,d,f)};a.gv.srs={};a.gv.addSRS=function(e,d,f){a.gv.srs[f]={type:e,unit:d,srid:f}};a.gv.getSRS=function(e){return a.gv.srs[e]};a.gv.clearAllMapInstance=function(){if(a.notNull(a.gv.mapInstances))for(var e=
a.gv.mapInstances;0<e.length;){var d=e.pop();d.over||d.destroyMap()}};a.gv.messagePath="/mapviewer/jslib/v2/messages/";a.gv.msgLoaded=!1;a.gv.loadMessage=function(e){a.gv.msgLoaded=!0;var d="en zh-CN ar cs da de el es fi fr hu it iw ja ko nl no pl pt pt-BR ro ru sk sv th tr zh-TW".split(" ");if(a.isNull(e)||""===e)e=(e=c.navigator.languages?c.navigator.languages[0]:null)||c.navigator.language||c.navigator.browserLanguage||c.navigator.userLanguage;e=e&&-1<d.indexOf(e)?e:e&&2<e.length&&d.indexOf(e.substring(0,
2))?e.substring(0,2):"en";var f=a.gv.messagePath;a.$.i18n.properties({name:"Messages",path:f,mode:"both",async:"true",language:e,callback:function(){"undefined"===typeof MAPVIEWER_9001&&a.util.Logger.warning(null,"Cannot load message files from "+f)}})};a.$(c).on("unload",function(){a.gv.clearAllMapInstance()});a.browser.msie&&(document.msCSSOMElementFloatMetrics=!0);a.gv.getLabel=function(e,d){var f=a.$.i18n.prop(e);d&&(f=f.replace(/\s/g,"\x26nbsp;"));return f};a.gv.setHttpMethod=function(e){e&&
"GET"===e.toUpperCase()?a.gv._httpMethod="GET":a.gv._httpMethod="POST"};a.gv.setHttpMethod("POST");a.gv.isWin8Touch=!1;c.navigator.msMaxTouchPoints&&c.navigator.msPointerEnabled&&(a.gv.isWin8Touch=!0);a.gv.tabIndexEnabled=!0;a.gv.setTabIndexEnabled=function(e){a.gv.tabIndexEnabled=e?!0:!1};a.gv.setLogLevel=function(e){a.isNull(e)||(e=e.toLowerCase(),e=a.util.Logger.LEVELS[e],a.isNull(e)?a.util.Logger.warning(null,"OM.gv.setLogLevel","Invalid log level specified."):a.util.Logger.currentLevel=e)};a.gv.getLogLevel=
function(){return a.isNull(a.util.Logger.currentLevel)?"":a.util.Logger.LEVELS_TEXT[a.util.Logger.currentLevel]};a.gv.showManipulator=!0;a.gv.setShowManipulator=function(e){a.gv.showManipulator=e?!0:!1};a.gv.featureDrag=!0;a.gv.enableFeatureDragging=function(e){a.gv.featureDrag=e?!0:!1};a.gv.featureDragDisabled=function(e){var d="Point"===e.geo.type||"OrientedPoint"===e.geo.type;return a.isNull(e.parentFeature)&&!d&&!a.gv.featureDrag};a.gv.internalLayersEnabled=!0;a.gv.useRTree=!0;a.gv.setUseRTree=
function(e){e&&(a.gv.useRTree=e)};a.gv.getUseRTree=function(){return a.gv.useRTree};a.gv.touchMoveThreshold=5;a.gv.setTouchMoveThreshold=function(e){0<=e&&(a.gv.touchMoveThreshold=e)};a.gv.allowFeaturePointsInteraction=!0;a.gv.MAX_ZOOM="MAX_ZOOM";a.gv.MID_ZOOM="MID_ZOOM";a.gv.pointZoomLevel=a.gv.MID_ZOOM;String.prototype.replaceAll||(String.prototype.replaceAll=function(a,d){return this.split(a).join(d)});a.Graphics=function(e,d){this.div=e;var f=a.$(this.div);this.width=f.width();this.height=f.height();
a.notNull(d)&&(this.hiDPI=d.hiDPI);this.oui=ouilib.createLiveGraphics(this.div,{defaultViewportWidth:this.width,defaultViewportHeight:this.height,hiDPI:this.hiDPI,frameRate:60});this.oui.tooltipManager._properties.cursorOffset=10;this.oui.tooltipManager._properties.dismissDelay=5E3;this.oui.tooltipManager.setHideDelay(0);this.setDefaultTooltipStyle()};a.Graphics.EVENT_CLICK="click";a.Graphics.EVENT_DOUBLE_CLICK="doubleClick";a.Graphics.EVENT_MOUSE_DOWN="mouseDown";a.Graphics.EVENT_MOUSE_UP="mouseUp";
a.Graphics.EVENT_MOUSE_OVER="mouseOver";a.Graphics.EVENT_MOUSE_OUT="mouseOut";a.Graphics.EVENT_MOUSE_LEAVE="mouseLeave";a.Graphics.EVENT_MOUSE_MOVE="mouseMove";a.Graphics.EVENT_MOUSE_DRAG="drag";a.Graphics.TYPE_GROUP=1;a.Graphics.TYPE_IMAGE=2;a.Graphics.TYPE_IMAGE_MARKER=3;a.Graphics.TYPE_SIMPLE_VECTOR_MARKER=4;a.Graphics.TYPE_COMPOUND_VECTOR_MARKER=5;a.Graphics.TYPE_PATH=6;a.Graphics.TYPE_RECTANGLE=7;a.Graphics.TYPE_ELLIPSE=8;a.Graphics.prototype.createGroup=function(e){e=new this.oui.graphics.Group(e);
e.vtype=a.Graphics.TYPE_GROUP;return e};a.Graphics.prototype.setTooltipStyle=function(a){this.oui.tooltipManager.applyStyle(a)};a.Graphics.prototype.getTooltipManager=function(){return this.oui.tooltipManager};a.Graphics.prototype.setDefaultTooltipStyle=function(){var e=new a.style.Text({styleName:"title",fill:"#000000",fontStyle:a.Text.FONTSTYLE_NORMAL,fontWeight:a.Text.FONTWEIGHT_BOLD,fontFamily:"Helvetica Neue",fontSize:11,hAlign:0,vAlign:.5}),d=new a.style.Text({styleName:"header",fill:"#B5B5B5",
fontStyle:a.Text.FONTSTYLE_NORMAL,fontFamily:"Helvetica Neue",fontSize:10,hAlign:1,vAlign:.5}),f=new a.style.Text({styleName:"txt",fill:"#000000",fontStyle:a.Text.FONTSTYLE_NORMAL,fontFamily:"Helvetica Neue",fontSize:10,hAlign:0,vAlign:.5});this.defaultTooltipStyle={background:this.oui.WHITE,border:{stroke:"#3B3B3B",rx:0,ry:0,thickness:4},text:{fill:this.oui.BLACK,fontSize:11},shadow:this.getGraphicFilter({type:"DROPSHADOW",offset:5})};this.currentTooltipStyle={titleStyle:e,headerStyle:d,contentStyle:f,
padding:{top:9,lineBegin:9,bottom:9,lineEnd:9}};this.setTooltipStyle(this.defaultTooltipStyle)};a.Graphics.prototype.getInnerTooltipStyle=function(){return this.currentTooltipStyle};a.Graphics.prototype.storeCustomTooltipTextStyle=function(e){a.notNull(e)&&(a.notNull(e.titleStyle)&&0<Object.getOwnPropertyNames(e.titleStyle).length&&(this.currentTooltipStyle.titleStyle=e.titleStyle),a.notNull(e.headerStyle)&&0<Object.getOwnPropertyNames(e.headerStyle).length&&(this.currentTooltipStyle.headerStyle=
e.headerStyle),a.notNull(e.contentStyle)&&0<Object.getOwnPropertyNames(e.contentStyle).length&&(this.currentTooltipStyle.contentStyle=e.contentStyle))};a.Graphics.prototype.addGroup=function(e,d){a.notNull(d)?d.appendChild(e):this.oui.rootNode.appendChild(e)};a.Graphics.prototype.setCursor=function(e,d){if(a.notNull(this.oui.tree.canvas)){for(var f=this.oui.tree.canvas,g="AUTO";e&&"AUTO"===g;)g=d,e=e.parentNode;f.style.cursor="object"===typeof d?"none":g}else a.notNull(this.oui.tree.svgNode)&&this.oui.tree.svgNode.attr("cursor",
"object"===typeof d?"none":d)};a.Graphics.prototype.drawImage=function(e,d,f){if(!e)return null;var g=f.group;g||(g=this.oui.rootNode);this.setId(g,f);d.x=e.x;d.y=e.y;d.width&&d.height&&(d.preserveAspectRatio=!0);if(f&&f.angle){var h=e.x+d.width/2;e=e.y+d.height/2;f=(new this.oui.geom.Matrix).rotate(f.angle,h,e);d.transform=f}d=new this.oui.graphics.Image(d);g.appendChild(d);d.vtype=a.Graphics.TYPE_IMAGE;return d};a.Graphics.prototype.drawImageMarker=function(a,d,f){f.xOffset&&(a.x+=f.xOffset);f.yOffset&&
(a.y+=f.yOffset);return d&&d.src?(d.width&&(a.x-=d.width/2),d.height&&(a.y-=d.height/2),a=this.drawImage(a,d,f)):null};a.Graphics.prototype.drawVectorMarker=function(e,d,f){f.xOffset&&(e.x+=f.xOffset);f.yOffset&&(e.y+=f.yOffset);f.width&&(e.x-=f.width/2);f.height&&(e.y-=f.height/2);f.transform=(new this.oui.geom.Matrix).translate(e.x,e.y);e=f.xScale?f.xScale:1;var g=f.yScale?f.yScale:1;if(1!=e||1!=g)f.transform=f.transform.scale(e,g);f.angle&&f.transform.rotate(f.angle,f.width/2/e,f.height/2/g);if(d&&
0<d.length){var h,l;e=f.group;1<=d.length&&(f.group=this.createGroup({transform:f.transform}),f.transform=null);h=null;for(g=0;g<d.length;g++){h=d[g].shape;l=d[g].style;l.transform=f.transform;a.isNull(l.fill)&&(l.fill="#ffffff",l.fillOpacity=0);a.notNull(f.gradient)&&(l.fill=f.gradient);var t=h.type;h="path"===t?this.drawPath(h.coords,l,f):"rectangle"===t?this.drawRectangle(h,l,f):this.drawEllipse(h,l,f)}if(e===f.group)return h.vtype=a.Graphics.TYPE_SIMPLE_VECTOR_MARKER,h;this.addGroup(f.group,e);
f.group.vtype=a.Graphics.TYPE_COMPOUND_VECTOR_MARKER;d=f.group;f.group=e;return d}return null};a.Graphics.prototype.drawRectangle=function(e,d,f){if(!e||a.isNull(e.x)||a.isNull(e.y)||a.isNull(e.width)&&a.isNull(e.rx)||a.isNull(e.height)&&a.isNull(e.ry))return null;var g=f.group;g||(g=this.oui.rootNode);this.setId(g,f);a.isNull(d.fill)&&(d.fill=this.oui.NO_PAINT);d.x=e.x;d.y=e.y;a.notNull(e.width)&&(d.width=e.width);a.notNull(e.rx)&&(d.rx=e.rx);a.notNull(e.height)&&(d.height=e.height);a.notNull(e.ry)&&
(d.ry=e.ry);e=new this.oui.graphics.Rectangle(d);e.vtype=a.Graphics.TYPE_RECTANGLE;g.appendChild(e);return e};a.Graphics.prototype.drawEllipse=function(e,d,f){if(!e||a.isNull(e.cx)||a.isNull(e.cy)||a.isNull(e.width)||a.isNull(e.height))return null;var g=f.group;g||(g=this.oui.rootNode);this.setId(g,f);a.isNull(d.fill)&&(d.fill=this.oui.NO_PAINT);d.cx=e.cx;d.cy=e.cy;d.width=e.width;d.height=e.height;var h=new this.oui.graphics.Ellipse(d);h.vtype=a.Graphics.TYPE_ELLIPSE;g.appendChild(h);a.notNull(d.inset)&&
(h=a.isNull(d.insetThickness)?1.25/f.xScale:d.insetThickness,f=a.isNull(d.strokeThickness)?1.75/f.xScale:d.strokeThickness,h=new this.oui.graphics.Ellipse({fill:this.oui.NO_PAINT,cx:e.cx,cy:e.cy,width:e.width-2*f-h,height:e.height-2*f-h,stroke:d.inset,strokeThickness:h}),h.vtype=a.Graphics.TYPE_ELLIPSE,g.appendChild(h));return h};a.Graphics.prototype.drawPath=function(e,d,f){for(var g=new this.oui.graphics.PathCommands,h=0,l=e.length;h<l;h++)this.drawSegment(g,e[h],f);e=f.group;e||(e=this.oui.rootNode);
this.setId(e,f);a.isNull(d.fill)&&(d.fill=this.oui.NO_PAINT);d.pathCommands=g;d=new this.oui.graphics.Path(d);e.appendChild(d);d.vtype=a.Graphics.TYPE_PATH;return d};a.Graphics.prototype.drawText=function(a,d){var f=d.group;f||(f=this.oui.rootNode);var g=new this.oui.graphics.Text(a);f.appendChild(g);g.vtype="TEXT";return g};a.Graphics.prototype.attachEventListener=function(e,d,f){a.isNull(f)&&(f=this.oui.rootNode);f.addEventListener(e,d)};a.Graphics.prototype.detachEventListener=function(e,d,f){a.isNull(f)&&
(f=this.oui.rootNode);f.removeEventListener(e,d)};a.Graphics.prototype.getLeftTop=function(a){return a.getTranslation()};a.Graphics.prototype.setLeftTop=function(a,d,f){return a.setTranslation(d,f)};a.Graphics.prototype.setImageMarker=function(a,d,f){if(f){if(d){var g=a.getWidth(),h=a.getHeight();f.width&&(g=f.width);f.height&&(h=f.height);f.x=d.x-g/2;f.y=d.y-h/2}else f.width&&(f.x=a.getX()-(f.width-a.getWidth())/2),f.height&&(f.y=a.getY()-(f.height-a.getHeight())/2);a.applyStyle(f)}else d&&(d.x-=
a.getWidth()/2,d.y-=a.getHeight()/2,a.applyStyle(d))};a.Graphics.prototype.setImage=function(a,d,f){f?(d&&(f.x=d.x,f.y=d.y),f.width&&f.height&&(f.preserveAspectRatio=!0),a.applyStyle(f)):d&&a.applyStyle(d)};a.Graphics.prototype.setRectangle=function(e,d,f){e.vtype==a.Graphics.TYPE_RECTANGLE&&(f?(d&&(f.x=d.x,f.y=d.y,a.notNull(d.width)?f.width=d.width:f.rx=d.rx,a.notNull(d.height)?f.height=d.height:f.ry=d.ry),e.applyStyle(f)):e.applyStyle(d))};a.Graphics.prototype.setEllipse=function(e,d,f){e.vtype===
a.Graphics.TYPE_ELLIPSE&&(f?(d&&(a.notNull(d.cx)&&(f.cx=d.cx),a.notNull(d.cy)&&(f.cy=d.cy),a.notNull(d.width)&&(f.width=d.width),a.notNull(d.height)&&(f.height=d.height)),e.applyStyle(f)):d&&e.applyStyle(d))};a.Graphics.prototype.setPath=function(e,d,f){if(e.vtype===a.Graphics.TYPE_PATH){var g=null;if(d)for(var g=new this.oui.graphics.PathCommands,h=0,l=d.length;h<l;h++)this.drawSegment(g,d[h]);f?(f.pathCommands=g,e.applyStyle(f)):g&&e.applyStyle({pathCommands:g})}};a.Graphics.prototype.remove=function(a){a&&
a.parentNode&&a.parentNode.removeChild(a)};a.Graphics.prototype.removeAll=function(){this.oui.rootNode.removeChildren()};a.Graphics.prototype.bringForward=function(a){a.bringForward()};a.Graphics.prototype.bringToTop=function(a){a.bringToFront()};a.Graphics.prototype.sendBackward=function(a){a.sendBackward()};a.Graphics.prototype.sendToBottom=function(a){a.sendToBack()};a.Graphics.prototype.getDisplayIndex=function(a){return a.parentNode?a.parentNode.getChildIndex(a):-1};a.Graphics.prototype.setDisplayIndex=
function(a,d){a.parentNode&&a.parentNode.setChildIndex(a,d)};a.Graphics.prototype.applyStyle=function(a,d){a.applyStyle(d)};a.Graphics.prototype.drawSegment=function(a,d,f){if(d&&d.length&&!(2>d.length)&&!isNaN(d[0])&&!isNaN(d[1]))if(f&&f.scTransform)f.genThreshold||(f.genThreshold=1),this.drawSegmentWithTransform(a,d,f);else{a._safeMoveTo(Math.round(d[0]),Math.round(d[1]));f=2;for(var g=d.length;f<g;f+=2)a._safeLineTo(Math.round(d[f]),Math.round(d[f+1]));d[0]==d[g-2]&&d[1]==d[g-1]&&a.closePath()}};
a.Graphics.prototype.drawSegmentWithTransform=function(a,d,f){var g=f.scTransform,h=g.transformPoint(d[0],d[1]),l=h.x,t=h.y;a._safeMoveTo(Math.round(h.x),Math.round(h.y));f=f.genThreshold;for(var F=2,I=d.length-2;F<I;F+=2){var h=g.transformPoint(d[F],d[F+1]),P=Math.round(h.x),h=Math.round(h.y),aa=P-l,U=h-t;aa>f||aa<-f||U>f||U<-f||a._safeLineTo(P,h)}h=g.transformPoint(d[I-2],d[I-1]);a._safeLineTo(Math.round(h.x),Math.round(h.y))};a.Graphics.prototype.setId=function(e,d){a.isNull(d.id)&&(d.id=e.length);
d.name=d.id?"path_"+d.id:"path_"+e.length};a.Graphics.prototype.setImageStyleLocation=function(a,d){a.x=d.x;a.y=d.y;a.width&&a.height&&(a.preserveAspectRatio=!0)};a.Graphics.prototype.setImageStyle=function(a){a.width&&a.height&&(a.preserveAspectRatio=!0)};a.Graphics.prototype.zoom=function(e,d){e.curScaleX=d.beginValue;e.curScaleY=d.beginValue;e.zoomPointXOffset=d.zoomPointXOffset;e.zoomPointYOffset=d.zoomPointYOffset;var f=new this.oui.anim.AnimateStyle({targetNode:e,beginValue:d.beginValue,endValue:d.endValue,
dur:d.duration,interpolator:function(f,h,l){f=(h-f)*l+f;l=h=1;var t=0,F=0;a.notNull(d.zoomPointXOffset)&&(t=-(e.zoomPointXOffset/f*e.curScaleX)+e.zoomPointXOffset,h=f/e.curScaleX);a.notNull(d.zoomPointYOffset)&&(F=-(e.zoomPointYOffset/f*e.curScaleY)+e.zoomPointYOffset,l=f/e.curScaleX);e.scale(h,l);e.translate(-t,-F);e.curScaleX=f;e.curScaleY=f}});d.endListener&&f.addEventListener(this.oui.EventTypes.END,function(a){d.endListener(a)});f.beginAt(0)};a.Graphics.prototype.setVisible=function(a,d){a.setVisibility(d)};
a.Graphics.prototype.isVisible=function(a){return a.getVisibility()};a.Graphics.prototype.clearGroup=function(a){a&&a.removeChildren()};a.Graphics.prototype.getGraphicFilter=function(a){if(a&&"DROPSHADOW"==a.type)return new this.oui.filters.DropShadow({opacity:a.opacity,color:a.color,offset:a.offset,radius:a.radius,knockout:a.knockout,angle:a.angle});if(a&&"BLUR"==a.type)return new this.oui.filters.Blur;if(a&&"GLOW"==a.type)return new this.oui.filters.Glow({color:"#ffff00",strength:10})};a.Graphics.prototype.setRotationTransform=
function(e,d){if(e&&d){a.isNull(e.width)&&(e.width=0);a.isNull(e.height)&&(e.height=0);var f=e.x+e.width/2,g=e.y+e.height/2,f=(new this.oui.geom.Matrix).rotate(d,f,g);e.transform=f}return e};a.Graphics.prototype.getWidthHeight=function(e){if(a.isNull(e))return null;e=e.getLocalBounds();return{w:e.width,h:e.height}};a.Graphics.prototype.setOpacity=function(a,d){a&&a.setOpacity(d)};a.Graphics.prototype.getTextSize=function(a,d){var f;f=0<a.indexOf("\n")?this.createTextBlock(a,d,0,0).node:this.createTextNode(a,
d,0,0);this.oui.rootNode.appendChild(f);f.setDisplay(!1);var g=this.getWidthHeight(f);this.remove(f);return g};a.Graphics.prototype.createTextNode=function(a,d,f,g){return d?this.oui.load({type:"text",textValue:a,fontFamily:d.fontFamily,fontSize:d.fontSize,fontStyle:d.fontStyle,fontWeight:d.fontWeight,fill:d.fill,x:f,y:g,textAlign:d.textAlign}):this.oui.load({type:"text",textValue:a,x:f,y:g})};a.Graphics.prototype.drawPieChart=function(e,d,f,g){if(!e||a.isNull(e.cx)||a.isNull(e.cy)||a.isNull(e.width)||
a.isNull(e.height)||a.isNull(d)||0===d.length||a.isNull(f)||f.length!==d.length)return null;var h=g.offsetAngle?g.offsetAngle:0,l=[];l.push(0);var t=0,F=e.width/2,I=e.height/2,P=g.group;P||(P=this.oui.rootNode);this.setId(P,g);var aa=this.createGroup();this.addGroup(aa,P);for(P=0;P<d.length;P++)t+=d[P],l.push(t);for(P=0;P<d.length;P++){var U=g.orientation&&2==g.orientation?l[P]/t*360+h:-(l[P]/t*360+h),ca=g.orientation&&2==g.orientation?l[P+1]/t*360+h:-(l[P+1]/t*360+h),ua=Math.round(d[P]/t*1E4)/100+
"%",U=this.drawSector(e.cx,e.cy,U,ca,F,I,{fill:f[P],stroke:g.stroke,strokeThickness:g.strokeThickness},g.plugable,g.description&&g.description[P]?g.description[P]+" \n value:"+d[P]+" \n percent:"+ua:null);aa.appendChild(U);U.vtype=a.Graphics.TYPE_PATH}aa.applyStyle({filter:g.filter});return aa};a.Graphics.prototype.drawSector=function(e,d,f,g,h,l,t,F,I){a.isNull(t.fill)&&(t.fill=this.oui.NO_PAINT);t.cx=e;t.cy=d;t.maxAngle=g;t.minAngle=f;t.minRadius=0;t.maxRadius=h;e=new this.oui.graphics.DiskSector(t);
if(!F||F&&!0===F)this.attachEventListener(a.Graphics.EVENT_MOUSE_OVER,function(a){a.target.parentNode.bringToFront();a.target.bringToFront();a.target.applyStyle({maxRadius:1.1*h});for(var e=a.target.parentNode.childrenCount,d=0;d<e;d++)a.target.parentNode.getChildAt(d)!==a.target&&a.target.parentNode.getChildAt(d).applyStyle({fillOpacity:.5})},e),this.attachEventListener(a.Graphics.EVENT_MOUSE_OUT,function(a){a.target.applyStyle({maxRadius:h});for(var e=a.target.parentNode.childrenCount,d=0;d<e;d++)a.target.parentNode.getChildAt(d).applyStyle({fillOpacity:1})},
e),e.applyStyle({tooltip:I});return e};a.Graphics.prototype.drawBarChart=function(e,d,f,g){if(!e||a.isNull(e.cx)||a.isNull(e.cy)||a.isNull(e.width)||a.isNull(e.height)||a.isNull(d)||0===d.length||a.isNull(f)||f.length!==d.length)return null;var h=g.group;h||(h=this.oui.rootNode);this.setId(h,g);var l=this.createGroup();this.addGroup(l,h);for(var t=h=0,F=0;F<d.length;F++)t+=Math.abs(d[F]),h<Math.abs(d[F])&&(h=Math.abs(d[F]));for(var F=e.height,I=e.width/d.length,P,aa=function(a){a.target.parentNode.bringToFront();
a.target.bringToFront();a.target.scale(1.1,1.1);for(var e=a.target.parentNode.childrenCount,d=0;d<e;d++)a.target.parentNode.getChildAt(d)!=a.target&&a.target.parentNode.getChildAt(d).applyStyle({fillOpacity:.4})},U=function(a){a.target.scale(1/1.1,1/1.1);for(var e=a.target.parentNode.childrenCount,d=0;d<e;d++)a.target.parentNode.getChildAt(d).applyStyle({fillOpacity:1})},ca=0;ca<d.length;ca++){P=d[ca]/h*F;P=this.drawRectangle({x:0,y:0>P?0:-P,width:I,height:Math.abs(P)},{fill:f[ca],stroke:g.stroke,
strokeThickness:g.strokeThickness},{group:l});P.translate(I*ca,0);if(!g.plugable||g&&!0===g.plugable)this.attachEventListener(a.Graphics.EVENT_MOUSE_OVER,aa,P),this.attachEventListener(a.Graphics.EVENT_MOUSE_OUT,U,P);var ua=Math.round(Math.abs(d[ca])/t*1E4)/100+"%";P.applyStyle({tooltip:g.description&&g.description[ca]?g.description[ca]+" \n value:"+d[ca]+" \n percent:"+ua:null})}d=this.getWidthHeight(l);this.setLeftTop(l,e.cx-d.w/2,e.cy+(2*F-d.h)/2);l.applyStyle({filter:g.filter});return l};a.Graphics.prototype.getScaleValue=
function(e){if(a.isNull(e))return null;e=e.getTransformMatrix();if(!a.isNull(e)){var d=e.exportToJSON();e=Math.sqrt(d[0]*d[0]+d[1]*d[1]);d=Math.sqrt(d[2]*d[2]+d[3]*d[3]);return{scaleX:e,scaleY:d}}};a.Graphics.prototype.clearToolTips=function(){this.oui.tooltipManager.hideTooltip()};a.Graphics.prototype.createTextBlock=function(e,d,f,g,h,l){e={textValue:e,maxWidth:h,maxLines:l,x:f,y:g,textAlign:a.Text.HORIZONTALALIGN_CENTER};d&&(e.fontFamily=d.fontFamily,e.fontSize=d.fontSize,e.fontStyle=d.fontStyle,
e.fontWeight=d.fontWeight,e.fill=d.fill);d=new this.oui.graphics.TextBlock(e);d.setDisplay(!1);this.oui.rootNode.appendChild(d);e=d.getLocalBounds();this.remove(d);d.setDisplay(!0);return{node:d,w:e.width,h:e.height}};a.Graphics.prototype.cloneText=function(e){if(e.hasChildNodes()){for(var d=this.createGroup(),f=0;f<e.childrenCount;f++){var g=this.cloneText(e.getChildAt(f));d.appendChild(g)}return d}if(e.vtype===a.Graphics.TYPE_IMAGE)return e={src:e.src(),x:e.x(),y:e.y(),width:e.width(),height:e.height()},
e=new this.oui.graphics.Image(e),e.vtype=a.Graphics.TYPE_IMAGE,e;try{var d=e.getTextValue(),f=e.getTransform(),g=e.getFontStyle(),h=e.getFontFamily(),l=e.getFontWeight(),t=e.getFontSize(),F=e.getX(),I=e.getY(),P=e.getFill();if(e.getMaxWidth){var aa=e.getMaxLines(),U=e.getMaxWidth();return new this.oui.graphics.TextBlock({textValue:d,maxWidth:U,maxLines:aa,x:F,y:I,textAlign:a.Text.HORIZONTALALIGN_CENTER,fontFamily:h,fontSize:t,fontStyle:g,fontWeight:l,fill:P,transform:f})}return this.oui.load({type:"text",
textValue:d,fontFamily:h,fontSize:t,fontStyle:g,fontWeight:l,fill:P,transform:f,x:F,y:I})}catch(ca){return null}};a.Graphics.prototype.createFillPattern=function(a){return new this.oui.style.PatternPaint({src:a})};a.UndoManager=a.Class.extend({initialize:function(){this.reset()},reset:function(){this.index=0;this.undoStack=[]},addEdit:function(a){this.undoStack[this.index++]=a;this.undoStack.splice(this.index);return this.index-1},undo:function(){try{var e=0;do{var d=this.editToUndo();d.undo();this.index--;
d.type&&(d.type===a.UndoManager.ENDBLOCK?e++:d.type===a.UndoManager.STARTBLOCK&&e--)}while(0<e)}catch(f){a.util.Logger.alert("MAPVIEWER_9021","OM.UndoManager.undo",f.message)}},redo:function(){try{var e=0;do{var d=this.editToRedo();d.redo();this.index++;d.type&&(d.type===a.UndoManager.ENDBLOCK?e--:d.type===a.UndoManager.STARTBLOCK&&e++)}while(0<e)}catch(f){a.util.Logger.alert("MAPVIEWER_9021","OM.UndoManager.redo",f.message)}},editToUndo:function(){return this.undoStack[this.index-1]},editToRedo:function(){return this.undoStack[this.index]},
canUndo:function(){var a=this.editToUndo();try{return a&&a.canUndo()}catch(d){throw d;}},canRedo:function(){var a=this.editToRedo();try{return a&&a.canRedo()}catch(d){throw d;}},canUndoOrRedo:function(){return this.canRedo()||this.canUndo()},trimEdits:function(a,d){a=a||0;d=d||this.undoStack.length;var f=d-a,g=this.undoStack.splice(a,f),h=[],l=0,t;for(t in this.undoStack)h[l++]=this.undoStack[t];this.undoStack=h;this.index>=d?this.index-=f:this.index>=a&&(this.index=a);return g},getRedoPresentationName:function(){var a=
this.editToRedo();try{return a.getPresentationName()}catch(d){throw d;}},getUndoOrRedoPresentationName:function(){var e=this.getUndoPresentationName();a.isNull(e)&&(e=this.getRedoPresentationName());return e},getUndoPresentationName:function(){var a=this.editToUndo();try{return a.getPresentationName()}catch(d){throw d;}},startChangeBlock:function(e){return this.addEdit(new a.UndoManager.SpecialEdit(e||"start change block",a.UndoManager.STARTBLOCK))},endChangeBlock:function(e){return this.addEdit(new a.UndoManager.SpecialEdit(e||
"end change block",a.UndoManager.ENDBLOCK))},destroy:function(){this.undoStack=this.index=b},print:function(){for(var a="Undo stack:\n",d=this.undoStack.length,f=0;f<d;f++){var g=this.undoStack[f],a=f===this.index?a+"\x3e":a+" ",a=a+("["+f+"] ");try{a+=g.getPresentationName()}catch(h){a+=h}a+="\n"}return a}});a.UndoManager.SpecialEdit=a.Class.extend({initialize:function(a,d){this.name=a;this.type=d},canUndo:function(){return!0},canRedo:function(){return!0},undo:function(){},redo:function(){},getPresentationName:function(){return this.name}});
a.UndoManager.STARTBLOCK="START_CHANGE_BLOCK";a.UndoManager.ENDBLOCK="END_CHANGE_BLOCK";a.proj.ProjUtil=a.proj.ProjUtil||{};a.proj.ProjUtil.EPSLN=1E-10;a.proj.ProjUtil.TWO_PI=2*Math.PI;a.proj.ProjUtil.LONG_MAX=Math.pow(2,32)+1;a.proj.ProjUtil.DBLLONG=461168601E10;a.proj.ProjUtil.RADIAN=Math.PI/180;a.proj.ProjUtil.DEGREE=180/Math.PI;a.proj.ProjUtil.radians=function(e){return e*a.proj.ProjUtil.RADIAN};a.proj.ProjUtil.degrees=function(e){return e*a.proj.ProjUtil.DEGREE};a.proj.ProjUtil.adjustLon=function(a){for(;-180>
a;)a+=360;for(;180<a;)a-=360;return a};a.proj.Albers=function(e){this.name=e.name||"ALBERS CONICAL EQUAL-AREA";var d=a.proj.ProjUtil,f=d.radians(e.standardParallel_1),g=d.radians(e.standardParallel_2),h=d.radians(e.latOrigin),l=d.radians(e.lonCenter),t=e.rMajor||6378206.4,F=.5*(Math.sin(f)+Math.sin(g));e=Math.cos(f);var I=e*e+2*F*Math.sin(f),P=Math.sqrt(I-2*F*Math.sin(h))/F;return{forward:function(a,e){var f=F*(d.radians(a)-l),g=Math.sqrt(I-2*F*Math.sin(d.radians(e)))/F;return{x:g*Math.sin(f)*t,y:(P-
g*Math.cos(f))*t}},inverse:function(a,e){a/=t;e/=t;var f=Math.atan(a/(P-e)),g=Math.sqrt(a*a+Math.pow(P-e,2)),f=d.degrees(l+f/F),g=d.degrees(Math.asin((I-g*g*F*F)/(2*F)));return{x:f,y:g}}}};a.proj.ablers_mainland=new a.proj.Albers({standardParallel_1:29.5,standardParallel_2:45.5,lonCenter:-96,latOrigin:23});a.proj.albers_hawaii=new a.proj.Albers({standardParallel_1:8,standardParallel_2:18,lonCenter:-160,latOrigin:20});a.proj.albers_hawaii.forward2=function(a){a.x-=12E5;a.y+=4E5;return a};a.proj.albers_hawaii.inverse2=
function(a,d){return{x:a+12E5,y:d-4E5}};a.proj.albers_alaska=new a.proj.Albers({standardParallel_1:55,standardParallel_2:65,lonCenter:-160,latOrigin:60});a.proj.albers_alaska.forward2=function(a){a.x=.4*a.x-22E5;a.y=.4*a.y+4E5;return a};a.proj.albers_alaska.inverse2=function(a,d){return{x:(a+22E5)/.4,y:(d-4E5)/.4}};a.proj.albers_puertorico=new a.proj.Albers({standardParallel_1:8,standardParallel_2:18,lonCenter:-60,latOrigin:10});a.proj.AlbersUSA=function(){var e=a.proj.albers_alaska,d=a.proj.albers_hawaii,
f=a.proj.albers_puertorico,g=a.proj.ablers_mainland;return{forward:function(a,l){var t=50<l?e:-140>a?d:21>l?f:g,F=t.forward(a,l);return t.forward2?t.forward2(F):F},inverse:function(a,f){var t=null,F=-145E4>a&&93E4>f?e:-65E4>a&&-125E4<a&&66E4>f?d:g;return F.inverse2?(t=F.inverse2(a,f),F.inverse(t.x,t.y)):F.inverse(a,f)}}}();a.proj.Robinson=function(e){var d=a.proj.ProjUtil,f=[[1,0],[.9986,.062],[.9954,.124],[.99,.186],[.9822,.248],[.973,.31],[.96,.372],[.9427,.434],[.9216,.4958],[.8962,.5571],[.8679,
.6176],[.835,.6769],[.7986,.7346],[.7597,.7903],[.7186,.8435],[.6732,.8936],[.6213,.9394],[.5722,.9761],[.5322,1],[.5322,1]],g=0;try{g=parseInt(e,10)||0,g=d.adjustLon(g)}catch(h){}return{forward:function(a,e){var h,I,P;a=d.adjustLon(a);a-=g;a=d.adjustLon(a);90<Math.abs(e)&&(e=90*(0<e?1:-1));h=parseInt(Math.abs(e)/5,10);I=Math.abs(e)/5-h;a=d.radians(a);e=d.radians(e);P=f[h][0]+I*(f[h+1][0]-f[h][0]);h=f[h][1]+I*(f[h+1][1]-f[h][1]);h*=8625154.6651;0>e&&(h=-h);return{x:5413124.8719*P*a,y:h}},inverse:function(a,
e){var h,I,P;h=0;if(8625154.6651<=Math.abs(e))I=90,h=f[18][0];else{I=Math.abs(e/8625154.6651);for(P=0;19>P;P++)if(f[P+1][1]>I){h=P;break}P=(I-f[h][1])/(f[h+1][1]-f[h][1]);I=5*(h+P);h=f[h][0]+P*(f[h+1][0]-f[h][0])}h=d.degrees(a/(5413124.8719*h))+g;h=d.adjustLon(h);0>e&&(I=-I);return{x:h,y:I}}}};a.proj.Winkel3=function(e){var d=a.proj.ProjUtil,f=Math.PI/2,g=0;try{g=parseInt(e,10)||0,g=d.adjustLon(g)}catch(h){g=0}var l=function(a){return 1<a?0:-1>a?Math.PI:Math.acos(a)};return{forward:function(a,e){a=
d.adjustLon(a);a-=g;a=d.adjustLon(a);a=d.radians(a);e=d.radians(e);var h;h=a;var P=e,aa=Math.cos(P),U;U=(U=l(aa*Math.cos(h/=2)))?U/Math.sin(U):1;h=[2*aa*Math.sin(h)*U,Math.sin(P)*U];return{x:(h[0]+a/f)/2*6378137,y:(h[1]+e)/2*6378137}},inverse:function(a,e){a/=6378137;e/=6378137;var h=a,P=e,aa=25,U=0,ca,ua;do{var Oa=Math.cos(P),Va=Math.sin(P),Jb=Math.sin(2*P),b=Va*Va,ub=Oa*Oa,Ab=Math.sin(h),rb=Math.cos(h/2),Bb=Math.sin(h/2),Fb=Bb*Bb,Ea=(ua=1-ub*rb*rb)?l(Oa*rb)*Math.sqrt(U=1/ua):U=0;ua=.5*(2*Ea*Oa*
Bb+h/f)-a;var Ha=.5*(Ea*Va+P)-e,Ia=.5*U*(ub*Fb+Ea*Oa*rb*b)+.5/f;ca=U*(Ab*Jb/4-Ea*Va*Bb);Va=.125*U*(Jb*Bb-Ea*Va*ub*Ab);b=.5*U*(b*rb+Ea*Fb*Oa)+.5;Oa=ca*Va-b*Ia;ca=(Ha*ca-ua*b)/Oa;ua=(ua*Va-Ha*Ia)/Oa;h-=ca;P-=ua}while((1E-6<Math.abs(ca)||1E-6<Math.abs(ua))&&0<--aa);h=d.degrees(h)+g;h=d.adjustLon(h);P=d.degrees(P);return{x:h,y:P}}}};a.util.Logger=a.util.Logger||{};a.util.Logger.LEVELS={finest:0,finer:1,fine:2,info:3,config:4,warning:5,severe:6};a.util.Logger.LEVELS_TEXT={0:"finest",1:"finer",2:"fine",
3:"info",4:"config",5:"warning",6:"severe"};a.util.Logger.currentLevel=a.util.Logger.LEVELS.warning;a.util.Logger.NO_ALERT_BOX=!1;a.util.Logger._log=function(a){"object"===typeof console?console.log(a):"object"===typeof opera?opera.postError(a):"object"===typeof java&&"object"===typeof java.lang&&java.lang.System.out.println(a)};a.util.Logger.finest=function(e,d,f){a.util.Logger.LEVELS.finest>=a.util.Logger.currentLevel&&a.util.Logger._log("[FINEST]  "+a.util.Logger._mix(e,d,f))};a.util.Logger.finer=
function(e,d,f){a.util.Logger.LEVELS.finer>=a.util.Logger.currentLevel&&a.util.Logger._log("[FINER]  "+a.util.Logger._mix(e,d,f))};a.util.Logger.fine=function(e,d,f){a.util.Logger.LEVELS.fine>=a.util.Logger.currentLevel&&a.util.Logger._log("[FINE]  "+a.util.Logger._mix(e,d,f))};a.util.Logger.info=function(e,d,f){a.util.Logger.LEVELS.info>=a.util.Logger.currentLevel&&a.util.Logger._log("[INFO]  "+a.util.Logger._mix(e,d,f))};a.util.Logger.config=function(e,d,f){a.util.Logger.LEVELS.config>=a.util.Logger.currentLevel&&
a.util.Logger._log("[CONFIG]  "+a.util.Logger._mix(e,d,f))};a.util.Logger.warning=function(e,d,f){a.util.Logger.LEVELS.warning>=a.util.Logger.currentLevel&&a.util.Logger._log("[WARNING]  "+a.util.Logger._mix(e,d,f))};a.util.Logger.severe=function(e,d,f){a.util.Logger.LEVELS.severe>=a.util.Logger.currentLevel&&a.util.Logger._log("[SEVERE]  "+a.util.Logger._mix(e,d,f))};a.util.Logger.alert=function(e,d,f){e=a.util.Logger._mix(e,d,f);a.util.Logger._log("[ALERT]  "+e);a.util.Logger.errorHandler?a.util.Logger.errorHandler(e):
a.util.Logger.NO_ALERT_BOX||alert(e)};a.util.Logger.throwErr=function(e,d,f){f=a.util.Logger._mix(e,d,f);f=Error(f);f.stack&&a.util.Logger.warning(e,d,f.stack);throw f;};a.util.Logger._mix=function(e,d,f){var g=null;e&&(g=a.$.i18n.prop(e),g=g=="["+e+"]"?a.Messages.getErrorMessage(e):e+":"+g);d&&(g=g?g+("\n    "+a.Messages.getString("Source")+": "+d):a.Messages.getString("Source")+": "+d);f&&(g=g?g+("\n    "+f):f);return g};a.util.ScreenTransform=function(a,d){this.dw=a;this.sw=d;this.sx=d.w/a.w;this.sy=
-d.h/a.h;this.tx=-a.x*this.sx+d.x;this.ty=-a.y*this.sy+d.y+d.h;this.xtr=a.w/d.w;this.ytr=a.h/d.h;this.rsx=1/this.sx;this.rsy=1/this.sy;this.rtx=-d.x*this.rsx+a.x;this.rty=-d.y*this.rsy+a.y+a.h};a.util.ScreenTransform.prototype.toScreenPoint=function(a,d){var f={};f.x=Math.round(a*this.sx+this.tx);f.y=Math.round(d*this.sy+this.ty);return f};a.util.ScreenTransform.prototype.toMapDataPoint=function(a,d){var f={};f.x=a*this.rsx+this.rtx;f.y=d*this.rsy+this.rty;return f};a.util.ScreenTransform.prototype.toScreenXLength=
function(a){return a*this.sx};a.util.ScreenTransform.prototype.toScreenYLength=function(a){return-a*this.sy};a.util.ScreenTransform.prototype.transformSegment=function(e,d,f){a.isNull(f)&&(f=2);if(!e.length||2>=e.length)return null;var g=d*this.xtr;d*=this.ytr;var h=[],l=e[0],t=e[1],F=l,I=t,l=Math.round(l*this.sx+this.tx),t=Math.round(t*this.sy+this.ty);h.push(l);h.push(t);for(var P=f,aa=e.length;P<aa;P+=f)if(l=e[P],t=e[P+1],Math.abs(l-F)>g||Math.abs(t-I)>d)F=l,I=t,l=Math.round(l*this.sx+this.tx),
t=Math.round(t*this.sy+this.ty),h.push(l,t);if(2>=h.length)return null;e[0]!==e[aa-2]||e[1]!==e[aa-1]||h[0]===h[h.length-2]&&h[1]===h[h.length-1]||h.push(h[0],h[1]);return h};a.util.ScreenTransform.getScreenCoordinates=function(a,d,f,g,h,l,t,F,I){return{x:(F-d)*l/(g-d)-a.divLeft,y:(h-I)*t/(h-f)-a.divTop}};a.util.ScreenTransform.prototype.toHeatMapPoint=function(a,d,f,g,h){var l={};l.x=Math.round((a*this.sx+this.tx-f)/h);l.y=Math.round((d*this.sy+this.ty-g)/h);return l};a.util.ScreenTransform.prototype.transformHeatMapSegment=
function(e,d,f,g,h,l){a.isNull(f)&&(f=2);if(!e.length||2>=e.length)return null;var t=d*this.xtr;d*=this.ytr;var F=[],I=e[0],P=e[1],aa=I,U=P,I=Math.round((I*this.sx+this.tx-g)/l),P=Math.round((P*this.sy+this.ty-h)/l);F.push(I);F.push(P);for(var ca=f,ua=e.length;ca<ua;ca+=f)if(I=e[ca],P=e[ca+1],Math.abs(I-aa)>t||Math.abs(P-U)>d)aa=I,U=P,I=Math.round(I*this.sx+this.tx),P=Math.round(P*this.sy+this.ty),F.push((I-g)/l,(P-h)/l);if(2>=F.length)return null;e[0]!==e[ua-2]||e[1]!==e[ua-1]||F[0]===F[F.length-
2]&&F[1]===F[F.length-1]||F.push(F[0],F[1]);return F};a.util.GeomUtil=a.util.GeomUtil||{};a.util.GeomUtil.earthRadius=6372795;a.util.GeomUtil.distance=function(a,d,f,g){return Math.sqrt(Math.pow(f-a,2)+Math.pow(g-d,2))};a.util.GeomUtil.pointLineDistance=function(a,d,f,g,h,l){var t=g-l,F=h-f;return Math.abs(t*a+F*d+(f*l-g*h))/Math.sqrt(t*t+F*F)};a.util.GeomUtil.pointSegmentDistance=function(e,d,f,g,h,l){var t=a.util.GeomUtil.distance(e,d,f,g),F=a.util.GeomUtil.distance(e,d,h,l),I=a.util.GeomUtil.distance(f,
g,h,l);if(0===I)return t;I=((e-f)*(h-f)+(d-g)*(l-g))/(I*I);return 0>I||1<I?Math.min(t,F):a.util.GeomUtil.pointLineDistance(e,d,f,g,h,l)};a.util.GeomUtil.pointInRect=function(a,d,f,g,h,l){return a<=h&&a>=f&&d<=l&&d>=g};a.util.GeomUtil.pointInPolygon=function(a,d,f,g,h){var l,t,F=0;l=0;for(t=f-1;l<f;t=l++)h[l]>d!=h[t]>d&&a<(g[t]-g[l])*(d-h[l])/(h[t]-h[l])+g[l]&&(F=!F);return F};a.util.GeomUtil.getPointAtBearing=function(e,d,f,g){d=a.util.GeomUtil.getRadiansFromLatLon(e,d);e=d.x;d=d.y;var h=f/a.util.GeomUtil.earthRadius;
f=Math.asin(Math.sin(d)*Math.cos(h)+Math.cos(d)*Math.sin(h)*Math.cos(g));g=e+Math.atan2(Math.sin(g)*Math.sin(h)*Math.cos(d),Math.cos(h)-Math.sin(d)*Math.sin(f));return a.util.GeomUtil.getLatLonFromRadians(g,f)};a.util.GeomUtil.getRadiansFromLatLon=function(a,d){for(;-180>a;)a+=360;for(;180<a;)a-=360;a=a*Math.PI/180;d=d*Math.PI/180;return{x:a,y:d}};a.util.GeomUtil.getLatLonFromRadians=function(a,d){a=180*a/Math.PI;d=180*d/Math.PI;return{x:a,y:d}};a.util.GeomUtil.densifyOrdinates=function(a,d){if(!a||
4>a.length)return a;for(var f=[],g=0;g<a.length-2;g+=2){var h=a[g],l=a[g+1],t=a[g+2]-h,F=a[g+3]-l;f.push(h);f.push(l);var I=Math.ceil(Math.abs(t)/d),P=Math.ceil(Math.abs(F)/d),I=Math.max(I,P);if(0<I)for(t=1*t/I,F=1*F/I,P=0;P<I-1;P++)h+=t,l+=F,f.push(h),f.push(l)}f.push(a[a.length-2]);f.push(a[a.length-1]);return f};a.util.GeomUtil.SimplifyCoordinates=function(a){for(var d=a.length,f=a[0],g=a[1],h=[f,g],l=2;l<d;l+=2)if(1<=Math.abs(f-a[l])||1<=Math.abs(g-a[l+1]))f=a[l],g=a[l+1],h.push(f),h.push(g);
return h};a.util.GeomUtil.getLength=function(e,d,f){var g=e?e.type:"",h=e.srid,l=null;if("LineString"!==g&&"MultiLineString"!==g&&"Polygon"!==g&&"MultiPolygon"!==g&&"Rectangle"!==g)return a.util.Logger.alert("MAPVIEWER_9015","OM.util.GeomUtil.getLength",""),l=-1;var g=function(a){var e=0,d=2,f=a.length;if(a&&3<f){for(;d<f;d+=2)var g=a[d]-a[d-2],h=a[d+1]-a[d-1],e=e+Math.sqrt(g*g+h*h);return e}return 0},t,F,I,P,aa;f&&(t=f.idx?f.idx:0,F=f.unit?f.unit:"METER",I=f.transformToGeodetic,P=f.dataSource?f.dataSource:
a.gv.defaultDataSource,aa=!1===f.toServerTranform?!1:!0);if(!h)return l=g(e.coordinates),d&&d(l,t),l;(f=a.gv.getSRS(h))?(a.util.GeomUtil.isGeo(h)&&(f.type="GEODETIC"),f.distConvFactor=a.gv.getUnitFactor(f.unit)):f=a.util.GeomUtil.isGeo(h)?{type:"GEODETIC",distConvFactor:1,maxX:180,maxY:90,minX:-180,minY:-90}:{type:"",distConvFactor:1,maxX:180,maxY:90,minX:-180,minY:-90};var U=null;I&&(U=a.util.CSTransformUtil.getCSTransformFunction(h,8307));if(!I||a.util.GeomUtil.isGeo(h)||I&&U||a.isNull(P)){h=0;
F?(h=a.gv.getUnitFactor(F),f.distConvFactor&&!I&&(h/=f.distConvFactor)):h=1;var ca=e.coordinates.slice(0);U&&(ca=a.util.CSTransformUtil.transformOrdinates(U,ca,e.dimension),f.type="GEODETIC");if(h)return l=f&&f.type&&"GEODETIC"===f.type.toUpperCase()&&I?a.util.GeomUtil.getGreatCircleLength(ca)/h:g(ca)/h,d&&d(l,t),l}a.$("#sub_tr_1")&&!U&&I&&a.$("#sub_tr_1").hide();g=e.toString();e=a.gv.localbaseURL()+"/foi";g={request:"getlength",version:1,figord:g};F&&(g.unit=F);I&&(g.togeodetic=!0===I?"yes":"no");
P&&(g.datasource=P);F=function(a){a*=1;d&&d(a,t);l=a};try{aa&&a.util.HttpRequest.send(e,g,F,"text")}catch(ua){a.util.Logger.alert("MAPVIEWER_9016","OM.util.GeomUtil.getLength",ua.stack?ua.message+"\nStack: "+ua.stack:ua.message),l=-1}return l};a.util.GeomUtil.getArea=function(e,d,f){var g=e?e.type:"";if("Polygon"!==g&&"MultiPolygon"!==g)return a.util.Logger.alert("MAPVIEWER_9046","OM.util.GeomUtil.getArea",""),F=-1;var h,l,t;f&&(h=f.unit?f.unit:"SQ_METER",l=f.transformToGeodetic,t=f.dataSource?f.dataSource:
a.gv.defaultDataSource);var F;f=e.toString();e=a.gv.localbaseURL()+"/foi";f={request:"getarea",version:1,figord:f};h&&(f.unit=h);l&&(f.togeodetic=!0===l?"yes":"no");t&&(f.datasource=t);h=function(a){a*=1;d&&d(a);F=a};try{a.util.HttpRequest.send(e,f,h,"text")}catch(I){a.util.Logger.alert("MAPVIEWER_9047","OM.util.GeomUtil.getArea",I.stack?I.message+"\nStack: "+I.stack:I.message),F=-1}return F};a.util.GeomUtil.moveCoordinates=function(e,d,f,g,h){var l=function(e,d,f){if(e){var l=e.length,t=2;a.notNull(h)&&
(t=h);g&&(t+=t);for(var F=0;F<l;F+=t)e[F]+=d,e[F+1]+=f}},t=a.util.ValidationUtil.isNumberArray;if(t(e))l(e,d,f);else for(var F=e.length,I=0;I<F;I++)if(t(e[I]))l(e[I],d,f);else for(var P=e[I].length,aa=0;aa<P;aa++)l(e[I][aa],d,f)};a.util.GeomUtil.moveGeometry=function(a,d,f){var g=a.getOrdinates(),h=a.getType(),l=a.getDimension(),t;if("Polygon"===h||"MultiLineString"==h)for(a=0;a<g.length;a++)for(h=0;h<g[a].length;h+=l)g[a][h]+=d,g[a][h+1]+=f;else if("MultiPolygon"===h)for(h=0;h<g.length;h++)for(a=
0;a<g[h].length;a++)for(t=0;t<g[h][a].length;t+=l)g[h][a][t]+=d,g[h][a][t+1]+=f;else if("LineString"===h)for(a=0;a<g.length;a++)g[a]+=d,g[a]+=f;else if("Rectangle"===h)a.move(d,f);else throw Error("Unsupported geometry type:"+h);};a.util.GeomUtil.getGreatCircleLength=function(e){for(var d=0,f=a.util.GeomUtil,g=0;g<e.length-2;g+=2)d+=f.getGreatCircleDistance({x:e[g],y:e[g+1]},{x:e[g+2],y:e[g+3]});return d};a.util.GeomUtil.getGreatCircleDistance=function(e,d){var f=a.util.GeomUtil;e=f.getRadiansFromLatLon(e.x,
e.y);d=f.getRadiansFromLatLon(d.x,d.y);var g=d.x-e.x,h=Math.sin((d.y-e.y)/2),g=Math.sin(g/2),h=h*h+Math.cos(e.y)*Math.cos(d.y)*g*g;return 2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h))*f.earthRadius};a.util.GeomUtil.getOGCOrdinateString=function(e,d){var f=2;a.notNull(d)&&(f=d);for(var g=0,h="";g<e.length;g+=f){0<g&&(h+=" ");for(var h=h+(e[g]+","+e[g+1]),l=2;l<f;l++)h+=","+e[g+l]}return h};a.util.GeomUtil.getWktCoordinateStringFromPoint=function(e,d){var f=2;a.notNull(d)&&(f=d);for(var g=0,h="";g<e.length;g+=
f){0<g&&(h+=" ");for(var l=0;l<f;l++)h+=e[g+l],l<f-1&&(h+=" ")}return h};a.util.GeomUtil.getWktCoordinateStringFromOrientedPoint=function(e,d){var f=2;a.notNull(d)&&(f=d);for(var g=0,h="";g<f;g+=f){0<g&&(h+=" ");for(var l=0;l<f;l++)h+=e[g+l],l<f-1&&(h+=" ")}return h};a.util.GeomUtil.getWktCoordinateStringFromLine=function(e,d){var f=2;a.notNull(d)&&(f=d);for(var g=0,h="";g<e.length;g+=f){0<g&&(h+=" ");for(var l=0;l<f;l++)h+=e[g+l],l<f-1&&(h+=" ");h+=","}return h};a.util.GeomUtil.getCurrentDistancePerPixelPrivate=
function(e){var d=e.getUniverse();e=e.getZoomLevel();e=d.getZoomLevels()[e];if(a.notNull(e.distancePerPixel))return e.distancePerPixel;var d=d.getSRID(),f=null,f=a.util.GeomUtil.isGeo(d)?111195*e.resolution:e.resolution;return e.distancePerPixel=f};a.util.GeomUtil.getCurrentDistancePerPixel=function(e,d){var f=a.util.GeomUtil.getCurrentDistancePerPixelPrivate(e);if(!a.isNull(d))if("pixel"===d)f=1;else{var g=a.gv.getUnitFactor(d);0!==g&&(f/=g)}return f};a.util.GeomUtil.calculateGreatCircle=function(e,
d,f,g){var h=e.clone(),l=d.clone(),t=h.getY()*Math.PI/180,F=h.getX()*Math.PI/180,I=l.getY()*Math.PI/180,P=l.getX()*Math.PI/180,l=g,h=[],aa=0,U=Math.PI/180;Math.abs(P-F)===Math.PI&&0===t+I&&(I+=Math.PI/18E7);var ca=f*Math.PI/180;for(g*=Math.PI/180;ca<=g;){var ua=Math.atan((Math.sin(t)*Math.cos(I)*Math.sin(ca-P)-Math.sin(I)*Math.cos(t)*Math.sin(ca-F))/(Math.cos(t)*Math.cos(I)*Math.sin(F-P)));h[2*aa]=180*ca/Math.PI;h[2*aa+1]=180*ua/Math.PI;aa++;ca=ca<g&&ca+U>=g?g:ca+U}g=[];if(e.getX()>d.getX()&&180!==
l&&-180!==f){for(t=0;t<h.length/2;t++)g[2*t]=h[h.length-2*t-2],g[2*t+1]=h[h.length-2*t-1];h=g}if(e.getX()<d.getX()&&(180===l||-180===f)){for(t=0;t<h.length/2;t++)g[2*t]=h[h.length-2*t-2],g[2*t+1]=h[h.length-2*t-1];h=g}return new a.geometry.LineString(h,8307)};a.util.GeomUtil.createGreatCircle=function(e,d){var f=a.util.GeomUtil.isGeo;if(f(e.srid)&&f(d.srid)){var f=e.getX(),g=d.getX(),h=[];if(f<g&&180>g-f)return h[0]=a.util.GeomUtil.calculateGreatCircle(e,d,f,g),h[0];if(180>Math.abs(f-g))return h[0]=
a.util.GeomUtil.calculateGreatCircle(e,d,g,f),h[0];f>g?(h[0]=a.util.GeomUtil.calculateGreatCircle(e,d,f,180),h[1]=a.util.GeomUtil.calculateGreatCircle(e,d,-180,g)):(h[0]=a.util.GeomUtil.calculateGreatCircle(e,d,g,180),h[1]=a.util.GeomUtil.calculateGreatCircle(e,d,-180,f));return new a.geometry.MultiLineString([h[0].coordinates,h[1].coordinates],8307)}a.util.Logger.alert("MAPVIEWER_9017","OM.util.GeomUtil.getGreatCircle","")};a.util.GeomUtil.flatten=function(e,d,f){var g=[];if(!e)return null;for(var h=
e.length,l=0,t=0;t<h;t++){var F=e[t];if(!(F instanceof a.geometry.Geometry)||0>F.getType().indexOf(d))return null;var I=F.getSRID();l||(l=I);if(l!==I)return null;f?g.push(F.coordinates):(g.push(F.getX()),g.push(F.getY()))}return{ordinates:g,srid:l}};a.util.GeomUtil.getOutCode=function(a,d,f){return a.minX>d?a.minY>f?3:a.maxY<f?9:1:a.maxX<d?a.minY>f?6:a.maxY<f?12:4:a.minY>f?2:a.maxY<f?8:0};a.util.GeomUtil.clipLineSegment=function(e,d,f,g,h){for(var l=a.util.GeomUtil.getOutCode,t=l(e,d,f),F=l(e,g,h);;){if(0===
(t|F))return{x0:d,y0:f,x1:g,y1:h};if(0!==(t&F))return null;var I=0!==t?t:F,P=null,aa=null;0!==(I&8)?(P=d+(g-d)*(e.maxY-f)/(h-f),aa=e.maxY):0!==(I&2)?(P=d+(g-d)*(e.minY-f)/(h-f),aa=e.minY):0!==(I&4)?(P=e.maxX,aa=f+(h-f)*(e.maxX-d)/(g-d)):(P=e.minX,aa=f+(h-f)*(e.minX-d)/(g-d));I===t?(d=P,f=aa,t=l(e,d,f)):(g=P,h=aa,F=l(e,g,h))}};a.util.GeomUtil.clipLine=function(e,d){var f=[];a.util.GeomUtil.concatMultiLine(d);for(var g=0,h=d.length;g<h;g++)if(d[g]&&d[g][0])for(var l=d[g][0],t=3,F=l.length;t<F;t+=2){var I=
a.util.GeomUtil.clipLineSegment(e,l[t-3],l[t-2],l[t-1],l[t]);if(I){var P=f.length-1;if(0<=P){var aa=f[P].length;if(1<aa&&I.x0===f[P][aa-2]&&I.y0===f[P][aa-1]){f[P].push(I.x1,I.y1);continue}}f.push([I.x0,I.y0,I.x1,I.y1])}}return f};a.util.GeomUtil.getSegmentLength=function(a,d,f,g){return Math.sqrt((a-f)*(a-f)+(d-g)*(d-g))};a.util.GeomUtil.getScreenLength=function(e){for(var d=0,f=0,g=e.length-3;f<g;f+=2)d+=a.util.GeomUtil.getSegmentLength(e[f],e[f+1],e[f+2],e[f+3]);return d};a.util.GeomUtil.getPointByPercent=
function(e,d,f){for(var g=[],h=a.util.GeomUtil,l=0,t=e.length;l<t;l++){var F=e[l],I=h.getScreenLength(F);I<f/2||(I*=d,(F=h.getPointByLength(I,F))&&g.push(F))}return g};a.util.GeomUtil.getPointByLength=function(e,d){for(var f=a.util.GeomUtil,g=0,h=d.length-3;g<h;g+=2){var l=f.getSegmentLength(d[g],d[g+1],d[g+2],d[g+3]);if(l>=e)return f=e/l,{x:d[g]+(d[g+2]-d[g])*f,y:d[g+1]+(d[g+3]-d[g+1])*f,pos:g,len:l};e-=l}return null};a.util.GeomUtil.getPoinsByLength=function(e,d,f,g,h,l){for(var t=a.util.GeomUtil.getSegmentLength(e[d],
e[d+1],f,g),F=e.length;t<h&&2<=d&&d<F-2;)5<=t&&(h-=t),d+=l,t=a.util.GeomUtil.getSegmentLength(e[d],e[d+1],f,g);return t>=h?(f=h/t,{x:e[d-l]+(e[d]-e[d-l])*f,y:e[d+1-l]+(e[d+1]-e[d+1-l])*f}):{x:e[d],y:e[d+1]}};a.util.GeomUtil.getCircle=function(a,d,f,g,h,l){var t=Math.sqrt((a-f)*(a-f)+(d-g)*(d-g)),F=Math.sqrt((f-h)*(f-h)+(g-l)*(g-l)),I=Math.sqrt((a-h)*(a-h)+(d-l)*(d-l)),P=(t+F+I)/2,P=Math.sqrt(P*(P-t)*(P-F)*(P-I)),t=t*F*I/4/P,F=((a*a-f*f+d*d-g*g)*(d-l)-(a*a-h*h+d*d-l*l)*(d-g))/(2*(d-l)*(a-f)-2*(d-g)*
(a-h)),I=((a*a-f*f+d*d-g*g)*(a-h)-(a*a-h*h+d*d-l*l)*(a-f))/(2*(d-g)*(a-h)-2*(d-l)*(a-f));a=Math.atan2(d-I,a-F);0>a&&(a+=2*Math.PI);h=Math.atan2(l-I,h-F);0>h&&(h+=2*Math.PI);f=Math.atan2(g-I,f-F);0>f&&(f+=2*Math.PI);a<f&&a>h?h+=2*Math.PI:a<f&&f>h?a+=2*Math.PI:a>f&&a<h?h-=2*Math.PI:a>f&&f<h&&(a-=2*Math.PI);return{x:F,y:I,r:t,sAngle:a,eAngle:h}};a.util.GeomUtil.isGeo=function(a){return 8307===a||8265===a||4326===a||4269===a};a.util.GeomUtil.isClockwise=function(e,d){return 0<=a.util.GeomUtil.polygonArea(e,
d)};a.util.GeomUtil.polylineLength=function(a,d){for(var f=a.length/d,g=0,h=0,l,t=1;t<f;t++)l=t*d,h*=d,g+=Math.sqrt((a[l]-a[h])*(a[l]-a[h])+(a[l+1]-a[h+1])*(a[l+1]-a[h+1])),h=t;return g};a.util.GeomUtil.polygonArea=function(a,d){for(var f=d||2,g=a.length/f,h=0,l=g-1,t=0,h=0;h<g;h++)t+=(a[l*f]+a[h*f])*(a[l*f+1]-a[h*f+1]),l=h;return t/2};a.util.GeomUtil.reverseCoordinates=function(a){for(var d=[],f=0;f<a.length-1;f+=2)d.unshift(a[f+1]),d.unshift(a[f]);return d};a.util.GeomUtil.getTransformedGeometry=
function(e,d){var f=[],g=e.getOrdinates(),h=e.getType(),l=e.getDimension(),t,F,I;if("Polygon"===h||"MultiLineString"==h)for(F=0;F<g.length;F++)t=a.util.GeomUtil.getTransformedCoordinates(g[F],l,d),f[F]=t;else if("MultiPolygon"===h)for(I=0;I<g.length;I++)for(f[I]=[],F=0;F<g[I].length;F++)t=a.util.GeomUtil.getTransformedCoordinates(g[I][F],l,d),f[I][F]=t;else f=a.util.GeomUtil.getTransformedCoordinates(g,l,d);if("Polygon"===h)f=new a.geometry.Polygon(f,e.srid,e.dim);else if("MultiPolygon"===h)f=new a.geometry.MultiPolygon(f,
e.srid,e.dim);else if("LineString"===h)f=new a.geometry.LineString(f,e.srid,e.dim);else if("MultiLineString"===h)f=new a.geometry.MultiLineString(f,e.srid,e.dim);else throw Error("Unsupported geometry type:"+h);return f};a.util.GeomUtil.getTransformedCoordinates=function(a,d,f){var g=[];if(2===d)f.transformAll(a,g);else{var h=a.length||0,l,t,F,I,P,aa,U,g=g||a;F=f.a;I=f.b;P=f.c;aa=f.d;U=f.tx;f=f.ty;for(h=0;h<a.length;h+=d)if(l=a[h],t=a[h+1],g[h]=F*l+P*t+U,g[h+1]=I*l+aa*t+f,2<d)for(l=2;l<d;l++)g[h+
l]=a[h+l]}return g};a.util.GeomUtil.parseGeoJson=function(e){if(!e.type)return null;var d=e.coordinates?e.coordinates:e.geometries,f=d.length,g=Array.prototype.concat,h;switch(e.type){case "Point":return e.dimension=f,e;case "OrientedPoint":return"number"!==typeof d[0]&&(e.coordinates=g.apply([],d)),e.dimension=f/2,e;case "MultiPoint":return e.dimension=d[0].length,e;case "OrientedMultiPoint":if("number"!==typeof d[0][0])for(h=0;h<f;h++)e.coordinates[h]=g.apply([],d[h]);e.dimension=d[0].length/2;
return e;case "LineString":return"number"!==typeof d[0]&&(e.dimension=d[0].length,e.coordinates=g.apply([],d)),e;case "MultiLineString":for(h=0;h<f;h++)"number"!==typeof d[h][0]&&(e.dimension=d[h][0].length,e.coordinates[h]=g.apply([],d[h]));return e;case "Polygon":for(h=0;h<f;h++)"number"!==typeof d[h][0]&&(e.dimension=d[h][0].length,e.coordinates[h]=g.apply([],d[h]));return e;case "MultiPolygon":for(h=0;h<f;h++)for(var l=0;l<d[h].length;l++)"number"!==typeof d[h][l][0]&&(e.dimension=d[h][l][0].length,
e.coordinates[h][l]=g.apply([],d[h][l]));return e;case "GeometryCollection":for(h=0;h<f;h++)d[h]=a.util.GeomUtil.parseGeoJson(d[h]);e.dimension=e.geometries[0].dimension;return e;case "Circle":e.dimension=2;for(h=0;h<f;h++)isNaN(d[h][0])&&(e.coordinates[h]=d[h]);return e;case "Rectangle":e.dimension=2;for(h=0;h<f;h++)isNaN(d[h][0])&&(e.coordinates[h]=d[h]);return e}};a.util.GeomUtil.parseCRSName=function(e){e.indexOf("EPSG");var d=e.split(":");1===d.length&&(d=e.split(" "));for(e=d.length-1;-1<e;e--)d[e]=
d[e].trim(),""===d[e]&&d.splice(e,1);for(e=0;e<d.length-1;e++)if("EPSG"===d[e].toUpperCase())return a.util.GeomUtil.EPSG_SDO_Map[d[e+1]];return null};a.util.GeomUtil.concatMultiLine=function(a){for(var d=a.length,f=0,g=d-1;f<g;f++)if(a[f]&&a[f][0])for(var h=f+1;h<d;h++)if(a[h]&&a[h][0]){var l=a[f][0].length,t=a[h][0].length;3>Math.abs(a[f][0][l-2]-a[h][0][0])&&3>Math.abs(a[f][0][l-1]-a[h][0][1])?(Array.prototype.push.apply(a[f][0],a[h][0]),a.splice(h,1),d--,g--,h--):3>Math.abs(a[f][0][0]-a[h][0][t-
2])&&3>Math.abs(a[f][0][1]-a[h][0][t-1])&&(Array.prototype.push.apply(a[h][0],a[f][0]),a[f]=a[h],a.splice(h,1),d--,g--,h--)}};a.util.GeomUtil.distanceToSegment=function(a,d,f,g,h,l){var t=[],F;if(0>=(a-f)*(h-f)+(d-g)*(l-g))return t[0]=Math.sqrt((a-f)*(a-f)+(d-g)*(d-g)),t[1]=0,t;if(0>=(a-h)*(f-h)+(d-l)*(g-l))return t[0]=Math.sqrt((a-h)*(a-h)+(d-l)*(d-l)),t[1]=1,t;t[1]=2;F=Math.sqrt((h-f)*(h-f)+(l-g)*(l-g));if(0===F)return t[0]=Math.sqrt((a-f)*(a-f)+(d-g)*(d-g)),t;t[0]=Math.abs((a-f)*(l-g)-(d-g)*(h-
f))/F;return t};a.util.GeomUtil.getSegmentPoint=function(a,d,f,g,h,l){h-=f;l-=g;0===h?a=d:0===l?(f=a,a=g):(l/=h,f=(a+l*(d-g)+l*l*f)/(1+l*l),a=(a-f)/l+d);return[f,a]};a.util.GeomUtil.poinInPolygonGeometry=function(e,d,f){if(a.isNull(e)||"Polygon"!==e.getType())return!1;var g=e.getDimension(),h=e.coordinates.length,l=e.coordinates[0].length,t=[],F=[],I;for(I=0;I<l;I+=g)t[I/g]=e.coordinates[0][I],F[I/g]=e.coordinates[0][I+1];if(a.util.GeomUtil.pointInPolygon(d,f,l/g,t,F)){for(var P=!1,aa=1;aa<h;aa++){l=
e.coordinates[aa].length;t=[];F=[];I=l/g;for(var U=0;U<l;U+=g)t[U/g]=e.coordinates[aa][U],F[U/g]=e.coordinates[aa][U+1];if(a.util.GeomUtil.pointInPolygon(d,f,I,t,F)){P=!0;break}}if(!1===P)return!0}return!1};a.util.GeomUtil.findGeometryElement=function(e,d,f,g){if(a.isNull(e))return!1;var h=e.getType(),l=e.getDimension(),t=-1,F=Number.MAX_VALUE,I=e.getOrdinates();switch(h){case "Point":l=e.getX()-d;e=e.getY()-f;e=Math.sqrt(l*l+e*e);e<=g&&(t=0);break;case "MultiPoint":for(h=0;h<I.length;h++)l=I[h][0]-
d,e=I[h][1]-f,e=Math.sqrt(l*l+e*e),e<=g&&e<F&&(F=e,t=h);break;case "LineString":for(F=0;F<I.length-l;F+=l)if(e=a.util.GeomUtil.distanceToSegment(d,f,I[F],I[F+1],I[F+l],I[F+l+1]),e[0]<=g){t=0;break}break;case "MultiLineString":for(h=0;h<I.length;h++)for(var P=0;P<I[h].length-l;P+=l)if(e=a.util.GeomUtil.distanceToSegment(d,f,I[h][P],I[h][P+1],I[h][P+l],I[h][P+l+1]),e[0]<=g&&e[0]<F){t=h;F=e[0];break}break;case "Polygon":a.util.GeomUtil.poinInPolygonGeometry(e,d,f)&&(t=0);break;case "MultiPolygon":for(g=
0;g<I.length;g++)if(F=new a.geometry.Polygon(I[g],e.getSRID(),e.dim),a.util.GeomUtil.poinInPolygonGeometry(F,d,f)){t=g;break}}return t};a.util.GeomUtil.removeGeometryElement=function(e,d){if(a.isNull(e)||0>d)return null;var f=e.getType();if("MultiPoint"!==f&&"MultiLineString"!==f&&"OrientedMultiPoint"!==f&&"MultiPolygon"!==f&&"GeometryCollection"!==f)return null;var g=e.getDimension(),h=e.getOrdinates();if(a.isNull(h))return null;var l=h.length;if(d>=l)return null;switch(f){case "MultiPoint":h.splice(d,
1);if(2===l&&(e=new a.geometry.Point(h[0][0],h[0][1],e.getSRID()),2<g))for(f=2;f<g;f++)e.addDimension(h[0][f]);break;case "OrientedMultiPoint":return null;case "MultiLineString":h.splice(d,1);2===l&&(e=new a.geometry.LineString(h[0],e.getSRID(),g));break;case "MultiPolygon":h.splice(d,1);2===l&&(e=new a.geometry.Polygon(h[0],e.getSRID(),g));break;case "GeometryCollection":return null;default:return null}e.mbr=null;e.getMBR();return e};a.util.GeomUtil.cloneGeometryElement=function(e,d){if(a.isNull(e)||
0>d)return null;var f=e.getType();if("MultiPoint"!==f&&"MultiLineString"!==f&&"OrientedMultiPoint"!==f&&"MultiPolygon"!==f&&"GeometryCollection"!==f)return null;var g=e.getDimension(),h=e.getOrdinates();if(a.isNull(h)||d>=h.length)return null;var l=null,l=[],t=function(a){for(var e=[],d=0;d<a.length;d++)e[d]=a[d]instanceof Array?t(a[d]):a[d];return e};switch(f){case "MultiPoint":l=new a.geometry.Point(h[d][0],h[d][1],e.getSRID());if(2<g)for(f=2;f<g;f++)l.addDimension(h[d][f]);break;case "OrientedMultiPoint":return null;
case "MultiLineString":l=t(h[d]);l=new a.geometry.LineString(l,e.getSRID(),g);break;case "MultiPolygon":l=t(h[d]);l=new a.geometry.Polygon(l,e.getSRID(),g);break;case "GeometryCollection":return null;default:return null}l.mbr=null;l.getMBR();return l};a.util.GeomUtil.getSquareDistance=function(a,d){var f=a.x-d.x,g=a.y-d.y;return f*f+g*g};a.util.GeomUtil.getSquareSegmentDistance=function(a,d,f){var g=d.x;d=d.y;var h=f.x-g,l=f.y-d,t;if(0!==h||0!==l)t=((a.x-g)*h+(a.y-d)*l)/(h*h+l*l),1<t?(g=f.x,d=f.y):
0<t&&(g+=h*t,d+=l*t);h=a.x-g;l=a.y-d;return h*h+l*l};a.util.GeomUtil.simplifyRadialDistance=function(a,d){var f,g=a.length,h,l=a[0],t=[l];for(f=1;f<g;f++)h=a[f],this.getSquareDistance(h,l)>d&&(t.push(h),l=h);l!==h&&t.push(h);return t};a.util.GeomUtil.simplifyDouglasPeucker=function(a,d){var f=a.length,g=new (typeof Uint8Array!==b+""?Uint8Array:Array)(f),h=0,l=f-1,t,F,I,P,aa=[],U=[],ca=[];for(g[h]=g[l]=1;l;){F=0;for(t=h+1;t<l;t++)I=this.getSquareSegmentDistance(a[t],a[h],a[l]),I>F&&(P=t,F=I);F>d&&
(g[P]=1,aa.push(h),U.push(P),aa.push(P),U.push(l));h=aa.pop();l=U.pop()}for(t=0;t<f;t++)g[t]&&ca.push(a[t]);return ca};a.util.GeomUtil.simplify=function(a,d){var f=d!==b?d*d:1;a=this.simplifyRadialDistance(a,f);return a=this.simplifyDouglasPeucker(a,f)};a.util.GeomUtil.simplifyCoordinates=function(a,d){var f=this.coordinates2points(a),f=this.simplify(f,d);return this.points2coordinates(f)};a.util.GeomUtil.points2coordinates=function(a){for(var d=[],f=0;f<a.length;f++)d.push(a[f].x),d.push(a[f].y);
return d};a.util.GeomUtil.coordinates2points=function(a){for(var d=[],f=0;f<a.length;)d.push({x:a[f],y:a[f+1]}),f+=2;return d};a.util.GeomUtil.toValidCoordinate=function(a,d){for(var f=a.getUniverse().getMapBounds(),g=f.getWidth(),h=f.getMinX(),f=f.getMaxX(),l=0;l<d.length;l++)d[2*l]<h&&(d[2*l]-=Math.floor((d[2*l]+g/2)/g)*g),d[2*l]>f&&(d[2*l]-=Math.ceil((d[2*l]-g/2)/g)*g);return d};a.util.GeomUtil.isWithinBBox=function(a,d,f,g,h,l){return a<f||a>h||d<g||d>l?!1:!0};a.util.GeomUtil.screenPointsXOffset=
function(a,d,f){var g=f.getUniverse().getMapBounds().getWidth(),h=f.getBaseWholeMapIndex(),l=f.getUniverse().getZoomLevels()[f.getZoomLevel()].resolution;return 1<f.getWholeMapNum()?a+g*(d-h)/l+(f.getRoundMapCenterPoint().getX()-f.getCenterPoint().getX())/l:a+g*(d-h)/l};a.util.GeomUtil.EPSG_SDO_Map={3857:3857,3875:3857,4326:8307,4269:8265,4267:8260,4202:81920,4203:81921,20248:81922,20249:81924,20250:81926,20251:81928,20252:81930,20253:81932,20254:81934,20255:81936,20256:81938,20257:81940,20258:81942,
20348:81923,20349:81925,20350:81927,20351:81929,20352:81931,20353:81933,20354:81935,20355:81937,20356:81939,20357:81941,20358:81943,23028:82323,23029:82328,23030:82337,23031:82340,23032:82343,23033:82346,23034:82349,23035:82352,23036:82355,23037:82358,23038:82361};a.util.BaiduUtil=a.util.BaiduUtil||{};a.util.BaiduUtil.SRID=38578009;a.util.BaiduUtil.MIN_ZOOM_LEVEL=3;a.util.BaiduUtil.MAX_ZOOM_LEVEL=18;a.util.BaiduUtil.transformGeom=function(e){if(a.isNull(e)||a.isNull(e.map))return a.util.Logger.warning("",
"OM.util.BaiduUtil.transformGeom","No valid map parameter found. Please provide {'map':myMap}."),e.geom;if(a.isNull(e.geom))return a.util.Logger.warning("","OM.util.BaiduUtil.transformGeom","No valid geometry parameter found. Please provide {'geom':myGeometry}."),e.geom;e.toSrid=a.notNull(e.toSrid)?e.toSrid:a.util.BaiduUtil.SRID;if(a.util.BaiduUtil.isSameSRID(e.geom.srid,e.toSrid))return a.notNull(e.callBack)&&e.callBack(e.geom),e.geom;if(e.geom.srid===a.util.BaiduUtil.SRID)return a.util.BaiduUtil.transform_PixToBD09LonLat({geom:e.geom,
toSrid:8307,bdutil:e.map.bdutil,callBack:e.callBack});if(e.toSrid===a.util.BaiduUtil.SRID)return e.geom.transform(8307,function(d){return a.util.BaiduUtil.transform_BD09LonLatToPix({geom:d,toSrid:a.util.BaiduUtil.SRID,bdutil:e.map.bdutil,callBack:e.callBack,inputIsBD09LonLat:e.inputIsBD09LonLat})});a.util.Logger.warning("","OM.util.BaiduUtil.transformGeom","Transform not supported from "+e.geom.srid+" to "+e.toSrid);return null};a.util.BaiduUtil.isSameSRID=function(a,d){return a!==d&&(8307!==a&&4326!==
a||8307!==d&&4326!==d)?!1:!0};a.util.BaiduUtil.transform_BD09LonLatToPix=function(e){if(a.isNull(e)||a.isNull(e.geom))return a.util.Logger.warning("","OM.util.BaiduUtil.transform_BD09LonLatToPix","No geometry found in the input parameters."),null;if(a.isNull(e.bdutil))return a.util.Logger.warning("","OM.util.BaiduUtil.transform_BD09LonLatToPix","No Baidu conversion utilities found in the input parameters."),null;var d=e.geom,f=a.util.BaiduUtil.SRID,g=e.bdutil,h=e.callBack;e=e.inputIsBD09LonLat;if(8307!==
d.srid&&4326!==d.srid)return a.util.Logger.warning("","OM.util.BaiduUtil.transform_BD09LonLatToPix","SRID ["+d.srid+"] is not supported."),null;if(d.srid===a.util.BaiduUtil.SRID)return h&&h(d,g),d;if(g)switch(d.type){case "Point":return a.util.BaiduUtil.transformLonLatToPix_Point(d,f,g,h,e);case "LineString":return a.util.BaiduUtil.transformLonLatToPix_Line(d,f,g,h,e);case "MultiLineString":return a.util.BaiduUtil.transformLonLatToPix_MultiLine(d,f,g,h,e);case "Rectangle":return a.util.BaiduUtil.transformLonLatToPix_Rectangle(d,
f,g,h,e);case "Polygon":return a.util.BaiduUtil.transformLonLatToPix_Polygon(d,f,g,h,e);case "MultiPolygon":return a.util.BaiduUtil.transformLonLatToPix_MultiPolygon(d,f,g,h,e);default:return a.util.Logger.warning("","OM.util.BaudiUtil.transform_BD09LonLatToPix","Type ["+this.type+"] is not supported yet."),null}else return a.util.Logger.warning("","OM.util.BaudiUtil.transform_BD09LonLatToPix","Baidu BD09 encoding utility is not provided."),null};a.util.BaiduUtil.transformLonLatToPix_Point=function(e,
d,f,g,h){return f.enableBD09Encoding&&this.isWithinChinaRect(e)&&!0!==h?a.util.BaiduUtil.Point_WGS84ToBaiduPix(e,d,f,g):a.util.BaiduUtil.Point_BD09LonLatToPix(e,d,f,g)};a.util.BaiduUtil.Point_WGS84ToBaiduPix=function(e,d,f,g){var h=a.geometry,l=null;try{for(var t=f.WGS84ToBD09,F=[],I=0,P=e.coordinates.length;I<P;I+=e.dim)F.push(new BMap.Point(e.coordinates[I],e.coordinates[I+1]));t.translate(F,1,5,function(t){if(0===t.status){t=t.points;for(var F=t.length,I=[],P=0;P<F;P++){var aa=f.project.lngLatToPoint(t[P]);
I.push(aa.x);I.push(aa.y);3===e.dim&&I.push(e.coordinates[P*e.dim+2])}l=h.Geometry.createGeometry({type:e.type,dim:e.dim,coordinates:I},d);l.dim=e.dim;a.notNull(g)&&g(l,f)}else a.util.Logger.warning(null,"OM.util.BaudiUtil.transformLonLatToPix_Point","server returned status: Failed.")});return l}catch(aa){return a.util.Logger.warning(null,"OM.util.BaiduUtil.transformLonLatToPix_Point","Cannot transform geometry coordinates to SRID: "+d+", due to "+aa.message),null}};a.util.BaiduUtil.Point_BD09LonLatToPix=
function(e,d,f,g,h){var l=a.geometry,t=null,F,I,P,aa=[],U=[],ca,ua;try{F=0;for(P=e.coordinates.length;F<P;F+=e.dim)ca=e.coordinates[F],ua=e.coordinates[F+1],h?aa.push(new BMap.Pixel(ca,ua)):aa.push(new BMap.Point(ca,ua));P=aa.length;U=[];for(I=0;I<P;I+=e.dim){var Oa;h?(Oa=f.project.pointToLngLat(aa[I]),U.push(Oa.lng),U.push(Oa.lat)):(Oa=f.project.lngLatToPoint(aa[I]),U.push(Oa.x),U.push(Oa.y));3===e.dim&&U.push(e.coordinates[I*e.dim+2])}t=l.Geometry.createGeometry({type:e.type,dim:e.dim,coordinates:U},
d);t.dim=e.dim;a.notNull(g)&&g(t,f);return t}catch(Va){return a.util.Logger.warning(null,"OM.util.BaiduUtil.Point_BD09LonLatToPix","Cannot transform geometry coordinates to SRID: "+d+", due to "+Va.message),null}};a.util.BaiduUtil.isWithinChinaRect=function(e){var d,f,g,h;switch(e.type){case "Polygon":d=[];for(h=0;h<e.coordinates.length;h++)for(g=0;g<e.coordinates[h].length;g++)d.push(e.coordinates[h][g]);break;case "MultiPolygon":d=[];for(f=0;f<e.coordinates.length;f++){var l=e.coordinates[f];for(h=
0;h<l.length;h++)for(g=0;g<l[h].length;g++)d.push(l[h][g])}break;case "MultiLine":d=[];for(h=0;h<e.coordinates.length;h++)for(g=0;g<e.coordinates[h].length;g++)d.push(e.coordinates[h][g]);break;default:d=e.getOrdinates()}f=e.getDimension();e={minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY,maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY};e=a.geometry.Geometry.getCoordsMBR(d,f,e);d=a.util.GeomUtil.pointInRect;return d(e.minX,e.minY,73,1,134,53)&&d(e.minX,e.maxY,73,1,134,53)&&
d(e.maxX,e.minY,73,1,134,53)&&d(e.maxX,e.maxY,73,1,134,53)?!0:!1};a.util.BaiduUtil.MultiLine_WGS84ToBaiduPix=function(e,d,f,g){var h=a.geometry,l,t,F,I,P,aa;try{var U=0,ca=[];for(P=0;P<e.coordinates.length;P+=1){var ua=e.coordinates[P],Oa=Math.ceil(ua.length/200);ca.push(Oa);var Va=[],Jb={};F=0;for(aa=ua.length;F<aa;F+=e.dim){var b=ua[F],ub=ua[F+1];0<F&&0===F%200?(t=Va.join(""),Va=[],a.util.BaiduUtil.doBaiduConversion(t,Jb,U,f),U+=1):F===aa-e.dim&&(Va.push(";"+b+","+ub),t=Va.join(""),Va=[],a.util.BaiduUtil.doBaiduConversion(t,
Jb,U,f),U+=1);0===F||0===F%200?Va.push(""+b+","+ub):Va.push(";"+b+","+ub)}}var Ab=!0,rb,Bb=0;rb=setInterval(function(){a:if(Bb++,100<Bb)clearInterval(rb),a.util.Logger.warning(null,"OM.util.BaudiUtil.MultiLine_WGS84ToBaiduPix","Failed to assemble the feature.");else{for(P=U=0;P<ca.length;P+=1)for(F=0;F<ca[P];F+=1){if(a.isNull(Jb[U.toString()])){Ab=!1;break a}U+=1}if(!0===Ab){clearInterval(rb);var t=[];U=0;var aa=[];for(F=0;F<ca.length;F+=1){var t=[],ua=U.toString();for(P=0;P<Jb[U].length;P+=1){var xa=
new BMap.Point(Jb[ua][P].x,Jb[ua][P].y),xa=f.project.lngLatToPoint(xa);t.push(xa.x);t.push(xa.y);for(I=2;I<e.dim;I+=1)t.push("")}U+=1;aa.push(t)}l=h.Geometry.createGeometry({type:e.type,dim:e.dim,coordinates:aa},d);l.dim=e.dim;g(l,f)}}},1E3);return l}catch(Fb){return a.util.Logger.warning(null,"OM.util.BaiduUtil.MultiLine_WGS84ToBaiduPix","Cannot transform geometry coordinates to SRID: "+d+", due to "+Fb.message),null}};a.util.BaiduUtil.MultiLine_BD09LonLatToPix=function(e,d,f,g,h){var l=a.geometry;
try{for(var t=[],F=0;F<e.coordinates.length;F+=1){for(var I=e.coordinates[F],P=[],aa=0;aa<I.length;aa+=e.dim){var U;h?(U=f.project.pointToLngLat(new BMap.Pixel(I[aa],I[aa+1])),P.push(U.lng),P.push(U.lat)):(U=f.project.lngLatToPoint(new BMap.Point(I[aa],I[aa+1])),P.push(U.x),P.push(U.y));for(var ca=2;ca<e.dim;ca+=1)P.push("")}t.push(P)}var ua=l.Geometry.createGeometry({type:e.type,dim:e.dim,coordinates:t},d);g&&g(ua,f);return ua}catch(Oa){return a.util.Logger.warning(null,"OM.util.BaiduUtil.MultiLine_BD09LonLatToPix",
"Cannot transform geometry coordinates to SRID "+d+", due to "+Oa.message),null}};a.util.BaiduUtil.Polygon_WGS84ToPix=function(e,d,f,g){var h=a.geometry,l,t,F,I,P;try{var aa=0,U=[],ca;for(F=0;F<e.coordinates.length;F+=1){var ua=e.coordinates[F],Oa=Math.ceil(ua.length/200);U.push(Oa);var Va=[],b={};l=0;for(I=ua.length;l<I;l+=e.dim){var c=ua[l],ub=ua[l+1];0<l&&0===l%200?(ca=Va.join(""),Va=[],a.util.BaiduUtil.doBaiduConversion(ca,b,aa,f),aa+=1):l===I-e.dim&&(Va.push(";"+c+","+ub),ca=Va.join(""),Va=[],
a.util.BaiduUtil.doBaiduConversion(ca,b,aa,f),aa+=1);0===l||0===l%200?Va.push(""+c+","+ub):l!==I-e.dim&&Va.push(";"+c+","+ub)}}var Ab=!0,rb,Bb=0;rb=setInterval(function(){a:if(Bb++,100<Bb)clearInterval(rb),a.util.Logger.warning(null,"OM.util.BaudiUtil.Polygon_WGS84ToPix","Failed to assemble the feature.");else{var I=0;for(F=0;F<U.length;F+=1)for(l=0;l<U[F];l+=1){if(a.isNull(b[I.toString()])){Ab=!1;break a}I+=1}if(!0===Ab){clearInterval(rb);var aa=[],I=0,ca=[];for(l=0;l<U.length;l+=1){var aa=[],xa=
I.toString();for(F=0;F<b[I].length;F+=1){var ua=new BMap.Point(b[xa][F].x,b[xa][F].y),ua=f.project.lngLatToPoint(ua);aa.push(ua.x);aa.push(ua.y);for(t=2;t<e.dim;t+=1)aa.push("")}I+=1;ca.push(aa)}P=h.Geometry.createGeometry({type:e.type,dim:e.dim,coordinates:ca},d);P.dim=e.dim;g(P,f)}}},1E3);return P}catch(Fb){return a.util.Logger.warning(null,"OM.util.BaiduUtil.Polygon_WGS84ToPix","Cannot transform geometry coordinates to SRID "+d+", due to "+Fb.message),null}};a.util.BaiduUtil.Rectangle_WGS84ToPix=
function(e,d,f,g){var h=a.geometry,l,t,F,I,P;try{var aa=0,U=[],ca;for(F=0;F<e.coordinates.length;F+=1){var ua=e.coordinates[F];U.push(1);var Oa=[],Va={};l=0;for(I=ua.length;l<I;l+=e.dim){var b=ua[l],c=ua[l+1];0<l&&0===l%200?(ca=Oa.join(""),Oa=[],a.util.BaiduUtil.doBaiduConversion(ca,Va,aa,f),aa+=1):l===I-e.dim&&(Oa.push(";"+b+","+c),ca=Oa.join(""),Oa=[],a.util.BaiduUtil.doBaiduConversion(ca,Va,aa,f),aa+=1);0===l?Oa.push(""+b+","+c):l!==I-e.dim&&Oa.push(";"+b+","+c)}a.util.BaiduUtil.doBaiduConversion(ca,
Va,aa,f)}var ub=!0,Ab,rb=0;Ab=setInterval(function(){a:if(rb++,100<rb)clearInterval(Ab),a.util.Logger.warning(null,"OM.util.BaudiUtil.Rectangle_WGS84ToPix","Failed to assemble the feature.");else{var I=0;for(F=0;F<U.length;F+=1)for(l=0;l<U[F];l+=1){if(a.isNull(Va[I.toString()])){ub=!1;break a}I+=1}if(!0===ub){clearInterval(Ab);var aa=[],I=0,ca=[];for(l=0;l<U.length;l+=1){var aa=[],ua=I.toString();for(F=0;F<Va[I].length;F+=1){var xa=new BMap.Point(Va[ua][F].x,Va[ua][F].y),xa=f.project.lngLatToPoint(xa);
aa.push(xa.x);aa.push(xa.y);for(t=2;t<e.dim;t+=1)aa.push("")}I+=1;ca.push(aa)}P=h.Geometry.createGeometry({type:e.type,dim:e.dim,coordinates:ca},d);P.dim=e.dim;g(P,f)}}},1E3);return P}catch(Bb){return a.util.Logger.warning(null,"OM.util.BaiduUtil.Rectangle_WGS84ToPix","Cannot transform geometry coordinates to SRID "+d+", due to "+Bb.message),null}};a.util.BaiduUtil.Polygon_BD09LonLatToPix=function(e,d,f,g,h){var l=a.geometry,t;try{for(var F=[],I=0;I<e.coordinates.length;I+=1){for(var P=e.coordinates[I],
aa=[],U=0;U<P.length;U+=e.dim){var ca;h?(ca=f.project.pointToLngLat(new BMap.Pixel(P[U],P[U+1])),aa.push(ca.lng),aa.push(ca.lat)):(ca=f.project.lngLatToPoint(new BMap.Point(P[U],P[U+1])),aa.push(ca.x),aa.push(ca.y));for(var ua=2;ua<e.dim;ua+=1)aa.push("")}F.push(aa)}t=l.Geometry.createGeometry({type:e.type,dim:e.dim,coordinates:F},d);g&&g(t,f);return t}catch(Oa){return a.util.Logger.warning(null,"OM.util.BaiduUtil.Polygon_BD09LonLatToPix","Cannot transform geometry coordinates to SRID "+d+", due to "+
Oa.message),null}};a.util.BaiduUtil.Rectangle_BD09LonLatToPix=function(e,d,f,g,h){var l=a.geometry,t;try{for(var F=e.coordinates,I=[],P=0;P<F.length;P+=e.dim){var aa;h?(aa=f.project.pointToLngLat(new BMap.Pixel(F[P],F[P+1])),I.push(aa.lng),I.push(aa.lat)):(aa=f.project.lngLatToPoint(new BMap.Point(F[P],F[P+1])),I.push(aa.x),I.push(aa.y))}t=l.Geometry.createGeometry({type:e.type,dim:e.dim,coordinates:I},d);g&&g(t,f);return t}catch(U){return a.util.Logger.warning(null,"OM.util.BaiduUtil.Rectangle_BD09LonLatToPix",
"Cannot transform geometry coordinates to SRID "+d+", due to "+U.message),null}};a.util.BaiduUtil.MultiPolygon_WGS84LonLatToPix=function(e,d,f,g){var h=a.geometry,l,t,F,I,P;try{var aa=0,U=[],ca;for(I=0;I<e.coordinates.length;I+=1){var ua=e.coordinates[I],Oa=Math.ceil(ua.length/200);U.push(Oa);var Va=[],b={};t=0;for(P=ua.length;t<P;t+=e.dim){var c=ua[t],ub=ua[t+1];0<t&&0===t%200?(ca=Va.join(""),Va=[],a.util.BaiduUtil.doBaiduConversion(ca,b,aa,f),aa+=1):t===P-e.dim&&(Va.push(";"+c+","+ub),ca=Va.join(""),
Va=[],a.util.BaiduUtil.doBaiduConversion(ca,b,aa,f),aa+=1);0===t||0===t%200?Va.push(""+c+","+ub):Va.push(";"+c+","+ub)}}var Ab=!0,rb,Bb=0;rb=setInterval(function(){a:if(Bb++,100<Bb)clearInterval(rb),a.util.Logger.warning(null,"OM.util.BaudiUtil.MultiPolygon_WGS84LonLatToPix","Failed to assemble the feature.");else{var P=0;for(I=0;I<U.length;I+=1)for(t=0;t<U[I];t+=1){if(a.isNull(b[P.toString()])){Ab=!1;break a}P+=1}if(!0===Ab){clearInterval(rb);var aa,P=0,ca=[];for(t=0;t<U.length;t+=1){aa=[];var xa=
P.toString();for(I=0;I<b[P].length;I+=1){var ua=new BMap.Point(b[xa][I].x,b[xa][I].y),ua=f.project.lngLatToPoint(ua);aa.push(ua.x);aa.push(ua.y);for(F=2;F<e.dim;F+=1)aa.push("")}P+=1;ca.push(aa)}l=h.Geometry.createGeometry({type:e.type,dim:e.dim,coordinates:ca},d);l.dim=e.dim;g(l,f)}}},1E3);return l}catch(Fb){return a.util.Logger.warning(null,"OM.util.BaiduUtil.MultiPolygon_WGS84LonLatToPix","Cannot transform geometry coordinates to SRID "+d+", due to "+Fb.message),null}};a.util.BaiduUtil.MultiPolygon_BD09LonLatToPix=
function(e,d,f,g,h){var l=a.geometry,t,F,I,P;try{var aa=[];for(F=0;F<e.coordinates.length;F+=1){var U=e.coordinates[F][0],ca=[];for(P=0;P<U.length;P+=e.dim){var ua;h?(ua=f.project.pointToLngLat(new BMap.Pixel(U[P],U[P+1])),ca.push(ua.lng),ca.push(ua.lat)):(ua=f.project.lngLatToPoint(new BMap.Point(U[P],U[P+1])),ca.push(ua.x),ca.push(ua.y));for(I=2;I<e.dim;I+=1)ca.push("")}var Oa=[];Oa.push(ca);aa.push(Oa)}t=l.Geometry.createGeometry({type:e.type,dim:e.dim,coordinates:aa},d);g&&g(t,f);return t}catch(Va){return a.util.Logger.warning(null,
"OM.util.BaiduUtil.MultiPolygon_BD09LonLatToPix","Cannot transform geometry coordinates to SRID "+d+", due to "+Va.message),null}};a.util.BaiduUtil.Line_WGS84ToBaiduPix=function(e,d,f,g){var h=a.geometry,l,t,F,I,P;try{var aa,U=0,ca=Math.ceil(e.coordinates.length/200),ua=[],Oa={};l=0;for(I=e.coordinates.length;l<I;l+=e.dim){var Va=e.coordinates[l],b=e.coordinates[l+1];0<l&&0===l%200?(aa=ua.join(""),ua=[],a.util.BaiduUtil.doBaiduConversion(aa,Oa,U,f),U+=1):l===I-e.dim&&(ua.push(";"+Va+","+b),aa=ua.join(""),
ua=[],a.util.BaiduUtil.doBaiduConversion(aa,Oa,U,f),U+=1);0===l||0===l%200?ua.push(""+Va+","+b):ua.push(";"+Va+","+b)}var c=!0,ub,Ab=0;ub=setInterval(function(){a:if(Ab++,100<Ab)clearInterval(ub),a.util.Logger.warning(null,"OM.util.BaiduUtil.Line_WGS84ToBaiduPix","Failed to assemble the feature.");else{for(l=0;l<ca;l+=1)if(a.isNull(Oa[l.toString()])){c=!1;break a}if(!0===c){clearInterval(ub);var I=[];for(l=0;l<ca;l+=1){var U=l.toString();for(F=0;F<Oa[U].length;F+=1){var aa=new BMap.Point(Oa[U][F].x,
Oa[U][F].y),aa=f.project.lngLatToPoint(aa);I.push(aa.x);I.push(aa.y);for(t=2;t<e.dim;t+=1)I.push("")}}P=h.Geometry.createGeometry({type:e.type,dim:e.dim,coordinates:I},d);P.dim=e.dim;g(P,f)}}},1E3);return P}catch(rb){return a.util.Logger.warning(null,"OM.util.BaiduUtil.Line_WGS84ToBaiduPix","Cannot transform geometry coordinates to SRID "+d+", due to "+rb.message),null}};a.util.BaiduUtil.Line_BD09LonLatToPix=function(e,d,f,g,h){var l=a.geometry,t,F,I;try{var P=[];for(I=0;I<e.coordinates.length;I+=
e.dim){var aa;h?(aa=f.project.pointToLngLat(new BMap.Pixel(e.coordinates[I],e.coordinates[I+1])),P.push(aa.lng),P.push(aa.lat)):(aa=f.project.lngLatToPoint(new BMap.Point(e.coordinates[I],e.coordinates[I+1])),P.push(aa.x),P.push(aa.y));for(F=2;F<e.dim;F+=1)P.push("")}t=l.Geometry.createGeometry({type:e.type,dim:e.dim,coordinates:P},d);g&&g(t,f);return t}catch(U){return a.util.Logger.warning(null,"OM.util.BaiduUtil.Line_BD09LonLatToPix","Cannot transform geometry coordinates to SRID "+d+", due to "+
U.message),null}};a.util.BaiduUtil.transformLonLatToPix_MultiLine=function(e,d,f,g,h){return f.enableBD09Encoding&&this.isWithinChinaRect(e)&&!0!==h?a.util.BaiduUtil.MultiLine_WGS84ToBaiduPix(e,d,f,g):a.util.BaiduUtil.MultiLine_BD09LonLatToPix(e,d,f,g)};a.util.BaiduUtil.transformLonLatToPix_Line=function(e,d,f,g,h){return f.enableBD09Encoding&&this.isWithinChinaRect(e)&&!0!==h?a.util.BaiduUtil.Line_WGS84ToBaiduPix(e,d,f,g):a.util.BaiduUtil.Line_BD09LonLatToPix(e,d,f,g)};a.util.BaiduUtil.transformLonLatToPix_Rectangle=
function(e,d,f,g,h){return f.enableBD09Encoding&&this.isWithinChinaRect(e)&&!0!==h?a.util.BaiduUtil.Rectangle_WGS84ToPix(e,d,f,g):a.util.BaiduUtil.Rectangle_BD09LonLatToPix(e,d,f,g)};a.util.BaiduUtil.transformLonLatToPix_Polygon=function(e,d,f,g,h){return f.enableBD09Encoding&&this.isWithinChinaRect(e)&&!0!==h?a.util.BaiduUtil.Polygon_WGS84ToPix(e,d,f,g):a.util.BaiduUtil.Polygon_BD09LonLatToPix(e,d,f,g)};a.util.BaiduUtil.transformLonLatToPix_MultiPolygon=function(e,d,f,g,h){return f.enableBD09Encoding&&
this.isWithinChinaRect(e)&&!0!==h?a.util.BaiduUtil.MultiPolygon_WGS84LonLatToPix(e,d,f,g):a.util.BaiduUtil.MultiPolygon_BD09LonLatToPix(e,d,f,g)};a.util.BaiduUtil.doBaiduConversion=function(e,d,f,g){var h={};h.coords=e;h.from="1";h.to="5";h.ak=g.ak;$.ajax({type:"GET",dataType:"jsonp",data:h,crossDomain:!0,url:g.BD09_APIURL,success:function(e){if(0===e.status){var g,h=[];for(g=0;g<e.result.length;g++)h.push(e.result[g]);d[f.toString()]=h}else a.util.Logger.warning("","OM.util.BaiduUtil.doBaiduConversion",
"baidu server returned error: "+e.message)},error:function(){a.util.Logger.warning("","BaiduUtil.doBaiduConversion","failed to encode.")}})};a.util.BaiduUtil.isZoomLevelValid=function(e){return a.isNull(e)?!1:e<a.util.BaiduUtil.MIN_ZOOM_LEVEL?(a.util.Logger.warning("","BaiduUtil.isZoomLevelValid","Baidu Map zoom level cannot be smaller than "+a.util.BaiduUtil.MIN_ZOOM_LEVEL),!1):e>a.util.BaiduUtil.MAX_ZOOM_LEVEL?(a.util.Logger.warning("","BaiduUtil.isZoomLevelValid","Baidu Map zoom level cannot be greater than "+
a.util.BaiduUtil.MAX_ZOOM_LEVEL),!1):!0};a.util.BaiduUtil.getValidZoomLevel=function(e){return a.isNull(e)?(a.util.Logger.warning("","BaiduUtil.getValidZoomLevel","Desired zoom level was not provided, returning: "+a.util.BaiduUtil.MIN_ZOOM_LEVEL),a.util.BaiduUtil.MIN_ZOOM_LEVEL):e<a.util.BaiduUtil.MIN_ZOOM_LEVEL?(a.util.Logger.warning("","BaiduUtil.getValidZoomLevel","Zoom level was out of supported range, adjusted from "+e+" to "+a.util.BaiduUtil.MIN_ZOOM_LEVEL),a.util.BaiduUtil.MIN_ZOOM_LEVEL):
e>a.util.BaiduUtil.MAX_ZOOM_LEVEL?(a.util.Logger.warning("","BaiduUtil.getValidZoomLevel","Zoom level was out of supported range, adjusted from "+e+" to "+a.util.BaiduUtil.MAX_ZOOM_LEVEL),a.util.BaiduUtil.MAX_ZOOM_LEVEL):e};a.util.BaiduUtil.transform_PixToBD09LonLat=function(e){a.isNull(e.toSrid)&&(e.toSrid=8307);var d=e.geom;if(a.isNull(d.srid)||a.isNull(e.toSrid))return a.util.Logger.warning("","OM.util.BaiduUtil.transform_BD09LonLatToPix","SRID is not specified."),null;var f=e.geom,g=e.callBack,
h=e.bdutil,l=e.toSrid;if(8307===d.srid||4326===d.srid)return g&&g(d,h),f;if(e.bdutil)switch(d.type){case "Point":return a.util.BaiduUtil.Point_BD09LonLatToPix(d,l,h,g,!0);case "LineString":return a.util.BaiduUtil.Line_BD09LonLatToPix(f,l,h,g,!0);case "MultiLineString":return a.util.BaiduUtil.MultiLine_BD09LonLatToPix(f,l,h,g,!0);case "Rectangle":return a.util.BaiduUtil.Rectangle_BD09LonLatToPix(f,l,h,g,!0);case "Polygon":return a.util.BaiduUtil.Polygon_BD09LonLatToPix(f,l,h,g,!0);case "MultiPolygon":return a.util.BaiduUtil.MultiPolygon_BD09LonLatToPix(f,
l,h,g,!0);default:return a.util.Logger.warning("","OM.util.BaudiUtil.transform_PixToBD09LonLat","Type ["+this.type+"] is not supported yet."),null}else return a.util.Logger.warning("","OM.util.BaudiUtil.transform_PixToBD09LonLat","Baidu BD09 encoding utility is not provided."),null};a.util.DomUtil=function(){};a.util.DomUtil.css=function(e){var d=document.styleSheets,f={},g;for(g in d)try{var h=d[g].rules||d[g].cssRules,l;for(l in h)e.is(h[l].selectorText)&&a.$.extend(f,a.util.DomUtil.css2json(h[l].style))}catch(t){}a.$.extend(f,
a.util.DomUtil.css2json(e.attr("style")));return f};a.util.DomUtil.css2json=function(a){var d={};if(!a)return d;var f;if(a instanceof CSSStyleDeclaration)for(f in a)a[f].toLowerCase&&(d[a[f].toLowerCase()]=a[a[f]]);else if("string"==typeof a)for(f in a=a.split(";"),a){var g=a[f].split(":");d[g[0].toLowerCase()]=g[1]}return d};a.util.DomUtil.getComputedStyle=function(a){var d={};if(c.getComputedStyle){var f=function(a,e){return e.toUpperCase()};a=c.getComputedStyle(a,null);for(var g=0,h=a.length;g<
h;g++){var l=a[g],t=l.replace(/\-([a-z])/g,f),l=a.getPropertyValue(l);d[t]=l}}else if(a.currentStyle)for(f in a=a.currentStyle,a)d[f]=a[f];return d};a.util.DomUtil.setImageSrc=function(e,d,f){var g=a.$(e);d?(g.css("opacity",f),g.attr("src",d)):g.attr("src",a.util.MiscUtil.transparentImgURL);g[0].onerror=function(){g.attr("src",a.gv.resourcePath()+"blank.gif");a.util.Logger.warning("","OM.util.DomUtil.setImageSrc","Failed fetching image from: "+d)}};a.util.DomUtil.changeOpacity=function(e,d){a.$(e).css("opacity",
d)};a.util.DomUtil.pixel=function(a){return Math.round(a)+"px"};a.util.DomUtil.createImageNode=function(e,d){var f=null,f=document.createElement("img");f.src=e;a.browser.msie&&!d&&(f.galleryImg="no");a.browser.mozilla?f.style.MozUserSelect="none":a.browser.safari?f.style.KhtmlUserSelect="none":a.browser.msie&&(f.unselectable="on");return f};a.util.DomUtil.setCursor=function(e,d){try{-1<d.indexOf(".")&&(d='url("'+d+'"),auto'),e.style.cursor=d}catch(f){"pointer"==d&&a.util.DomUtil.setCursor(e,"hand")}};
a.util.DomUtil.getTouchCount=function(e){if(a.isNull(e.originalEvent)&&a.isNull(e.touches))return a.util.Logger.warning("","OM.util.DomUtil.getTouchCount","Received event with no touch information: "),0;e.originalEvent&&(e=e.originalEvent);if("TOUCHSTART"===e.type.toUpperCase())return e.touches.length;if("TOUCHEND"===e.type.toUpperCase())return e.changedTouches.length};a.util.DomUtil.getTouchesPosition=function(a){a.originalEvent&&(a=a.originalEvent);if(a.touches){for(var d=a.touches.length,f=[],
g=0;g<d;g++)f.push({x:a.touches[g].pageX,y:a.touches[g].pageY});return 1==f.length?f[0]:f}return[]};a.util.DomUtil.getTouchesClientPosition=function(a){a.originalEvent&&(a=a.originalEvent);if(a.touches){for(var d=a.touches.length,f=[],g=0;g<d;g++)f.push({x:a.touches[g].clientX,y:a.touches[g].clientY});return 1===f.length?f[0]:f}return[]};a.util.DomUtil.getChangedTouchesPosition=function(a){a.originalEvent&&(a=a.originalEvent);if(a.changedTouches){for(var d=a.changedTouches.length,f=[],g=0;g<d;g++)f.push({x:a.changedTouches[g].pageX,
y:a.changedTouches[g].pageY});return f}return[]};a.util.DomUtil.getTouchesScale=function(a){a.originalEvent&&(a=a.originalEvent);return a.scale};a.util.DomUtil.getElementPos=function(a){if(a)return a.position()};a.util.DomUtil.getPageDirection=function(e){this.$div=a.$("\x3cdiv style\x3d'position:absolute;width:0px;height:0px;z-index:3000'\x3e\x3c/div\x3e");e.$topLayerDIV.append(this.$div);e=document.createElement("table");var d=document.createElement("tr"),f=document.createElement("td"),g=document.createElement("td"),
h=document.createElement("tbody");e.cellSpacing=0;e.cellPadding=0;f.innerHTML="fsdfsds";g.innerHTML="p";h.appendChild(d);e.appendChild(h);d.appendChild(f);d.appendChild(g);this.$div[0].appendChild(e);this.pageDirection=0===f.offsetLeft?!0:!1;this.$div[0].removeChild(e);this.$div.remove();return this.pageDirection};a.util.DomUtil.isHtml=function(a){return 0<=a.indexOf("\x3c!DOCTYPE")||0<=a.toUpperCase().indexOf("\x3cHTML")||0<=a.toUpperCase().indexOf("\x3cBODY")||0<=a.toUpperCase().indexOf("\x3cIMG")||
0<=a.toUpperCase().indexOf("\x3cDIV")||0<=a.toUpperCase().indexOf("\x3cP\x3e")||0<=a.toUpperCase().indexOf("\x3cBR")||0<=a.toUpperCase().indexOf("\x3cA")||0<=a.toUpperCase().indexOf("\x3cTABLE")||0<=a.toUpperCase().indexOf("\x3cTEXTAREA")||0<=a.toUpperCase().indexOf("\x3cINPUT")||0<=a.toUpperCase().indexOf("\x3cFONT")||0<=a.toUpperCase().indexOf("\x3cAREA")||0<=a.toUpperCase().indexOf("\x3cLABEL")||0<=a.toUpperCase().indexOf("\x3cTD")?!0:0<=a.toUpperCase().indexOf("\x3cSPAN")?!0:!1};a.util.DomUtil.setFontIcon=
function(e,d,f){if(e)return e=a.$(e),e.attr("omv2-font-icon",d),a.notNull(f)&&e.css("color",f),e};a.util.XMLUtil={};a.util.XMLUtil.parse="undefined"!==typeof c.DOMParser?function(a){return(new DOMParser).parseFromString(a,"text/xml")}:function(a){var d=new ActiveXObject("Microsoft.XMLDOM");d.async="false";d.loadXML(a);return d};a.util.XMLUtil.xmlToString="undefined"!==typeof XMLSerializer?function(a){return(new XMLSerializer).serializeToString(a)}:function(a){return a.xml};a.util.XMLUtil.getAllTextContent=
function(e,d){return a.util.XMLUtil.getAllTextContent_(e,d,[]).join("")};a.util.XMLUtil.getAllTextContent_=function(e,d,f){if(e.nodeType===Node.CDATA_SECTION_NODE||e.nodeType===Node.TEXT_NODE)d?f.push(String(e.nodeValue).replace(/(\r\n|\r|\n)/g,"")):f.push(e.nodeValue);else for(e=e.firstChild;e;e=e.nextSibling)a.util.XMLUtil.getAllTextContent_(e,d,f);return f};a.util.XMLUtil.getAttributeNS=function(a,d,f){return a.getAttributeNS(d,f)||""};a.util.XMLUtil.makeArrayPusher=function(a,d){return function(f,
g){var h=a.call(d!==b?d:this,f,g);h!==b&&g[g.length-1].push(h)}};a.util.XMLUtil.makeObjectPropertyPusher=function(a,d,f){return function(g,h){var l=a.call(f!==b?f:this,g,h);if(l!==b){var t=h[h.length-1],F=d!==b?d:g.localName;(F in t?t[F]:t[F]=[]).push(l)}}};a.util.XMLUtil.makeObjectPropertySetter=function(a,d,f){return function(g,h){var l=a.call(f!==b?f:this,g,h);l!==b&&(h[h.length-1][d!==b?d:g.localName]=l)}};a.util.XMLUtil.makeStructureNS=function(a,d,f){f=f!==b?f:{};f[a]=d;return f};a.util.XMLUtil.parseNode=
function(a,d,f,g){for(d=d.firstElementChild;d;d=d.nextElementSibling){var h=a[d.namespaceURI];h!==b&&(h=h[d.localName],h!==b&&h.call(g,d,f))}};a.util.XMLUtil.pushParseAndPop=function(e,d,f,g,h){g.push(e);a.util.XMLUtil.parseNode(d,f,g,h);return g.pop()};a.util.ValidationUtil=a.util.ValidationUtil||{isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},isNumber2:function(a){return null!==a&&"number"===typeof a},isObject:function(a){return null!==a&&"object"===typeof a},isNumberArray:function(e){if(!e||
"object"!==typeof e)return!1;var d=e.length;if(0===d)return!1;for(var f=a.util.ValidationUtil.isNumber,g=0;g<d;g++)if(!f(e[g]))return!1;return!0},getColor:function(e){if(a.isNull(e))return null;var d=typeof e;if("string"===d)return/#[0-9a-fA-F]{6}/.test(e)?e:/[0-9a-fA-F]{6}/.test(e)?"#"+e:null;if("number"===d){if(0===e)return"#000000";for(e=Math.round(e).toString(16);6>e.length;)e="0"+e;return"#"+e}return null}};a.util.CSTransformUtil=a.util.CSTransformUtil||function(){var e=[],d=[{srid:54004,params:[0,
0,1,0,0]},{srid:8307,params:[6378137,298.257223563]}],f=new function(){this.getCSTransformFunction=function(d,f){var l=e[d];if(l){if(a.notNull(l[f]))return l[f];var t=l[8307],F=e[8307][f];return a.notNull(t)&&a.notNull(F)?function(a,e){var d=t(a,e);return F(d.x,d.y)}:null}return null};this.addCSTransformFunction=function(a,d,f){var t=e[a];t||(t=e[a]=[]);t[d]=f};this.transOrdinatesArray=function(a,e,d){for(var f=a.length,F=Array(f),I=0;I<f;I+=e){var P=d(a[I],a[I+1]);F[I]=P.x;F[I+1]=P.y;for(P=2;P<e;P++)F[I+
P]=a[I+P]}return F};this.transformOrdinates=function(e,d,f){var t=a.util.ValidationUtil,F=null;f||(f=2);var I=this.transOrdinatesArray;if(t.isNumberArray(d))F=I(d,f,e);else for(var P=d.length,F=Array(P),aa=0;aa<P;aa++)if(t.isNumberArray(d[aa]))F[aa]=I(d[aa],f,e);else{var U=d[aa].length;F[aa]=Array(U);for(var ca=0;ca<U;ca++)F[aa][ca]=I(d[aa][ca],f,e)}return F};this.bootstrapTransformations=function(){var e=this,d=e.addCSTransformFunction;d(54004,8307,function(a,d){return e.mercatorToGeodetic(a,d,54004,
8307)});d(8307,54004,function(a,d){return e.geodeticToMercator(a,d,8307,54004)});d(3785,8307,function(a,d){return e.SphereMercatorToGeodetic(a,d,6378137)});d(8307,3785,function(a,d){return e.geodeticToSphereMercator(a,d,6378137)});d(3857,8307,function(a,d){return e.SphereMercatorToGeodetic(a,d,6378137)});d(8307,3857,function(a,d){return e.geodeticToSphereMercator(a,d,6378137)});d(53004,8307,function(a,d){return e.SphereMercatorToGeodetic(a,d,6371E3)});d(8307,53004,function(a,d){return e.geodeticToSphereMercator(a,
d,6371E3)});d(54004,4326,function(a,d){return e.mercatorToGeodetic(a,d,54004,8307)});d(4326,54004,function(a,d){return e.geodeticToMercator(a,d,8307,54004)});d(3785,4326,function(a,d){return e.SphereMercatorToGeodetic(a,d,6378137)});d(4326,3785,function(a,d){return e.geodeticToSphereMercator(a,d,6378137)});d(3857,4326,function(a,d){return e.SphereMercatorToGeodetic(a,d,6378137)});d(4326,3857,function(a,d){return e.geodeticToSphereMercator(a,d,6378137)});d(53004,4326,function(a,d){return e.SphereMercatorToGeodetic(a,
d,6371E3)});d(4326,53004,function(a,d){return e.geodeticToSphereMercator(a,d,6371E3)});d(53004,54004,function(a,d){var f=e.SphereMercatorToGeodetic(a,d,6371E3);return e.geodeticToMercator(f.x,f.y,8307,54004)});d(54004,53004,function(a,d){var f=e.mercatorToGeodetic(a,d,54004,8307);return e.geodeticToSphereMercator(f.x,f.y,6371E3)});d(3785,54004,function(a,d){var f=e.SphereMercatorToGeodetic(a,d,6378137);return e.geodeticToMercator(f.x,f.y,8307,54004)});d(54004,3785,function(a,d){var f=e.mercatorToGeodetic(a,
d,54004,8307);return e.geodeticToSphereMercator(f.x,f.y,6378137)});d(3857,54004,function(a,d){var f=e.SphereMercatorToGeodetic(a,d,6378137);return e.geodeticToMercator(f.x,f.y,8307,54004)});d(54004,3857,function(a,d){var f=e.mercatorToGeodetic(a,d,54004,8307);return e.geodeticToSphereMercator(f.x,f.y,6378137)});d(3785,53004,function(a,d){var f=e.SphereMercatorToGeodetic(a,d,6378137);return e.geodeticToSphereMercator(f.x,f.y,6371E3)});d(53004,3785,function(a,d){var f=e.SphereMercatorToGeodetic(a,d,
6371E3);return e.geodeticToSphereMercator(f.x,f.y,6378137)});d(3857,53004,function(a,d){var f=e.SphereMercatorToGeodetic(a,d,6378137);return e.geodeticToSphereMercator(f.x,f.y,6371E3)});d(53004,3857,function(a,d){var f=e.SphereMercatorToGeodetic(a,d,6371E3);return e.geodeticToSphereMercator(f.x,f.y,6378137)});d(3857,3785,function(a,e){return{x:a,y:e}});d(3785,3857,function(a,e){return{x:a,y:e}});var f=new a.proj.Albers({standardParallel_1:29.5,standardParallel_2:45.5,lonCenter:-96,latOrigin:23});
d(8307,32775,f.forward);d(32775,8307,f.inverse);d(8307,505050,a.proj.AlbersUSA.forward);d(505050,8307,a.proj.AlbersUSA.inverse);d(4326,505050,a.proj.AlbersUSA.forward);d(505050,4326,a.proj.AlbersUSA.inverse);f=new a.proj.Winkel3(0);d(8307,1009801,f.forward);d(1009801,8307,f.inverse);f=new a.proj.Robinson(0);d(8307,180224,f.forward);d(180224,8307,f.inverse)};this.geodeticToMercator=function(e,d,f,t){var F=this.getCSParameters(t),I=this.getCSParameters(f);if(!F||!I)return null;d=a.util.GeomUtil.getRadiansFromLatLon(e,
d);e=d.x;d=d.y;var P=F[3];f=F[4];t=F[2];var aa=F[1],F=I[0],I=1/I[1],I=Math.sqrt(2*I-I*I);e=P+F*t*(e-aa);P=Math.sin(d);d=Math.tan(Math.PI/4+d/2);P=Math.pow((1-I*P)/(1+I*P),I/2);d=f+F*t*Math.log(d*P);return{x:e,y:d}};this.mercatorToGeodetic=function(e,d,f,t){var F=this.getCSParameters(f),I=this.getCSParameters(t);if(!F||!I)return null;t=F[3];var P=F[4];f=F[2];var F=F[1],aa=I[0],I=1/I[1],I=Math.sqrt(2*I-I*I);d=Math.pow(Math.E,(P-d)/(aa*f));d=Math.PI/2-2*Math.atan2(d,1);var U=Math.pow(I,4),ca=Math.pow(I,
6),ua=Math.pow(I,8),I=I*I/2,P=5*U/24,Oa=ca/12,Va=13*ua/360,b=Math.sin(2*d),U=7*U/48,c=29*ca/240,ub=811*ua/11520,Ab=Math.sin(2*d),ca=7*ca/120,rb=81*ua/1120,Bb=Math.sin(6*d),ua=4279*ua/161280,Fb=Math.sin(8*d);return a.util.GeomUtil.getLatLonFromRadians((e-t)/(aa*f)+F,d+(I+P+Oa+Va)*b+(U+c+ub)*Ab+(ca+rb)*Bb+ua*Fb)};this.getCSParameters=function(a){for(var e=d.length,f=0;f<e;f++)if(d[f].srid===a)return d[f].params;return null};this.geodeticToSphereMercator=function(e,d,f){85<d?d=85:-85>d&&(d=-85);d=a.util.GeomUtil.getRadiansFromLatLon(e,
d);e=d.x;d=d.y;d=Math.sin(d);d=Math.log((1+d)/(1-d));return{x:f*e,y:d*f/2}};this.SphereMercatorToGeodetic=function(e,d,f){e/=f;d=Math.pow(Math.E,2*d/f);d=Math.asin((d-1)/(d+1));return a.util.GeomUtil.getLatLonFromRadians(e,d)}};f.bootstrapTransformations();return f}();a.util.HttpRequest={};a.util.HttpRequest.localDomain=document.location.protocol+"//"+document.location.host;a.util.HttpRequest.instanceId=Math.round(1E4*Math.random());a.util.HttpRequest.reqCount=0;a.util.HttpRequest.scriptTagCount=
0;a.util.HttpRequest.requests=[];a.util.HttpRequest.urlMaxLength=4E3;a.util.HttpRequest.instanceIdTable={};a.util.HttpRequest.send=function(e,d,f,g,h,l,t){if(e){a.isNull(t)&&(t=a.gv.proxyEnabled);var F=a.util.HttpRequest,I=function(d,f,g){"abort"!==g&&(h?h(d,f,g):(f="URL: "+e,g&&(f+="\nError: "+g),d&&d.responseText&&(f+="\nResponse : "+d.responseText),a.util.Logger.alert("MAPVIEWER_9014","OM.util.HttpRequest.send",f)))},P="POST";"GET"===a.gv._httpMethod&&(P="GET");var aa=!1;d.$enableXHR&&(aa=!0,delete d.$enableXHR);
return F.isLocalDomain(e)||aa?"json"===g||"jsonp"===g?(new F.XHR(a.$.ajax({url:e,data:d,method:P,success:function(e){try{var d=null,d=a.$.parseJSON(e);f(d)}catch(g){e=g.message,g.stack&&(e+="\n  Stack: "+g.stack),a.util.Logger.warning("MAPVIEWER_9013","OM.util.HttpRequest.send",e),h&&h(this.jqXHR,"Error parsing response as JSON data.",g)}},dataType:"text",xhrFields:{withCredentials:!0}}))).setErrorHandler(I):(new F.XHR(a.$.ajax({url:e,method:P,data:d,success:f,dataType:g,xhrFields:{withCredentials:!0}}))).setErrorHandler(I):
"jsonp"===g||"xml"===g||"XML"===g||"Xml"===g?(new F.XHR(a.$.ajax({url:e,method:P,data:d,success:f,dataType:g}))).setErrorHandler(I):t?(l=a.util.HttpRequest.localDomain+a.gv.proxyPath,d.rtarget=e,(new F.XHR(P(l,d,function(a){f(a)},g))).setErrorHandler(I)):F.sendAsScripts(e,d,f,g,l)}};a.util.HttpRequest.sendAsScripts=function(e,d,f,g,h){function l(a){F=a;t.instanceIdTable[e]=a;t.sendAsScriptsWithId(e,d,f,g,F)}if(!e)return null;var t=a.util.HttpRequest,F=t.instanceIdTable[e];if(a.isNull(F)){var I="v2"+
t.reqCount++,P=e,P=0<P.indexOf("?")?P+"\x26":P+"?",P=P+("callback_id\x3d"+I+"\x26"),aa="text",U=l;h?(t.instanceIdTable[e]="_1",aa=g,U=f):P+="getinstid\x3dtrue";P+="\x26"+a.$.param(d);return t.sendAsScript(P,U,aa,I)}return t.sendAsScriptsWithId(e,d,f,g,F)};a.util.HttpRequest.sendAsScriptsWithId=function(e,d,f,g,h){var l=a.util.HttpRequest,t=new l.XHR;h="v2"+h+"_"+l.reqCount++;e=0<e.indexOf("?")?e+"\x26":e+"?";e+="callback_id\x3d"+h+"\x26";var F=e+a.$.param(d);if(F.length>l.urlMaxLength){var F={},I;
for(I in d)F[I]=d[I]+"";d=1;for(e+="ref\x3d"+Math.floor(1E4*Math.random())+"\x26";;){I=e+"pn\x3d"+d;var P=l.getParameters(F,l.urlMaxLength-I.length);if(0<l.getParametersCount(F))I=l.sendAsScript(I+P,f,g,h,d),t.addScriptId(I.getScriptIds()[0]);else{I=l.sendAsScript(e+"pn\x3de"+d+P,f,g,h,d);t.addScriptId(I.getScriptIds()[0]);break}d++}return t}return l.sendAsScript(F,f,g,h)};a.util.HttpRequest.sendAsScript=function(e,d,f,g,h){if(!e)return null;var l=a.util.HttpRequest,t=document.createElement("script");
t.id="OMV_XHR_"+l.scriptTagCount++;t.src=e;t.type="text/javascript";t.charset="utf-8";l.requests.push({jsNode:t,callBack:d,reqId:g,format:f,parts:h});document.body.appendChild(t);e=new l.XHR;e.addScriptId(t.id);return e};a.util.HttpRequest.callBack=function(e,d,f){for(var g=a.util.HttpRequest.requests,h=null;0<g.length&&(h=g[0],!h.callBack&&!h.parts);){if(h.jsNode){try{document.body.removeChild(h.jsNode)}catch(l){}h.jsNode=null}g.shift()}for(var t=0;t<g.length;t++)if(h=g[t],h.reqId===e&&h.parts===
f){e=!1;h=g[t];try{document.body.removeChild(h.jsNode)}catch(F){e=!0}h.jsNode=null;0===t&&g.shift();!e&&a.notNull(d)&&h.callBack&&("json"===h.format?"string"===typeof d?h.callBack(a.$.parseJSON(d)):h.callBack(d):"xml"===h.format?h.callBack(a.util.XMLUtil.parse(d)):h.callBack(d));h.callBack=null;break}};a.util.HttpRequest.isLocalDomain=function(e){var d=a.util.HttpRequest;e=a.$.trim(e);return 0===e.toLowerCase().indexOf("http://")||0===e.toLowerCase().indexOf("https://")?d.getDomain(e)===d.localDomain:
!0};a.util.HttpRequest.getDomain=function(a){if(!a)return null;var d=a.indexOf("://");return 0<d?(d=a.indexOf("/",d+3),0<d?a.substring(0,d):a.substring(0)):null};a.util.HttpRequest.getParameters=function(a,d){var f="",g;for(g in a){var h="\x26"+g+"\x3d";if(f.length+h.length>=d)break;f+=h;d-=f.length;var h=a[g],l=encodeURIComponent(h),t=l.length;if(t<=d)f+=l,delete a[g];else for(t=Math.floor(1*h.length/t*d);0<=t;t--)if(l=h.substring(0,t),l=encodeURIComponent(l),l.length<=d)return a[g]=h.substring(t),
f+l}return f};a.util.HttpRequest.getParametersCount=function(a){var d=0,f;for(f in a)++d;return d};a.util.HttpRequest.XHR=function(a){this.scriptTags=[];this.error=this.jQXHR=null;a&&(this.jQXHR=a)};a.util.HttpRequest.XHR.prototype.addScriptId=function(a){this.scriptTags.push(a)};a.util.HttpRequest.XHR.prototype.getScriptIds=function(){return this.scriptTags};a.util.HttpRequest.XHR.prototype.abort=function(){if(this.jQXHR)this.jQXHR.abort();else for(var a=0;a<this.scriptTags.length;a++){var d=document.getElementById(this.scriptTags[a]);
if(d&&d.parentNode)try{d.parentNode.removeChild(d)}catch(f){}}};a.util.HttpRequest.XHR.prototype.setErrorHandler=function(a){this.jQXHR?this.jQXHR.fail(a):this.error=a;return this};a.util.CoverageGrid=function(a){this.yResolution=this.xResolution=null;this.grid={};this.gridDeviceSize=this.gridHeight=this.gridWidth=128;this.setBox(a)};a.util.CoverageGrid.prototype.setBox=function(e){this.minX=e.minX;this.minY=e.minY;this.maxX=e.maxX;this.maxY=e.maxY;a.notNull(e.gridSize)&&(this.gridDeviceSize=e.gridSize)};
a.util.CoverageGrid.prototype.init=function(){this.clear()};a.util.CoverageGrid.prototype.clear=function(){var a=this.grid,d;for(d in a)delete a[d]};a.util.CoverageGrid.prototype.conflicts=function(a){for(var d=Math.floor((a[1]-this.minY)/this.gridHeight),f=Math.floor((a[2]-this.minX)/this.gridWidth),g=Math.floor((a[3]-this.minY)/this.gridHeight),h=Math.floor((a[0]-this.minX)/this.gridWidth);h<=f;h++)for(var l=d;l<=g;l++)if(this.conflictsWithCell(h,l,a))return!0;return!1};a.util.CoverageGrid.prototype.insert=
function(a){for(var d=Math.floor((a[1]-this.minY)/this.gridHeight),f=Math.floor((a[2]-this.minX)/this.gridWidth),g=Math.floor((a[3]-this.minY)/this.gridHeight),h=Math.floor((a[0]-this.minX)/this.gridWidth);h<=f;h++)for(var l=d;l<=g;l++)this.insertToCell(h,l,a)};a.util.CoverageGrid.prototype.remove=function(a){for(var d=Math.floor((a[1]-this.minY)/this.gridHeight),f=Math.floor((a[2]-this.minX)/this.gridWidth),g=Math.floor((a[3]-this.minY)/this.gridHeight),h=Math.floor((a[0]-this.minX)/this.gridWidth);h<=
f;h++)for(var l=d;l<=g;l++)this.removeFromCell(h,l,a)};a.util.CoverageGrid.prototype.insertToCell=function(a,d,f){this.grid[a]||(this.grid[a]={});this.grid[a][d]||(this.grid[a][d]=[]);this.grid[a][d].push(f)};a.util.CoverageGrid.prototype.conflictsWithCell=function(a,d,f){if(!this.grid[a]||!this.grid[a][d])return!1;a=this.grid[a][d];for(d=0;d<a.length;d++){var g=a[d];if(!(g[2]<=f[0]||g[0]>=f[2]||g[3]<f[1]||g[1]>f[3]))return!0}return!1};a.util.CoverageGrid.prototype.removeFromCell=function(a,d,f){if(this.grid[a]&&
this.grid[a][d]){d=this.grid[a][d];for(var g=0;g<d.length;g++)if(d[g]===f){this.grid[a].splice(g,1);break}}};a.util.MiscUtil=a.util.MiscUtil||{arraysAreEqual:function(e,d){if(!(e===d||a.isNull(e)&&a.isNull(d)||a.isNull(e)&&0===d.length||0===e.length&&a.isNull(d))){if(null===e||null===d||e.length!==d.length)return!1;for(var f=0,g=e.length;f<g;f++)if(e[f]!=d[f])return!1}return!0},mixin:function(a){for(var d=Array.prototype.slice.call(arguments,1),f=d.length,g,h=0;h<f;h++)if(g=d[h])for(var l in g)g.hasOwnProperty(l)&&
(a[l]=g[l]);return a},mark:function(){var a=0;return function(d){d._omapsid_=d._omapsid_||++a;return d._omapsid_}}(),signURL:function(e,d){if(a.isNull(CryptoJS)||a.isNull(e)||a.isNull(d))return null;var f=e.replace("-","+"),f=f.replace("_","/"),f=CryptoJS.enc.Base64.parse(f),f=CryptoJS.HmacSHA1(d,f),f=CryptoJS.enc.Base64.stringify(f),f=f.replace("+","-");return f=f.replace("/","_")},generateUid:function(a){function d(){return(65536*(1+Math.random())|0).toString(16).substring(1)}a=a||"-";return d()+
d()+a+d()+a+d()+a+d()+a+d()+d()+d()},parseNumberAndUnit:function(e){var d={};if(a.isNull(e))return d;if(a.util.ValidationUtil.isNumber(e))return d.value=e,d;e=e.trim();for(var f="",g=null,h=0;h<e.length;h++){var l=e.charAt(h);if(a.util.ValidationUtil.isNumber(l)||"-"===l&&0===h)f+=l;else if("."===l)a.util.ValidationUtil.isNumber(e.charAt(h+1))&&(f+=l);else{g=e.substring(h,e.length).trim();break}}0<f.length&&(d.value=f);a.isNotNull(g)&&(d.unit=g);return d},substituteStr:function(e,d,f){var g=e.toUpperCase().indexOf(d.toUpperCase());
return 0>g?(a.util.Logger.warning("MAPVIEWER_9200","OM.util.MiscUtil.substituteStr","Did not find "+d+" in "+e),e):e.substring(0,g)+f+e.substring(g+d.length)},oddNumberClick:function(e,d){var f,g=0;if(a.isNull(d)||0>=d)d=a.event.MouseEvent.DEBOUNCE_MILI_SEC;return function(){var a=this,l=arguments,t=function(){f=null;e.apply(a,l);g=0};clearTimeout(f);g+=1;0!==g%2&&(f=setTimeout(t,d))}},debounce:function(e,d){var f;if(a.isNull(d)||0>=d)d=a.event.MouseEvent.DEBOUNCE_MILI_SEC;return function(){var a=
this,h=arguments;clearTimeout(f);f=setTimeout(function(){f=null;e.apply(a,h)},d)}},md5Hash:function(){function e(a,e){var f=e[0],g=e[1],h=e[2],aa=e[3],U=e[4],ca=e[5],ua=e[6],Oa=e[7],Va=e[8],b=e[9],c=e[10],ub=e[11],Ab=e[12],rb=e[13],Bb=e[14],Fb=e[15],Ea=a[0],Ha=a[1],Ia=a[2],xa=a[3],Ea=d(Ha&Ia|~Ha&xa,Ea,Ha,f,7,-680876936),xa=d(Ea&Ha|~Ea&Ia,xa,Ea,g,12,-389564586),Ia=d(xa&Ea|~xa&Ha,Ia,xa,h,17,606105819),Ha=d(Ia&xa|~Ia&Ea,Ha,Ia,aa,22,-1044525330),Ea=d(Ha&Ia|~Ha&xa,Ea,Ha,U,7,-176418897),xa=d(Ea&Ha|~Ea&
Ia,xa,Ea,ca,12,1200080426),Ia=d(xa&Ea|~xa&Ha,Ia,xa,ua,17,-1473231341),Ha=d(Ia&xa|~Ia&Ea,Ha,Ia,Oa,22,-45705983),Ea=d(Ha&Ia|~Ha&xa,Ea,Ha,Va,7,1770035416),xa=d(Ea&Ha|~Ea&Ia,xa,Ea,b,12,-1958414417),Ia=d(xa&Ea|~xa&Ha,Ia,xa,c,17,-42063),Ha=d(Ia&xa|~Ia&Ea,Ha,Ia,ub,22,-1990404162),Ea=d(Ha&Ia|~Ha&xa,Ea,Ha,Ab,7,1804603682),xa=d(Ea&Ha|~Ea&Ia,xa,Ea,rb,12,-40341101),Ia=d(xa&Ea|~xa&Ha,Ia,xa,Bb,17,-1502002290),Ha=d(Ia&xa|~Ia&Ea,Ha,Ia,Fb,22,1236535329),Ea=d(Ha&xa|Ia&~xa,Ea,Ha,g,5,-165796510),xa=d(Ea&Ia|Ha&~Ia,xa,
Ea,ua,9,-1069501632),Ia=d(xa&Ha|Ea&~Ha,Ia,xa,ub,14,643717713),Ha=d(Ia&Ea|xa&~Ea,Ha,Ia,f,20,-373897302),Ea=d(Ha&xa|Ia&~xa,Ea,Ha,ca,5,-701558691),xa=d(Ea&Ia|Ha&~Ia,xa,Ea,c,9,38016083),Ia=d(xa&Ha|Ea&~Ha,Ia,xa,Fb,14,-660478335),Ha=d(Ia&Ea|xa&~Ea,Ha,Ia,U,20,-405537848),Ea=d(Ha&xa|Ia&~xa,Ea,Ha,b,5,568446438),xa=d(Ea&Ia|Ha&~Ia,xa,Ea,Bb,9,-1019803690),Ia=d(xa&Ha|Ea&~Ha,Ia,xa,aa,14,-187363961),Ha=d(Ia&Ea|xa&~Ea,Ha,Ia,Va,20,1163531501),Ea=d(Ha&xa|Ia&~xa,Ea,Ha,rb,5,-1444681467),xa=d(Ea&Ia|Ha&~Ia,xa,Ea,h,9,-51403784),
Ia=d(xa&Ha|Ea&~Ha,Ia,xa,Oa,14,1735328473),Ha=d(Ia&Ea|xa&~Ea,Ha,Ia,Ab,20,-1926607734),Ea=d(Ha^Ia^xa,Ea,Ha,ca,4,-378558),xa=d(Ea^Ha^Ia,xa,Ea,Va,11,-2022574463),Ia=d(xa^Ea^Ha,Ia,xa,ub,16,1839030562),Ha=d(Ia^xa^Ea,Ha,Ia,Bb,23,-35309556),Ea=d(Ha^Ia^xa,Ea,Ha,g,4,-1530992060),xa=d(Ea^Ha^Ia,xa,Ea,U,11,1272893353),Ia=d(xa^Ea^Ha,Ia,xa,Oa,16,-155497632),Ha=d(Ia^xa^Ea,Ha,Ia,c,23,-1094730640),Ea=d(Ha^Ia^xa,Ea,Ha,rb,4,681279174),xa=d(Ea^Ha^Ia,xa,Ea,f,11,-358537222),Ia=d(xa^Ea^Ha,Ia,xa,aa,16,-722521979),Ha=d(Ia^
xa^Ea,Ha,Ia,ua,23,76029189),Ea=d(Ha^Ia^xa,Ea,Ha,b,4,-640364487),xa=d(Ea^Ha^Ia,xa,Ea,Ab,11,-421815835),Ia=d(xa^Ea^Ha,Ia,xa,Fb,16,530742520),Ha=d(Ia^xa^Ea,Ha,Ia,h,23,-995338651),Ea=d(Ia^(Ha|~xa),Ea,Ha,f,6,-198630844),xa=d(Ha^(Ea|~Ia),xa,Ea,Oa,10,1126891415),Ia=d(Ea^(xa|~Ha),Ia,xa,Bb,15,-1416354905),Ha=d(xa^(Ia|~Ea),Ha,Ia,ca,21,-57434055),Ea=d(Ia^(Ha|~xa),Ea,Ha,Ab,6,1700485571),xa=d(Ha^(Ea|~Ia),xa,Ea,aa,10,-1894986606),Ia=d(Ea^(xa|~Ha),Ia,xa,c,15,-1051523),Ha=d(xa^(Ia|~Ea),Ha,Ia,g,21,-2054922799),Ea=
d(Ia^(Ha|~xa),Ea,Ha,Va,6,1873313359),xa=d(Ha^(Ea|~Ia),xa,Ea,Fb,10,-30611744),Ia=d(Ea^(xa|~Ha),Ia,xa,ua,15,-1560198380),Ha=d(xa^(Ia|~Ea),Ha,Ia,rb,21,1309151649),Ea=d(Ia^(Ha|~xa),Ea,Ha,U,6,-145523070),xa=d(Ha^(Ea|~Ia),xa,Ea,ub,10,-1120210379),Ia=d(Ea^(xa|~Ha),Ia,xa,h,15,718787259),Ha=d(xa^(Ia|~Ea),Ha,Ia,b,21,-343485551);a[0]=~~(Ea+a[0]);a[1]=~~(Ha+a[1]);a[2]=~~(Ia+a[2]);a[3]=~~(xa+a[3])}function d(a,d,e,f,g,h){d=~~(~~(d+a)+~~(f+h));return~~((d<<g|d>>>32-g)+e)}function f(a){return h[a>>4&15]+h[a>>0&
15]+h[a>>12&15]+h[a>>8&15]+h[a>>20&15]+h[a>>16&15]+h[a>>28&15]+h[a>>24&15]}var g=[0,8,16,24],h="0123456789abcdef".split("");return function(d){if(a.isNull(d))return"";for(var h=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],F=d.length,I=[1732584193,-271733879,-1732584194,271733878],P=64;P<=F;P+=64){var aa=h,U=d,ca=P-64;aa[0]=U.charCodeAt(ca)+(U.charCodeAt(1+ca)<<8)+(U.charCodeAt(2+ca)<<16)+(U.charCodeAt(3+ca)<<24);aa[1]=U.charCodeAt(4+ca)+(U.charCodeAt(5+ca)<<8)+(U.charCodeAt(6+ca)<<16)+(U.charCodeAt(7+ca)<<24);
aa[2]=U.charCodeAt(8+ca)+(U.charCodeAt(9+ca)<<8)+(U.charCodeAt(10+ca)<<16)+(U.charCodeAt(11+ca)<<24);aa[3]=U.charCodeAt(12+ca)+(U.charCodeAt(13+ca)<<8)+(U.charCodeAt(14+ca)<<16)+(U.charCodeAt(15+ca)<<24);aa[4]=U.charCodeAt(16+ca)+(U.charCodeAt(17+ca)<<8)+(U.charCodeAt(18+ca)<<16)+(U.charCodeAt(19+ca)<<24);aa[5]=U.charCodeAt(20+ca)+(U.charCodeAt(21+ca)<<8)+(U.charCodeAt(22+ca)<<16)+(U.charCodeAt(23+ca)<<24);aa[6]=U.charCodeAt(24+ca)+(U.charCodeAt(25+ca)<<8)+(U.charCodeAt(26+ca)<<16)+(U.charCodeAt(27+
ca)<<24);aa[7]=U.charCodeAt(28+ca)+(U.charCodeAt(29+ca)<<8)+(U.charCodeAt(30+ca)<<16)+(U.charCodeAt(31+ca)<<24);aa[8]=U.charCodeAt(32+ca)+(U.charCodeAt(33+ca)<<8)+(U.charCodeAt(34+ca)<<16)+(U.charCodeAt(35+ca)<<24);aa[9]=U.charCodeAt(36+ca)+(U.charCodeAt(37+ca)<<8)+(U.charCodeAt(38+ca)<<16)+(U.charCodeAt(39+ca)<<24);aa[10]=U.charCodeAt(40+ca)+(U.charCodeAt(41+ca)<<8)+(U.charCodeAt(42+ca)<<16)+(U.charCodeAt(43+ca)<<24);aa[11]=U.charCodeAt(44+ca)+(U.charCodeAt(45+ca)<<8)+(U.charCodeAt(46+ca)<<16)+(U.charCodeAt(47+
ca)<<24);aa[12]=U.charCodeAt(48+ca)+(U.charCodeAt(49+ca)<<8)+(U.charCodeAt(50+ca)<<16)+(U.charCodeAt(51+ca)<<24);aa[13]=U.charCodeAt(52+ca)+(U.charCodeAt(53+ca)<<8)+(U.charCodeAt(54+ca)<<16)+(U.charCodeAt(55+ca)<<24);aa[14]=U.charCodeAt(56+ca)+(U.charCodeAt(57+ca)<<8)+(U.charCodeAt(58+ca)<<16)+(U.charCodeAt(59+ca)<<24);aa[15]=U.charCodeAt(60+ca)+(U.charCodeAt(61+ca)<<8)+(U.charCodeAt(62+ca)<<16)+(U.charCodeAt(63+ca)<<24);e(I,h)}h=d.substring(P-64);P=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];aa=h.length&-4;
for(d=0;d<aa;d+=4)P[d>>2]=h.charCodeAt(d)|h.charCodeAt(d+1)<<8|h.charCodeAt(d+2)<<16|h.charCodeAt(d+3)<<24;aa=h.length;for(U=d>>2;d<aa;++d)P[U]|=h.charCodeAt(d)<<g[d&3];P[U]|=128<<g[d&3];55<d&&(e(I,P),P=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);P[14]=8*F;e(I,P);return f(I[0])+f(I[1])+f(I[2])+f(I[3])}}(),transparentImgURL:"data:image/gif;base64,R0lGODlhBQAFAIAAAP///wAAACH5BAEAAAAALAAAAAAFAAUAAAIEhI+pWAA7"};a.util.LoadFileUtil={};a.util.LoadFileUtil.CssLoaded=!1;a.util.LoadFileUtil.JsLoaded=!1;a.util.LoadFileUtil.JsLoadedTwice=
!1;a.util.LoadFileUtil.LoadCss=function(e){var d=document.getElementsByTagName("head")[0],f=document.createElement("link");f.setAttribute("rel","stylesheet");f.setAttribute("href",e);d.appendChild(f);f.onload=f.onreadystatechange=function(){a.util.LoadFileUtil.CssLoaded=!0;f.onload=f.onreadystatechange=null}};a.util.LoadFileUtil.LoadJs=function(e,d){var f=document.getElementsByTagName("head")[0],g=document.createElement("script");g.setAttribute("type","text/javascript");g.setAttribute("src",e);f.appendChild(g);
g.onload=g.onreadystatechange=function(){a.isNull(d)?a.util.LoadFileUtil.JsLoaded=!0:a.util.LoadFileUtil.JsLoadedTwice=!0;g.onload=g.onreadystatechange=null}};a.util.TimerManager=function(a){var d=function(){var a=this;a.schedule=function(d,e){a.cancel();a.time=e;a.callback=d;a.timeout=setTimeout(a.doCallback,e)};a.reset=function(){a.timeout&&a.schedule(a.callback,a.time)};a.cancel=function(){a.timeout&&(clearTimeout(a.timeout),a.timeout=b)};a.doCallback=function(){try{a.callback()}catch(d){}};return{reset:a.reset,
schedule:a.schedule,cancel:a.cancel}},f=this;f.defaultTime=a?a:2E3;f.timers=[];f.getTimer=function(a){a||(a="NO_NAME");f.timers[a]||(f.timers[a]=new d);return f.timers[a]};f.schedule=function(a,d,e){0===d||d||(d=f.defaultTime);f.getTimer(a).schedule(e,d)};f.reset=function(a){f.getTimer(a).reset()};f.cancel=function(a){f.getTimer(a).cancel()};return{schedule:f.schedule,reset:f.reset,cancel:f.cancel}};a.util.WorldMercatorUtil=a.util.WorldMercatorUtil||function(){var e=12756274*Math.PI/256,d=[e,e/2,
e/4,e/8,e/16,e/32,e/64,e/128,e/256,e/512,e/1024,e/2048,e/4096,e/8192,e/16384,e/32768,e/65536,e/131072,e/262144,e/524288,e/1048576,e/2097152,e/4194304,e/8388608],f=12756274*Math.PI/2;return new function(){this.pixelsToMeters=function(a,e,l){a=d[a];return[e*a-f,l*a-f]};this.metersToLonLat=function(a,d){var e=a/f*180,t=d/f*180,t=180/Math.PI*(2*Math.atan(Math.exp(t*Math.PI/180))-Math.PI/2);return[e,t]};this.lonLatToMeters=function(a,d){var e=a*f/180,t=Math.log(Math.tan((90+d)*Math.PI/360))/(Math.PI/180),
t=t*f/180;return[e,t]};this.metersToPixels=function(a,e,l){a=d[a];e=Math.round((e+f)/a);l=Math.round((l+f)/a);return[e,l]};this.getTileCoverage=function(d,e,f){f=(1<<d)-1-f;var t=this.pixelsToMeters(d,256*e,256*f);d=this.pixelsToMeters(d,256*(e+1),256*(f+1));return new a.geometry.Rectangle(t[0],t[1],d[0],d[1],3857)};this.getTileCoverageLL=function(d,e,f){e=this.getTileCoverage(d,e,f);d=this.metersToLonLat(e.getMinX(),e.getMinY());e=this.metersToLonLat(e.getMaxX(),e.getMaxY());return new a.geometry.Rectangle(d[0],
d[1],e[0],e[1],8307)}}}();a.util.Publisher=a.util.Publisher||{subscribers:{any:[]},subscribe:function(a,d){d=d||"any";"undefined"===typeof this.subscribers[d]&&(this.subscribers[d]=[]);this.subscribers[d].push(a)},unsubscribe:function(a,d){this.visitSubscribers("unsubscribe",a,d)},publish:function(a,d){this.visitSubscribers("publish",{publisher:this,publication:a},d)},visitSubscribers:function(e,d,f){var g=f||"any";f=this.subscribers[g]||[];var h=f.length;0===h&&a.util.Logger.info(0,"OM.util.Publisher",
'No methods subscribed to "'+g+'"');for(g=0;g<h;g++)if("publish"===e)f[g](d);else f[g]===d&&f.splice(g,1)}};a.util.Task=a.Class.extend({mixin:a.util.Publisher,initialize:function(e,d){this.subscribers={any:[]};this.taskType=a.util.Task.types.ANY;for(var f in a.util.Task.types)if(f===d){this.taskType=d;break}this.status=a.util.Task.actions.IDLE;e instanceof a.util.Progress&&this.subscribe(e.updateTask.bind(e))},start:function(){this.updateTask(a.util.Task.actions.START)},update:function(e){isNaN(e)?
a.util.Logger.warn(0,"OM.util.Task.update","Non numeric update!"):0<e&&1>e?this.updateTask(100*e):a.util.Logger.warn(0,"OM.util.Task.update","Update out of range")},updateTask:function(e){100===this.status||this.status===a.util.Task.actions.ERROR||this.status===a.util.Task.actions.FINISH?a.util.Logger.info(0,"OM.util.Task","WARNING: NOT UPDATING AS TASK IS DONE"):(this.status=e,this.publish(e))},complete:function(){this.updateTask(a.util.Task.actions.FINISH)},abort:function(){this.updateTask(a.util.Task.actions.ERROR)}});
a.util.Task.actions={START:"START",IDLE:"IDLE",PENDING:"PENDING",FINISH:"FINISH",ERROR:"ERROR"};a.util.Task.types={ANY:"ANY",DETERMINISTIC:"DETERMINISTIC",INDETERMINISTIC:"INDETERMINISTIC"};a.util.Progress=a.Class.extend({mixin:a.util.Publisher,initialize:function(){this.subscribers={any:[]};this.taskFamilies={any:[]};this.taskFamiliesStatus={any:{advance:0,total:0,pending:0,finished:0,error:0}};this.progress=0;this.mode=a.util.Progress.modes.DETERMINISTIC;if(a.isNull(this.map)||a.isNull(this.container)||
a.isNull(this.progDiv)||a.isNull(this.progSpan))return null},addTask:function(a){var d=a.publication;a=a.publisher;"undefined"===typeof this.taskFamilies.any&&(this.taskFamilies.any=[],this.taskFamiliesStatus.any={});this.taskFamilies.any.push(a);a.status=d},updateTask:function(e){var d=e.publication,f=e.publisher,g=this.mode;d!==a.util.Task.actions.FINISH&&d!==a.util.Task.actions.ERROR&&100!==d&&"100%"!==d||this.isTaskRegistered(f)?(this.isTaskRegistered(f)?f.status=d:this.addTask(e),this.progress=
this.updateProgress(),"100%"!==f.status&&100!==f.status&&f.status!==a.util.Task.actions.FINISH&&f.status!==a.util.Task.actions.ERROR||this.removeCompletedTasks(f),"function"===typeof this.publish&&(this.publish(this.progress,"progress"),g!==this.mode&&this.publish(this.mode,"mode"))):a.util.Logger.warning(0,"OM.util.Progress.update","Cannot finish a task not previously started")},isTaskRegistered:function(a){var d=this.taskFamilies.any;return"undefined"===typeof d||0>d.indexOf(a)?!1:!0},removeCompletedTasks:function(e){if(this.isTaskRegistered(e)){e=
this.taskFamilies.any;for(var d=e.length,f=0;f<d;f++)if(e[f].status!==a.util.Task.actions.FINISH&&e[f].status!==a.util.Task.actions.ERROR&&"100"!==e[f].status&&"100%"!==e[f].status)return;this.taskFamilies.any.length=0;this.taskFamiliesStatus.any.advance=0}},updateProgress:function(){var e=[],d=0,f=0;this.mode=a.util.Progress.modes.DETERMINISTIC;for(var g in this.taskFamilies){var h=this.taskFamilies[g],l=this.taskFamiliesStatus[g],t=h.length;if(0!==t){for(var F=a.util.Task.actions,I=0,P=0,aa=0,U=
0,ca=0;ca<t;ca++){var ua=0;h[ca].status===F.FINISH||h[ca].status===F.ERROR?(ua=100,h[ca].status===F.FINISH?P++:U++):isNaN(parseInt(h[ca].status))?(h[ca].taskType===a.util.Task.types.INDETERMINISTIC&&(this.mode=a.util.Progress.modes.INDETERMINISTIC),ua=0,aa++):(ua=parseInt(h[ca].status),100>ua?(h[ca].taskType===a.util.Task.types.INDETERMINISTIC&&(this.mode=a.util.Progress.modes.INDETERMINISTIC),aa++):P++);I+=ua;f++}0<I&&(I/=t);h=l.advance;if("undefined"===typeof h||I>=h)l.advance=I;l.total=t;l.pending=
aa;l.finish=P;l.error=U;e.push(l.advance)}}for(f=0;f<e.length;f++)d+=e[f];0<d&&(d/=e.length);return d},getStatistics:function(){return this.taskFamiliesStatus},getCurrentTasks:function(){return this.taskFamilies}});a.util.Progress.modes={DETERMINISTIC:"DETERMINISTIC",INDETERMINISTIC:"INDETERMINISTIC"};a.util.ProgressBar=a.Class.extend({initialize:function(e,d){a.isNull(e)||a.isNull(e.$oracleMapDiv)?a.util.Logger.warning(0,"OM.util.ProgressBar","Map instance or container is null!"):(this.options=d||
{enable:!0,mode:a.util.Progress.modes.DETERMINISTIC},this.container=e.$oracleMapDiv,this.progressBarDiv=a.$("\x3cdiv class\x3d'omv2_progDiv' id \x3d'progressBarDiv"+e.mapInstanceId+"'\x3e\x3c/div\x3e"),this.indetProgressBarSpan=a.$("\x3cspan class\x3d'omv2_progSpanInd' style\x3d'width:100%'\x3e\x3c/span\x3e"),this.deterProgressBarSpan=a.$("\x3cspan class\x3d'omv2_progSpan' style\x3d'width:0%'\x3e\x3c/span\x3e"),this.progressBarSpan=this.options.mode===a.util.Progress.modes.DETERMINISTIC?this.deterProgressBarSpan:
this.indetProgressBarSpan,this.progressBarDiv.append(this.progressBarSpan),this.container.append(this.progressBarDiv),this.prevStatus=0)},updateUi:function(e){e=e.publication;if(isNaN(e))a.util.Logger.warning(0,"OM.util.ProgressBar.UpdateUi","Wrong update type: ");else if(!0===this.options.enable){this.progressBarDiv.css("visibility","visible");this.progressBarSpan.css("width",this.prevStatus+"%");this.options.mode===a.util.Progress.modes.DETERMINISTIC?this.progressBarSpan.css("width",e+"%"):this.progressBarSpan.css("width",
"100%");this.prevStatus=e;var d=this.progressBarDiv;100<=e&&(e=this.prevStatus=0,this.options.mode===a.util.Progress.modes.DETERMINISTIC&&(e=500),setTimeout(function(){d.css("visibility","hidden")},e))}},switchMode:function(e){e=e.publication;var d;e!==a.util.Progress.modes.DETERMINISTIC&&e!==a.util.Progress.modes.INDETERMINISTIC?a.util.Logger.warning(0,"OM.util.ProgressBar.SwitchMode","Wrong mode: "+e):(d=this.progressBarSpan===this.deterProgressBarSpan?a.util.Progress.modes.DETERMINISTIC:a.util.Progress.modes.INDETERMINISTIC,
e!==d&&(this.progressBarSpan.remove(),this.progressBarSpan=e===a.util.Progress.modes.DETERMINISTIC?this.deterProgressBarSpan:this.indetProgressBarSpan,this.progressBarDiv.append(this.progressBarSpan),this.options.mode=e))}});a.util.ProgressBar.modes={DETERMINATE:"DETERMINATE",INDETERMINATE:"INDETERMINTATE"};a.util.ProgressBar.INDETERMINATE_START="START_INDETERMINATE";a.util.ProgressBar.INDETERMINATE_FINISH="FINISH_INDETERMINATE";a.geometry.Geometry=a.Class.extend({initialize:function(e){this.srid=
this.type=null;if(a.isNull(e))this.srid=8307;else if(a.util.ValidationUtil.isNumber(e))this.srid="number"===typeof e?e:parseInt(e);else return a.util.Logger.throwErr("MAPVIEWER_9018","geom.Geometry","srid:"+e),null;this.mbr=this.geometries=this.coordinates=null;this.dim=2},getMBR:function(){var e=a.geometry;if(!this.mbr){var d=e.Geometry.calculateMBR(this.coordinates,this.type,this.dim);this.mbr=new e.Rectangle(d.minX,d.minY,d.maxX,d.maxY,this.srid)}return this.mbr},getMIR:function(){var e=[];if("GeometryCollection"===
this.type){var d=this.geometries;if(a.isNull(d)||0===d.length)return null;for(var f=-1,g=null,h=null,l=0;l<d.length;l++)g=d[l].getMIR(),a.notNull(g)&&(e=[g.getMinX(),g.getMinY(),g.getMaxX(),g.getMaxY()],e=this.getRectangleArea(e),e>f&&(h=g,f=e));return h}d=this.dim?this.dim:2;f=this.coordinates;g=this.getMBR();e[0]=g.getMinX();e[1]=g.getMinY();e[2]=g.getMaxX();e[3]=g.getMaxY();if("Polygon"===this.type)e=this.getLabelBox(f,d);else if("MultiPolygon"===this.type)for(g=-1,h=null,l=0;l<f.length;l++)h=
this.getLabelBox(f[l],d),this.getRectangleArea(h)>g&&(e=h,g=this.getRectangleArea(e));return a.isNull(e)?null:new a.geometry.Rectangle(e[0],e[1],e[2],e[3],this.srid)},getDimension:function(){return this.dim},_getMeasure:function(e){var d=this.coordinates,f=this.geometries,g=null,h=0;if(a.isNull(d)){if(a.isNull(f))return 0;for(d=0;d<f.length;d++)h+=f[d]._getMeasure(e);return h}"area"===e?g=a.util.GeomUtil.polygonArea:"length"===e&&(g=a.util.GeomUtil.polylineLength);if(a.$.isArray(d[0])){for(e=0;e<
d.length;e++)h+=g(d[e],this.dim);return h}return g(d,this.dim)},getLength:function(){return this._getMeasure("length")},getArea:function(){return this._getMeasure("area")},getLabelBox:function(e,d){for(var f=e[0],g=a.geometry.Geometry.calculateMBR(e,"Polygon",d),g=new a.geometry.Rectangle(g.minX,g.minY,g.maxX,g.maxY,this.srid),h=(g.getMaxY()-g.getMinY())/100,l=[],t=0;100>t;t++)l[t]=this.findIntersections(f,d,g,100,t);var t=Math.floor(50),F=this.findLongestSegment(l[t]),f=null,I,P,aa;-1!=F&&(I=t,P=
l[t][F],F=l[t][F+1],aa=g.getMinY()+(t+1)*h,f=this.getOptimalBox(l,g,100,P,F,aa,I));for(t=0;100>t;t++)F=this.findLongestSegment(l[t]),-1!=F&&(I=t,P=l[t][F],F=l[t][F+1],aa=g.getMinY()+(t+1)*h,I=this.getOptimalBox(l,g,100,P,F,aa,I),this.getRectangleArea(I)>1*this.getRectangleArea(f)&&(f=I));return f},getOptimalBox:function(e,d,f,g,h,l,t){g=[g,l,h,l];l=h=!0;var F=(d.getMaxY()-d.getMinY())/f,I=t+1;for(--t;h||l;I++,t--){I>=f&&(h=!1);0>t&&(l=!1);var P=null,aa=null,U;h&&(U=d.getMinY()+(I+1)*F,P=this.expandBox(g,
e[I],U));l&&(U=d.getMinY()+(t+1)*F,aa=this.expandBox(g,e[t],U));U=P;this.getRectangleArea(P)<this.getRectangleArea(aa)?(U=aa,h&&I--):l&&t++;if(a.isNull(U)||this.getRectangleArea(U)<this.getRectangleArea(g))break;else g=U}return g},expandBox:function(e,d,f){var g=e[0],h=e[2],l=g,t=h,F=0;if(a.isNull(d)||2>d.length)return null;for(var I=1;I<d.length;I+=2){var P=d[I-1],aa=d[I];if(P>=h)break;if(!(aa<=g)&&(P=Math.max(P,g),aa=Math.min(aa,h),aa>P)){var U=aa-P;U>F&&(F=U,l=P,t=aa)}}if(0>=F)return null;d=[];
d[0]=l;d[1]=Math.min(e[1],f);d[2]=t;d[3]=Math.max(e[3],f);return d},findLongestSegment:function(e){var d=-1,f=0;if(a.isNull(e)||2>e.length)return-1;for(var g=1;g<e.length;g+=2){var h=e[g]-e[g-1];h>d&&(d=h,f=g-1)}return f},findIntersections:function(a,d,f,g,h){g=(f.getMaxY()-f.getMinY())/g;f=f.getMinY()+(h+1)*g;h=[];for(g=d;g<a.length;g+=d){var l=a[g-d],t=a[g-d+1],F=a[g],I=a[g+1],P,aa;t>I&&(P=t,aa=l,t=I,l=F,I=P,F=aa);f<t||f>I||(t!=I?h.push((F-l)*(f-t)/(I-t)+l):(h.push(l),h.push(F)))}h.sort(function(a,
d){return a-d});return h},getRectangleArea:function(e){return a.isNull(e)?0:(e[2]-e[0])*(e[3]-e[1])},transform:function(e,d,f,g,h){if(a.notNull(h)&&(e===a.util.BaiduUtil.SRID||this.srid===a.util.BaiduUtil.SRID))return a.util.BaiduUtil.transformGeom({geom:this,toSrid:e,callBack:d,map:h.map,inputIsBD09LonLat:h.inputIsBD09LonLat});var l=a.geometry;if(a.isNull(this.srid)||a.isNull(e))return a.util.Logger.warning("MAPVIEWER_9019","geom.Geometry.transform",""),null;if(this.srid===e)return d?d(this):this;
if(h=a.util.CSTransformUtil.getCSTransformFunction(this.srid,e)){f=null;try{if(this instanceof l.GeometryCollection)f=this.clientTransform(e);else{var t=a.util.CSTransformUtil.transformOrdinates(h,this.coordinates,this.dim);f=l.Geometry.createGeometry({type:this.type,dim:this.dim,coordinates:t},e);f.dim=this.dim}if(d){d(f);return}return f}catch(F){return a.util.Logger.warning(null,"geom.Geometry.transform","Cannot transform geometry coordinates to SRID "+e+": "+this.toString()+", due to "+F.message),
null}}t=a.gv.localbaseURL();if(!f&&t)f=t+"/mcserver";else if(!f){a.util.Logger.warning("MAPVIEWER_9020","geom.Geometry.transform","");return}a.util.HttpRequest.send(f,{request:"cstransform",gformat:"geojson",dstsrid:e,datasource:g,geometry:this.toString()},function(f){f?(f=l.Geometry.createGeometry(f,e),d(f)):a.util.Logger.warning("MAPVIEWER_9018","geom.Geometry.transform","")},"json",function(d){d?a.util.Logger.warning("MAPVIEWER_9018","geom.Geometry.transform",d.responseText):a.util.Logger.warning("MAPVIEWER_9018",
"geom.Geometry.transform","")})},clone:function(e){var d=a.geometry,f=this.coordinates;if(e&&f)var g=function(a){for(var d=[],e=0;e<a.length;e++)d[e]=a[e]instanceof Array?g(a[e]):a[e];return d},f=g(this.coordinates);if(this instanceof d.Circle)return new d.Circle(this.getCenterX(),this.getCenterY(),this.getRadius(),this.srid);switch(this.type){case "Point":return e=new d.Point(this.getX(),this.getY(),this.srid),2<this.dim&&(e.coordinates=f,e.dim=this.dim),e;case "OrientedPoint":return e=new d.Point(this.getX(),
this.getY(),this.srid,this.getOrientationX(),this.getOrientationY()),2<this.dim&&(e.coordinates=f,e.dim=this.dim),e;case "MultiPoint":case "OrientedMultiPoint":return new d.MultiPoint(f,this.srid,this.dim);case "LineString":return new d.LineString(f,this.srid,this.dim);case "MultiLineString":return new d.MultiLineString(f,this.srid,this.dim);case "Polygon":return new d.Polygon(f,this.srid,this.dim);case "MultiPolygon":return new d.MultiPolygon(f,this.srid,this.dim);case "Rectangle":return new d.Rectangle(this.getMinX(),
this.getMinY(),this.getMaxX(),this.getMaxY(),this.srid);case "GeometryCollection":for(var f=[],h=0,l=this.geometries;h<l;h++)f.push(this.geometries[h].clone(e));return new d.GeometryCollection(f,this.srid);default:return new d.Geometry(f,this.srid,this.dim)}},toString:function(){var e;e="{"+('"type":"'+this.type+'",');e=a.isNull(this.srid)?e+'"srid":8307,':e+('"srid":'+this.srid+",");e+='"coordinates":';var d=a.GeomTypes;if(this.type===d.MULTIPOINT||this.type===d.MULTILINESTRING||this.type===d.MULTIPOLYGON||
this.type===d.POLYGON||this.type===d.ORIENTEDMULTIPOINT){e+="[";for(var f=this.coordinates.length,g=0;g<f;g++){e+="[";if(this.type===d.MULTIPOLYGON){for(var h=this.coordinates[g].length,l=0;l<h;l++)e+="["+this.coordinates[g][l]+"],";h=e.length;e=e.substring(0,h-1)}else e+=this.coordinates[g];e+="],"}f=e.length;e=e.substring(0,f-1);e+="]"}else e+="["+this.coordinates+"]";return e+"}"},densify:function(){var e=a.GeomTypes;if(this.type===e.POINT||this.type===e.MULTIPOINT||this.type===e.ORIENTEDPOINT||
this.type===e.ORIENTEDMULTIPOINT)return this;var d={type:"GEODETIC",distConvFactor:1};if(8307!==this.srid&&8265!==this.srid&&4326!==this.srid&&4269!==this.srid&&(!d||"GEODETIC"!==d.type&&"PROJECTED"!==d.type))return this;var f=1;d&&"PROJECTED"===d.type&&(f=1E5*d.distConvFactor);var g=d=null;if(this.type===e.LINESTRING)d=a.util.GeomUtil.densifyOrdinates(this.coordinates,f),g=this.type;else if(this.type===e.RECTANGLE)e=[this.getMinX(),this.getMinY(),this.getMinX(),this.getMaxY(),this.getMaxX(),this.getMaxY(),
this.getMaxX(),this.getMinY(),this.getMinX(),this.getMinY()],d=a.util.GeomUtil.densifyOrdinates(e,f),g="Polygon";else{if(this.type===e.GEOMETRYCOLLECTION){f=this.geometries.length;e=Array(f);for(d=0;d<f;d++)e[d]=this.geometries[d].densify();return new a.geometry.GeometryCollection(e,this.srid)}for(var g=this.coordinates.length,d=Array(g),h=0;h<g;h++)if(this.type===e.MULTIPOLYGON){var l=this.coordinates[h].length;d[h]=Array(l);for(var t=0;t<l;t++)d[h][t]=a.util.GeomUtil.densifyOrdinates(this.coordinates[h][t],
f)}else d[h]=a.util.GeomUtil.densifyOrdinates(this.coordinates[h],f);g=this.type}return new a.geometry.Geometry.createGeometry({type:g,coordinates:d},this.srid)},move:function(e,d,f){a.util.GeomUtil.moveCoordinates(this.coordinates,e,d,"OrientedPoint"===this.type||"OrientedMultiPoint"===this.type?!0:!1,this.dim,f);this.mbr&&this.mbr.move(e,d)},getSRID:function(){return this.srid},getOrdinates:function(){return this.coordinates},getType:function(){return this.type},toJSON:function(){return this.type===
a.GeomTypes.GEOMETRYCOLLECTION?{type:this.type,srid:this.srid,geometries:this.geometries}:{type:this.type,srid:this.srid,coordinates:this.coordinates}}});a.geometry.Geometry.createGeometry=function(e,d){var f,g,h=a.geometry;f=a.GeomTypes;var l=e.type,t=2;e.dim&&(t=e.dim);var F=e.coordinates;g=null;var I=h.Geometry;if(l===f.POINT){if(f=F[0],g=F[1],g=new h.Point(f,g,d),2<t)for(f=2;f<t;f++)g.addDimension(F[f])}else if(l===f.ORIENTEDPOINT){if(f=F[0],g=F[1],g=new h.Point(f,g,d,F[t],F[t+1]),2<t)for(f=2;f<
t;f++)g.addDimension(F[f],F[t+f])}else if(l===f.LINESTRING)g=new h.LineString(F,d,t);else if(l===f.RECTANGLE)g=new h.Rectangle(F[0],F[1],F[2],F[3],d);else if(l===f.POLYGON)g=new h.Polygon(F,d,t);else if(l===f.MULTIPOINT||l===f.ORIENTEDMULTIPOINT)g=new h.MultiPoint(F,d,t);else if(l===f.MULTILINESTRING)g=new h.MultiLineString(F,d,t);else if(l===f.MULTIPOLYGON)g=new h.MultiPolygon(F,d,t);else if(l===f.CIRCLE)g=new h.Circle(F[0],F[1],F[2],d);else if(l===f.GEOMETRYCOLLECTION){t=e.geometries;F=t.length;
g=I.createGeometry;for(f=0;f<F;f++)t[f]=g(t[f],d);g=new h.GeometryCollection(t,d)}!e.mbr||e.mbr instanceof I||(g.mbr=new h.Rectangle(e.mbr.minX,e.mbr.minY,e.mbr.maxX,e.mbr.maxY,d));return g};a.geometry.Geometry.calculateMBR=function(e,d,f){var g={minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY,maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY},h=a.geometry.Geometry.getCoordsMBR,l=e.length;f=f?f:2;if("Polygon"===d)g=h(e[0],f,g);else if("MultiPolygon"===d)for(d=0;d<l;d++)g=h(e[d][0],
f,g);else if("LineString"===d)g=h(e,f,g);else if("MultiLineString"===d)for(d=0;d<l;d++)g=h(e[d],f,g);else if("Rectangle"===d)g={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};else if("Point"===d||"OrientedPoint"===d)g={minX:e[0],minY:e[1],maxX:e[0],maxY:e[1]};else if("MultiPoint"===d)for(d=0;d<l;d++)g=h(e[d],f,g);else if("OrientedMultiPoint"===d)for(d=0;d<l;d++)g=h([e[d][0],e[d][1]],f,g);return g};a.geometry.Geometry.getCoordsMBR=function(a,d,f){a[0]<f.minX&&(f.minX=a[0]);a[0]>f.maxX&&(f.maxX=a[0]);a[1]<
f.minY&&(f.minY=a[1]);a[1]>f.maxY&&(f.maxY=a[1]);for(var g=d,h=a.length;g<h;g+=d)a[g]<f.minX?f.minX=a[g]:a[g]>f.maxX&&(f.maxX=a[g]),a[g+1]<f.minY?f.minY=a[g+1]:a[g+1]>f.maxY&&(f.maxY=a[g+1]);return f};a.geometry.Geometry.calculateGeomCollectionMBR=function(e,d){if(!e||0===e.length||d!==a.GeomTypes.GEOMETRYCOLLECTION)return null;var f,g=null;f=null;for(var h=0;h<e.length;h++)if(f=e[h].coordinates)f=a.geometry.Geometry.calculateMBR(f,e[h].type),g?(g.minX>f.minX&&(g.minX=f.minX),g.minY>f.minY&&(g.minY=
f.minY),g.maxX<f.maxX&&(g.maxX=f.maxX),g.maxY<f.maxY&&(g.maxY=f.maxY)):(g={},g.minX=f.minX,g.minY=f.minY,g.maxX=f.maxX,g.maxY=f.maxY);return g};a.geometry.Geometry.findSubstring=function(a,d){var f=d.wkti,g=d.wktStr.substring(f).match(a);return g?(f+=g[0].length,d.wkti=f,d.wktMatch=g[0],d):null};a.geometry.Geometry.wktGetCoords=function(e){for(var d=[],f,g=a.geometry.Geometry.findSubstring;g(/^[-+]?([0-9]*\.[0-9]+([eE][-+]?[0-9]+)?|[0-9]+([eE][-+]?[0-9]+)?)/,e)||g(/^(\,)/,e);)f=e.wktMatch,","!=f&&
d.push(parseFloat(f)),g(/^\s*/,e);e.wktCoords=d;return d.length?e:null};a.geometry.Geometry.wktGetMulticoords=function(e){var d=a.geometry.Geometry.findSubstring;d(/^\s*/,e);for(var f=0,g=[],h=[],l=g,t;d(/^(\()/,e)||d(/^(\))/,e)||d(/^(\,)/,e)||d(/^[-+]?([0-9]*\.[0-9]+([eE][-+]?[0-9]+)?|[0-9]+([eE][-+]?[0-9]+)?)/,e);){t=e.wktMatch;if("("==t)h.push(l),l=[],h[h.length-1].push(l),f++;else if(")"==t){l=h.pop();if(!l)return null;f--;if(0===f)break}else if(","!==t){if(isNaN(parseFloat(t)))return null;l.push(parseFloat(t))}d(/^\s*/,
e)}if(0!==f)return null;e.wktCoords=g[0];return e};a.geometry.Geometry.wktGetMulticoordsPoint=function(e){var d=a.geometry.Geometry.findSubstring;d(/^\s*/,e);for(var f=0,g=[],h=[g],l=g,t;d(/^(\()/,e)||d(/^(\))/,e)||d(/^(\,)/,e)||d(/^[-+]?([0-9]*\.[0-9]+([eE][-+]?[0-9]+)?|[0-9]+([eE][-+]?[0-9]+)?)/,e);){t=e.wktMatch;if("("==t)h.push(l),l=[],h[h.length-1].push(l),f++;else if(")"==t){l=h.pop();if(!l)return;f--;if(0===f)break}else if(","==t)l=[],h[h.length-1].push(l);else{if(isNaN(parseFloat(t)))return null;
l.push(parseFloat(t))}d(/^\s*/,e)}if(0!==f)return null;e.wktCoords=g;return e};a.geometry.Geometry.wktToPoint=function(e){var d=a.geometry,f=d.Geometry.findSubstring;if(!f(/^(point)/i,e))return null;f(/^\s*/,e);f(/^z/i,e)&&(e.wktDim=3,f(/^\s*/,e));if(!f(/^(\()/,e))return null;var g=[];if(d.Geometry.wktGetCoords(e))g=e.wktCoords;else return null;f(/^\s*/,e);if(!f(/^(\))/,e))return null;d=new d.Point(g[0],g[1],8307);3==e.wktDim&&d.addDimension(g[2]);return d};a.geometry.Geometry.wktToLinestring=function(e){var d=
a.geometry,f=d.Geometry.findSubstring;if(!f(/^(linestring)/i,e))return null;f(/^\s*/,e);f(/^z/i,e)&&(e.wktDim=3,f(/^\s*/,e));if(!f(/^(\()/,e))return null;var g=[];if(d.Geometry.wktGetCoords(e))g=e.wktCoords;else return null;return g&&f(/^(\))/,e)?2==e.wktDim?new d.LineString(g):new d.LineString(g,8307,e.wktDim):null};a.geometry.Geometry.wktToPolygon=function(e){var d=a.geometry,f=d.Geometry.findSubstring;if(!f(/^(polygon)/i,e))return null;f(/^\s*/,e);f(/^z/i,e)&&(e.wktDim=3,f(/^\s*/,e));f=[];if(d.Geometry.wktGetMulticoords(e))f=
e.wktCoords;else return null;return 2==e.wktDim?new d.Polygon(f):new d.Polygon(f,8307,e.wktDim)};a.geometry.Geometry.wktToMultipoint=function(e){var d=a.geometry,f=d.Geometry.findSubstring;if(!f(/^(multipoint)/i,e))return null;f(/^\s*/,e);f(/^z/i,e)&&(e.wktDim=3,f(/^\s*/,e));var g=[];if(d.Geometry.wktGetMulticoordsPoint(e))g=e.wktCoords;else return null;f(/^\s*/,e);return 2==e.wktDim?new d.MultiPoint(g):new d.MultiPoint(g,8307,e.wktDim)};a.geometry.Geometry.wktToMultilinestring=function(e){var d=
a.geometry,f=d.Geometry.findSubstring;if(!f(/^(multilinestring)/i,e))return null;f(/^\s*/,e);f(/^z/i,e)&&(e.wktDim=3,f(/^\s*/,e));f=[];if(d.Geometry.wktGetMulticoords(e))f=e.wktCoords;else return null;return 2==e.wktDim?new d.MultiLineString(f):new d.MultiLineString(f,8307,e.wktDim)};a.geometry.Geometry.wktToMultipolygon=function(e){var d=a.geometry,f=d.Geometry.findSubstring;if(!f(/^(multipolygon)/i,e))return null;f(/^\s*/,e);f(/^z/i,e)&&(e.wktDim=3,f(/^\s*/,e));f=[];if(d.Geometry.wktGetMulticoords(e))f=
e.wktCoords;else return null;return 2==e.wktDim?new d.MultiPolygon(f):new d.MultiPolygon(f,8307,e.wktDim)};a.geometry.Geometry.wktToGeometrycollection=function(e){var d=a.geometry,f=d.Geometry.findSubstring,g=[],h;if(!f(/^(geometrycollection)/i,e))return null;f(/^\s*/,e);f(/^z/i,e)&&(e.wktDim=3,f(/^\s*/,e));if(!f(/^(\()/,e))return null;do if(h=d.Geometry.root(e))g.push(h),f(/^\s*/,e),f(/^(\,)/,e),f(/^\s*/,e);else break;while(h);return f(/^(\))/,e)?new d.GeometryCollection(g):null};a.geometry.Geometry.root=
function(e){var d=a.geometry;return d.Geometry.wktToGeometrycollection(e)||d.Geometry.wktToPoint(e)||d.Geometry.wktToLinestring(e)||d.Geometry.wktToPolygon(e)||d.Geometry.wktToMultipoint(e)||d.Geometry.wktToMultilinestring(e)||d.Geometry.wktToMultipolygon(e)};a.geometry.Geometry.createGeometryFromWKT=function(e){return a.geometry.Geometry.root({wktStr:e,wkti:0,wktMatch:"",wktCoords:[],wktDim:2})};a.geometry.Rectangle=a.geometry.Geometry.extend({initialize:function d(a,g,h,l,t){d.base.call(this,t);
this.setRectangle(a,g,h,l)},getCenter:function(){return new a.geometry.Point((this.getMaxX()-this.getMinX())/2+this.getMinX(),(this.getMaxY()-this.getMinY())/2+this.getMinY(),this.srid)},getMinX:function(){return this.coordinates[0]},getMinY:function(){return this.coordinates[1]},getMaxX:function(){return this.coordinates[2]},getMaxY:function(){return this.coordinates[3]},getWidth:function(){return this.coordinates[2]-this.coordinates[0]},getHeight:function(){return this.coordinates[3]-this.coordinates[1]},
setRectangle:function(d,f,g,h){var l=a.util.ValidationUtil.isNumber;l(d)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Rectangle.setRectangle","minX:"+d);l(g)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Rectangle.setRectangle","maxX:"+g);l(f)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Rectangle.setRectangle","minY:"+f);l(h)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Rectangle.setRectangles","maxY:"+h);d=Number(d);f=Number(f);g=Number(g);h=Number(h);d>g&&(l=g,g=d,d=l);f>h&&(l=h,h=f,f=l);
this.type="Rectangle";this.coordinates=[d,f,g,h]},getLength:function(){var a=this.coordinates;return 2*(a[2]-a[0])+2*(a[3]-a[1])},getArea:function(){return this.getWidth()*this.getHeight()},move:function(a,f){this.coordinates[0]+=a;this.coordinates[1]+=f;this.coordinates[2]+=a;this.coordinates[3]+=f},expand:function(a){a&&a.type===this.type&&(this.coordinates[0]>a.coordinates[0]&&(this.coordinates[0]=a.coordinates[0]),this.coordinates[1]>a.coordinates[1]&&(this.coordinates[1]=a.coordinates[1]),this.coordinates[2]<
a.coordinates[2]&&(this.coordinates[2]=a.coordinates[2]),this.coordinates[3]<a.coordinates[3]&&(this.coordinates[3]=a.coordinates[3]))},toGML:function(){var a='\x3cgml:Polygon srsName\x3d"SDO:'+this.srid+'" xmlns:gml\x3d"http://www.opengis.net/gml"\x3e',a=a+"\x3cgml:outerBoundaryIs\x3e\x3cgml:LinearRing\x3e\x3cgml:coordinates\x3e"+(this.getMinX()+","+this.getMinY()+" "+this.getMaxX()+","+this.getMinY()+" "),a=a+(this.getMaxX()+","+this.getMaxY()+" "+this.getMinX()+","+this.getMaxY()+" "),a=a+(this.getMinX()+
","+this.getMinY()+"\x3c/gml:coordinates\x3e\x3c/gml:LinearRing\x3e\x3c/gml:outerBoundaryIs\x3e");return a+="\x3c/gml:Polygon\x3e"},toWKT:function(){return"Rectangle"!=this.type?null:"POLYGON ("+this.coordinates[0]+" "+this.coordinates[1]+", "+this.coordinates[0]+" "+this.coordinates[3]+", "+this.coordinates[2]+" "+this.coordinates[3]+", "+this.coordinates[2]+" "+this.coordinates[1]+", "+this.coordinates[0]+" "+this.coordinates[1]+")"}});a.geometry.Point=a.geometry.Geometry.extend({initialize:function f(g,
h,l,t,F){f.base.call(this,l);l=a.util.ValidationUtil.isNumber;l(g)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Point","x:"+g);l(h)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Point","y:"+h);a.notNull(t)&&a.notNull(F)?(l(t)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Point","orientationX:"+t),l(F)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Point","orientationY:"+F),this.type="OrientedPoint",this.coordinates=[Number(g),Number(h),Number(t),Number(F)]):(this.type="Point",this.coordinates=
[Number(g),Number(h)])},setPointIndex:function(f){a.notNull(f)&&(this.wraparoundMapIndex=f)},equals:function(f){if(a.isNull(f)||f.type!==this.type||f.srid!==this.srid||f.dim!==this.dim||f.coordinates.length!==this.coordinates.length)return!1;for(var g=0;g<this.coordinates.length;g++)if(this.coordinates[g]!==f.coordinates[g])return!1;return!0},getX:function(){return this.coordinates[0]},getY:function(){return this.coordinates[1]},getDimensionValue:function(a){return 0>a||a>this.dim-1?b:this.coordinates[a]},
getOrientationX:function(){return"OrientedPoint"===this.type?this.coordinates[this.dim]:b},getOrientationY:function(){return"OrientedPoint"===this.type?this.coordinates[this.dim+1]:b},getOrientationValue:function(a){return 0>a||a>this.dim-1||"OrientedPoint"!==this.type?b:this.coordinates[this.dim+a]},isOriented:function(){return this.coordinates.length>this.dim?!0:!1},getLength:function(){return 0},getArea:function(){return 0},setPoint:function(f,g){var h=a.util.ValidationUtil.isNumber;h(f)||a.util.Logger.throwErr("MAPVIEWER_9018",
"geom.Point","x:"+f);h(g)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Point","y:"+g);this.coordinates[0]=Number(f);this.coordinates[1]=Number(g)},setDimensionValue:function(a,g){0>a||a>this.dim-1||(this.coordinates[a]=g)},setOrientationValue:function(a,g){0>a||a>this.dim-1||"OrientedPoint"!==this.type||(this.coordinates[this.dim+a]=g)},move:function g(a,l){this.x+=a;this.y+=l;g.base.call(this,a,l)},toGML:function(){var g=a.util.GeomUtil.getOGCOrdinateString(this.coordinates,this.dim),h='\x3cgml:Point srsName\x3d"SDO:'+
this.srid+'" xmlns:gml\x3d"http://www.opengis.net/gml"\x3e\x3cgml:coordinates decimal\x3d"." cs\x3d"," ts\x3d" "\x3e';return h+g+"\x3c/gml:coordinates\x3e\x3c/gml:Point\x3e"},toWKT:function(){if("Point"!==this.type&&"OrientedPoint"!==this.type)return null;var g,h=this.dim;g="Point"===this.type?a.util.GeomUtil.getWktCoordinateStringFromPoint(this.coordinates,h):a.util.GeomUtil.getWktCoordinateStringFromOrientedPoint(this.coordinates,h);var l="POINT";if(2==h)l+=" (";else if(3==h)l+=" Z (";else return null;
return l+(g+")")},getOrientationPoint:function(g,h,l){if(a.isNull(l))if(this.isOriented())l=Math.atan2(this.coordinates[this.dim+1],this.coordinates[this.dim]);else return null;var t=g*Math.cos(l)*h.resolution;g=g*Math.sin(l)*h.resolution*h.stretchRatio;return new a.geometry.Point(this.coordinates[0]+t,this.coordinates[1]+g,this.srid)},addDimension:function(g,h){"OrientedPoint"===this.type?(a.isNull(h)?this.coordinates.push(0):this.coordinates.push(h),this.coordinates.splice(this.dim,0,g)):this.coordinates.push(g);
this.dim++},removeDimension:function(a){2>a||a>this.dim-1||("OrientedPoint"===this.type&&this.coordinates.splice(this.dim+a,1),this.coordinates.splice(this.dim-1,1),this.dim--)}});a.geometry.LineString=a.geometry.Geometry.extend({initialize:function h(l,t,F){h.base.call(this,t);!a.isNull(l)&&a.util.ValidationUtil.isNumberArray(l)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.LineString","ordinates:"+l);4>l.length&&a.util.Logger.throwErr("MAPVIEWER_9011","geom.LineString","ordinates:"+l);this.dim=
F||2;this.type="LineString";this.coordinates=l},toGML:function(){var h=a.util.GeomUtil.getOGCOrdinateString(this.coordinates,this.dim),l='\x3cgml:LineString srsName\x3d"SDO:'+this.srid+'" xmlns:gml\x3d"http://www.opengis.net/gml"\x3e\x3cgml:coordinates decimal\x3d"." cs\x3d"," ts\x3d" "\x3e';return l+h+"\x3c/gml:coordinates\x3e\x3c/gml:LineString\x3e"},toWKT:function(){if("LineString"!=this.type)return null;var h="LINESTRING",l=this.dim;if(2==l)h+=" (";else if(3==l)h+=" Z (";else return null;l=a.util.GeomUtil.getWktCoordinateStringFromLine(this.coordinates,
l);h+=l;h=h.substring(0,h.length-1);return h+")"},getFirstPoint:function(){var h=this.coordinates;return 2>h.length?null:new a.geometry.Point(h[0],h[1],this.srid)},getLastPoint:function(){var h=this.coordinates;if(2>h.length)return null;var l=h.length;return new a.geometry.Point(h[l-2],h[l-1],this.srid)}});a.geometry.LineString.create=function(h){(a.isNull(h)||2>h.length)&&a.util.Logger.throwErr("MAPVIEWER_9018","geom.LineString.create","pointArray:"+h);var l=a.util.GeomUtil.flatten(h,"Point");l||
a.util.Logger.throwErr("MAPVIEWER_9018","geom.LineString.create","pointArray:"+h);return new a.geometry.LineString(l.ordinates,l.srid)};a.geometry.Polygon=a.geometry.Geometry.extend({initialize:function l(t,F,I){l.base.call(this,F);F=a.util.ValidationUtil;(a.isNull(t)||0===t.length)&&a.util.Logger.throwErr("MAPVIEWER_9018","geom.Polygon","ordinates:"+t);F.isNumberArray(t)&&(t=[t]);F.isNumberArray(t[0])||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Polygon","ordinates:"+t);a.notNull(I)&&(this.dim=
I);this.type="Polygon";this.coordinates=t},toGML:function(){var l=a.util.GeomUtil.getOGCOrdinateString(this.coordinates[0],this.dim),t='\x3cgml:Polygon srsName\x3d"SDO:'+this.srid+'" xmlns:gml\x3d"http://www.opengis.net/gml"\x3e',t=t+'\x3cgml:outerBoundaryIs\x3e\x3cgml:LinearRing\x3e\x3cgml:coordinates decimal\x3d"." cs\x3d"," ts\x3d" "\x3e'+(l+"\x3c/gml:coordinates\x3e\x3c/gml:LinearRing\x3e\x3c/gml:outerBoundaryIs\x3e");if(1<this.coordinates.length)for(l=1;l<this.coordinates.length;l++)var F=a.util.GeomUtil.getOGCOrdinateString(this.coordinates[l],
this.dim),t=t+'\x3cgml:innerBoundaryIs\x3e\x3cgml:LinearRing\x3e\x3cgml:coordinates decimal\x3d"." cs\x3d"," ts\x3d" "\x3e',t=t+(F+"\x3c/gml:coordinates\x3e\x3c/gml:LinearRing\x3e\x3c/gml:innerBoundaryIs\x3e");return t+="\x3c/gml:Polygon\x3e"},toWKT:function(){if("Polygon"!==this.type)return null;var l=this.coordinates.length,t="POLYGON",F=this.dim;if(2==F)t+=" (";else if(3==F)t+=" Z (";else return null;for(var I=0;I<l;I++)var P=a.util.GeomUtil.getWktCoordinateStringFromLine(this.coordinates[I],F),
t=t+("("+P),t=t.substring(0,t.length-1),t=t+"), ";t=t.substring(0,t.length-2);return t+")"}});a.geometry.Polygon.createCirclePolygon=function(l,t,F,I){I||(I=8307);for(var P=[],aa=2*Math.PI/480,U=0;480>U;U++){var ca=U*aa;P[2*U]=l+F*Math.cos(ca);P[2*U+1]=t+F*Math.sin(ca)}P[960]=P[0];P[961]=P[1];return new a.geometry.Polygon(P,I)};a.geometry.Polygon.createGeodeticCirclePolygon=function(l,t,F,I){I||(I=8307);for(var P=[],aa=0;36>aa;aa++){var U=a.util.GeomUtil.getPointAtBearing(l,t,F,aa*Math.PI/18);P[2*
aa]=U.x;P[2*aa+1]=U.y}P[72]=P[0];P[73]=P[1];return new a.geometry.Polygon(P,I)};a.geometry.Polygon.create=function(l,t){(a.isNull(l)||3>l.length)&&a.util.Logger.throwErr("MAPVIEWER_9018","geom.Polygon.create","pointArray:"+l);var F=a.util.GeomUtil.flatten(l,"Point");F||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Polygon.create","pointArray:"+l);if(t&&2<t.length){var I=a.util.GeomUtil.flatten(t,"Point");I?F.srid!==I.srid&&a.util.Logger.throwErr("MAPVIEWER_9033","geom.Polygon.create",""):a.util.Logger.throwErr("MAPVIEWER_9018",
"geom.Polygon.create","outerPointArray:"+t);return new a.geometry.Polygon([F.ordinates,I.ordinates],F.srid)}return new a.geometry.Polygon([F.ordinates],F.srid)};a.geometry.Circle=a.geometry.Geometry.extend({initialize:function t(F,I,P,aa){t.base.call(this,aa);aa=a.util.ValidationUtil.isNumber;aa(F)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Circle","centerX:"+F);aa(I)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Circle","centerY:"+I);aa(P)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Circle",
"radius:"+P);this.centerX=Number(F);this.centerY=Number(I);this.radius=Number(P);this.toCirclePolygon();this.type="Polygon"},getRadius:function(){return this.radius},getCenterX:function(){return this.centerX},getLength:function(){return 6.283185307179586*this.radius},getArea:function(){return 3.141592653589793*this.radius*this.radius},getCenterY:function(){return this.centerY},setCircle:function(t,F,I){var P=a.util.ValidationUtil.isNumber;P(t)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Circle.setCircle",
"centerX:"+t);P(F)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Circle.setCircle","centerY:"+F);P(I)||a.util.Logger.throwErr("MAPVIEWER_9018","geom.Circle.setCircle","radius:"+I);this.centerX=Number(t);this.centerY=Number(F);this.radius=Number(I);this.toCirclePolygon()},toCirclePolygon:function(){this.circlePolygon||(this.circlePolygon=a.geometry.Polygon.createCirclePolygon(this.centerX,this.centerY,this.radius,this.srid),this.coordinates=this.circlePolygon.coordinates)},move:function F(a,P){this.centerX+=
a;this.centerY+=P;F.base.call(this,a,P)},toGML:function(){return this.circlePolygon.toGML()},toWKT:function(){return this.circlePolygon.toWKT()}});a.geometry.MultiPoint=a.geometry.Geometry.extend({initialize:function I(P,aa,U){I.base.call(this,aa);aa=a.util.ValidationUtil;(a.isNull(P)||1>P.length)&&a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPoint","ordinates:"+P);aa.isNumberArray(P[0])||a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPoint","ordinates:"+P);a.notNull(U)&&(this.dim=U);U=
P.length;aa=!0;for(var ca=0;ca<U;ca++)P[ca].length<2*this.dim&&(aa=!1);this.type=aa?"OrientedMultiPoint":"MultiPoint";this.coordinates=P},getLength:function(){return 0},getArea:function(){return 0},toGML:function(){for(var I=this.coordinates.length,P='\x3cgml:MultiPoint srsName\x3d"SDO:'+this.srid+'" xmlns:gml\x3d"http://www.opengis.net/gml"\x3e',aa=0;aa<I;aa++)var U=a.util.GeomUtil.getOGCOrdinateString(this.coordinates[aa],this.dim),P=P+"\x3cgml:pointMember\x3e",P=P+('\x3cgml:Point srsName\x3d"SDO:'+
this.srid+'" xmlns:gml\x3d"http://www.opengis.net/gml"\x3e\x3cgml:coordinates decimal\x3d"." cs\x3d"," ts\x3d" "\x3e'),P=P+(U+"\x3c/gml:coordinates\x3e\x3c/gml:Point\x3e"),P=P+"\x3c/gml:pointMember\x3e";return P+"\x3c/gml:MultiPoint\x3e"},toWKT:function(){if("MultiPoint"!=this.type)return null;var I=this.coordinates.length,P="MULTIPOINT",aa=this.dim;if(2==aa)P+=" (";else if(3==aa)P+=" Z (";else return null;for(var U=0;U<I;U++)var ca=a.util.GeomUtil.getWktCoordinateStringFromPoint(this.coordinates[U],
aa),P=P+(ca+", ");P=P.substring(0,P.length-2);return P+")"}});a.geometry.MultiPoint.create=function(I){(a.isNull(I)||2>I.length)&&a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPoint.create","pointArray:"+I);var P=a.util.GeomUtil.flatten(I,"Point",!0);P||a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPoint.create","pointArray:"+I);return new a.geometry.MultiPoint(P.ordinates,P.srid)};a.geometry.MultiLineString=a.geometry.Geometry.extend({initialize:function P(aa,U,ca){P.base.call(this,U);
U=a.util.ValidationUtil;var ua=a.isNull(aa)?0:aa.length;1>ua&&a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiLineString","ordinates:"+aa);for(var Oa=0;Oa<ua;Oa++)!a.isNull(aa[Oa])&&U.isNumberArray(aa[Oa])||a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiLineString","ordinates:"+aa);a.notNull(ca)&&(this.dim=ca);this.type="MultiLineString";this.coordinates=aa},toGML:function(){for(var P=this.coordinates.length,aa='\x3cgml:MultiLineString srsName\x3d"SDO:'+this.srid+'" xmlns:gml\x3d"http://www.opengis.net/gml"\x3e',
U=0;U<P;U++)var aa=aa+"\x3cgml:lineStringMember\x3e",ca=a.util.GeomUtil.getOGCOrdinateString(this.coordinates[U],this.dim),aa=aa+('\x3cgml:LineString srsName\x3d"SDO:'+this.srid+'" xmlns:gml\x3d"http://www.opengis.net/gml"\x3e\x3cgml:coordinates decimal\x3d"." cs\x3d"," ts\x3d" "\x3e'),aa=aa+(ca+"\x3c/gml:coordinates\x3e\x3c/gml:LineString\x3e"),aa=aa+"\x3c/gml:lineStringMember\x3e";return aa+"\x3c/gml:MultiLineString\x3e"},toWKT:function(){if("MultiLineString"!==this.type)return null;var P=this.coordinates.length,
aa="MULTILINESTRING",U=this.dim;if(2==U)aa+=" (";else if(3==U)aa+=" Z (";else return null;for(var ca=0;ca<P;ca++)var ua=a.util.GeomUtil.getWktCoordinateStringFromLine(this.coordinates[ca],U),aa=aa+("("+ua),aa=aa.substring(0,aa.length-1),aa=aa+"), ";aa=aa.substring(0,aa.length-2);return aa+")"}});a.geometry.MultiLineString.create=function(P){(a.isNull(P)||2>P.length)&&a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiLineString.create","lineArray:"+P);var aa=a.util.GeomUtil.flatten(P,"LineString",
!0);aa||a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiLineString.create","lineArray:"+P);return new a.geometry.MultiLineString(aa.ordinates,aa.srid)};a.geometry.MultiPolygon=a.geometry.Geometry.extend({initialize:function aa(U,ca,ua){aa.base.call(this,ca);ca=a.util.ValidationUtil;var Oa=a.isNull(U)?0:U.length;1>Oa&&a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPolygon","ordinates:"+U);for(var Va=0;Va<Oa;Va++)(a.isNull(U[Va])||0===U[Va].length)&&a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPolygon",
"ordinates:"+U),ca.isNumberArray(U[Va])&&(U[Va]=[U[Va]]),ca.isNumberArray(U[Va][0])||a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPolygon","ordinates:"+U);a.notNull(ua)&&(this.dim=ua);this.type="MultiPolygon";this.coordinates=U},_getMeasure:function(aa){var U=this.coordinates,ca=U.length,ua=null,Oa=0;"area"===aa?ua=a.util.GeomUtil.polygonArea:"length"===aa&&(ua=a.util.GeomUtil.polylineLength);for(var Va=0;Va<ca;Va++)if(aa=U[Va],a.$.isArray(aa[0]))for(var b=0;b<aa.length;b++)Oa+=ua(aa[b],this.dim);
else Oa+=ua(aa,this.dim);return Oa},toGML:function(){for(var aa=this.coordinates.length,U='\x3cgml:MultiPolygon srsName\x3d"SDO:'+this.srid+'" xmlns:gml\x3d"http://www.opengis.net/gml"\x3e',ca=0;ca<aa;ca++){var U=U+"\x3cgml:polygonMember\x3e",ua=a.util.GeomUtil.getOGCOrdinateString(this.coordinates[ca][0],this.dim),U=U+('\x3cgml:Polygon srsName\x3d"SDO:'+this.srid+'" xmlns:gml\x3d"http://www.opengis.net/gml"\x3e'),U=U+'\x3cgml:outerBoundaryIs\x3e\x3cgml:LinearRing\x3e\x3cgml:coordinates decimal\x3d"." cs\x3d"," ts\x3d" "\x3e',
U=U+(ua+"\x3c/gml:coordinates\x3e\x3c/gml:LinearRing\x3e\x3c/gml:outerBoundaryIs\x3e");if(1<this.coordinates[ca].length)for(ua=1;ua<this.coordinates[ca].length;ua++)var Oa=a.util.GeomUtil.getOGCOrdinateString(this.coordinates[ca][ua],this.dim),U=U+'\x3cgml:innerBoundaryIs\x3e\x3cgml:LinearRing\x3e\x3cgml:coordinates decimal\x3d"." cs\x3d"," ts\x3d" "\x3e',U=U+(Oa+"\x3c/gml:coordinates\x3e\x3c/gml:LinearRing\x3e\x3c/gml:innerBoundaryIs\x3e");U+="\x3c/gml:Polygon\x3e";U+="\x3c/gml:polygonMember\x3e"}return U+
"\x3c/gml:MultiPolygon\x3e"},toWKT:function(){if("MultiPolygon"!==this.type)return null;var aa=this.coordinates.length,U="MULTIPOLYGON",ca=this.dim;if(2==ca)U+=" (";else if(3==ca)U+=" Z (";else return null;for(var ua=0;ua<aa;ua++){for(var Oa=this.coordinates[ua].length,Va=this.coordinates[ua],U=U+"(",b=0;b<Oa;b++)var c=a.util.GeomUtil.getWktCoordinateStringFromLine(Va[b],ca),U=U+("("+c),U=U.substring(0,U.length-1),U=U+"), ";U=U.substring(0,U.length-2);U+="), "}U=U.substring(0,U.length-2);return U+
")"}});a.geometry.MultiPolygon.create=function(aa){(a.isNull(aa)||2>aa.length)&&a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPolygon.create","polygonArray:"+aa);var U=a.util.GeomUtil.flatten(aa,"Polygon",!0);U||a.util.Logger.throwErr("MAPVIEWER_9018","geom.MultiPolygon.create","polygonArray:"+aa);return new a.geometry.MultiPolygon(U.ordinates,U.srid)};a.geometry.GeometryCollection=a.geometry.Geometry.extend({initialize:function U(ca,ua){U.base.call(this,ua);for(var Oa=ca.length,b=0;b<Oa;b++)ca[b]instanceof
a.geometry.Geometry?a.isNull(ua)?ca[b].srid=ua:ca[b].srid!==ua&&(ca[b]=ca[b].transform(ua)):a.util.Logger.throwErr("MAPVIEWER_9018","geom.GeometryCollection","geometryArray:"+ca);this.geometries=ca;this.type="GeometryCollection"},getMBR:function(){if(!this.mbr){var U=a.geometry.Geometry.calculateGeomCollectionMBR(this.geometries,this.type);this.mbr=new a.geometry.Rectangle(U.minX,U.minY,U.maxX,U.maxY,this.srid)}return this.mbr},toString:function(){var a;a="{"+('"type":"'+this.type+'",');a+='"srid":'+
this.srid+",";a+='"geometries":[';for(var ca=this.geometries.length,ua=0;ua<ca;ua++)a+=this.geometries[ua].toString()+",";ca=a.length;a=a.substring(0,ca-1);return a+"]}"},clientTransform:function(U){for(var ca=this.geometries.length,ua=Array(ca),Oa=0;Oa<ca;Oa++)ua[Oa]=this.geometries[Oa].transform(U);return new a.geometry.GeometryCollection(ua,U)},move:function(a,ca){for(var ua=this.geometries.length,Oa=0;Oa<ua;Oa++)this.geometries[Oa].move(a,ca);this.mbr&&this.mbr.move(a,ca)},toGML:function(){for(var a=
this.geometries.length,ca='\x3cgml:MultiGeometry srsName\x3d"SDO:'+this.srid+'" xmlns:gml\x3d"http://www.opengis.net/gml"\x3e',ua=0;ua<a;ua++)ca+="\x3cgml:geometryMember\x3e",ca+=this.geometries[ua].toGML(),ca+="\x3c/gml:geometryMember\x3e";return ca+"\x3c/gml:MultiGeometry\x3e"},toWKT:function(){if("GeometryCollection"!=this.type)return null;for(var a=this.geometries.length,ca="GEOMETRYCOLLECTION (",ua=0;ua<a;ua++)ca+=this.geometries[ua].toWKT(),ca+=", ";ca=ca.substring(0,ca.length-2);return ca+
")"}});a.event.EventSource={addListener:function(a,ca,ua){var Oa=this._omListeners=this._omListeners||{};Oa[a]=Oa[a]||[];Oa[a].push({listener:ca,context:ua||this});return this},hasListener:function(a){return"_omListeners"in this&&a in this._omListeners&&0<this._omListeners[a].length},getListeners:function(a){return this.hasListener(a)?this._omListeners[a]:[]},deleteListener:function(a,ca,ua){if(!this.hasListener(a))return this;for(var Oa=0,b=this._omListeners,c=b[a].length;Oa<c;Oa++)if(b[a][Oa].listener===
ca&&(!ua||b[a][Oa].context===ua)){b[a].splice(Oa,1);break}return this},deleteListeners:function(a){if(!this.hasListener(a))return this;this._omListeners[a]=[];return this},deleteAllListeners:function(){this._omListeners={};return this},fire:function(U){if(!this.hasListener(U))return this;var ca=this._omListeners[U].slice(),ua=[].slice.apply(arguments),b,Va;2<=ua.length&&ua.splice(0,1);for(var c=0,Qb=ca.length;c<Qb;c++)if(b=ca[c].listener){Va=ca[c].context||this;try{0<ua.length?b.apply(Va,ua):b.call(Va)}catch(ub){b=
ub.message,ub.stack&&(b+="\nStack: "+ub.stack),a.util.Logger.warning("MAPVIEWER_9032","EventSource.fire",b)}}return this},stopEvents:{},initProcessedEventStatus:function(){this.processedStatus={}},setProcessedEventStatus:function(U,ca,ua){ca===a.event.MouseEvent.TOUCH_TAP&&(ca=a.event.MouseEvent.MOUSE_CLICK);ca===a.event.MouseEvent.MOUSE_CLICK&&(this.processedStatus[U.name]=this.processedStatus[U.name]||{},this.processedStatus[U.name][ca]=ua)},getProcessedEventStatus:function(U,ca){if(ca!==a.event.MouseEvent.MOUSE_CLICK||
a.isNull(this.processedStatus[U]))return!1;for(var ua=this.processedStatus[U],b=0;b<ua.length;b+=1){var Va=ua[b];if(a.notNull(Va)&&Va.etype===ca)return Va.etype}return!1},resetProcessedEvent:function(a,ca){this.setProcessedEventStatus(a,ca,!1)},isProcessedEvent:function(U,ca){return a.isNull(this.processedStatus[U.name])?!1:this.processedStatus[U.name][ca]}};a.event.EventSource.on=a.event.EventSource.addListener;a.event.Event=a.Class.extend({initialize:function(U,ca){if(a.isNull(U)||a.isNull(ca))return null;
this.type=U;this.target=ca;this.evt=null}});a.event.MapEvent=a.event.Event.extend({initialize:function ca(a,b){ca.base.call(this,a,b);this.preMapCenter=this.affectedLayer=this.beforeZoomLevel=null}});a.event.MapEvent.I_MAP_CENTER_ZOOM="i_mapCenterZoom";a.event.MapEvent.I_MAP_DRAGGING="i_mapDragging";a.event.MapEvent.MAP_BEFORE_ZOOM="mapBeforeZoom";a.event.MapEvent.MAP_AFTER_ZOOM="mapAfterZoom";a.event.MapEvent.MAP_RECENTERED="mapRecentered";a.event.MapEvent.MAP_INITIALIZED="mapInitialized";a.event.MapEvent.MAP_RESET_UNIVERSE=
"mapResetUniverse";a.event.MapEvent.MAP_RESIZED="mapResized";a.event.MapEvent.MAP_BEFORE_REFRESH="mapBeforeRefresh";a.event.MapEvent.MAP_AFTER_REFRESH="mapAfterRefresh";a.event.MapEvent.MAP_REDRAW="mapRedraw";a.event.MapEvent.LAYER_ADDED="layerAdded";a.event.MapEvent.LAYER_DELETED="layerDeleted";a.event.MapEvent.LAYER_REORDERED="layerReordered";a.event.MapEvent.MAP_DESTROY="mapDestroy";a.event.MapEvent.MAP_RESTRICT_CENTER="mapRestrictCenter";a.event.MapEvent.MAP_STYLE_CHANGED="mapStyleChanged";a.event.MapEvent.MAP_CLEAN=
"mapClean";a.event.MapEvent.I_MAP_NSDP_MAPPED="mapNSDPMapped";a.event.KeyboardEvent=a.event.Event.extend({initialize:function ua(a,b){ua.base.call(this,a,b);this.event=null}});a.event.KeyboardEvent.KEY_DOWN="keyDown";a.event.KeyboardEvent.KEY_UP="keyUp";a.event.LayerEvent=a.event.Event.extend({initialize:function Oa(a,b){Oa.base.call(this,a,b);this.affectedFeature=null}});a.event.LayerEvent.BEFORE_REFRESH="beforeFresh";a.event.LayerEvent.AFTER_REFRESH="afterFresh";a.event.LayerEvent.FEATURE_SELECTED=
"featureSelected";a.event.LayerEvent.FEATURE_DESELECTED="featureDeselected";a.event.LayerEvent.RENDERING_STYLE_CHANGED="renderingStyleChanged";a.event.LayerEvent.LABELING_STYLE_CHANGED="labelingStyleChanged";a.event.LayerEvent.SELECTION_STYLE_CHANGED="selectionStyleChanged";a.event.LayerEvent.HOVER_STYLE_CHANGED="hoverStyleChanged";a.event.LayerEvent.RESULT_STYLE_CHANGED="resultStyleChanged";a.event.LayerEvent.LABEL_VISIBILITY_CHANGED="labelVisibilityChanged";a.event.LayerEvent.LAYER_VISIBILITY_CHANGED=
"layerVisibilityChanged";a.event.LayerEvent.LAYER_REMOVED="layerRemoved";a.event.LayerEvent.LAYER_INITIALIZED="layerInitialized";a.event.LayerEvent.FEATURE_MOVING="featureMoving";a.event.LayerEvent.FEATURE_MOVED="featureMoved";a.event.LayerEvent.FEATURE_EDITED="featureEdited";a.event.LayerEvent.FEATURE_ORIENTATION_CHANGING="featureOrientationChanging";a.event.LayerEvent.LAYER_Z_INDEX_CHANGED="layerZIndexChanged";a.event.LayerEvent.LAYER_INIT="layerInit";a.event.LayerEvent.FINISH_GOT_CONFIG="layerFinishGotConfig";
a.event.LayerEvent.FINISH_LOAD="layerFinishLoad";a.event.LayerEvent.TILE_IMG_LOADED="tileImgLoaded";a.event.LayerEvent.ALL_TILES_LOADED="allTilesImgLoaded";a.event.LayerEvent.TILE_IMG_LOAD_ERROR="tileImgLoadError";a.event.LayerEvent.TILE_IMG_LOADING="tileImgLoading";a.event.LayerEvent.VECTOR_LAYER_LOADING_THEME="GETTING_THEME_DATA";a.event.LayerEvent.VECTOR_LAYER_PARSING_THEME="PARSING_THEME_DATA";a.event.LayerEvent.FEATURES_LOADED="featuresLoad";a.event.LayerEvent.FEATURES_DISPLAYED="featuresDisplay";
a.event.LayerEvent.INIT_ERROR="initError";a.event.LayerEvent.NSDP_MAPPED="nsdpMapped";a.event.MapDecorationEvent=a.event.Event.extend({initialize:function Va(a,b){Va.base.call(this,a,b)}});a.event.MapDecorationEvent.BEFORE_COLLAPSE="beforeCollapse";a.event.MapDecorationEvent.AFTER_COLLAPSE="afterCollapse";a.event.MapDecorationEvent.BEFORE_RESTORE="beforeRestore";a.event.MapDecorationEvent.AFTER_RESTORE="afterRestore";a.event.MapDecorationEvent.DRAG_START="dragStart";a.event.MapDecorationEvent.DRAG=
"drag";a.event.MapDecorationEvent.DRAG_END="dragEnd";a.event.MapDecorationEvent.DISPLAYED="displayed";a.event.MouseEvent=a.event.Event.extend({initialize:function Jb(a,b){Jb.base.call(this,a,b);this.feature=this.location=null}});a.event.MouseEvent.MOUSE_DOWN="mouseDown";a.event.MouseEvent.MOUSE_UP="mouseUp";a.event.MouseEvent.MOUSE_MOVE="mouseMove";a.event.MouseEvent.MOUSE_OVER="mouseOver";a.event.MouseEvent.MOUSE_OUT="mouseOut";a.event.MouseEvent.MOUSE_CLICK="click";a.event.MouseEvent.MOUSE_RIGHT_CLICK=
"rightClick";a.event.MouseEvent.MOUSE_DOUBLE_CLICK="doubleClick";a.event.MouseEvent.WHEEL_SCROLL="wheelScroll";a.event.MouseEvent.TOUCH_TAP="tap";a.event.MouseEvent.TOUCH_LONG_PRESS="touchlongpress";a.event.MouseEvent.TOUCH_END="touchend";a.event.MouseEvent.TOUCH_START="touchstart";a.event.MouseEvent.MOUSE_ENTER="mouseEnter";a.event.MouseEvent.MOUSE_LEAVE="mouseLeave";a.event.MouseEvent.DEBOUNCE_MILI_SEC=300;a.event.MouseEvent.DELAY_MILI_SEC=300;a.event.ToolEvent=a.event.Event.extend({initialize:function Qb(a,
b){Qb.base.call(this,a,b);this.location=null}});a.event.ToolEvent.TOOL_START="toolStart";a.event.ToolEvent.TOOL_END="toolEnd";a.event.ToolEvent.TOOL_CLEAR="toolClear";a.event.ToolEvent.RECTANGLE_DRAG="rectangleDrag";a.event.ToolEvent.CIRCLE_DRAG="circleDrag";a.event.ToolEvent.REDLINE_POINT_CREATE="redlinePointCreate";a.event.ToolEvent.REDLINE_POINT_REMOVE="redlinePointRemove";a.event.ToolEvent.REDLINE_DRAW="redlineDraw";a.event.ToolEvent.REDLINE_EDITED="redlineEdited";a.event.ToolEvent.DISTANCE_UPDATE=
"distanceUpdate";a.event.ToolEvent.SNAP_POINT="snapPoint";a.event.ToolEvent.MOUSE_RIGHT_CLICK="mouseRightClick";a.event.ToolbarEvent=a.event.Event.extend({initialize:function ub(a,b){ub.base.call(this,a,b)}});a.event.ToolbarEvent.BUTTON_STATE_CHANGE="buttonStateChange";a.event.ToolbarEvent.BUTTON_DOWN="buttonDown";a.event.ToolbarEvent.BUTTON_UP="buttonUp";a.universe.ZoomLevel=a.Class.extend({initialize:function(b,c){!a.isNull(b)&&a.util.ValidationUtil.isNumber(b)&&(this.resolution=b,this.stretchRatio=
1,c&&c.stretchRatio&&(this.stretchRatio=c.stretchRatio),this.infotip=null,c&&c.infotip&&(this.infotip=c.infotip))}});a.universe.Universe=a.Class.extend({initialize:function(b){if(a.isNull(b)||!a.util.ValidationUtil.isObject(b)||a.isNull(b.srid)||!b.bounds)return null;this.srid=b.srid;this.bound=b.bounds;this.bound.srid!==this.srid&&(this.bound=this.bound.transform(this.srid));this.geodetic=b.geodetic?b.geodetic:this.srid&&8307===this.srid;if(!b.zoomLevels&&b.numberOfZoomLevels){this.zoomLevels=[];
var c=this.bound,rb=Math.abs(c.getMaxX()-c.getMinX())/256,c=Math.abs(c.getMaxY()-c.getMinY())/256;c>rb&&(rb=c);for(c=0;c<b.numberOfZoomLevels;c++)this.zoomLevels[c]=new a.universe.ZoomLevel(rb),rb/=2}else this.zoomLevels=b.zoomLevels;this.homeZoomlevel=this.homeCenter=null},getSRID:function(){return this.srid},getMapBounds:function(){return this.bound},getZoomLevelNumber:function(){return this.zoomLevels.length},getZoomLevels:function(){return this.zoomLevels},equals:function(a){if(this.srid!==a.srid||
this.zoomLevels&&a.zoomLevels&&this.zoomLevels.length!==a.zoomLevels.length)return!1;for(var b=this.zoomLevels.length,c=0;c<b;c++)if(this.zoomLevels[c].resolution!==a.zoomLevels[c].resolution||this.zoomLevels[c].stretchRatio!==a.zoomLevels[c].stretchRatio)return!1;return!0},clone:function(){var b={};a.$.extend(b,this);return b},copy:function(a){this.homeCenter=a.homeCenter;this.homeZoomlevel=a.homeZoomlevel;return this}});a.universe.Universe.EPSG4326={SRID:8307,unites:"degrees",metersPerUnit:6378137*
Math.PI/180,bounds:new a.geometry.Rectangle(-180,-90,180,90,8307)};a.universe.Universe.EPSG3857={SRID:3857,unites:"meters",metersPerUnit:1,bounds:new a.geometry.Rectangle(-20037508,-20037508,20037508,20037508,3857)};a.universe.Universe.getMPU=function(b){switch(b){case 3857:return a.universe.Universe.EPSG3857.metersPerUnit;case 8307:return a.universe.Universe.EPSG4326.metersPerUnit;default:return a.util.Logger.warning("","OM.universe.Universe.getMPU","srid's MPU is not found, 1 is returned."),1}};
a.universe.Universe.getSpecs=function(b){switch(b){case 3857:return a.universe.Universe.EPSG3857;case 8307:return a.universe.Universe.EPSG4326;case 2180:return a.universe.Universe.EPSG2180}};a.universe.WorldMercatorUniverse=a.universe.Universe.extend({initialize:function Ab(){var b=a.universe.ZoomLevel,b={srid:3857,bounds:new a.geometry.Rectangle(-20037508,-20037508,20037508,20037508,3857),zoomLevels:[new b(78271.515625),new b(39135.7578125),new b(19567.87890625),new b(9783.939453125),new b(4891.9697265625),
new b(2445.98486328125),new b(1222.992431640625),new b(611.4962158203125),new b(305.74810791015625),new b(152.87405395507812),new b(76.43702697753906),new b(38.21851348876953),new b(19.109256744384766),new b(9.554628372192383),new b(4.777314186096191),new b(2.3886570930480957),new b(1.1943285465240479),new b(.5971642732620239),new b(.29858213663101196)]};Ab.base.call(this,b)}});a.universe.ElocationUniverse=a.universe.Universe.extend({initialize:function rb(){var b=a.universe.ZoomLevel,b={srid:3857,
bounds:new a.geometry.Rectangle(-20037508,-20037508,20037508,20037508,3857),zoomLevels:[new b(78271.515625),new b(39135.7578125),new b(19567.87890625),new b(9783.939453125),new b(4891.9697265625),new b(2445.98486328125),new b(1222.992431640625),new b(611.4962158203125),new b(305.74810791015625),new b(152.87405395507812),new b(76.43702697753906),new b(38.21851348876953),new b(19.109256744384766),new b(9.554628372192383),new b(4.777314186096191),new b(2.3886570930480957),new b(1.1943285465240479),new b(.5971642732620239),
new b(.29858213663101196)]};rb.base.call(this,b)}});a.universe.SElocationUniverse=a.universe.Universe.extend({initialize:function Bb(){var b=a.universe.ZoomLevel,b={srid:3857,bounds:new a.geometry.Rectangle(-20037508,-20037508,20037508,20037508,3857),zoomLevels:[new b(52181.010416666664),new b(31308.60625),new b(17393.67013888889),new b(9208.413602941177),new b(4743.72821969697),new b(2371.864109848485),new b(1185.9320549242425),new b(592.9660274621212),new b(297.04560009487665),new b(148.52280004743832),
new b(74.26140002371916),new b(37.12189500829974),new b(18.56314849401162),new b(9.28157424700581),new b(4.640511983458825),new b(2.3201184380187336),new b(1.1599302843826644),new b(.5799651421913322),new b(.2897185251365837)]};Bb.base.call(this,b)}});a.universe.LatLonUniverse=a.universe.Universe.extend({initialize:function Fb(){var b=a.universe.ZoomLevel,b={srid:8307,bounds:new a.geometry.Rectangle(-180,-90,180,90,8307),zoomLevels:[new b(.703125),new b(.3515625),new b(.17578125),new b(22.5/256),
new b(11.25/256),new b(5.625/256),new b(2.8125/256),new b(1.40625/256),new b(.703125/256),new b(.3515625/256),new b(.17578125/256),new b(.087890625/256),new b(.0439453125/256),new b(8.58306884765625E-5),new b(4.291534423828125E-5),new b(2.1457672119140625E-5),new b(1.0728836059570312E-5),new b(5.364418029785156E-6),new b(2.682209014892578E-6)]};Fb.base.call(this,b)}});a.universe.OSMUniverse=a.universe.Universe.extend({initialize:function Ea(){var b=a.universe.ZoomLevel,b={srid:3857,bounds:new a.geometry.Rectangle(-20037508,
-20037508,20037508,20037508,3857),zoomLevels:[new b(156543.03125),new b(78271.515625),new b(39135.7578125),new b(19567.87890625),new b(9783.939453125),new b(4891.9697265625),new b(2445.98486328125),new b(1222.992431640625),new b(611.4962158203125),new b(305.74810791015625),new b(152.87405395507812),new b(76.43702697753906),new b(38.21851348876953),new b(19.109256744384766),new b(9.554628372192383),new b(4.777314186096191),new b(2.3886570930480957),new b(1.1943285465240479),new b(.5971642732620239)]};
Ea.base.call(this,b)}});a.universe.TomTomUniverse=a.universe.Universe.extend({initialize:function Ha(){var b=a.universe.ZoomLevel,b={srid:3857,bounds:new a.geometry.Rectangle(-20037508,-20037508,20037508,20037508,3857),zoomLevels:[new b(19567.9),new b(9783.9),new b(4892),new b(2446),new b(1223),new b(611.5),new b(305.7),new b(152.9),new b(76.4),new b(38.2),new b(19.1),new b(9.6),new b(4.8),new b(2.4),new b(1.2),new b(.596875)]};Ha.base.call(this,b)}});a.universe.BaiduUniverse=a.universe.Universe.extend({initialize:function Ia(){var xa=
a.universe.ZoomLevel,xa={srid:a.util.BaiduUtil.SRID,bounds:new a.geometry.Rectangle(-2.003772637E7,-1.247410417E7,2.003772637E7,1.247410417E7,a.util.BaiduUtil.SRID),zoomLevels:[new xa(262144),new xa(131072),new xa(65536),new xa(32768),new xa(16384),new xa(8192),new xa(4096),new xa(2048),new xa(1024),new xa(512),new xa(256),new xa(128),new xa(64),new xa(32),new xa(16),new xa(8),new xa(4),new xa(2),new xa(1)]};Ia.base.call(this,xa)}});a.universe.LocationBoxUniverse=a.universe.Universe.extend({initialize:function xa(){var b=
a.universe.ZoomLevel,b={srid:3857,bounds:new a.geometry.Rectangle(-20037508,-20037508,20037508,20037508,3857),zoomLevels:[new b(4891.9697265625),new b(2445.98486328125),new b(1222.992431640625),new b(611.4962158203125),new b(305.74810791015625),new b(152.87405395507812),new b(76.43702697753906),new b(38.21851348876953),new b(19.109256744384766),new b(9.554628372192383),new b(4.777314186096191),new b(2.3886570930480957),new b(1.1943285465240479),new b(.5971642732620239),new b(.29858213663101196)]};
xa.base.call(this,b)}});a.style.Style=a.Class.extend({initialize:function(b){this.origConfig=a.isNull(b)?null:a.$.extend(!0,{},b);this.styleName=b&&b.styleName?b.styleName:this.generateName();this.styleType=b&&b.styleType?b.styleType:"Style";this.effects=b&&b.effects?b.effects:[];this.animation=b&&b.animationStyle?b.animationStyle:null;this.bindings=null;this.isServerSide=!1},clone:function(){return a.$.extend(!0,{},this)},generateName:function(){var a=0;return function(){return"_om_style"+ ++a}}(),
getConfig:function(){return this.origConfig},getStyleName:function(){return this.styleName},draw:function(a,b,Ua){},getBindables:function(){return[]},isBindable:function(a){var b=this.getBindables();if(!a||!b||0===b.length)return!1;for(var Ua=0;Ua<b.length;Ua++)if(a.toUpperCase()===b[Ua].toUpperCase())return!0;return!1},isBound:function(b){var c=this.bindings;if(a.isNull(b)||a.isNull(c)||0===c.length||b&&!this.isBindable(b))return!1;for(var Ua=0;Ua<c.length;Ua++)if(b.toUpperCase()===c[Ua].attribute.toUpperCase())return!0;
return!1},hasBinding:function(){return a.notNull(this.bindings)&&0<this.bindings.length},isFeatureBound:function(b){var c=this.bindings;if(a.isNull(c)||0===c.length)return!1;for(var Ua,Ka=!1,Ta=c.length,Wa=0;Wa<Ta;Wa++)Ua=this.resolveDataValue(c[Wa],b),a.notNull(Ua)&&(Ka=!0);return Ka},isServerSide:function(){return this.isServerSide},bindData:function(b,c,Ua){if(b&&c&&this.isBindable(b)){a.isNull(this.bindings)&&(this.bindings=[]);var Ka={};Ka.attribute=b.toUpperCase();Ka.column="string"===typeof c?
c.toUpperCase():c;a.notNull(Ua)?Ua instanceof a.style.Formatter?Ka.formatter=Ua:(Ka.resolver=Ua.resolver,Ka.attrList=Ua.attrList,Ka.classification=Ua.classification?Ua.classification:"equal"):a.util.Logger.throwErr("MAPVIEWER_9051","style.bindData","Must specify a Formatter.");this.bindings.push(Ka)}else a.util.Logger.warning(null,"Style.bindData","Invalid binding attribute or column")},unbindData:function(a){if(a&&this.bindings&&this.isBound(a))for(var b=this.bindings,Ua=0;Ua<b.length;Ua++)a.toUpperCase()===
b[Ua].attribute.toUpperCase()&&(b.splice(Ua,1),this.initialize(this.origConfig),this.bindings=b)},unbindAllData:function(a){if(a&&this.isBound(a))for(var b=this.bindings,Ua=0;Ua<b.length;Ua++)if(a===b[Ua].attribute){b.splice(Ua,1);this.initialize(this.origConfig);this.bindings=b;break}},resolveDataValue:function(xa,c){if("string"===typeof xa.column){var Ua=xa._colName=xa.column,Ka=c.parentLayer;if(a.isNull(Ka))return b;xa.column=new a.Column({data:Ka.getAllFeatures(),keyGetter:function(){return this.id},
valueGetter:function(){var a=this.attributes&&this.attributes[Ua]?this.attributes[Ua]:null;return!isNaN(parseFloat(a))&&isFinite(a)?parseFloat(a):a}})}return xa.column.getValueOfRow(c.id)},resolveBinding:function(b,c){var Ua,Ka=null,Ta,Wa;Ua=this.resolveDataValue(b,c);if(a.notNull(b.formatter))return Ka=b.formatter.resolve(Ua,b.column,c);if(a.notNull(b.resolver))Ka=b.resolver(Ua,b.column);else if(Ta=b.column.getMin(),Wa=b.column.getMax(),b.attrList&&0<b.attrList.length){if(Ta===Wa)return b.attrList[0];
if("logarithmic"===b.classification){1>Ta&&(Ta=1);var cb=Math.log(Ta);Wa=(Math.log(Wa)-cb)/b.attrList.length;for(var kb=0;kb<b.attrList.length;kb++){var Ya=Math.exp(cb+Wa*(kb+1));if(0===kb&&Ua<=Ya||Ua>=Ta&&Ua<=Ya){Ka=b.attrList[kb];break}Ta=Ya}}else Ua=parseInt((Ua-Ta)/((Wa-Ta)/b.attrList.length)),Ua>=b.attrList.length&&(Ua=b.attrList.length-1),Ka=b.attrList[Ua]}return Ka}});a.style.Style.calculateStyleSize=function(b,c){if(!(a.isNull(b)||a.notNull(b.realWidth)&&a.notNull(b.realHeight))){var Ua=b.lengthUnit?
b.lengthUnit:"pixel",Ua=Ua.toLowerCase(),Ka=a.util.GeomUtil.getCurrentDistancePerPixel(c);if("pixel"!==Ua){var Ta=a.gv.getUnitFactor(Ua);0===Ta?Ua="pixel":Ka/=Ta}"pixel"===Ua?(b.realWidth=b.width,b.realHeight=b.height):b.unitFontSize?b.fontSize=parseFloat(b.unitFontSize/Ka):b.unitFillWidth||b.unitCenterLineWidth||b.unitStrokeThickness?(b.fillWidth=parseFloat(b.unitFillWidth/Ka),b.centerLineWidth=parseFloat(b.unitCenterLineWidth/Ka),b.strokeThickness=parseFloat(b.unitStrokeThickness/Ka),b.calculateRealSize()):
b.unitSpotlightRadius?b.spotlightRadius=parseFloat(b.unitSpotlightRadius/Ka):(Ta=b.height,Ua=parseFloat(b.width/Ka),Ka=parseFloat(Ta/Ka),Ua=Ua<parseFloat(b.minlength)?parseFloat(b.minlength):Ua,Ka=Ka<parseFloat(b.minlength)?parseFloat(b.minlength):Ka,b.realWidth=Ua>parseFloat(b.maxlength)?parseFloat(b.maxlength):Ua,b.realHeight=Ka>parseFloat(b.maxlength)?parseFloat(b.maxlength):Ka,!a.isNull(b.max_size_in_px)&&0<b.max_size_in_px&&(b.realWidth>b.max_size_in_px||b.realHeight>b.max_size_in_px)&&(Ka=Math.max(b.realWidth,
b.realHeight),Ka=b.max_size_in_px/Ka,b.realWidth*=Ka,b.realHeight*=Ka))}};a.style.Style.rgbToHsv=function(a){var b,Ua;Ua=a.r/255;var Ka=a.g/255,Ta=a.b/255,Wa=Math.min(Ua,Ka,Ta);a=Math.max(Ua,Ka,Ta);Wa=a-Wa;0===Wa?b=0:a===Ka?b=60*(Ta-Ua)/Wa+120:a===Ta?b=60*(Ua-Ka)/Wa+240:a===Ua&&(b=Ka>=Ta?60*(Ka-Ta)/Wa+0:60*(Ka-Ta)/Wa+360);Ua=0===a?0:Wa/a;return{h:Math.round(b),s:Math.round(100*Ua),v:Math.round(100*a)}};a.style.Style.hsvToRgb=function(a){var b=a.h,Ua=a.s;a=a.v;var Ka,Ta,Wa,c,kb,Ya;if(0===Ua)Wa=Ta=
Ka=b=Ua=a=Math.round(255*a/100);else{Ua/=100;a/=100;c=Math.floor(b/60)%6;kb=b/60-c;b=a*(1-Ua);Ya=a*(1-Ua*kb);Ua=a*(1-Ua*(1-kb));switch(c){case 0:Ka=a;Ta=Ua;Wa=b;break;case 1:Ka=Ya;Ta=a;Wa=b;break;case 2:Ka=b;Ta=a;Wa=Ua;break;case 3:Ka=b;Ta=Ya;Wa=a;break;case 4:Ka=Ua;Ta=b;Wa=a;break;case 5:Ka=a,Ta=b,Wa=Ya}Ka=Math.round(255*Ka);Ta=Math.round(255*Ta);Wa=Math.round(255*Wa)}return{r:Ka,g:Ta,b:Wa}};a.style.Style.ColorLuminance=function(a,b){a=String(a).replace(/[^0-9a-f]/gi,"");6>a.length&&(a=a[0]+a[0]+
a[1]+a[1]+a[2]+a[2]);b=b||0;var Ua="#",Ka,Ta;for(Ta=0;3>Ta;Ta++)Ka=parseInt(a.substr(2*Ta,2),16),Ka=Math.round(Math.min(Math.max(0,Ka+Ka*b),255)).toString(16),Ua+=("00"+Ka).substr(Ka.length);return Ua};a.style.colorbrewer={YlGn:{3:["#f7fcb9","#addd8e","#31a354"],4:["#ffffcc","#c2e699","#78c679","#238443"],5:["#ffffcc","#c2e699","#78c679","#31a354","#006837"],6:"#ffffcc #d9f0a3 #addd8e #78c679 #31a354 #006837".split(" "),7:"#ffffcc #d9f0a3 #addd8e #78c679 #41ab5d #238443 #005a32".split(" "),8:"#ffffe5 #f7fcb9 #d9f0a3 #addd8e #78c679 #41ab5d #238443 #005a32".split(" "),
9:"#ffffe5 #f7fcb9 #d9f0a3 #addd8e #78c679 #41ab5d #238443 #006837 #004529".split(" ")},YlGnBu:{3:["#edf8b1","#7fcdbb","#2c7fb8"],4:["#ffffcc","#a1dab4","#41b6c4","#225ea8"],5:["#ffffcc","#a1dab4","#41b6c4","#2c7fb8","#253494"],6:"#ffffcc #c7e9b4 #7fcdbb #41b6c4 #2c7fb8 #253494".split(" "),7:"#ffffcc #c7e9b4 #7fcdbb #41b6c4 #1d91c0 #225ea8 #0c2c84".split(" "),8:"#ffffd9 #edf8b1 #c7e9b4 #7fcdbb #41b6c4 #1d91c0 #225ea8 #0c2c84".split(" "),9:"#ffffd9 #edf8b1 #c7e9b4 #7fcdbb #41b6c4 #1d91c0 #225ea8 #253494 #081d58".split(" ")},
GnBu:{3:["#e0f3db","#a8ddb5","#43a2ca"],4:["#f0f9e8","#bae4bc","#7bccc4","#2b8cbe"],5:["#f0f9e8","#bae4bc","#7bccc4","#43a2ca","#0868ac"],6:"#f0f9e8 #ccebc5 #a8ddb5 #7bccc4 #43a2ca #0868ac".split(" "),7:"#f0f9e8 #ccebc5 #a8ddb5 #7bccc4 #4eb3d3 #2b8cbe #08589e".split(" "),8:"#f7fcf0 #e0f3db #ccebc5 #a8ddb5 #7bccc4 #4eb3d3 #2b8cbe #08589e".split(" "),9:"#f7fcf0 #e0f3db #ccebc5 #a8ddb5 #7bccc4 #4eb3d3 #2b8cbe #0868ac #084081".split(" ")},BuGn:{3:["#e5f5f9","#99d8c9","#2ca25f"],4:["#edf8fb","#b2e2e2",
"#66c2a4","#238b45"],5:["#edf8fb","#b2e2e2","#66c2a4","#2ca25f","#006d2c"],6:"#edf8fb #ccece6 #99d8c9 #66c2a4 #2ca25f #006d2c".split(" "),7:"#edf8fb #ccece6 #99d8c9 #66c2a4 #41ae76 #238b45 #005824".split(" "),8:"#f7fcfd #e5f5f9 #ccece6 #99d8c9 #66c2a4 #41ae76 #238b45 #005824".split(" "),9:"#f7fcfd #e5f5f9 #ccece6 #99d8c9 #66c2a4 #41ae76 #238b45 #006d2c #00441b".split(" ")},PuBuGn:{3:["#ece2f0","#a6bddb","#1c9099"],4:["#f6eff7","#bdc9e1","#67a9cf","#02818a"],5:["#f6eff7","#bdc9e1","#67a9cf","#1c9099",
"#016c59"],6:"#f6eff7 #d0d1e6 #a6bddb #67a9cf #1c9099 #016c59".split(" "),7:"#f6eff7 #d0d1e6 #a6bddb #67a9cf #3690c0 #02818a #016450".split(" "),8:"#fff7fb #ece2f0 #d0d1e6 #a6bddb #67a9cf #3690c0 #02818a #016450".split(" "),9:"#fff7fb #ece2f0 #d0d1e6 #a6bddb #67a9cf #3690c0 #02818a #016c59 #014636".split(" ")},PuBu:{3:["#ece7f2","#a6bddb","#2b8cbe"],4:["#f1eef6","#bdc9e1","#74a9cf","#0570b0"],5:["#f1eef6","#bdc9e1","#74a9cf","#2b8cbe","#045a8d"],6:"#f1eef6 #d0d1e6 #a6bddb #74a9cf #2b8cbe #045a8d".split(" "),
7:"#f1eef6 #d0d1e6 #a6bddb #74a9cf #3690c0 #0570b0 #034e7b".split(" "),8:"#fff7fb #ece7f2 #d0d1e6 #a6bddb #74a9cf #3690c0 #0570b0 #034e7b".split(" "),9:"#fff7fb #ece7f2 #d0d1e6 #a6bddb #74a9cf #3690c0 #0570b0 #045a8d #023858".split(" ")},BuPu:{3:["#e0ecf4","#9ebcda","#8856a7"],4:["#edf8fb","#b3cde3","#8c96c6","#88419d"],5:["#edf8fb","#b3cde3","#8c96c6","#8856a7","#810f7c"],6:"#edf8fb #bfd3e6 #9ebcda #8c96c6 #8856a7 #810f7c".split(" "),7:"#edf8fb #bfd3e6 #9ebcda #8c96c6 #8c6bb1 #88419d #6e016b".split(" "),
8:"#f7fcfd #e0ecf4 #bfd3e6 #9ebcda #8c96c6 #8c6bb1 #88419d #6e016b".split(" "),9:"#f7fcfd #e0ecf4 #bfd3e6 #9ebcda #8c96c6 #8c6bb1 #88419d #810f7c #4d004b".split(" ")},RdPu:{3:["#fde0dd","#fa9fb5","#c51b8a"],4:["#feebe2","#fbb4b9","#f768a1","#ae017e"],5:["#feebe2","#fbb4b9","#f768a1","#c51b8a","#7a0177"],6:"#feebe2 #fcc5c0 #fa9fb5 #f768a1 #c51b8a #7a0177".split(" "),7:"#feebe2 #fcc5c0 #fa9fb5 #f768a1 #dd3497 #ae017e #7a0177".split(" "),8:"#fff7f3 #fde0dd #fcc5c0 #fa9fb5 #f768a1 #dd3497 #ae017e #7a0177".split(" "),
9:"#fff7f3 #fde0dd #fcc5c0 #fa9fb5 #f768a1 #dd3497 #ae017e #7a0177 #49006a".split(" ")},PuRd:{3:["#e7e1ef","#c994c7","#dd1c77"],4:["#f1eef6","#d7b5d8","#df65b0","#ce1256"],5:["#f1eef6","#d7b5d8","#df65b0","#dd1c77","#980043"],6:"#f1eef6 #d4b9da #c994c7 #df65b0 #dd1c77 #980043".split(" "),7:"#f1eef6 #d4b9da #c994c7 #df65b0 #e7298a #ce1256 #91003f".split(" "),8:"#f7f4f9 #e7e1ef #d4b9da #c994c7 #df65b0 #e7298a #ce1256 #91003f".split(" "),9:"#f7f4f9 #e7e1ef #d4b9da #c994c7 #df65b0 #e7298a #ce1256 #980043 #67001f".split(" ")},
OrRd:{3:["#fee8c8","#fdbb84","#e34a33"],4:["#fef0d9","#fdcc8a","#fc8d59","#d7301f"],5:["#fef0d9","#fdcc8a","#fc8d59","#e34a33","#b30000"],6:"#fef0d9 #fdd49e #fdbb84 #fc8d59 #e34a33 #b30000".split(" "),7:"#fef0d9 #fdd49e #fdbb84 #fc8d59 #ef6548 #d7301f #990000".split(" "),8:"#fff7ec #fee8c8 #fdd49e #fdbb84 #fc8d59 #ef6548 #d7301f #990000".split(" "),9:"#fff7ec #fee8c8 #fdd49e #fdbb84 #fc8d59 #ef6548 #d7301f #b30000 #7f0000".split(" ")},YlOrRd:{3:["#ffeda0","#feb24c","#f03b20"],4:["#ffffb2","#fecc5c",
"#fd8d3c","#e31a1c"],5:["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],6:"#ffffb2 #fed976 #feb24c #fd8d3c #f03b20 #bd0026".split(" "),7:"#ffffb2 #fed976 #feb24c #fd8d3c #fc4e2a #e31a1c #b10026".split(" "),8:"#ffffcc #ffeda0 #fed976 #feb24c #fd8d3c #fc4e2a #e31a1c #b10026".split(" "),9:"#ffffcc #ffeda0 #fed976 #feb24c #fd8d3c #fc4e2a #e31a1c #bd0026 #800026".split(" ")},YlOrBr:{3:["#fff7bc","#fec44f","#d95f0e"],4:["#ffffd4","#fed98e","#fe9929","#cc4c02"],5:["#ffffd4","#fed98e","#fe9929","#d95f0e",
"#993404"],6:"#ffffd4 #fee391 #fec44f #fe9929 #d95f0e #993404".split(" "),7:"#ffffd4 #fee391 #fec44f #fe9929 #ec7014 #cc4c02 #8c2d04".split(" "),8:"#ffffe5 #fff7bc #fee391 #fec44f #fe9929 #ec7014 #cc4c02 #8c2d04".split(" "),9:"#ffffe5 #fff7bc #fee391 #fec44f #fe9929 #ec7014 #cc4c02 #993404 #662506".split(" ")},Purples:{3:["#efedf5","#bcbddc","#756bb1"],4:["#f2f0f7","#cbc9e2","#9e9ac8","#6a51a3"],5:["#f2f0f7","#cbc9e2","#9e9ac8","#756bb1","#54278f"],6:"#f2f0f7 #dadaeb #bcbddc #9e9ac8 #756bb1 #54278f".split(" "),
7:"#f2f0f7 #dadaeb #bcbddc #9e9ac8 #807dba #6a51a3 #4a1486".split(" "),8:"#fcfbfd #efedf5 #dadaeb #bcbddc #9e9ac8 #807dba #6a51a3 #4a1486".split(" "),9:"#fcfbfd #efedf5 #dadaeb #bcbddc #9e9ac8 #807dba #6a51a3 #54278f #3f007d".split(" ")},Blues:{3:["#deebf7","#9ecae1","#3182bd"],4:["#eff3ff","#bdd7e7","#6baed6","#2171b5"],5:["#eff3ff","#bdd7e7","#6baed6","#3182bd","#08519c"],6:"#eff3ff #c6dbef #9ecae1 #6baed6 #3182bd #08519c".split(" "),7:"#eff3ff #c6dbef #9ecae1 #6baed6 #4292c6 #2171b5 #084594".split(" "),
8:"#f7fbff #deebf7 #c6dbef #9ecae1 #6baed6 #4292c6 #2171b5 #084594".split(" "),9:"#f7fbff #deebf7 #c6dbef #9ecae1 #6baed6 #4292c6 #2171b5 #08519c #08306b".split(" ")},Greens:{3:["#e5f5e0","#a1d99b","#31a354"],4:["#edf8e9","#bae4b3","#74c476","#238b45"],5:["#edf8e9","#bae4b3","#74c476","#31a354","#006d2c"],6:"#edf8e9 #c7e9c0 #a1d99b #74c476 #31a354 #006d2c".split(" "),7:"#edf8e9 #c7e9c0 #a1d99b #74c476 #41ab5d #238b45 #005a32".split(" "),8:"#f7fcf5 #e5f5e0 #c7e9c0 #a1d99b #74c476 #41ab5d #238b45 #005a32".split(" "),
9:"#f7fcf5 #e5f5e0 #c7e9c0 #a1d99b #74c476 #41ab5d #238b45 #006d2c #00441b".split(" ")},Oranges:{3:["#fee6ce","#fdae6b","#e6550d"],4:["#feedde","#fdbe85","#fd8d3c","#d94701"],5:["#feedde","#fdbe85","#fd8d3c","#e6550d","#a63603"],6:"#feedde #fdd0a2 #fdae6b #fd8d3c #e6550d #a63603".split(" "),7:"#feedde #fdd0a2 #fdae6b #fd8d3c #f16913 #d94801 #8c2d04".split(" "),8:"#fff5eb #fee6ce #fdd0a2 #fdae6b #fd8d3c #f16913 #d94801 #8c2d04".split(" "),9:"#fff5eb #fee6ce #fdd0a2 #fdae6b #fd8d3c #f16913 #d94801 #a63603 #7f2704".split(" ")},
Reds:{3:["#fee0d2","#fc9272","#de2d26"],4:["#fee5d9","#fcae91","#fb6a4a","#cb181d"],5:["#fee5d9","#fcae91","#fb6a4a","#de2d26","#a50f15"],6:"#fee5d9 #fcbba1 #fc9272 #fb6a4a #de2d26 #a50f15".split(" "),7:"#fee5d9 #fcbba1 #fc9272 #fb6a4a #ef3b2c #cb181d #99000d".split(" "),8:"#fff5f0 #fee0d2 #fcbba1 #fc9272 #fb6a4a #ef3b2c #cb181d #99000d".split(" "),9:"#fff5f0 #fee0d2 #fcbba1 #fc9272 #fb6a4a #ef3b2c #cb181d #a50f15 #67000d".split(" ")},Greys:{3:["#f0f0f0","#bdbdbd","#636363"],4:["#f7f7f7","#cccccc",
"#969696","#525252"],5:["#f7f7f7","#cccccc","#969696","#636363","#252525"],6:"#f7f7f7 #d9d9d9 #bdbdbd #969696 #636363 #252525".split(" "),7:"#f7f7f7 #d9d9d9 #bdbdbd #969696 #737373 #525252 #252525".split(" "),8:"#ffffff #f0f0f0 #d9d9d9 #bdbdbd #969696 #737373 #525252 #252525".split(" "),9:"#ffffff #f0f0f0 #d9d9d9 #bdbdbd #969696 #737373 #525252 #252525 #000000".split(" ")},PuOr:{3:["#f1a340","#f7f7f7","#998ec3"],4:["#e66101","#fdb863","#b2abd2","#5e3c99"],5:["#e66101","#fdb863","#f7f7f7","#b2abd2",
"#5e3c99"],6:"#b35806 #f1a340 #fee0b6 #d8daeb #998ec3 #542788".split(" "),7:"#b35806 #f1a340 #fee0b6 #f7f7f7 #d8daeb #998ec3 #542788".split(" "),8:"#b35806 #e08214 #fdb863 #fee0b6 #d8daeb #b2abd2 #8073ac #542788".split(" "),9:"#b35806 #e08214 #fdb863 #fee0b6 #f7f7f7 #d8daeb #b2abd2 #8073ac #542788".split(" "),10:"#7f3b08 #b35806 #e08214 #fdb863 #fee0b6 #d8daeb #b2abd2 #8073ac #542788 #2d004b".split(" "),11:"#7f3b08 #b35806 #e08214 #fdb863 #fee0b6 #f7f7f7 #d8daeb #b2abd2 #8073ac #542788 #2d004b".split(" ")},
BrBG:{3:["#d8b365","#f5f5f5","#5ab4ac"],4:["#a6611a","#dfc27d","#80cdc1","#018571"],5:["#a6611a","#dfc27d","#f5f5f5","#80cdc1","#018571"],6:"#8c510a #d8b365 #f6e8c3 #c7eae5 #5ab4ac #01665e".split(" "),7:"#8c510a #d8b365 #f6e8c3 #f5f5f5 #c7eae5 #5ab4ac #01665e".split(" "),8:"#8c510a #bf812d #dfc27d #f6e8c3 #c7eae5 #80cdc1 #35978f #01665e".split(" "),9:"#8c510a #bf812d #dfc27d #f6e8c3 #f5f5f5 #c7eae5 #80cdc1 #35978f #01665e".split(" "),10:"#543005 #8c510a #bf812d #dfc27d #f6e8c3 #c7eae5 #80cdc1 #35978f #01665e #003c30".split(" "),
11:"#543005 #8c510a #bf812d #dfc27d #f6e8c3 #f5f5f5 #c7eae5 #80cdc1 #35978f #01665e #003c30".split(" ")},PRGn:{3:["#af8dc3","#f7f7f7","#7fbf7b"],4:["#7b3294","#c2a5cf","#a6dba0","#008837"],5:["#7b3294","#c2a5cf","#f7f7f7","#a6dba0","#008837"],6:"#762a83 #af8dc3 #e7d4e8 #d9f0d3 #7fbf7b #1b7837".split(" "),7:"#762a83 #af8dc3 #e7d4e8 #f7f7f7 #d9f0d3 #7fbf7b #1b7837".split(" "),8:"#762a83 #9970ab #c2a5cf #e7d4e8 #d9f0d3 #a6dba0 #5aae61 #1b7837".split(" "),9:"#762a83 #9970ab #c2a5cf #e7d4e8 #f7f7f7 #d9f0d3 #a6dba0 #5aae61 #1b7837".split(" "),
10:"#40004b #762a83 #9970ab #c2a5cf #e7d4e8 #d9f0d3 #a6dba0 #5aae61 #1b7837 #00441b".split(" "),11:"#40004b #762a83 #9970ab #c2a5cf #e7d4e8 #f7f7f7 #d9f0d3 #a6dba0 #5aae61 #1b7837 #00441b".split(" ")},PiYG:{3:["#e9a3c9","#f7f7f7","#a1d76a"],4:["#d01c8b","#f1b6da","#b8e186","#4dac26"],5:["#d01c8b","#f1b6da","#f7f7f7","#b8e186","#4dac26"],6:"#c51b7d #e9a3c9 #fde0ef #e6f5d0 #a1d76a #4d9221".split(" "),7:"#c51b7d #e9a3c9 #fde0ef #f7f7f7 #e6f5d0 #a1d76a #4d9221".split(" "),8:"#c51b7d #de77ae #f1b6da #fde0ef #e6f5d0 #b8e186 #7fbc41 #4d9221".split(" "),
9:"#c51b7d #de77ae #f1b6da #fde0ef #f7f7f7 #e6f5d0 #b8e186 #7fbc41 #4d9221".split(" "),10:"#8e0152 #c51b7d #de77ae #f1b6da #fde0ef #e6f5d0 #b8e186 #7fbc41 #4d9221 #276419".split(" "),11:"#8e0152 #c51b7d #de77ae #f1b6da #fde0ef #f7f7f7 #e6f5d0 #b8e186 #7fbc41 #4d9221 #276419".split(" ")},RdBu:{3:["#ef8a62","#f7f7f7","#67a9cf"],4:["#ca0020","#f4a582","#92c5de","#0571b0"],5:["#ca0020","#f4a582","#f7f7f7","#92c5de","#0571b0"],6:"#b2182b #ef8a62 #fddbc7 #d1e5f0 #67a9cf #2166ac".split(" "),7:"#b2182b #ef8a62 #fddbc7 #f7f7f7 #d1e5f0 #67a9cf #2166ac".split(" "),
8:"#b2182b #d6604d #f4a582 #fddbc7 #d1e5f0 #92c5de #4393c3 #2166ac".split(" "),9:"#b2182b #d6604d #f4a582 #fddbc7 #f7f7f7 #d1e5f0 #92c5de #4393c3 #2166ac".split(" "),10:"#67001f #b2182b #d6604d #f4a582 #fddbc7 #d1e5f0 #92c5de #4393c3 #2166ac #053061".split(" "),11:"#67001f #b2182b #d6604d #f4a582 #fddbc7 #f7f7f7 #d1e5f0 #92c5de #4393c3 #2166ac #053061".split(" ")},RdGy:{3:["#ef8a62","#ffffff","#999999"],4:["#ca0020","#f4a582","#bababa","#404040"],5:["#ca0020","#f4a582","#ffffff","#bababa","#404040"],
6:"#b2182b #ef8a62 #fddbc7 #e0e0e0 #999999 #4d4d4d".split(" "),7:"#b2182b #ef8a62 #fddbc7 #ffffff #e0e0e0 #999999 #4d4d4d".split(" "),8:"#b2182b #d6604d #f4a582 #fddbc7 #e0e0e0 #bababa #878787 #4d4d4d".split(" "),9:"#b2182b #d6604d #f4a582 #fddbc7 #ffffff #e0e0e0 #bababa #878787 #4d4d4d".split(" "),10:"#67001f #b2182b #d6604d #f4a582 #fddbc7 #e0e0e0 #bababa #878787 #4d4d4d #1a1a1a".split(" "),11:"#67001f #b2182b #d6604d #f4a582 #fddbc7 #ffffff #e0e0e0 #bababa #878787 #4d4d4d #1a1a1a".split(" ")},
RdYlBu:{3:["#fc8d59","#ffffbf","#91bfdb"],4:["#d7191c","#fdae61","#abd9e9","#2c7bb6"],5:["#d7191c","#fdae61","#ffffbf","#abd9e9","#2c7bb6"],6:"#d73027 #fc8d59 #fee090 #e0f3f8 #91bfdb #4575b4".split(" "),7:"#d73027 #fc8d59 #fee090 #ffffbf #e0f3f8 #91bfdb #4575b4".split(" "),8:"#d73027 #f46d43 #fdae61 #fee090 #e0f3f8 #abd9e9 #74add1 #4575b4".split(" "),9:"#d73027 #f46d43 #fdae61 #fee090 #ffffbf #e0f3f8 #abd9e9 #74add1 #4575b4".split(" "),10:"#a50026 #d73027 #f46d43 #fdae61 #fee090 #e0f3f8 #abd9e9 #74add1 #4575b4 #313695".split(" "),
11:"#a50026 #d73027 #f46d43 #fdae61 #fee090 #ffffbf #e0f3f8 #abd9e9 #74add1 #4575b4 #313695".split(" ")},Spectral:{3:["#fc8d59","#ffffbf","#99d594"],4:["#d7191c","#fdae61","#abdda4","#2b83ba"],5:["#d7191c","#fdae61","#ffffbf","#abdda4","#2b83ba"],6:"#d53e4f #fc8d59 #fee08b #e6f598 #99d594 #3288bd".split(" "),7:"#d53e4f #fc8d59 #fee08b #ffffbf #e6f598 #99d594 #3288bd".split(" "),8:"#d53e4f #f46d43 #fdae61 #fee08b #e6f598 #abdda4 #66c2a5 #3288bd".split(" "),9:"#d53e4f #f46d43 #fdae61 #fee08b #ffffbf #e6f598 #abdda4 #66c2a5 #3288bd".split(" "),
10:"#9e0142 #d53e4f #f46d43 #fdae61 #fee08b #e6f598 #abdda4 #66c2a5 #3288bd #5e4fa2".split(" "),11:"#9e0142 #d53e4f #f46d43 #fdae61 #fee08b #ffffbf #e6f598 #abdda4 #66c2a5 #3288bd #5e4fa2".split(" ")},RdYlGn:{3:["#fc8d59","#ffffbf","#91cf60"],4:["#d7191c","#fdae61","#a6d96a","#1a9641"],5:["#d7191c","#fdae61","#ffffbf","#a6d96a","#1a9641"],6:"#d73027 #fc8d59 #fee08b #d9ef8b #91cf60 #1a9850".split(" "),7:"#d73027 #fc8d59 #fee08b #ffffbf #d9ef8b #91cf60 #1a9850".split(" "),8:"#d73027 #f46d43 #fdae61 #fee08b #d9ef8b #a6d96a #66bd63 #1a9850".split(" "),
9:"#d73027 #f46d43 #fdae61 #fee08b #ffffbf #d9ef8b #a6d96a #66bd63 #1a9850".split(" "),10:"#a50026 #d73027 #f46d43 #fdae61 #fee08b #d9ef8b #a6d96a #66bd63 #1a9850 #006837".split(" "),11:"#a50026 #d73027 #f46d43 #fdae61 #fee08b #ffffbf #d9ef8b #a6d96a #66bd63 #1a9850 #006837".split(" ")},Accent:{3:["#7fc97f","#beaed4","#fdc086"],4:["#7fc97f","#beaed4","#fdc086","#ffff99"],5:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0"],6:"#7fc97f #beaed4 #fdc086 #ffff99 #386cb0 #f0027f".split(" "),7:"#7fc97f #beaed4 #fdc086 #ffff99 #386cb0 #f0027f #bf5b17".split(" "),
8:"#7fc97f #beaed4 #fdc086 #ffff99 #386cb0 #f0027f #bf5b17 #666666".split(" ")},Dark2:{3:["#1b9e77","#d95f02","#7570b3"],4:["#1b9e77","#d95f02","#7570b3","#e7298a"],5:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e"],6:"#1b9e77 #d95f02 #7570b3 #e7298a #66a61e #e6ab02".split(" "),7:"#1b9e77 #d95f02 #7570b3 #e7298a #66a61e #e6ab02 #a6761d".split(" "),8:"#1b9e77 #d95f02 #7570b3 #e7298a #66a61e #e6ab02 #a6761d #666666".split(" ")},Paired:{3:["#a6cee3","#1f78b4","#b2df8a"],4:["#a6cee3","#1f78b4","#b2df8a",
"#33a02c"],5:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99"],6:"#a6cee3 #1f78b4 #b2df8a #33a02c #fb9a99 #e31a1c".split(" "),7:"#a6cee3 #1f78b4 #b2df8a #33a02c #fb9a99 #e31a1c #fdbf6f".split(" "),8:"#a6cee3 #1f78b4 #b2df8a #33a02c #fb9a99 #e31a1c #fdbf6f #ff7f00".split(" "),9:"#a6cee3 #1f78b4 #b2df8a #33a02c #fb9a99 #e31a1c #fdbf6f #ff7f00 #cab2d6".split(" "),10:"#a6cee3 #1f78b4 #b2df8a #33a02c #fb9a99 #e31a1c #fdbf6f #ff7f00 #cab2d6 #6a3d9a".split(" "),11:"#a6cee3 #1f78b4 #b2df8a #33a02c #fb9a99 #e31a1c #fdbf6f #ff7f00 #cab2d6 #6a3d9a #ffff99".split(" "),
12:"#a6cee3 #1f78b4 #b2df8a #33a02c #fb9a99 #e31a1c #fdbf6f #ff7f00 #cab2d6 #6a3d9a #ffff99 #b15928".split(" ")},Pastel1:{3:["#fbb4ae","#b3cde3","#ccebc5"],4:["#fbb4ae","#b3cde3","#ccebc5","#decbe4"],5:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6"],6:"#fbb4ae #b3cde3 #ccebc5 #decbe4 #fed9a6 #ffffcc".split(" "),7:"#fbb4ae #b3cde3 #ccebc5 #decbe4 #fed9a6 #ffffcc #e5d8bd".split(" "),8:"#fbb4ae #b3cde3 #ccebc5 #decbe4 #fed9a6 #ffffcc #e5d8bd #fddaec".split(" "),9:"#fbb4ae #b3cde3 #ccebc5 #decbe4 #fed9a6 #ffffcc #e5d8bd #fddaec #f2f2f2".split(" ")},
Pastel2:{3:["#b3e2cd","#fdcdac","#cbd5e8"],4:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4"],5:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9"],6:"#b3e2cd #fdcdac #cbd5e8 #f4cae4 #e6f5c9 #fff2ae".split(" "),7:"#b3e2cd #fdcdac #cbd5e8 #f4cae4 #e6f5c9 #fff2ae #f1e2cc".split(" "),8:"#b3e2cd #fdcdac #cbd5e8 #f4cae4 #e6f5c9 #fff2ae #f1e2cc #cccccc".split(" ")},Set1:{3:["#e41a1c","#377eb8","#4daf4a"],4:["#e41a1c","#377eb8","#4daf4a","#984ea3"],5:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00"],6:"#e41a1c #377eb8 #4daf4a #984ea3 #ff7f00 #ffff33".split(" "),
7:"#e41a1c #377eb8 #4daf4a #984ea3 #ff7f00 #ffff33 #a65628".split(" "),8:"#e41a1c #377eb8 #4daf4a #984ea3 #ff7f00 #ffff33 #a65628 #f781bf".split(" "),9:"#e41a1c #377eb8 #4daf4a #984ea3 #ff7f00 #ffff33 #a65628 #f781bf #999999".split(" ")},Set2:{3:["#66c2a5","#fc8d62","#8da0cb"],4:["#66c2a5","#fc8d62","#8da0cb","#e78ac3"],5:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854"],6:"#66c2a5 #fc8d62 #8da0cb #e78ac3 #a6d854 #ffd92f".split(" "),7:"#66c2a5 #fc8d62 #8da0cb #e78ac3 #a6d854 #ffd92f #e5c494".split(" "),
8:"#66c2a5 #fc8d62 #8da0cb #e78ac3 #a6d854 #ffd92f #e5c494 #b3b3b3".split(" ")},Set3:{3:["#8dd3c7","#ffffb3","#bebada"],4:["#8dd3c7","#ffffb3","#bebada","#fb8072"],5:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3"],6:"#8dd3c7 #ffffb3 #bebada #fb8072 #80b1d3 #fdb462".split(" "),7:"#8dd3c7 #ffffb3 #bebada #fb8072 #80b1d3 #fdb462 #b3de69".split(" "),8:"#8dd3c7 #ffffb3 #bebada #fb8072 #80b1d3 #fdb462 #b3de69 #fccde5".split(" "),9:"#8dd3c7 #ffffb3 #bebada #fb8072 #80b1d3 #fdb462 #b3de69 #fccde5 #d9d9d9".split(" "),
10:"#8dd3c7 #ffffb3 #bebada #fb8072 #80b1d3 #fdb462 #b3de69 #fccde5 #d9d9d9 #bc80bd".split(" "),11:"#8dd3c7 #ffffb3 #bebada #fb8072 #80b1d3 #fdb462 #b3de69 #fccde5 #d9d9d9 #bc80bd #ccebc5".split(" "),12:"#8dd3c7 #ffffb3 #bebada #fb8072 #80b1d3 #fdb462 #b3de69 #fccde5 #d9d9d9 #bc80bd #ccebc5 #ffed6f".split(" ")}};a.style.Text=a.style.Style.extend({initialize:function Rb(b){b=b||{};b.styleType="Text";Rb.base.call(this,b);this.fontFamily=a.notNull(b.fontFamily)?b.fontFamily:null;this.fontStyle=a.notNull(b.fontStyle)?
b.fontStyle:a.Text.FONTSTYLE_NORMAL;this.fontWeight=a.notNull(b.fontWeight)?b.fontWeight:a.Text.FONTWEIGHT_NORMAL;this.fill=a.notNull(b.fill)?b.fill:null;this.lengthUnit=a.notNull(b.lengthUnit)?b.lenghtUnit:"pixel";this.lengthUnit=a.notNull(b.sizeUnit)?b.sizeUnit:"pixel";"pixel"===this.lengthUnit?this.fontSize=a.notNull(b.fontSize)?parseInt(b.fontSize):12:this.unitFontSize=a.notNull(b.fontSize)?parseInt(b.fontSize):10;this.hAlign=a.notNull(b.hAlign)?b.hAlign:a.Text.HORIZONTALALIGN_CENTER;this.vAlign=
a.notNull(b.vAlign)?b.vAlign:a.Text.VERTICALALIGN_CENTER;this.sticky=a.notNull(b.sticky)?b.sticky:!1},toXMLString:function(){var b="",c="",c=a.notNull(this.fontStyle)&&this.fontStyle===a.Text.FONTSTYLE_ITALIC?"font-style:italic;":"font-style:plain;",b=a.notNull(this.hAlign)&&this.hAlign===a.HORIZONTALALIGN_LEFT?"text-align:left;":a.notNull(this.hAlign)&&this.hAlign===a.HORIZONTALALIGN_RIGHT?"text-align:right;":"text-align:center;",Ka;Ka=""+('\x3cstyle name\x3d"'+this.getStyleName()+'"\x3e');Ka=Ka+
'\x3cg class\x3d"text" style\x3d"'+c;Ka+=a.notNull(this.fontFamily)?"font-family:"+this.fontFamily+";":"";Ka+=a.notNull(this.fontSize)?"font-size:"+this.fontSize+"pt;":"";Ka+=b;Ka+=a.notNull(this.fill)?"fill:"+this.fill:"";return Ka+='"\x3e\x3c/g\x3e\x3c/style\x3e'},draw:function(b,c,Ka){this.resolve(b);var Ta=b.geo,Wa=b.geo.type;if(Ka.markerPoint&&b.shapeGroup)b.shapeGroup.push(this.drawText(c,Ka.group,Ka.markerPoint,b.markerText));else if(Ka.sPoint)b.shape=this.drawText(c,Ka.group,Ka.sPoint,b.markerText);
else if("LineString"!==Wa&&"MultiLineString"!==Wa)if("Polygon"===Wa||"MultiPolygon"===Wa)b.screenPoints||(Wa=null,b.labelBox?Wa=new a.geometry.Point((b.labelBox[0]+b.labelBox[2])/2,(b.labelBox[1]+b.labelBox[3])/2,Ta.srid):Ta.mbr&&(Wa=new a.geometry.Point((Ta.mbr.getMinX()+Ta.mbr.getMaxX())/2,(Ta.mbr.getMinY()+Ta.mbr.getMaxY())/2,Ta.srid)),Wa=b.transformGeometry(Wa),b.screenPoints||(b.screenPoints=Wa)),b.shape=this.drawText(c,Ka.group,b.screenPoints,b.markerText);else if(b.screenPoints||b.transformGeometry(Ta),
"Point"===Wa||"OrientedPoint"===Wa)b.shape=this.drawText(c,Ka.group,b.screenPoints,b.text),a.isNull(b.renderingStyle)||(b.markerWidth=this.realWidthInPx,b.markerHeight=this.realWidthInPx)},drawText:function(b,c,Ka,Ta){if(0!==this.width&&0!==this.height){var Wa=b.getGraphics();Ka=Wa.createTextNode(Ta,this,Ka.x,Ka.y);c.appendChild(Ka);this.size=Wa.getWidthHeight(Ka);a.style.Style.calculateStyleSize(this,b);c=b=0;if(a.notNull(this.hAlign))switch(this.hAlign){case a.Text.HORIZONTALALIGN_CENTER:b=(0-this.size.w)/
2;break;case a.Text.HORIZONTALALIGN_RIGHT:b=-this.size.w}if(a.notNull(this.vAlign))switch(this.hAlign){case a.Text.VERTICALALIGN_CENTER:c=(this.size.h-4)/2;break;case a.Text.VERTICALALIGN_TOP:c=this.size.h}(new Wa.oui.geom.Matrix).translate(b,c);return Ka}},getBindables:function(){a.isNull(this.bindableAttrs)&&(this.bindableAttrs=["Color","FontSize","FontFamily","FontStyle"]);return this.bindableAttrs},resolve:function(b){if(!this.bindings||0===this.bindings.length)return this;for(var c=0,Ka=this.bindings.length;c<
Ka;c++){var Ta=this.bindings[c],Wa=this.resolveBinding(Ta,b);"COLOR"===Ta.attribute?(this.fill=Wa,this.isBound("COLOR")&&1===this.bindings.length&&Wa===a.PaintTypes.NO_PAINT&&(this.width=0)):"FONTSIZE"===Ta.attribute?this.fontSize=Wa:"FONTFAMILY"===Ta.attribute?this.fontFamily=Wa:"FONSTYLE"===Ta.attribute&&(this.fontStyle=Wa)}return this}});a.style.Gradient=a.style.Style.extend({initialize:function Ua(b){b=b||{};b.styleType=b&&b.styleType?b.styleType:"AbstractGradient";Ua.base.call(this,b);if(a.isNull(b.stops))return a.util.Logger.throwErr(null,
"Gradient.initialize","Color stops not provided."),null;this.copyOrigStops();this.useFeatureBoundingBox=b&&a.notNull(b.useFeatureBoundingBox)?b.useFeatureBoundingBox:!0;this.stroke=b&&a.notNull(b.stroke)?b.stroke:null;this.strokeThickness=b&&a.notNull(b.strokeThickness)?parseFloat(b.strokeThickness):1;this.strokeOpacity=b&&a.notNull(b.strokeOpacity)?b.strokeOpacity:1;this.fillOpacity=b&&a.notNull(b.fillOpacity)?b.fillOpacity:1;this.strokeDash=a.notNull(b.strokeDash)?b.strokeDash:[]},copyOrigStops:function(){this.stops1=
[];for(var a,b=this.origConfig,c=0;c<b.stops.length;c++)a=b.stops[c],this.stops1.push({offset:a.offset,color:a.color})},createGradientStop:function(a){a=a.oui.style.GradientStop;if(this.stops1){var b=this.stops1.length;this.stops=[];for(var c=0;c<b;c++)this.stops1[c]instanceof a||(this.stops[c]=new a({offset:this.stops1[c].offset,color:this.stops1[c].color}))}},draw:function(b,c,Ta){var Wa=b.geo,cb=Ta.type?Ta.type:Wa.type;c=c.getGraphics();var kb,Ya,Pa;Ta.screenPoints?Wa=Ta.screenPoints:(b.screenPoints||
b.transformGeometry(Wa),Wa=b.screenPoints);this.resolve(b,c);if(("LineString"===cb||"MultiLineString"===cb)&&Wa&&0<Wa.length)if(kb={stroke:this.stroke,strokeOpacity:this.strokeOpacity,strokeThickness:this.strokeThickness},"LineString"===cb)b.shape=c.drawPath(Wa,kb,Ta);else{Pa=c.createGroup();Ta.group.appendChild(Pa);Ta.group=Pa;cb=0;for(Ya=Wa.length;cb<Ya;cb++)c.drawPath(Wa[cb],kb,Ta);b.shape=Pa}else if(this.createStyle(c),kb={stroke:this.stroke,strokeOpacity:this.strokeOpacity,strokeThickness:this.strokeThickness,
fill:this.fill,fillOpacity:this.fillOpacity,strokeDashArray:this.strokeDash},"Point"===cb||"OrientedPoint"===cb||"MultiPoint"===cb||"OrientedMultiPoint"===cb)if(Ya=a.gv.defaultMarkerStyleWidth,Pa=a.gv.defaultMarkerStyleHeight,kb=[{shape:{type:"circle",cx:Ya/2,cy:Pa/2,width:Ya,height:Pa,scaleX:1,scaleY:1},style:kb}],"MultiPoint"===cb||"OrientedMultiPoint"===cb){Pa=c.createGroup();Ta.group.appendChild(Pa);Ta.group=Pa;cb=0;for(Ya=Wa.length;cb<Ya;cb++)c.drawVectorMarker({x:Wa[cb].x,y:Wa[cb].y},kb,Ta);
b.shape=Pa}else b.shape=c.drawVectorMarker({x:Wa.x,y:Wa.y},kb,Ta);else if(Wa&&0!==Wa.length)if("Rectangle"===cb)b.shape=c.drawRectangle(Wa,kb,Ta);else if("Polygon"===cb)b.shape=c.drawPath(Wa,kb,Ta);else if("MultiPolygon"===cb){cb=c.createGroup();Ta.group.appendChild(cb);Ta.group=cb;Ya=0;for(Pa=Wa.length;Ya<Pa;Ya++)c.drawPath(Wa[Ya],kb,Ta);b.shape=cb}},getBindables:function(){return["StartColor","EndColor"]},resolve:function(b){var c,Ta;if(!this.bindings||0===this.bindings.length)return Ta=this.stops1.length,
this.stops1[0].color===this.origConfig.stops[0].color&&this.stops1[Ta-1].color===this.origConfig.stops[Ta-1].color||this.copyOrigStops(),this;c=0;for(Ta=this.bindings.length;c<Ta;c++){var Wa=this.bindings[c],cb=this.resolveBinding(Wa,b);"STARTCOLOR"===Wa.attribute?a.notNull(cb)&&a.util.ValidationUtil.getColor(cb)?this.stops1[0].color=cb:this.stops1[0].color=this.origConfig.stops[0].color:"ENDCOLOR"===Wa.attribute&&(a.notNull(cb)&&a.util.ValidationUtil.getColor(cb)?(Ta=this.stops1.length,this.stops1[Ta-
1].color=cb):(Ta=this.origConfig.stops.length,this.origConfig.stops[Ta-1].color=cb))}return this}});a.style.LinearGradient=a.style.Gradient.extend({initialize:function Ka(a){a.styleType="LinearGradient";Ka.base.call(this,a);this.x1=a.x1||0;this.y1=a.y1||0;this.x2=a.x2||0;this.y2=a.y2||0},createStyle:function(a){this.createGradientStop(a);this.fill=new a.oui.style.LinearGradient({x1:this.x1,y1:this.y1,x2:this.x2,y2:this.y2,stops:this.stops})}});a.style.Color=a.style.Style.extend({initialize:function Ta(b){b=
b||{};b.styleType="Color";Ta.base.call(this,b);var c=a.util.ValidationUtil.getColor;this.stroke=a.notNull(b.stroke)&&c(b.stroke)?c(b.stroke):a.PaintTypes.NO_PAINT;this.strokeOpacity=a.notNull(b.strokeOpacity)?b.strokeOpacity:1;this.strokeThickness=a.notNull(b.strokeThickness)?parseFloat(b.strokeThickness):1;this.strokeDash=a.notNull(b.strokeDash)?b.strokeDash:[];this.fill=a.notNull(b.fill)&&c(b.fill)?c(b.fill):a.PaintTypes.NO_PAINT;this.fillOpacity=a.notNull(b.fillOpacity)?b.fillOpacity:1;this.gradient=
b.gradient||"off";this.outlineStroke=a.notNull(b.outlineStroke)&&c(b.outlineStroke)?c(b.outlineStroke):null;this.outlineStrokeThickness=a.notNull(b.outlineStrokeThickness)?parseFloat(b.outlineStrokeThickness):1;this.fill===a.PaintTypes.NO_PAINT?(this.fillOpacity=0,this.noNativeFill=!0):this.noNativeFill=!1;a.notNull(b.stroke)&&(b.stroke=c(b.stroke));a.notNull(b.outlineStroke)&&(b.outlineStroke=c(b.outlineStroke));a.notNull(b.fill)&&(b.fill=c(b.fill))},resolve:function(b){if(!this.bindings||0===this.bindings.length)return this;
for(var c=0,cb=this.bindings.length;c<cb;c++){var kb=this.bindings[c],Ya=this.resolveBinding(kb,b);"FILL"===kb.attribute?(this.fill=Ya,Ya&&a.util.ValidationUtil.getColor(Ya))?this.noNativeFill&&0===this.fillOpacity&&(this.fillOpacity=1):this.fillOpacity=0:"STROKE"===kb.attribute?(this.stroke=Ya,Ya&&a.util.ValidationUtil.getColor(Ya)||(this.stroke=a.PaintTypes.NO_PAINT)):"STROKETHICKNESS"===kb.attribute&&(this.strokeThickness=Number(Ya),isNaN(Ya))}return this},draw:function(b,c,cb){this.resolve(b,
Pa);var kb=b.geo,Ya=cb.type?cb.type:kb.type,Pa=c.getGraphics();"off"===this.gradient||0===this.fillOpacity||this.fill instanceof Pa.oui.style.LinearGradient||(this.fill=new Pa.oui.style.LinearGradient({x1:0,y1:0,x2:1,y2:1,stops:[new Pa.oui.style.GradientStop({offset:0,color:"#eeffffff"}),new Pa.oui.style.GradientStop({offset:1,color:this.fill})]}));var Xa,hb;cb.screenPoints?c=cb.screenPoints:(b.screenPoints||b.transformGeometry(kb),c=b.screenPoints);if("Point"===Ya||"OrientedPoint"===Ya||"MultiPoint"===
Ya||"OrientedMultiPoint"===Ya){var fb=a.gv.defaultMarkerStyleWidth;Xa=a.gv.defaultMarkerStyleHeight;kb=[{shape:{type:"circle",cx:fb/2,cy:Xa/2,width:fb,height:Xa,scaleX:1,scaleY:1},style:this}];cb.width=fb;cb.height=Xa;if("MultiPoint"===Ya||"OrientedMultiPoint"===Ya){Ya=Pa.createGroup();cb.group.appendChild(Ya);cb.group=Ya;Xa=0;for(hb=c.length;Xa<hb;Xa++)Pa.drawVectorMarker({x:c[Xa].x,y:c[Xa].y},kb,cb);b.shape=Ya}else b.shape=Pa.drawVectorMarker({x:c.x,y:c.y},kb,cb)}else if(c&&0!==c.length)if(kb={stroke:this.stroke,
strokeOpacity:this.strokeOpacity,strokeThickness:this.strokeThickness,strokeDashArray:this.strokeDash,fill:this.fill,fillOpacity:this.fillOpacity},fb=null,a.notNull(this.outlineStroke)&&(fb={stroke:this.outlineStroke,strokeThickness:2*this.outlineStrokeThickness+this.strokeThickness,fill:this.fill,fillOpacity:this.fillOpacity}),"LineString"===Ya||"MultiLineString"===Ya?(kb.stroke||(kb.stroke=kb.fill?kb.fill:"#000000"),kb.fill=null):kb.fill===a.PaintTypes.NO_PAINT&&(kb.fill="#ffffff",kb.fillOpacity=
0),"LineString"===Ya||"Polygon"===Ya||"Rectangle"===Ya)Xa=Pa.drawPath,"Rectangle"===Ya&&(Xa=Pa.drawRectangle),a.isNull(fb)?b.shape=Xa.call(Pa,c,kb,cb):(Ya=Pa.createGroup(),cb.group.appendChild(Ya),cb.group=Ya,Xa.call(Pa,c,fb,cb),Xa.call(Pa,c,kb,cb),b.shape=Ya);else if("MultiLineString"===Ya||"MultiPolygon"===Ya){Ya=Pa.createGroup();cb.group.appendChild(Ya);cb.group=Ya;Xa=0;for(hb=c.length;Xa<hb;Xa++)a.notNull(fb)&&Pa.drawPath(c[Xa],fb,cb),Pa.drawPath(c[Xa],kb,cb);b.shape=Ya}},getBindables:function(){return this.bindableAttrs?
this.bindableAttrs:this.bindableAttrs=["Fill","Stroke","StrokeThickness"]},toXMLString:function(){var b;b=""+('\x3cstyle name\x3d"'+this.getStyleName()+'"\x3e');b=b+'\x3cg class\x3d"color" style\x3d"'+(a.notNull(this.stroke)?"stroke:"+this.stroke+";":"");b+=a.notNull(this.strokeOpacity)?"stroke-opacity:"+Math.min(Math.round(255*this.strokeOpacity),255)+";":"";b+=a.notNull(this.fill)?"fill:"+this.fill+";":"";b+=a.notNull(this.fillOpacity)?"fill-opacity:"+Math.min(Math.round(255*this.fillOpacity),255)+
";":"";return b+='"\x3e\x3c/g\x3e\x3c/style\x3e'}});a.style.Bucket=a.Class.extend({initialize:function(a){this.seq=a.seq||0;a.label&&(this.label=a.label);a.labelStyle&&(this.labelStyle=a.labelStyle)},evaluate:function(){return!1},clone:function(){return a.$.extend(!0,{},this)}});a.style.RangedBucket=a.style.Bucket.extend({initialize:function Wa(b){Wa.base.call(this,b);this.low=a.notNull(b.low)?b.low:Number.NEGATIVE_INFINITY;this.high=a.notNull(b.high)?b.high:Number.POSITIVE_INFINITY;this.includeHighValue=
a.notNull(b.includeHighValue)?b.includeHighValue:!1},evaluate:function(b){if(a.isNull(b))return!1;a.$.isArray(b)&&(b=b[0]);return this.includeHighValue?b>=this.low&&b<=this.high:b>=this.low&&b<this.high},setIncludeHighValue:function(a){this.includeHighValue=a},toXMLString:function(){var b;b="\x3cRangedBucket"+(a.isNull(this.seq)?"":' seq\x3d"'+this.seq+'"');b+=a.isNull(this.label)?"":' label\x3d"'+this.label+'"';b+=a.isNull(this.labelStyle)?"":' label_style\x3d"'+this.label+'"';b+=a.isNull(this.low)?
"":' low\x3d"'+this.low+'"';b+=a.isNull(this.high)?"":' high\x3d"'+this.high+'"';return b+"/\x3e"}});a.style.CollectionBucket=a.style.Bucket.extend({initialize:function cb(a){cb.base.call(this,a);this.keepWhiteSpace=a.keepWhiteSpace||!1;this.dataType=a.dataType||"string";this.values=a.values||[]},evaluate:function(b){var c=this.values.length;if(a.isNull(b)||0===c)return!1;a.$.isArray(b)&&(b=b[0]);for(var Ya=0;Ya<c;Ya++)if(this.values[Ya]==b)return!0;return!1},toXMLString:function(b){var c;c="\x3cCollectionBucket"+
(a.isNull(this.seq)?"":' seq\x3d"'+this.seq+'"');c+=a.isNull(this.dataType)?"":' type\x3d"'+this.dataType+'"';c+=a.isNull(this.keep_white_space)||!0!==this.keep_white_space?"":' keep_white_space\x3d""true"';c+=a.isNull(b)?"":' style\x3d"'+b+'"';b="";for(var Ya=0,Pa=this.values.length;Ya<Pa;Ya++)b+=this.values[Ya],Ya<Pa-1&&(b+=",");c=c+"\x3e"+b;return c+="\x3c/CollectionBucket\x3e"}});a.style.BucketStyle=a.style.Style.extend({initialize:function kb(c){function Pa(b){var za=hb.length+1;hb[za-1]=b;za===
Xa&&(fb.styles=hb,"off"!==fb.gradient&&hb[0]instanceof a.style.Color&&fb.createGradients())}c=c||{};c.styleType=c.styleType||"BucketStyle";kb.base.call(this,c);c.style&&c.buckets&&c.style!==c.buckets&&a.util.Logger.warning("MAPVIEWER_9030","OM.style.BucketStyle","");this.styles=c.styles||[];0===this.styles.length&&"ColorScheme"!==c.styleType&&"VariableMarker"!==c.styleType&&a.util.Logger.warning("MAPVIEWER_9029","OM.style.BucketStyle","");this.gradient=c.gradient||"off";var Xa=this.styles.length,
hb=[],fb=this;if(0!==Xa&&this.styles[0]instanceof a.style.Style)"off"!==this.gradient&&this.styles[0]instanceof a.style.Color&&this.createGradients();else for(var sb=0;sb<Xa;sb++)a.style.StyleStore.getServerSideStyle(this.styles[sb].dataSource,this.styles[sb].style,{url:this.styles[sb].url,callback:Pa});this.numClasses=c.numClasses||5;this.defaultStyle=c.defaultStyle||null;this.buckets=c.buckets||[];c.classification||c.low===b||c.high===b||(this.buckets=this.createEqualBuckets(c.high,c.low));this.classification=
c.classification||"equal";0<this.buckets.length&&"custom"!==this.classification&&(a.util.Logger.info("MAPVIEWER_9028","OM.style.BucketStyle",""),this.classification="custom");this.algorithm=c.algorithm||null;this.effects=c.effects||null;this.isNumeric="undefined"===typeof c.isNumeric?!0:c.isNumeric;this.gradient=c.gradient||"off";this.checkRangedBuckets()},resolve:function(b){var c=b.parentLayer.styleAttributes;this.generateBuckets(b.parentLayer.featureArray,c,!1);var Pa=b.attributes;if(Pa){var Xa=
null,hb=a.notNull(c)?c.length:0;if(0<hb){Xa=Pa[c[0].toUpperCase()];if(1<hb)for(Xa=[Xa],b=1;b<hb;b++)Xa.push(Pa[c[b].toUpperCase()]);return this.getRealStyle(Xa)}if(b.columns)return Xa=Pa[b.columns[0].toUpperCase()],this.getRealStyle(Xa)}return null},draw:function(a,b,c){var Xa=this.resolve(a);Xa&&Xa.draw(a,b,c)},generateBuckets:function(b,c,Pa){this.buckets&&0<this.buckets.length&&(!Pa||this.buckets[0]instanceof a.style.CollectionBucket)||!b||0===b.length||!(c=c||b[0].columns)||(c=c instanceof Array?
c[0]:c,c=c.toUpperCase(),"equal"===this.classification?this.buckets=this.equalRangeMethod(b,c):"quantile"===this.classification||"quantiles"===this.classification?this.buckets=this.quantilesMethod(b,c):"logarithmic"===this.classification?this.buckets=this.logarithmicMethod(b,c):this.algorithm?this.buckets=this.algorithm.call(this,b,c,this.numClasses):"custom"===this.classification?a.isNull(this.buckets)&&a.util.Logger.warning("MAPVIEWER_9096","OM.style.BucketStyle",""):(a.util.Logger.warning("MAPVIEWER_9026",
"OM.style.BucketStyle",""),this.buckets=[]),this.checkRangedBuckets())},checkRangedBuckets:function(){var b=this.buckets;if(!(a.isNull(b)||0===b.length||b[0]instanceof a.style.CollectionBucket)){for(var c=-1,Pa,Xa=Number.NEGATIVE_INFINITY,hb=0;hb<b.length;hb++)Pa=b[hb].high,a.notNull(Pa)&&Pa>Xa&&(Xa=Pa,c=hb);b[c].setIncludeHighValue(!0)}},getDefaultStyle:function(){return this.defaultStyle},setDefaultStyle:function(a){this.defaultStyle=a},getRealStyle:function(a){if(typeof a===b||null===a)return this.defaultStyle;
var c=this.buckets,Pa=this.buckets.length;if(c&&0<Pa)for(var Xa=0;Xa<Pa;Xa++)if(c[Xa].evaluate(a))return this.styles[Xa];return this.defaultStyle},logarithmicMethod:function(a,b){var c=this.getMinMaxValues(a,b);return this.createLogarithmicBuckets(c.max,c.min)},getMinMaxValues:function(b,c){if("_NUMBERINCLUSTER"===c)return this.getMinMaxNumbers(b);for(var Pa=null,Xa=null,hb=b.length,fb,sb=a.util.ValidationUtil.isNumber2,Cb=0;Cb<hb;Cb++)if((fb=b[Cb])&&fb.attributes&&"undefined"!==typeof fb.attributes[c]&&
(fb=fb.attributes[c],a.notNull(fb))){this.isNumeric&&!sb(fb)&&(fb=Number(fb));if(a.isNull(Pa)||Pa>fb)Pa=fb;if(a.isNull(Xa)||fb>Xa)Xa=fb}return{min:Pa,max:Xa}},getMinMaxNumbers:function(a){return{min:a[0],max:a[1]}},equalRangeMethod:function(a,b){var c=this.getMinMaxValues(a,b);return this.createEqualBuckets(c.max,c.min)},createEqualBuckets:function(b,c){for(var Pa=[],Xa=(b-c)/this.numClasses,hb=c,fb=1;fb<=this.numClasses;fb++)Pa[fb-1]=new a.style.RangedBucket({low:hb,high:hb+Xa}),hb+=Xa;Pa[this.numClasses-
1].high++;return Pa},createLogarithmicBuckets:function(b,c){for(var Pa=[],Xa=c,hb=Math.log(c),fb=(Math.log(b)-hb)/this.numClasses,sb=1;sb<=this.numClasses;sb++){var Cb=Math.exp(hb+fb*sb);Pa[sb-1]=new a.style.RangedBucket({low:Xa,high:Cb});Xa=Cb}Pa[this.numClasses-1].high++;return Pa},quantilesMethod:function(){return[]},createGradients:function(){for(var b=this.styles,c,Pa=[],Xa=0;Xa<b.length;Xa++)c=b[Xa],Pa.push(new a.style.LinearGradient({stops:[{offset:0,color:"#eeffffff"},{offset:1,color:c.fill}],
x1:0,y1:0,x2:1,y2:1,stroke:c.stroke,fillOpacity:c.fillOpacity,strokeOpacity:c.strokeOpacity}));this.styles=Pa},clearBuckets:function(){if("equal"===this.classification||"quantile"===this.classification||"quantiles"===this.classification||"logarithmic"===this.classification||this.algorithm)this.buckets=[]},toXMLString_substyles:function(){for(var b="",c="",c=null,Pa=0,Xa=this.styles.length;Pa<Xa;Pa+=1)c=this.styles[Pa],c=a.isNull(c)?"":c.toXMLString(),a.isNull(c)||(b+=c);c=this.defaultStyle;a.notNull(c)&&
!this.hasStyle(c)&&(c=c.toXMLString(),b+=c);return b},hasStyle:function(b){for(var c=0,Pa=this.styles.length;c<Pa;c+=1){var Xa=this.styles[c];if(!a.isNull(Xa)&&a.notNull(b.styleName)&&a.notNull(Xa.styleName)&&b.styleName.toUpperCase()===Xa.styleName.toUpperCase())return!0}return!1},toXMLString_adv:function(){var b="",b="";this.buckets.length!==this.styles.length&&a.util.Logger.warning("","OM.style.BucketStyle","Number of buckets and styles do not match");for(var c=Math.min(this.buckets.length,this.styles.length),
b="\x3cBuckets"+(a.notNull(this.defaultStyle)?' default_style\x3d"'+this.defaultStyle.getStyleName()+'"':""),b=b+"\x3e",Pa=null,Xa=null,hb="",Pa=Pa="",fb=0;fb<c;fb+=1)Pa=this.buckets[fb],Xa=this.styles[fb],Pa instanceof a.style.CollectionBucket?Pa=hb=a.isNull(Pa)?"":Pa.toXMLString(Xa.getStyleName()):(hb=a.isNull(Pa)?"":Pa.toXMLString(),Pa=a.isNull(Pa)?"":Xa.getStyleName(),Pa=hb.substring(0,hb.length-2)+' style\x3d"'+Pa+'"/\x3e'),a.isNull(hb)||(b+=Pa);return b='\x3cstyle name\x3d"'+this.styleName+
'"\x3e\x3cAdvancedStyle\x3e\x3cBucketStyle\x3e'+(b+"\x3c/Buckets\x3e")+"\x3c/BucketStyle\x3e\x3c/AdvancedStyle\x3e\x3c/style\x3e"},toXMLString:function(){var a=this.toXMLString_adv();return this.toXMLString_substyles()+a}});a.style.ColorScheme=a.style.BucketStyle.extend({initialize:function Ya(b){b.styleType="ColorScheme";Ya.base.call(this,b);this.baseColor=a.notNull(b.baseColor)?b.baseColor:null;this.fromColor=a.notNull(b.fromColor)?b.fromColor:null;this.toColor=a.notNull(b.toColor)?b.toColor:null;
this.fillOpacity=a.notNull(b.fillOpacity)?b.fillOpacity:1;this.stroke=a.notNull(b.stroke)?b.stroke:null;this.strokeOpacity=a.notNull(b.strokeOpacity)?b.strokeOpacity:1;this.strokeThickness=a.notNull(b.strokeThickness)?parseFloat(b.strokeThickness):1;this.calculateColorStops()},calculateColorStops:function(){this.styles&&0<this.styles.length||(this.fromColor&&this.toColor?this.calculateMultiHueStops():this.baseColor?this.calculateSingleHueStops():a.util.Logger.warning("MAPVIEWER_9025","OM.style.ColorScheme.calculateColorStops",
""))},calculateSingleHueStops:function(){for(var b=a.style.ColorScheme.rgbStringParse(this.baseColor),b=a.style.Style.rgbToHsv(b),c=b.v/this.numClasses,Xa=0;Xa<this.numClasses;Xa++){var hb=a.style.Style.hsvToRgb({h:b.h,s:b.s,v:b.v-Xa*c}),fb=hb.r.toString(16);2!==fb.length&&(fb="0"+fb);var sb=hb.g.toString(16);2!==sb.length&&(sb="0"+sb);hb=hb.b.toString(16);2!==hb.length&&(hb="0"+hb);fb=new a.style.Color({fill:"#"+fb+sb+hb,fillOpacity:this.fillOpacity,stroke:this.stroke,strokeThickness:this.strokeThickness,
strokeOpacity:this.strokeOpacity});this.styles.push(fb)}},calculateMultiHueStops:function(){for(var b=a.style.ColorScheme,c=b.rgbStringParse(this.fromColor),Xa=a.style.Style.rgbToHsv(c),c=b.rgbStringParse(this.toColor),hb=a.style.Style.rgbToHsv(c),b=(hb.h-Xa.h)/this.numClasses,c=(hb.s-Xa.s)/this.numClasses,hb=(hb.v-Xa.v)/this.numClasses,fb=0;fb<this.numClasses;fb++){var sb=a.style.Style.hsvToRgb({h:Xa.h+b*fb,s:Xa.s+c*fb,v:Xa.v+hb*fb}),Cb=sb.r.toString(16);2!==Cb.length&&(Cb="0"+Cb);var za=sb.g.toString(16);
2!==za.length&&(za="0"+za);sb=sb.b.toString(16);2!==sb.length&&(sb="0"+sb);Cb=new a.style.Color({fill:"#"+Cb+za+sb,fillOpacity:this.fillOpacity,stroke:this.stroke,strokeThickness:this.strokeThickness,strokeOpacity:this.strokeOpacity});this.styles.push(Cb)}},getColorStops:function(){var a=[];if(!this.styles)return a;for(var b=this.styles.length,c=0;c<b;c++)a.push(this.styles[c].fill);return a}});a.style.ColorScheme.rgbStringParse=function(b){var c={};b=a.$.trim(b);c.r=parseInt(b[1]+b[2],16);c.g=parseInt(b[3]+
b[4],16);c.b=parseInt(b[5]+b[6],16);return c};a.style.HeatMap=a.style.Style.extend({initialize:function Pa(b){b=b||{};b.styleType="HeatMap";Pa.base.call(this,b);this.colorStops=a.notNull(b.colorStops)?b.colorStops:null;this.opacity=a.notNull(b.opacity)?b.opacity:1;this.containerVectorLayer=a.notNull(b.containerVectorLayer)?b.containerVectorLayer:null;this.lengthUnit=a.notNull(b.lengthUnit)?b.lengthUnit:"pixel";"pixel"===this.lengthUnit?this.spotlightRadius=a.notNull(b.spotlightRadius)?b.spotlightRadius:
5:this.unitSpotlightRadius=a.notNull(b.spotlightRadius)?b.spotlightRadius:5;this.maxValue=a.notNull(b.maxValue)?b.maxValue:null;this.minValue=a.notNull(b.minValue)?b.minValue:null;this.sampleFactor=a.notNull(b.sampleFactor)?b.sampleFactor:2;this.isTop=a.notNull(b.isTop)?b.isTop:!1},getBindables:function(){return this.bindableAttrs?this.bindableAttrs:this.bindableAttrs=["Heat"]},getDataValueFromBinding:function(a){return this.bindings&&0!==this.bindings.length?this.resolveDataValue(this.bindings[0],
a):null},getIsTop:function(){return this.isTop},setIsTop:function(a){this.isTop=a}});a.style.RadialGradient=a.style.Gradient.extend({initialize:function Xa(a){a=a||{};a.styleType="RadialGradient";Xa.base.call(this,a);this.cx=a.cx||0;this.cy=a.cy||0;this.radius=a.radius||0},createStyle:function(a){this.createGradientStop(a);this.fill=new a.oui.style.RadialGradient({cx:this.cx,cy:this.cy,radius:this.radius,stops:this.stops})}});a.style.PieSlice=function(a,b){this.name=a;this.color=b};a.style.PieChart=
a.style.Style.extend({initialize:function hb(b){b.styleType="PieChart";if(b&&b.pieSlices&&!(1>b.pieSlices.length)){hb.base.call(this,b);var c=b.pieSlices.length;this.colors=[];this.names=[];for(var Cb=0;Cb<c;Cb++){var za=b.pieSlices[Cb];this.colors.push(za.color);this.names.push(za.name)}this.stroke=a.notNull(b.stroke)?b.stroke:"#000000";this.strokeThickness=a.notNull(b.strokeThickness)?parseFloat(b.strokeThickness):1;this.startingAngle=a.notNull(b.startingAngle)?parseFloat(b.startingAngle):0;this.direction=
a.notNull(b.direction)?b.direction:"CCW";this.radius=a.notNull(b.radius)?b.radius:50;this.width=2*this.radius;this.height=2*this.radius;this.lengthUnit=a.notNull(b.lengthUnit)?b.lengthUnit:"pixel";this.enableHighlight=b.enableHighlight?b.enableHighlight:!1;this.maxlength=b.radiusPixelRange&&b.radiusPixelRange.max?2*b.radiusPixelRange.max:5E3;this.minlength=b.radiusPixelRange&&b.radiusPixelRange.min?2*b.radiusPixelRange.min:0;this.showOnPoint=1}},resolve:function(a){if(!this.bindings||0===this.bindings.length)return this;
for(var b=0,c=this.bindings.length;b<c;b++){var Cb=this.bindings[b],za=this.resolveBinding(Cb,a);"RADIUS"===Cb.attribute?(this.radius=za,this.width=2*this.radius,this.height=2*this.radius):"SIZE"===Cb.attribute&&(this.radius=za/2,this.height=this.width=za)}return this},draw:function(b,c,sb){if(b.attributes){this.resolve(b);var Cb=c.getGraphics(),za=sb.sPoint,db=this.colors,ga=this.names;if(ga&&!(1>ga.length)){for(var ea=ga.length,ia=Array(ea),Fa=0;Fa<ea;Fa++){var ja=b.getAttributeValue(ga[Fa]);if(a.notNull(ja))ia[Fa]=
parseFloat(ja);else return}a.style.Style.calculateStyleSize(this,c);c={cx:za.x,cy:za.y,width:this.realWidth,height:this.realHeight};sb.stroke=this.stroke;sb.strokeThickness=this.strokeThickness;this.enableHighlight&&(sb.plugable=!0,sb.description=ga);sb.offsetAngle=this.startingAngle;sb.orientation="CW"===this.direction?2:1;b.shape=Cb.drawPieChart(c,ia,db,sb)}}},getBindables:function(){return this.bindableAttrs?this.bindableAttrs:this.bindableAttrs=["Radius","Size"]}});a.style.VariableMarker=a.style.BucketStyle.extend({initialize:function fb(b){b.styleType=
"VariableMarker";fb.base.call(this,b);this.marker=a.notNull(b.marker)?b.marker:null;this.startSize=a.notNull(b.startSize)?b.startSize:7;this.increament=a.notNull(b.increment)?b.increment:3;this.createAllMarkerStyles()},createAllMarkerStyles:function(){if(!(this.styles&&0<this.styles.length))if(this.marker instanceof a.style.Marker){this.styles=[];for(var b=0;b<this.numClasses;b++){var c=this.marker.clone();c.width=this.startSize+this.increament*b;c.height=c.width;c.calculateVectorMarkerScale();this.styles.push(c)}}else a.util.Logger.warning("MAPVIEWER_9024",
a.style.VariableMarker.createAllMarkerStyles,"")}});a.style.Bar=function(a,b){this.name=a;this.color=b};a.style.BarChart=a.style.Style.extend({initialize:function sb(b){b.styleType="BarChart";if(b&&b.bars&&!(1>b.bars.length)){sb.base.call(this,b);var za=b.bars.length;this.colors=[];this.names=[];for(var db=0;db<za;db++){var c=b.bars[db];this.colors.push(c.color);this.names.push(c.name)}this.stroke=a.notNull(b.stroke)?b.stroke:"#000000";this.strokeThickness=a.notNull(b.strokeThickness)?parseFloat(b.strokeThickness):
1;this.showXAxis=a.notNull(b.showXAxis)?b.showXAxis:!1;this.showYAxis=a.notNull(b.showYAxis)?b.showYAxis:!1;this.backGround=a.notNull(b.background)?b.background:null;this.width=a.notNull(b.width)?parseFloat((""+b.width).replace(/[^\d.]/g,"")):100;this.height=a.notNull(b.height)?parseFloat((""+b.height).replace(/[^\d.]/g,"")):100;a.isNull(b.lengthUnit)?this.lengthUnit=a.notNull(b.width)?(""+b.width).replace(/[0-9.]/g,""):"pixel":this.lengthUnit=b.lengthUnit;if(a.isNull(this.lengthUnit)||0===this.lengthUnit.length)this.lengthUnit=
"pixel";this.enableHighlight=a.notNull(b.enableHighlight)?b.enableHighlight:!1;this.maxlength=b.lengthPixelRange&&b.lengthPixelRange.max?b.lengthPixelRange.max:5E3;this.minlength=b.lengthPixelRange&&b.lengthPixelRange.min?b.lengthPixelRange.min:0;this.showOnPoint=1}},resolve:function(a){if(!this.bindings||0===this.bindings.length)return this;for(var b=0,za=this.bindings.length;b<za;b++){var db=this.bindings[b],c=this.resolveBinding(db,a);"SIZE"===db.attribute?this.origConfig.width&&this.origConfig.height&&
this.origConfig.width!==this.origConfig.height?(this.height=this.origConfig.height*c/this.origConfig.width,this.width=c):this.height=this.width=c:"WIDTH"===db.attribute?this.width=c:"HEIGHT"===db.attribute&&(this.height=c)}return this},draw:function(b,c,za){this.resolve(b);if(b.attributes){var db=c.getGraphics(),ga=za.sPoint,ea=this.colors,ia=this.names;if(ia&&!(1>ia.length)){for(var Fa=ia.length,ja=Array(Fa),qa=0;qa<Fa;qa++){var Ba=b.getAttributeValue(ia[qa]);if(a.notNull(Ba))ja[qa]=parseFloat(Ba);
else return}a.style.Style.calculateStyleSize(this,c);c={cx:ga.x,cy:ga.y,width:this.realWidth,height:this.realHeight};za.stroke=this.stroke;za.strokeThickness=this.strokeThickness;this.enableHighlight&&(za.plugable=!0,za.description=ia);b.shape=db.drawBarChart(c,ja,ea,za)}}},getBindables:function(){return this.bindableAttrs?this.bindableAttrs:this.bindableAttrs=["Size","Width","Height"]}});a.style.Line=a.style.Style.extend({initialize:function Cb(b){b=b||{};b.styleType="Line";Cb.base.call(this,b);
var db=a.util.ValidationUtil.getColor,c=a.PaintTypes.NO_PAINT;this.stroke=b.stroke&&db(b.stroke)?db(b.stroke):a.PaintTypes.NO_PAINT;this.strokeOpacity=a.notNull(b.strokeOpacity)?parseFloat(b.strokeOpacity):1;this.strokeDash=b.strokeDash||[];this.strokeLineCap=b.strokeLineCap||a.LineCaps.ROUND;this.strokeLineJoin=b.strokeLineJoin||a.LineJoins.ROUND;this.fill=a.notNull(b.fill)&&db(b.fill)?db(b.fill):c;this.fillOpacity=a.notNull(b.fillOpacity)?parseFloat(b.fillOpacity):1;this.centerLine=a.notNull(b.centerLine)&&
db(b.centerLine)?db(b.centerLine):c;this.markerPattern=b.markerPattern||null;a.notNull(b.startMarker)&&(b.startMarker.vectorDef&&b.startMarker.getFNFormat()?this.markerStart=b.startMarker.getFNFormat():b.startMarker.d?this.markerStart=b.startMarker:this.startMarker=b?b.startMarker:null);a.notNull(b.endMarker)&&(b.endMarker.vectorDef&&b.endMarker.getFNFormat()?this.markerEnd=b.endMarker.getFNFormat():b.endMarker.d?this.markerEnd=b.endMarker:this.endMarker=b?b.endMarker:null);this.oriented=b?b.orientedMarker:
!1;this.centerLineDash=b.centerLineDash||[];this.cased=!1;this.lengthUnit=b.lengthUnit?b.lengthUnit:"pixel";"pixel"===this.lengthUnit?(this.fillWidth=b&&a.notNull(b.fillWidth)&&this.fill!==c?parseFloat(b.fillWidth):0,this.centerLineWidth=b&&a.notNull(b.centerLineWidth)&&this.centerLine!==c?parseFloat(b.centerLineWidth):0,this.strokeThickness=b&&a.notNull(b.strokeThickness)&&this.stroke!==c?parseFloat(b.strokeThickness):1):(this.unitFillWidth=b&&a.notNull(b.fillWidth)&&this.fill!==c?parseFloat(b.fillWidth):
0,this.unitCenterLineWidth=b&&a.notNull(b.centerLineWidth)&&this.centerLine!==c?parseFloat(b.centerLineWidth):0,this.unitStrokeThickness=b&&a.notNull(b.strokeThickness)&&this.stroke!==c?parseFloat(b.strokeThickness):1);this.calculateRealSize()},calculateRealSize:function(){var b=null;this.stylelist=[];var za=a.PaintTypes.NO_PAINT;this.stroke!==za&&0<this.strokeThickness&&(b={stroke:this.stroke,strokeThickness:0<this.fillWidth?2*this.strokeThickness+this.fillWidth:this.strokeThickness,strokeLineCap:this.strokeLineCap,
strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDash,strokeOpacity:this.strokeOpacity},this.markerStart&&(b.markerStart=this.markerStart),this.markerEnd&&(b.markerEnd=this.markerEnd),this.stylelist.push(b));this.fill!==za&&0<this.fillWidth&&(b={stroke:this.fill,strokeThickness:this.fillWidth,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.strokeDash,strokeOpacity:this.fillOpacity},this.markerStart&&(b.markerStart=this.markerStart),this.markerEnd&&
(b.markerEnd=this.markerEnd),this.stylelist.push(b));this.centerLine!==za&&0<this.centerLineWidth&&(0===this.fillWidth||this.fill!==this.centerLine)&&(b={stroke:this.centerLine,strokeThickness:this.centerLineWidth,strokeLineCap:this.strokeLineCap,strokeLineJoin:this.strokeLineJoin,strokeDashArray:this.centerLineDash},this.stylelist.push(b));(this.startMarker||this.endMarker)&&this.stylelist.push({})},resolve:function(a){if(!this.bindings||0===this.bindings.length)return this;for(var b=0,db=this.bindings.length;b<
db;b++){var c=this.bindings[b],ea=this.resolveBinding(c,a);"FILL"===c.attribute?this.fill=ea:"FILLWIDTH"===c.attribute&&(this.fillWidth=ea)}this.calculateRealSize();return this},draw:function(b,za,db){this.resolve(b);var c=this.origConfig;a.notNull(c.startMarker)&&c.startMarker.vectorDef&&c.startMarker.getFNFormat&&(this.markerStart=c.startMarker.getFNFormat(b));a.notNull(c.endMarker)&&c.endMarker.vectorDef&&c.endMarker.getFNFormat&&(this.markerEnd=c.endMarker.getFNFormat(b));var ea=b.geo,c=db.type?
db.type:ea.type;if("Point"!==c&&"OrientedPoint"!==c&&"MultiPoint"!==c&&"OrientedMultiPoint"!==c){var ia=za.getGraphics();db.screenPoints?ea=db.screenPoints:(b.screenPoints||b.transformGeometry(ea),ea=b.screenPoints);if(ea&&0!==ea.length){var Fa,ja;a.style.Style.calculateStyleSize(this,za);if("LineString"===c||"Polygon"===c)"LineString"===c&&(this.totalLengthInPx=this.calcLength(ea[0])),this.drawLine(za,ea,db.group,"Polygon"===c,b);else if("Rectangle"===c)this.drawLine(za,[[ea.x,ea.y,ea.x+ea.width,
ea.y,ea.x+ea.width,ea.y+ea.height,ea.x,ea.y+ea.height,ea.x,ea.y]],db.group,!0,b);else if("MultiLineString"===c||"MultiPolygon"===c){if(this.cased){Fa=[];ja=db.group.length;for(var qa=0;qa<ja;qa++)Fa[qa]=ia.createGroup(),db.group[qa].appendChild(Fa[qa])}else Fa=ia.createGroup(),db.group.appendChild(Fa);ja=ea.length;this.totalLengthInPx=0;if("MultiLineString"===c)for(db=0;db<ja;db++)this.totalLengthInPx+=this.calcLength(ea[db][0]);for(db=0;db<ja;db++)this.drawLine(za,ea[db],Fa,"MultiPolygon"===c,b);
b.shapeGroup=Fa}b.shapeGroup&&0<b.shapeGroup.length?(b.shape=b.shapeGroup[0],1===b.shapeGroup.length&&(b.shapeGroup=null)):(b.shape=b.shapeGroup,b.shapeGroup=null)}}},drawLine:function(b,za,db,c,ea){var ia=this.stylelist,Fa=ia.length,ja={group:db},qa=b.getGraphics();ea.shapeGroup=[];for(var Ba=0;Ba<Fa;Ba++){var Na=ia[Ba];Na.stroke&&(this.cased&&(ja.group=db[Ba]),Na={stroke:Na.stroke,strokeThickness:Na.strokeThickness,strokeLineCap:Na.strokeLineCap,strokeDashArray:Na.strokeDashArray,strokeOpacity:Na.strokeOpacity,
markerStart:Na.markerStart,markerEnd:Na.markerEnd},c&&(Na.fill=a.PaintTypes.NO_PAINT,Na.fillOpacity=0),ea.shapeGroup.push(qa.drawPath(za,Na,ja)))}db=db.length?db[Ba-1]:db;this.startMarker&&!this.markerStart&&(ja=Math.atan2(za[0][3]-za[0][1],za[0][2]-za[0][0]),this.drawMarker(this.startMarker,ea,b,db,{x:za[0][0],y:za[0][1],angle:ja}));this.endMarker&&!this.markerEnd&&(c=za[0].length,ja=Math.atan2(za[0][c-1]-za[0][c-3],za[0][c-2]-za[0][c-4]),this.drawMarker(this.endMarker,ea,b,db,{x:za[0][c-2],y:za[0][c-
1],angle:ja}));if(a.notNull(this.markerPattern)&&a.notNull(this.markerPattern.markers)&&0<this.markerPattern.markers.length)if(qa=[],c=za[0],!0===this.markerPattern.serverLineArrow)if(!0===this.markerPattern.startAndEndMarers)ia=this.markerPattern.markers[0],ia.height=this.markerPattern.markerHeight,ia.width=this.markerPattern.markerWidth,ia.lengthUnit=this.markerPattern.lengthUnit,ia.max_size_in_px=this.markerPattern.max_size_in_px,ia.vectorDef&&ia.calculateVectorMarkerScale(),ja=Math.atan2(za[0][3]-
za[0][1],za[0][2]-za[0][0]),this.drawMarker(ia,ea,b,db,{x:za[0][0],y:za[0][1],angle:ja}),c=za[0].length,ja=Math.atan2(za[0][c-1]-za[0][c-3],za[0][c-2]-za[0][c-4]),this.drawMarker(ia,ea,b,db,{x:za[0][c-2],y:za[0][c-1],angle:ja});else if(a.notNull(this.markerPattern.percent)&&0<this.markerPattern.percent){ja=a.util.GeomUtil;ia=qa=0;for(Fa=c.length;ia<Fa-3;ia+=2)qa+=ja.getSegmentLength(c[ia],c[ia+1],c[ia+2],c[ia+3]);ia=qa*this.markerPattern.percent;c=za[0];qa=this.getMarkerDrawPosition(ia,c);za={};za.height=
this.markerPattern.markerHeight;za.width=this.markerPattern.markerWidth;za.lengthUnit=this.markerPattern.lengthUnit;za.max_size_in_px=this.markerPattern.max_size_in_px;!0!==this.markerPattern.multipleMarker?0<qa.length&&(0<qa.length&&qa.splice(0,1),1<qa.length&&qa.splice(1,qa.length-1)):0<qa.length&&qa.splice(0,1);this.drawMarkers({feature:ea,mapContext:b,pointArray:qa,group:db,oriented:this.markerPattern.oriented,serverLineArrowSize:za})}else{if(!0===this.markerPattern.vertexes){qa=[];ia=0;for(Fa=
c.length;ia<Fa-2;ia+=2)ja=ia+3<Fa?Math.atan2(c[ia+3]-c[ia+1],c[ia+2]-c[ia]):0,za={x:c[ia],y:c[ia+1],angle:ja},qa.push(za);za={};za.height=this.markerPattern.markerHeight;za.width=this.markerPattern.markerWidth;za.lengthUnit=this.markerPattern.lengthUnit;za.max_size_in_px=this.markerPattern.max_size_in_px;this.drawMarkers({feature:ea,mapContext:b,pointArray:qa,group:db,oriented:this.markerPattern.oriented,serverLineArrowSize:za})}}else{ja=a.util.GeomUtil;if(a.isNull(this.markerPattern.intervalUnit)||
""===this.markerPattern.intervalUnit)this.markerPattern.intervalUnit="pixel";ia=this.markerPattern.interval/ja.getCurrentDistancePerPixel(b,this.markerPattern.intervalUnit);qa=this.getMarkerDrawPosition(ia,c);this.drawMarkers({feature:ea,mapContext:b,pointArray:qa,group:db,oriented:this.markerPattern.oriented})}},getMarkerDrawPosition:function(b,za){for(var c=[],ga=0,ea=a.util.GeomUtil,ia=0,Fa=za.length;ia<Fa-3;){var ja=null,qa=ea.getSegmentLength(za[ia],za[ia+1],za[ia+2],za[ia+3]),Ba=b*c.length;
ga+qa>=Ba?(ja=(Ba-ga)/qa,ja={x:za[ia]+(za[ia+2]-za[ia])*ja,y:za[ia+1]+(za[ia+3]-za[ia+1])*ja},ja.angle=Math.atan2(za[ia+3]-za[ia+1],za[ia+2]-za[ia])):(ga+=qa,ia+=2);ja&&c.push(ja)}return c},drawMarkers:function(b){var za=b.feature,c=b.mapContext,ga=b.pointArray,ea=b.group;b=b.serverLineArrowSize;for(var ia=this.totalLengthInPx,Fa=0;Fa<ga.length;Fa++){var ja={group:ea,markerPoint:ga[Fa]},qa=this.markerPattern.markers[Fa%this.markerPattern.markers.length];a.notNull(b)&&(qa.height=b.height,qa.width=
b.width,qa.lengthUnit=b.lengthUnit,qa.max_size_in_px=b.max_size_in_px,qa.noShowCap=ia,qa.vectorDef&&qa.calculateVectorMarkerScale());a.notNull(qa)&&a.notNull(qa.draw)&&qa.draw(za,c,ja)}},drawMarker:function(a,b,c,ga,ea){ga={group:ga,markerPoint:ea};a.noShowCap=this.totalLengthInPx;a.draw(b,c,ga)},getBindables:function(){return this.bindableAttrs?this.bindableAttrs:this.bindableAttrs=["Fill","FillWidth"]},getOverallThickness:function(){1>this.strokeThickness&&(this.strokeThickness=1);var a=1;return a=
0<this.fillWidth?2*this.strokeThickness+this.fillWidth:this.strokeThickness},getOverallLine:function(){var b=this.getOverallThickness(),za="",c="#000000",c=a.notNull(this.fill)&&0<this.fillWidth?this.fill:this.stroke,za=za+("fill:"+c+";")+(a.notNull(this.strokeThickness)?"stroke-width:"+b+";":""),za=za+(a.notNull(this.strokeOpacity)?"fill-opacity:"+Math.min(Math.round(255*this.strokeOpacity),255)+";":"");return za+=a.notNull(this.strokeLineCap)?"stroke-linecap:"+this.strokeLineCap:""},getOverallLine_strokeDash:function(){var b=
this.getOverallThickness(),za="",c="#000000",c=a.notNull(this.fill)&&0<this.fillWidth?this.fill:this.stroke,za=za+("fill:"+c+";");0<this.strokeDash.length&&(a.isNull(this.fill)||0===this.fillWidth)&&(za+="fill-opacity:0;");za+=a.notNull(this.strokeThickness)?"stroke-width:"+b+";":"";return za+=a.notNull(this.strokeLineCap)?"stroke-linecap:"+this.strokeLineCap:""},getParallelLine:function(){var b="",za;a.notNull(this.fill)&&0<this.fillWidth?(b='\x3cline class\x3d"parallel"'+(' style\x3d"fill:'+this.stroke+
";stroke-width:"+this.strokeThickness+'"'),b+="/\x3e"):a.notNull(this.centerLine)&&0<this.centerLineWidth&&(b='\x3cline class\x3d"parallel"',za=Math.max((this.strokeThickness-this.centerLineWidth)/2,0),b+=' style\x3d"fill:'+this.stroke+";stroke-width:"+za+'"/\x3e',b+="/\x3e");return b},getParallelLine_strokeDash:function(){var b="",za;a.notNull(this.fill)&&0<this.fillWidth?(b='\x3cline class\x3d"parallel" style\x3d"fill:'+this.stroke,b+=a.notNull(this.strokeOpacity)?";fill-opacity:"+Math.min(Math.round(255*
this.strokeOpacity),255)+";":"",b+=";stroke-width:"+this.strokeThickness+'"',b+="/\x3e"):a.notNull(this.centerLine)&&0<this.centerLineWidth&&(b='\x3cline class\x3d"parallel"',za=Math.max((this.strokeThickness-this.centerLineWidth)/2,0),b+=' style\x3d"fill:'+this.stroke,b+=a.notNull(this.strokeOpacity)?";fill-opacity:"+Math.min(Math.round(255*this.strokeOpacity),255)+";":"",b+=";stroke-width:"+za+'"',0<this.strokeDash.length&&(b+=' dash\x3d"'+this.strokeDash[0]+","+this.strokeDash[1]+'"'),b+="/\x3e/\x3e");
return b},getCenterLine:function(){var b="";a.notNull(this.centerLine)&&0<this.centerLineWidth?(b='\x3cline class\x3d"base" style\x3d"fill:'+this.centerLine+";stroke-width:"+this.centerLineWidth+'"',0<this.centerLineDash.length&&(b+=' dash\x3d"'+this.centerLineDash[0]+","+this.centerLineDash[1]+'"'),b+="/\x3e"):a.notNull(this.fill)&&0<this.fillWidth?(b='\x3cline class\x3d"base" style\x3d"fill:'+this.fill+";stroke-width:"+this.fillWidth+'"',0<this.centerLineDash.length&&(b+=' dash\x3d"'+this.centerLineDash[0]+
","+this.centerLineDash[1]+'"'),b+="/\x3e"):b='\x3cline class\x3d"base"/\x3e';return b},getCenterLine_strokeDash:function(){var b="";2===this.strokeDash.length?(b='\x3cline class\x3d"base" style\x3d"fill:'+this.stroke+";",b+=a.notNull(this.strokeOpacity)?"fill-opacity:"+Math.min(Math.round(255*this.strokeOpacity),255)+";":"",b+="stroke-width:"+this.strokeThickness+'"',b+=' dash\x3d"'+this.strokeDash[0]+","+this.strokeDash[1]+'"',b+="/\x3e"):b='\x3cline class\x3d"base"/\x3e';return b},getCenterLine_centerLineDash:function(){var a=
"";2===this.centerLineDash.length?(a='\x3cline class\x3d"base" style\x3d"fill:'+this.centerLine+";",a+="stroke-width:"+this.centerLineWidth+'"',a+=' dash\x3d"'+this.centerLineDash[0]+","+this.centerLineDash[1]+'"',a+="/\x3e"):a='\x3cline class\x3d"base"/\x3e';return a},toXMLString:function(){var a="",b="",c="";0===this.strokeDash.length&&0===this.centerLineDash.length?(a=this.getOverallLine(),b=this.getParallelLine(),c=this.getCenterLine()):0!==this.strokeDash.length&&0===this.centerLineDash.length?
(a=this.getOverallLine_strokeDash(),b=this.getParallelLine(),c=this.getCenterLine_strokeDash()):(0===this.strokeDash.length&&0!==this.centerLineDash.length?a=this.getOverallLine():(a=this.getOverallLine_strokeDash(),b=this.getParallelLine_strokeDash()),c=this.getCenterLine_centerLineDash());var ga='\x3cstyle name\x3d"'+this.getStyleName()+'"\x3e';return ga+('\x3cg class\x3d"line" style\x3d"'+a+'"\x3e'+b+c+"\x3c/g\x3e\x3c/style\x3e")},calcLength:function(a){for(var b=0,c,ga,ea=2,ia=a.length;ea<ia;ea+=
2)c=a[ea]-a[ea-2],ga=a[ea+1]-a[ea-1],b+=Math.sqrt(c*c+ga*ga);return b}});a.style.Marker=a.style.Style.extend({initialize:function za(c){c=c||{};c.styleType="Marker";za.base.call(this,c);this.width=a.notNull(c.width)?c.width:null;this.height=a.notNull(c.height)?c.height:null;this.max_size_in_px=a.notNull(c.max_size_in_px)?c.max_size_in_px:null;this.xOffset=a.notNull(c.xOffset)?c.xOffset:0;this.yOffset=a.notNull(c.yOffset)?c.yOffset:0;this.lengthUnit=a.notNull(c.lengthUnit)?c.lengthUnit:"pixel";this.src=
a.notNull(c.src)?c.src:null;this.textStyle=a.notNull(c.textStyle)?c.textStyle:null===c.textStyle?null:b;this.gradient=a.notNull(c.gradient)?c.gradient:null;this.src&&(a.isNull(this.width)||a.isNull(this.height))&&this.loadImgFromSource();this.nullFill=a.notNull(c.nullFillSrc)?c.nullFillSrc:null;(this.vectorDef=a.notNull(c.vectorDef)?c.vectorDef:null)&&this.calculateVectorMarkerScale();this.textOffset=c.textOffset?c.textOffset:null;this.showOnPoint=2;this.realHeightInPx=this.realWidthInPx=null},loadImgFromSource:function(){var b=
this,c=new Image;c.src=this.src;c.onload=function(){a.isNull(b.width)&&(b.width=c.width);a.isNull(b.height)&&(b.height=c.height);b.origConfig&&(b.origConfig.width=c.width,b.origConfig.height=c.height)}},resolve:function(b){if(!this.bindings||0===this.bindings.length)return this;for(var c=0,ga=this.bindings.length;c<ga;c++){var ea=this.bindings[c],ia=this.resolveBinding(ea,b);"FILL"===ea.attribute?(this.vectorDef&&0<this.vectorDef.length&&(this.vectorDef[0].style.fill=ia),this.isBound("FILL")&&1===
this.bindings.length&&(this.width=ia===a.PaintTypes.NO_PAINT?0:a.notNull(this.origConfig.width)?this.origConfig.width:null)):"SIZE"===ea.attribute?this.origConfig.width&&this.origConfig.height&&this.origConfig.width!==this.origConfig.height?(this.height=this.origConfig.height*ia/this.origConfig.width,this.width=ia):this.height=this.width=ia:"WIDTH"===ea.attribute?this.width=ia:"HEIGHT"===ea.attribute?this.height=ia:"SOURCE"===ea.attribute&&(this.src=ia,this.loadImgFromSource())}(a.isNull(this.width)||
isNaN(this.width))&&a.notNull(this.origConfig.width)&&(this.width=this.origConfig.width);(a.isNull(this.height)||isNaN(this.height))&&a.notNull(this.origConfig.height)&&(this.height=this.origConfig.height);this.calculateVectorMarkerScale();return this},draw:function(b,c,ga){this.resolve(b);var ea=b.geo,ia=b.geo.type;if(ga.markerPoint&&b.shapeGroup)c=this.drawMarker(c,ga.group,ga.markerPoint,b.markerText),a.notNull(c)&&b.shapeGroup.push(c);else if(ga.sPoint)b.shape=this.drawMarker(c,ga.group,ga.sPoint,
b.markerText);else if("LineString"!==ia&&"MultiLineString"!==ia)if("string"===typeof this.nullFill&&(this.nullFill=c.getGraphics().createFillPattern(this.nullFill)),"Polygon"===ia||"MultiPolygon"===ia){if(!b.screenPoints){var Fa=null;b.labelBox?Fa=new a.geometry.Point((b.labelBox[0]+b.labelBox[2])/2,(b.labelBox[1]+b.labelBox[3])/2,ea.srid):ea.mbr&&(Fa=new a.geometry.Point((ea.mbr.getMinX()+ea.mbr.getMaxX())/2,(ea.mbr.getMinY()+ea.mbr.getMaxY())/2,ea.srid));Fa=b.transformGeometry(Fa);b.screenPoints||
(b.screenPoints=Fa)}b.shape=this.drawMarker(c,ga.group,b.screenPoints,b.markerText)}else if(b.screenPoints||b.transformGeometry(ea),"Point"===ia||"OrientedPoint"===ia)b.shape=this.drawMarker(c,ga.group,b.screenPoints,b.markerText),a.isNull(b.renderingStyle)||(b.markerWidth=this.realWidthInPx,b.markerHeight=this.realWidthInPx),this.markerText&&this.drawMarker(c,Fa,b.screenPoints,b.markerText);else if("MultiPoint"===ia||"OrientedMultiPoint"===ia){Fa=c.getGraphics().createGroup();ga.group.appendChild(Fa);
ga=0;for(ea=b.screenPoints.length;ga<ea;ga++)this.drawMarker(c,Fa,b.screenPoints[ga],b.markerText);b.shape=Fa}},drawMarker:function(b,c,ga,ea){if(0!==this.width&&0!==this.height){var ia={group:c,xOffset:this.xOffset,yOffset:this.yOffset};ga.angle&&(ia.angle=ga.angle);var Fa=b.getGraphics(),ja={lengthUnit:this.lengthUnit,width:this.width,height:this.height,max_size_in_px:this.max_size_in_px},qa,Ba;if(this.src){ja.width=this.width;ja.height=this.height;ja.src=this.src;ia.enableCache=!0;a.style.Style.calculateStyleSize(ja,
b);this.realWidthInPx=ja.realWidth;this.realHeightInPx=ja.realHeight;b=this.noShowCap;var Na=this.realWidthInPx,wb=this.realHeightInPx;if(!(a.isNull(b)||b>Na&&b>wb))return;ja.width=ja.realWidth;ja.height=ja.realHeight;ia=Fa.drawImageMarker({x:ga.x,y:ga.y},ja,ia)}else{ja.vectorDef=this.vectorDef;this.vectorDef&&this.vectorDef[0]&&this.vectorDef[0].shape||(qa=a.gv,Ba=qa.defaultMarkerStyleWidth,Na=qa.defaultMarkerStyleHeight,a.isNull(ja.width)&&(ja.width=Ba),a.isNull(ja.height)&&(ja.height=Na),ja.vectorDef=
[{shape:{type:"circle",cx:ja.width/2,cy:ja.height/2,width:ja.width,height:ja.height,scaleX:1,scaleY:1},style:a.$.extend(!0,{},qa.defaultMarkerStyle,ja)}]);a.style.Style.calculateStyleSize(ja,b);b={};a.$.extend(!0,b,ja.vectorDef);b.length=ja.vectorDef.length;ia.width=ja.realWidth;ia.height=ja.realHeight;this.realWidthInPx=ja.realWidth;this.realHeightInPx=ja.realHeight;qa=this.noShowCap;Ba=this.realWidthInPx;Na=this.realHeightInPx;if(!(a.isNull(qa)||qa>Ba&&qa>Na))return;qa=ja.realWidth/ja.width*b[0].shape.scaleX;
Ba=ja.realHeight/ja.height*b[0].shape.scaleY;b[0].style.strokeThickness&&(b[0].style.strokeThickness/=qa);b[0].style.insetThickness&&(b[0].style.insetThickness/=qa);if(a.isNull(b[0].style.fill)&&a.notNull(this.nullFill)||b[0].style.fill===a.PaintTypes.NO_PAINT&&a.notNull(this.nullFill))b[0].style.fill=this.nullFill,"string"===typeof b[0].style.fill&&(b[0].style.fill=Fa.createFillPattern(b[0].style.fill));qa&&Ba&&(ia.xScale=qa,ia.yScale=Ba);a.notNull(this.gradient)&&("object"===typeof this.gradient?
ia.gradient=this.gradient:"radial"===this.gradient&&(Na=this.getRadialGradient(Fa,this.vectorDef[0].style.fill),ia.gradient=Na));ia=Fa.drawVectorMarker({x:ga.x,y:ga.y},b,ia)}if(ea){ea=Fa.createTextNode(ea,this.textStyle,0,0);b=Fa.getWidthHeight(ea);if(ja.src)return ja=Fa.createGroup(),ja.appendChild(ia),ja.appendChild(ea),c.appendChild(ja),c=ga.x-b.w/2,ga=ga.y+(b.h-4)/2,this.textOffset&&(c+=this.textOffset.x?this.textOffset.x:0,ga+=this.textOffset.y?this.textOffset.y:0),ea.translate(c,ga),ja;ia.appendChild(ea);
ga=((ja.realWidth?ja.realWidth:ja.width)-b.w)/2;c=((ja.realHeight?ja.realHeight:ja.height)+b.h-4)/2;this.textOffset&&(ga+=this.textOffset.x?this.textOffset.x:0,c+=this.textOffset.y?this.textOffset.y:0);ea.scale(1/qa,1/Ba);ea.translate(ga,c)}return ia}},getRadialGradient:function(b,c){if(a.isNull(b)||a.isNull(c))return null;var ga=b.oui;return new ga.style.RadialGradient({cx:.3,cy:.3,radius:.5,stops:[new ga.style.GradientStop({offset:0,color:"#ffffff"}),new ga.style.GradientStop({offset:.8,color:c})]})},
calculateVectorMarkerScale:function(){(a.isNull(this.height)||a.isNull(this.width))&&this.vectorDef&&0<this.vectorDef.length&&a.isNotNull(this.vectorDef[0].shape)&&a.isNotNull(this.vectorDef[0].shape.width)&&a.isNotNull(this.vectorDef[0].shape.height)&&(this.height=this.vectorDef[0].shape.height,this.width=this.vectorDef[0].shape.width);if(this.vectorDef&&0<=this.width&&0<=this.height&&a.isNotNull(this.width)&&a.isNotNull(this.height)){var b,c,ga=Number.MIN_VALUE,ea=Number.MIN_VALUE,ia=Number.MAX_VALUE,
Fa=Number.MAX_VALUE;for(b=0;b<this.vectorDef.length;b++)if(c=this.vectorDef[b].shape,c.width=c.width?c.width:this.width,c.height=c.height?c.height:this.height,"circle"===c.type)0===c.cx&&0===c.cy&&(c.cx=c.width/2,c.cy=c.height/2),ia=Math.min(ia,c.cx-c.width/2),Fa=Math.min(Fa,c.cy-c.height/2),ga=Math.max(ga,c.cx+c.width/2),ea=Math.max(ea,c.cy+c.height/2);else if("rectangle"===c.type)a.isNull(c.x)&&(c.x=0),a.isNull(c.y)&&(c.y=0),c.scaleX=1,c.scaleY=1,ia=Math.min(ia,c.x),Fa=Math.min(Fa,c.y),ga=Math.max(ga,
c.x+c.width),ea=Math.max(ea,c.y+c.height);else{c=this.vectorDef[b].shape.coords[0];for(var ja=0,qa=c.length;ja<qa;ja+=2)c[ja]*=1,c[ja+1]*=1,c[ja]<ia&&(ia=c[ja]),c[ja]>ga&&(ga=c[ja]),c[ja+1]<Fa&&(Fa=c[ja+1]),c[ja+1]>ea&&(ea=c[ja+1])}b=ga-ia;Fa=ea-Fa;b==Number.MIN_VALUE&&(b=1);Fa==Number.MIN_VALUE&&(Fa=1);ea=this.width/b;Fa=this.height/Fa;for(b=0;b<this.vectorDef.length;b++)c=this.vectorDef[b].shape,c.scaleX=ea,c.scaleY=Fa,a.notNull(this.vectorDef[b].style)&&a.notNull(this.vectorDef[b].style.strokeThickness)&&
(this.vectorDef[b].style.strokeThickness=parseFloat(this.vectorDef[b].style.strokeThickness))}},getFNFormat:function(a){if(this.src||!this.vectorDef||0===this.vectorDef.length||!this.vectorDef[0].shape||"path"!==this.vectorDef[0].shape.type||!this.vectorDef[0].shape.coords||1>this.vectorDef[0].shape.coords.length||4>this.vectorDef[0].shape.coords[0].length)return null;for(var b=this.vectorDef[0].shape,c=b.coords[0],ea="M "+c[0]+" "+c[1],ia=2,Fa=c.length;ia<Fa;ia+=2)ea+=" L "+c[ia]+" "+c[ia+1];a?this.resolve(a):
this.calculateVectorMarkerScale();this.vectorDef[0].style&&!this.vectorDef[0].style.fill&&(this.vectorDef[0].style.fillOpacity=0);return{height:b.scaleY,width:b.scaleX,d:ea,refX:this.xOffset,refY:this.yOffset,paint:this.vectorDef[0].style,strokeUnits:!1}},getBindables:function(){return this.bindableAttrs?this.bindableAttrs:this.bindableAttrs=this.src?["Size","Width","Height","Source"]:["Fill","Size","Width","Height"]},getShapeString:function(b){var c="",ga="";if(b&&"circle"===b.type)c='\x3ccircle cx\x3d"'+
b.cx+'" cy\x3d"'+b.cy+'" r\x3d"0"/\x3e';else if(b&&"rectangle"===b.type)ga=""+b.x+","+b.y+",",ga+=b.x+b.width+","+b.y+",",ga+=b.x+b.width+","+(b.y+b.height)+",",ga+=b.x+","+(b.y+b.height)+",",ga+=b.x+","+b.y,c='\x3cpolygon points\x3d"'+ga+'"/\x3e';else if(b&&"path"===b.type){ga="";b=b.coords[0];4>b.length&&a.util.Logger.warning("MAPVIEWER_9106","OM.style.Marker.getShapeString","It only contains ["+b.length+"] vertexes.");for(var c=0,ea=b.length;c<ea;c+=1)ga+=b[c],c<b.length-1&&(ga+=",");c='\x3cpolygon points\x3d"'+
ga+'"/\x3e'}return c},getAnchorString:function(){var b,c,ga=c=b="";a.isNull(this.xOffset)||0===this.xOffset?b="0.5":(b=(this.width+this.xOffset)/this.width,b=Math.max(0,b),b=Math.min(1,b),b=""+b);a.isNull(this.yOffset)||0===this.yOffset?c+="0.5":(c=(this.height+this.yOffset)/this.height,c=Math.max(0,c),c=Math.min(1,c),c=""+c);if("0.5"!==b||"0.5"!==c)ga='\x3canchor x\x3d"'+b+'" y\x3d"'+c+'"/\x3e';return ga},getImageSrcString:function(b){var c="";if(a.notNull(b)){var ga,ea=b.lastIndexOf(".");0<ea&&
(ga=b.substring(ea+1));0>b.lastIndexOf("http")?(ea=document.URL,a.notNull(ea)?(ea=ea.substring(0,ea.lastIndexOf("/")+1),b=ea+b,c="\x3cimage"+(a.notNull(ga)&&0<ga.trim().length?' markerType\x3d"'+ga+'"':"")+' href\x3d"'+b+'"/\x3e'):a.util.Logger.warning("MAPVIEWER_9107","OM.style.Marker.getImageSrcString")):c="\x3cimage"+(a.notNull(ga)&&0<ga.trim().length?' markerType\x3d"'+ga+'"':"")+' href\x3d"'+b+'"/\x3e'}return c},toXMLString:function(){var b="",c="",ga=-1,ea=-1,ia="",Fa="",ja="",qa="";a.notNull(this.lengthUnit)&&
"pixel"!==this.lengthUnit&&(ia=this.lengthUnit);if(a.notNull(this.vectorDef)){this.vectorDef&&this.vectorDef[0]&&this.vectorDef[0].style&&(b=this.vectorDef[0].style.fill,a.notNull(this.vectorDef[0].style.fillOpacity)&&(ga=Math.min(Math.round(255*this.vectorDef[0].style.fillOpacity),255)),c=this.vectorDef[0].style.stroke,a.notNull(this.vectorDef[0].style.strokeOpacity)&&(ea=Math.min(Math.round(255*this.vectorDef[0].style.strokeOpacity),255)));var Ba=this.vectorDef[0].shape;Ba&&(Fa=this.getShapeString(Ba),
ja=this.getAnchorString())}else a.notNull(this.src)&&(qa=this.getImageSrcString(this.src));Ba=""+('\x3cstyle name\x3d"'+this.getStyleName()+'"\x3e');Ba+='\x3cg class\x3d"marker"'+(a.notNull(this.max_size_in_px)?' max_size_in_px\x3d"'+this.max_size_in_px+'"':"")+' style\x3d"';Ba+=a.notNull(c)&&0<c.length?"stroke:"+c+";":"";Ba+=a.notNull(ea)&&0<=ea?"stroke-opacity:"+ea+";":"";Ba+=a.notNull(b)&&0<b.length?"fill:"+b+";":"";Ba+=a.notNull(ga)&&0<=ga?"fill-opacity:"+ga+";":"";Ba+=a.notNull(this.width)&&
0<this.width?"width:"+this.width+ia+";":"";Ba+=a.notNull(this.height)&&0<this.height?"height:"+this.height+ia+";":"";Ba=Ba+'"\x3e'+Fa;Ba+=ja;Ba+=qa;return Ba+="\x3c/g\x3e\x3c/style\x3e"},enableNullFillPattern:function(b){a.notNull(b)?this.nullFill=b:this.nullFill=null}});a.style.Marker.isSameShape=function(a,b){if(a.type===b.type)if("circle"===a.type){if(a.cx===b.cx&&a.cy===b.cy&&a.width===b.width&&a.height===b.height)return!0}else if("rectangle"===a.type){if(a.x===b.x&&a.y===b.y&&a.width===b.width&&
a.height===b.height)return!0}else{var c=a.coords[0],ea=b.coords[0];if(c.length!==ea.length)return!1;for(var ia=0,Fa=c.length;ia<Fa;ia+=2)if(c[ia]!==ea[ia])return!1;return!0}return!1};a.style.StyleStore=a.style.StyleStore||{};a.style.StyleStore.styleCache=a.style.StyleStore.styleCache||{};a.style.StyleStore.styleCachePromises=a.style.StyleStore.styleCachePromises||{};a.style.StyleStore.getServerSideStyle=function(b,c,ga){var ea=a.style.StyleStore.styleCachePromises;if(!b||!c)return a.util.Logger.alert("MAPVIEWER_9018",
"OM.style.StyleStore.getServerSideStyle","dataSource:"+b+" styleName:"+c),null;var ia=a.style.StyleStore.getCachedStyle(b,c);if(a.isNull(ia)){if(!ga||!ga.callback)return a.util.Logger.alert("MAPVIEWER_9018","OM.style.StyleStore.getServerSideStyle","options.callback:"+ga.callback),null;var Fa,ia=function(ia){if(a.isNull(ia)&&ga&&ga.callback)ga.callback(null);else{var ea=null;try{ea=a.style.StyleStore.parseXMLStyle(ia,c,b,Fa)}catch(wb){ea=a.style.StyleStore.parseJSONStyle(ia,c)}a.notNull(ea)&&(ea.isServerSide=
!0,a.style.StyleStore.putStyle(b,c,ea));ga&&ga.callback&&("__Invalid__"===ea.styleName?(ga.callback(null),ea=null):ga.callback(ea));return ea}},ja={xml_request:'\x3cnon_map_request\x3e\x3cget_style_definition data_source\x3d"'+b+'" style\x3d"'+c+'"/\x3e\x3c/non_map_request\x3e'};Fa=ga&&ga.url?ga.url+"/omserver":a.gv.localbaseURL()+"/omserver";var qa=a.style.StyleStore.getKey(b,c);ea[qa]||(ea[qa]=a.$.Deferred(function(b){a.util.HttpRequest.send(Fa,ja,function(a){b.resolve(a)},"text",function(){a.util.Logger.warning("MAPVIEWER_9023",
"OM.style.StyleStore.getServerSideStyle");b.reject()})}).promise());return ea[qa].done(ia).fail(ia)}if("__Invalid__"===ia.styleName)return ga&&ga.callback&&ga.callback(null),null;ga&&ga.callback&&ga.callback(ia);return ia};a.style.StyleStore.parseXMLStyle=function(b,c,ga,ea){"string"===typeof b&&(b=a.$.trim(b),b=a.$.parseXML(b));b=a.$(b);a.notNull(b.find("oms_error")[0])?(c=new a.style.Style({styleName:"__Invalid__"}),a.util.Logger.alert("MAPVIEWER_9023","OM.style.StyleStore.parseXMLStyle",b.find("oms_error").text())):
c=a.style.StyleStore.createStyle(b,c,ga,ea);a.isNull(c)&&(c=new a.style.Style({styleName:"__Invalid__"}));return c};a.style.StyleStore.parseJSONStyle=function(b,c){"string"===typeof b&&(b=a.$.parseJSON(b));if(!b.type)return null;var ga=b.type,ea=b.def;ea.styleName=c;var ia;switch(ga){case "color":ia=new a.style.Color(ea);break;case "marker":ia=new a.style.Marker(ea);break;case "pulse_animation":ia=new a.style.PulseAnimation(ea);break;case "color_animation":ga={};ga.styleName=c;b.beginColorDef&&(ga.beginColor=
new a.style.Color(b.beginColorDef.def));b.endColorDef&&(ga.endColor=new a.style.Color(b.endColorDef.def));ea.duration&&(ga.duration=ea.duration);ea.movingDashLine&&(ga.enableMovingDashLine=ea.movingDashLine);ia=new a.style.AnimationColor(ga);break;case "bar_chart":ia=b.barArr;for(var Fa=ia.length,ja=[],ga=0;ga<Fa;ga++)ja.push(new a.style.Bar(ia[ga].name,ia[ga].color));ea.bars=ja;ia=new a.style.BarChart(ea);break;case "pie_chart":ia=b.pieArr;Fa=ia.length;ja=[];for(ga=0;ga<Fa;ga++)ja.push(new a.style.PieSlice(ia[ga].name,
ia[ga].color));ea.pieSlices=ja;ia=new a.style.PieChart(ea)}return ia};a.style.StyleStore.createStyle=function(b,c,ga,ea){var ia=a.style.StyleStore,Fa;b=b.find("non_map_response \x3e style");for(var ja=0;ja<b.length;ja++){var qa=b.eq(ja),Ba=qa.attr("name"),qa=ia.createSingleStyle(qa,ga,ea);a.notNull(qa)&&(a.style.StyleStore.putStyle(ga,Ba,qa),Ba==c&&(Fa=qa))}if(a.notNull(Fa)&&a.notNull(Fa.markerPattern)&&a.notNull(Fa.markerPattern.markers))for(c=Fa.markerPattern.markers,Fa.markerPattern.markers=[],
ea=0;ea<c.length;ea++)Fa.markerPattern.markers.push(a.style.StyleStore.getCachedStyle(ga,c[ea]));return Fa};a.style.StyleStore.createSingleStyle=function(b,c,ga){var ea=a.style.StyleStore,ia=b.find("AdvancedStyle")[0];return a.isNull(ia)?ea.createSimpleStyle({dataSource:c,data:b,url:ga}):ea.createAdvancedStyle(b.parent(),c,ga)};a.style.StyleStore.createAdvancedStyle=function(b,c,ga){var ea=b.find("AdvancedStyle")[0],ia=a.style.StyleStore;switch(a.$(ea).children()[0].tagName){case "PieChartStyle":return ia.createPieChartStyle(b);
case "BarChartStyle":return ia.createBarChartStyle(b);case "ColorSchemeStyle":return ia.createColorSchemeStyle(b);case "HeatMapStyle":return ia.createHeatMapStyle(b,c);case "BucketStyle":return ia.createBucketStyle(b,c,ga);case "VariableMarkerStyle":return ia.createVariableMarkerStyle(b,c,ga)}};a.style.StyleStore.getCachedStyle=function(b,c){var ga=a.style.StyleStore.styleCache,ea=a.style.StyleStore.getKey(b,c);return ga[ea]};a.style.StyleStore.putStyle=function(b,c,ga){var ea=a.style.StyleStore.styleCache;
a.isNull(b)||a.isNull(c)||(b=a.style.StyleStore.getKey(b,c),ea[b]=ga)};a.style.StyleStore.getKey=function(b,c){a.isNull(b)&&(b="");a.isNull(c)&&(c="");return b.toLowerCase()+"__"+c.toLowerCase()};a.style.StyleStore._styleStringToArray=function(a){a=a.attr("style").split(";");for(var b=[],c=0,ea=a.length;c<ea;c++){var ia=a[c].split(":");ia&&ia[0]&&(b[ia[0]]=ia[1])}return b};a.style.StyleStore._maxSizeInPx=function(b){b=b.attr("max_size_in_px");a.isNull(b)?b="":b.trim();return b};a.style.StyleStore.createSimpleStyle=
function(b){var c=b.data,ga=b.dataSource;b=b.url;var ea=c.find("g"),ia=a.style.StyleStore;if(a.notNull(ea[0]))switch(ea.attr("class")){case "color":return ia.createColorStyle(c);case "line":return ia.createLineStyle(c);case "area":return ia.createAreaStyle(ga,b,c);case "marker":return ia.createMarkerStyle(ga,b,c);case "text":return ia.createTextStyle(c);default:return null}else return null};a.style.StyleStore.createColorStyle=function(b){var c={},ga=a.style.StyleStore;c.styleName=b.attr("name");b.find("g").each(function(b,
ia){var za=a.$(ia),za=ga._styleStringToArray(za);c.fill="function"!==typeof za.fill?za.fill:null;c.fillOpacity=za["fill-opacity"]?parseInt(za["fill-opacity"])/255:1;c.stroke=za.stroke;c.strokeThickness=za["stroke-width"];c.strokeOpacity=za["stroke-opacity"]?parseInt(za["stroke-opacity"])/255:1});return new a.style.Color(c)};a.style.StyleStore.createLineStyle=function(b){var c={},ga=a.style.StyleStore;c.styleName=b.attr("name");b.find("g").each(function(b,ia){var za=a.$(ia),ja=ga._styleStringToArray(za);
c.fill="function"!==typeof ja.fill?ja.fill:null;c.fillOpacity=ja["fill-opacity"]?parseInt(ja["fill-opacity"])/255:1;c.fillWidth=ja["stroke-width"];c.strokeLineCap=ja["stroke-linecap"];c.strokeLineJoin=ja["stroke-linejoin"];c.cased="true"===za.attr("cased")?!0:!1;if(a.notNull(ja["marker-name"])){c.markerPattern={};c.markerPattern.serverLineArrow=!0;c.markerPattern.oriented=!0;var qa=ja["marker-name"];c.markerPattern.markers=[];c.markerPattern.markers.push(qa);var Ba;if(a.notNull(ja["marker-size"]))Ba=
ja["marker-size"],qa=parseFloat(Ba.replace(/[^0-9.]/g,"")),Ba=Ba.replace(/[0-9.]/g,""),c.markerPattern.markerWidth=qa,c.markerPattern.markerHeight=qa,c.markerPattern.lengthUnit=Ba;else if(a.notNull(ja["marker-width"])){Ba=ja["marker-width"];var Na=ja["marker-height"],qa=parseFloat(Ba.replace(/[^0-9.]/g,"")),Na=parseFloat(Na.replace(/[^0-9.]/g,""));Ba=Ba.replace(/[0-9.]/g,"");c.markerPattern.markerWidth=qa;c.markerPattern.markerHeight=Na;c.markerPattern.lengthUnit=Ba}qa=ja["marker-position"];0<qa.length&&
0===qa.replace(/[0-9.]/g,"").length?c.markerPattern.percent=parseFloat(qa):"all_points"===qa.toLowerCase()?c.markerPattern.vertexes=!0:"end_points"===qa.toLowerCase()&&(c.markerPattern.startAndEndMarers=!0);qa=ja["multiple-marker"];a.notNull(qa)&&"true"===qa.toLowerCase()&&(c.markerPattern.multipleMarker=!0);ja=ja["max-size-in-px"];a.notNull(ja)&&(c.markerPattern.max_size_in_px=parseInt(ja.replace(/[^0-9]/g,"")))}za.find("line").each(function(b,x){var y,q=a.$(x);"parallel"===q.attr("class")?(y=ga._styleStringToArray(q),
c.stroke="function"!==typeof y.fill?y.fill:null,c.strokeThickness=y["stroke-width"],c.strokeDash=ga.splitDashArray(q.attr("dash"))):"base"===q.attr("class")&&(y=ga._styleStringToArray(q),c.centerLine="function"!==typeof y.fill?y.fill:null,c.centerLineWidth=y["stroke-width"],c.centerLineDash=ga.splitDashArray(q.attr("dash")))});za.find("marker-pattern").each(function(b,x){var y=a.$(x),q=y.attr("offset")||"",k=y.attr("interval")||"";c.markerPattern={};c.markerPattern.offset=parseInt(q);c.markerPattern.offsetUnit=
q.replace(/[0-9]/g,"");c.markerPattern.interval=parseInt(k);c.markerPattern.intervalUnit=k.replace(/[0-9]/g,"");c.markerPattern.markers=[];y.find("marker").each(function(x,b){var y=a.$(b);c.markerPattern.markers.push(y.html())})})});return new a.style.Line(c)};a.style.StyleStore.createAreaStyle=function(b,c,ga){var ea={},ia=a.style.StyleStore;ea.styleName=ga.attr("name");ga.find("g").each(function(ga,ja){var qa=a.$(ja),qa=ia._styleStringToArray(qa);ea.fill=qa.fill;ea.stroke=qa.stroke;ea.strokeThickness=
qa["stroke-width"];ea.strokeOpacity=qa["stroke-opacity"]?parseInt(qa["stroke-opacity"])/255:1;ea.fillOpacity=qa["fill-opacity"]?parseInt(qa["fill-opacity"])/255:1;a.isNull(ea.fill)&&(ea.src=c+"?sty\x3d"+ea.styleName+"\x26ds\x3d"+b+"\x26w\x3d10\x26h\x3d10")});return a.notNull(ea.fill)?new a.style.Color(ea):new a.style.Area(ea)};a.style.StyleStore.createMarkerStyle=function(b,c,ga){var ea={},ia=a.style.StyleStore,Fa={},ja={},qa={};ea.styleName=ga.attr("name");ga.find("g").each(function(){var x=a.$(this),
b=ia._maxSizeInPx(x);!a.isNull(b)&&0<b.length&&(ea.max_size_in_px=parseInt(b));x=ia._styleStringToArray(x);b=a.util.MiscUtil.parseNumberAndUnit(x.width);a.notNull(b.value)?ea.width=1*b.value:ea.width=1*x.width;a.notNull(b.unit)&&(ea.lengthUnit=b.unit);b=a.util.MiscUtil.parseNumberAndUnit(x.height);a.notNull(b.value)?ea.height=1*b.value:ea.height=1*x.height;a.notNull(b.unit)&&(ea.lengthUnit=b.unit);x.fill&&"function"!==typeof x.fill&&(ja.fill=x.fill);x["fill-opacity"]&&(ja.fillOpacity=x["fill-opacity"]?
parseInt(x["fill-opacity"])/255:1);x.stroke&&(ja.stroke=x.stroke);x["stroke-width"]&&(ja.strokeThickness=x["stroke-width"]);x["stroke-opacity"]&&(ja.strokeOpacity=x["stroke-opacity"]?parseInt(x["stroke-opacity"])/255:1)});var Ba,Na=!1;if(0!==ga.find("image").length)"dummy.gif"===ga.find("image").attr("href")?ea.src=c+"?w\x3d"+ea.width+"\x26h\x3d"+ea.height+"\x26sty\x3d"+ea.styleName+"\x26ds\x3d"+b:ea.src=ga.find("image").attr("href");else if(0!==ga.find("svgSymbol").length)ea.src=c+"?w\x3d"+ea.width+
"\x26h\x3d"+ea.height+"\x26sty\x3d"+ea.styleName+"\x26ds\x3d"+b;else if(0!==ga.find("ttfSymbol").length)Na=!0,ea.src=c+"?w\x3d"+ea.width+"\x26h\x3d"+ea.height+"\x26sty\x3d"+ea.styleName+"\x26ds\x3d"+b;else{if(0!==ga.find("circle").length)qa.type="circle",qa.cx=1*ga.find("circle").attr("cx"),qa.cy=1*ga.find("circle").attr("cy"),qa.width=ea.width,qa.height=ea.height;else if(0!==ga.find("rect").length){qa.type="rectangle";b=ga.find("rect").attr("points").split(",");Ba=0;for(c=b.length;Ba<c;Ba++)b[Ba]*=
1;qa.width=ea.width;qa.height=ea.height;qa.x=b[0];qa.y=b[1]}else{b=ga.find("polygon").attr("points")||ga.find("polyline").attr("points");qa.type="path";b=b.split(",");if(ga.find("polygon").attr("points")){2<=b.length&&(b.push(b[0]),b.push(b[1]));var wb=b.length,x=Number.MAX_VALUE,y=Number.MAX_VALUE;for(c=0;c<wb;c+=2)x=Math.min(x,b[c]),y=Math.min(y,b[c+1]);for(c=0;c<wb;c+=2)b[c]-=x,b[c+1]-=y}qa.coords=[b]}Fa.shape=qa}qa=ga.find("anchor").attr("x");ga=ga.find("anchor").attr("y");a.notNull(qa)&&a.notNull(ea.width)&&
(ea.xOffset=-(Number(qa)-.5)*ea.width);a.notNull(ga)&&a.notNull(ea.height)&&(ea.yOffset=-(Number(ga)-.5)*ea.height);if(Na)Fa=new a.style.Marker(ea);else{for(Ba in ja){Fa.style=ja;break}if(Fa.shape||Fa.style)ea.vectorDef=[Fa];Fa=new a.style.Marker(ea);Fa.calculateVectorMarkerScale()}return Fa};a.style.StyleStore.createTextStyle=function(b){var c={};c.styleName=b.attr("name");b.find("g").each(function(b,ea){var ia=a.$(ea),za=a.Text,ia=a.style.StyleStore._styleStringToArray(ia);c.fill="function"!==typeof ia.fill?
ia.fill:null;c.fontStyle="italic"===ia["font-style"]?za.FONTSTYLE_ITALIC:za.FONTSTYLE_NORMAL;c.fontFamily=ia["font-family"];var ja=ia["font-size"];if(ja){var qa=a.util.MiscUtil.parseNumberAndUnit(ja);a.notNull(qa.value)?c.fontSize=1*qa.value:c.fontSize=parseInt(ja);a.notNull(qa.unit)&&(c.sizeUnit=qa.unit,"pt"===qa.unit&&(c.fontSize=parseInt(96*c.fontSize/72),c.sizeUnit=null))}c.fontWeight="bold"===ia["font-weight"]?za.FONTWEIGHT_BOLD:za.FONTWEIGHT_NORMAL});return new a.style.Text(c)};a.style.StyleStore.createPieChartStyle=
function(b){var c={pieSlices:[]};c.styleName=b.find("style").attr("name");c.radius=b.find("PieChartStyle").attr("pieradius");b.find("PieSlice").each(function(b,ea){var ia=a.$(ea),za=ia.attr("color"),ia=ia.attr("name");c.pieSlices.push(new a.style.PieSlice(ia,za))});return new a.style.PieChart(c)};a.style.StyleStore.createBarChartStyle=function(b){var c={bars:[]};c.styleName=b.find("style").attr("name");var ga=b.find("BarChartStyle");c.width=ga.attr("width");c.height=ga.attr("height");c.showXAxis=
ga.attr("show_x_axis");c.maxSize=ga.attr("max_value");b.find("Bar").each(function(b,ia){var ga=a.$(ia),ja=ga.attr("color"),ga=ga.attr("name");c.bars.push(new a.style.Bar(ga,ja))});return new a.style.BarChart(c)};a.style.StyleStore.createColorSchemeStyle=function(b){var c=a.style.StyleStore.createBucketConfig(b);b=b.find("ColorSchemeStyle");c.baseColor=b.attr("basecolor");var ga=b.attr("basecolor_opacity");c.baseColorOpacity=ga?parseInt(ga)/255:1;c.stroke=b.attr("strokecolor");b.attr("strokewidth")&&
(c.strokeThickness=1*b.attr("strokewidth"));ga=b.attr("strokecolor_opacity");c.strokeOpacity=ga?parseInt(ga)/255:1;return new a.style.ColorScheme(c)};a.style.StyleStore.createHeatMapStyle=function(b,c){var ga={},ea=b.find("spot_light_radius").text();ga.styleName=b.find("style").attr("name");var ia=b.find("container_theme").text();ia&&(ga.containerVectorLayer=new a.layer.VectorLayer("container",{def:{type:a.layer.VectorLayer.TYPE_PREDEFINED,dataSource:c,theme:ia,loadOnDemand:!1}}));ga.spotlightRadius=
1*ea.match(/\d+\.?\d+/g);(ea=ea.match(/[a-z]+/g))&&0<ea.length&&(ga.lengthUnit=ea[0]);ea=b.find("color_stops");ia=ea.attr("alpha");ga.opacity=1;ia&&(ga.opacity=parseFloat(ia/256));for(var ea=a.$.trim(ea.text()).split(","),ia=0,Fa=ea.length;ia<Fa;ia++)ea[ia]=a.util.ValidationUtil.getColor(ea[ia]);ga.colorStops=ea;return new a.style.HeatMap(ga)};a.style.StyleStore.createBucketStyle=function(b,c,ga){b=a.style.StyleStore.createBucketConfig(b,c,ga);return new a.style.BucketStyle(b)};a.style.StyleStore.createBucketConfig=
function(b,c,ga){var ea={};ea.styleName=b.find("style:has('AdvancedStyle')").attr("name");var ia=b.find("Buckets"),Fa=a.style.StyleStore,ja=ia.attr("default_style");ja&&(ea.defaultStyle=Fa.getSubStyleByName(b,ja,c,ga));ea.buckets=[];ea.styles=[];var qa,ja=ia.find("RangedBucket");if(0<ja.length)return qa=a.style.RangedBucket,ja.each(function(){ea.classification="custom";var x=a.$(this),y={};y.seq=1*x.attr("seq");y.label=x.attr("label");var q=1*x.attr("low"),k=1*x.attr("high");y.low=isNaN(q)?Number.NEGATIVE_INFINITY:
q;y.high=isNaN(k)?Number.POSITIVE_INFINITY:k;x=x.attr("style");x=Fa.getSubStyleByName(b,x,c,ga);y=new qa(y);ea.buckets.push(y);x&&ea.styles.push(x)}),ea.numClasses=ea.buckets.length,ea;ja=ia.find("CollectionBucket");if(0<ja.length)return qa=a.style.CollectionBucket,ja.each(function(){ea.classification="custom";var x=a.$(this),y={};y.seq=1*x.attr("seq");y.label=x.attr("label");var q=x.attr("style"),q=Fa.getSubStyleByName(b,q,c,ga),k=x.attr("label_style");y.labelStyle=Fa.getSubStyleByName(b,k,c,ga);
y.keepWhiteSpace=x.attr("keep_white_space");k=x.attr("type");y.dataType=k;var O=x.attr("delimiter");O||(O=",");for(var x=x.text().split(O),O=x.length,u=0;u<O;u++)if("integer"===k||"short"===k)x[u]=parseInt(x[u]);else if("double"==k||"long"===k)x[u]=parseFloat(x[u]);y.values=x;y=new qa(y);ea.buckets.push(y);q&&ea.styles.push(q)}),ea.numClasses=ea.buckets.length,ea;if(ja=ia.attr("styles"))for(var ja=ja.split(","),Ba=0,Na=ja.length;Ba<Na;Ba++){var wb=Fa.getSubStyleByName(b,ja[Ba],c,ga);ea.styles.push(wb)}ja=
ia.attr("low");Ba=ia.attr("high");ja&&(ea.low=1*ja);Ba&&(ea.high=1*Ba);ia=ia.attr("nbuckets");ea.numClasses=ia?1*ia:null;return ea};a.style.StyleStore.createVariableMarkerStyle=function(b,c,ga){var ea=a.style.StyleStore.createBucketConfig(b,c,ga),ia=b.find("VariableMarkerStyle"),Fa=a.style.StyleStore,ja=ia.attr("basemarker");ea.marker=Fa.getSubStyleByName(b,ja,c,ga);b=ia.attr("startsize");ia=ia.attr("increment");b&&(ea.startSize=1*b);ia&&(ea.increament=1*ia);return new a.style.VariableMarker(ea)};
a.style.StyleStore.getSubStyleByName=function(b,c,ga,ea){b=b.find('style[name\x3d"'+c+'"]')[0];b=a.$(b);return a.style.StyleStore.createSimpleStyle({dataSource:ga,url:ea,data:b})};a.style.StyleStore.splitDashArray=function(a){if(a){a=a.split(",");for(var b=a.length,c=0;c<b;c++)a[c]=parseInt(a[c]);return a}return null};a.style.StyleStore.defaultMarkerStyle=new a.style.Marker({width:50,height:50,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAG3klEQVRoQ+2XaWwUZRzG37n26LWUAi0toi1IImhiggqioiEhqYkJH5SEIyECMSAYTCiKHAot5xflC2CQ+EFEjgBRULlrLeEoJKACBakNaaDHUloshXZLa3d8nndmyrZAod3tasgOeTvnzjy///P83xkU8ZgsymPCIWIg/zcnY47EHOmhCsSi1UOF7fZtY450u3Q99MOYI/6bzSMVoWWHW2BTtO5P87mKwr1PtxwpqWjcXXOrafSvl81eQphtGhTczZS7vK0prH0Fa1Med86HHn89U63rk+g5MiQjblw4MF0GKa9t/vzQ6bIZeQUivqG00NLcyRIMEqTjRdi3D7XUVYg18yY0jB3+5IYBKa6c7sJ0GaSkMlD88ffXhx4vPNBWZefhJsoO2VKkaartNYXAKArOWdZJyGfTVPHl/PEXhqR7h0UN5PK1pqqpm6rSLp46bD3TSlFbhSWAs++Ix76qqnYIuQNcRM5E5FRFFxneRrFj5RR/Vqqnf1RBpn3rT7tw6pD1TOiSuulCEBC2x9Yxxsp2BiCOA5Zr1oUm1unegNi1fHL0QaZvrkorPglH7D5HXe9xQfaFqt0VDyAnbmh96ZBc4E4GQHbkTYg+CKNFR6RYRsSxoYMDKsUzUkEahX8QLbd0AuJ3ckaDIx5EK/cdgLijGy2nR6QTVl5k88oYaYrMPY9JoXRFJo5rjdw4bzllOWaKAeiR7YvH+TOjDSKjVZR/1wlqoig6IsVqQtGgnk7ogCIEz2nctvuI7xU7XhlxAbF9wZv/Dcj5ol+cXhcaBEoAiKQ4RcU+QUzbAd2Q0FbjwzHu0xruIW7p7gax7ZOx/sx+RvSjdeEkQDiN2pU2IZKRsqJkOaKohnSDYPKY3SPsG4XXYvpV4F66+5bYkjM6+iCM1vmTBTIqrLEJwW1iIUw1AMA+oXgZM+zLbSt6ElZOEtbsxWbfPOdFgOjRdUT2yCl8njAamtvKOsSzoRXdJYXLinNtO8N9XAiD6AbiJd2y3iMZntti08znogtSWhW48v626if+IAgqyxlINVzSAUUHFPJP0TxmCkO6QwdUuBcEKB1QNDiCbzD2FN/uWQmNYsPUQVcH9dUHWtNZ15cuf2uV+gNb1hXenLh1D16IsicIABBUXzM8gHPJZlawVhgxVJ4QcsZizOx+ke8TvlDRN28NaRWzRidvHZyqT+o6gvWLLoNU1jUPr6hpyJ+xrc5XVXoa1adoCDbcEIxtwKgciJyAK4rtitXsgJIuBuWrR8Of3nFCZD+tiKkjvLmpPm1p1ED4IMJU1gTyZ+6s91WW/AZHLPEOhIZ9xkwwaoBT4ZhB4UiUm5Oa/EA2RYpXFa8NNsS7L+i5ZqBxfVpaYnVUQdpgapsAc9tXVXYJIF6hQbjq9iJdcRCPmAFCh3oPetztUoROGGzrIEnG6VcGGWLi8+FDdCtaoRWTztTeyZ/9wx2fv7xMaG7kBECMFd1xGbqIhxX8EIlDGxFExydML1w26ilDZGcFVu/e/t3Xc+fOvt6JE+ykVox/7DW37/631P5hl3uk4wMlzI2W/A/2mL5qf4VQ3PFwxit0lyHi3Ypwo6O9hircaCOCJCNxI7J0MVQr2bgqd+HOfft++rsTCHzkiBaMAMYtjNsYTTZQO5iwQSji0tWal+pb4g/N39eadLW2QTridasiAeI9cIQghmoiTooYmamLlBtHdy7/bNHBM2eKbj4AgiIJ0YzRiMHrajEI3WC7E1EQFoJfgolr1m18Y1T25G9WFAQTSmuDMlLxBtzQAaGbom+cKiHiyg/uXbls4ZHic+dY4dDFEUYAB4KiCVGDwfjdsB3h+XZLOI44EAm4Y1+M1PdmzRkxPWd13hdHgt6yOlMkoi84S/VLUMXLgPBc+fngquVLjv1Z3A6CAM5g/jnu2E7U2wDXbAhG7B4IEoUDws8sJF4kY/SzYXpPmjJt2Jwla+etPx70XqkLiv5Jmng1SxMJ5XtDIZzoOI3sNDP7gRAUTAg6QDfqHuSEY0skQJJwsxSM3jZUAmCe+XDp2nlfnTC9w9I10af6wP5Vyz49evH8WcbEqTpFcybimr1AADYyIdjUBOFgvHj+npnKgQjXERaBriBAgvHy2YNgibt+PDzlL++otzPrC/esWLqg4OzZ31lVinaqTnEUTfEOABvbOUYwgnYK4MCE40joPRwgvCEEQZLGjHlz4EeLl4zPW5Sz/8SJY5xtKCpUNAWHgjgOPZLwUDfCdaTjvbjvAHmxTSiu+T50ZiEHxKn2fV9u97vxw45FwpEHARGKUzMXpy/uO+M8TOSjnO8pkEd5dkSviYFEtJwRuFnMkQgUMaK3iDkS0XJG4GaPjSP/Al31T1GL6r+HAAAAAElFTkSuQmCC",
yOffset:-12,xOffset:2});a.style.StyleStore.defaultLineStyle=new a.style.Line({stroke:"#000000",strokeThickness:1});a.style.StyleStore.defaultPolygonStyle=new a.style.Color({stroke:"#000000",strokeThickness:1,fill:"#bebebe"});a.style.StyleStore.defaulTextStyle=new a.style.Text({fontSize:12,fill:"#000000"});a.style.BasicAnimation=a.style.Style.extend({initialize:function db(b){db.base.call(this,b);this.duration=a.notNull(b.duration)?b.duration:5;this.repeatCount=b.repeatCount?b.repeatCount:Number.MAX_VALUE},
isRepeat:function(){return 0<this.repeatCount},getDuration:function(){return this.duration}});a.style.AnimationColor=a.style.BasicAnimation.extend({initialize:function ga(b){b=b||{};b.styleType="AnimationColor";ga.base.call(this,b);this.beginColor=a.notNull(b.beginColor)?b.beginColor:new a.style.Color({strokeThickness:1,stroke:"#000000",fill:"#ffffff"});this.endColor=a.notNull(b.endColor)?b.endColor:new a.style.Color({strokeThickness:1,stroke:"#ffffff",fill:"#000000"});if(this.movingDashLine=a.notNull(b.enableMovingDashLine)?
b.enableMovingDashLine:!1)this.beginColor.strokeDashArray=[10,10];a.isNull(b.repeat)||b.repeat?this.repeatCount=Number.POSITIVE_INFINITY:this.repeatCount=1},draw:function(a,b,c){this.beginColor.draw(a,b,c)},createAnimation:function(a,b,c){this.target=a;if(this.beginColor&&this.endColor){var Fa=[],ja={};this.beginColor.stroke!==this.endColor.stroke&&(ja.stroke={beginValue:this.covertColor(this.beginColor.stroke,b),endValue:this.covertColor(this.endColor.stroke,b),interpolator:b.oui.anim.interpolateColor});
this.beginColor.strokeThickness!==this.endColor.strokeThickness&&(ja.strokeThickness={beginValue:this.beginColor.strokeThickness,endValue:this.endColor.strokeThickness});c||(this.beginColor.fill!==this.endColor.fill&&(ja.fill={beginValue:this.covertColor(this.beginColor.fill,b),endValue:this.covertColor(this.endColor.fill,b),interpolator:b.oui.anim.interpolateColor}),this.beginColor.fillOpacity!==this.endColor.fillOpacity&&(ja.fillOpacity={beginValue:this.beginColor.fillOpacity,endValue:this.endColor.fillOpacity}),
this.beginColor.strokeOpacity!==this.endColor.strokeOpacity&&(ja.strokeOpacity={beginValue:this.beginColor.strokeOpacity,endValue:this.endColor.strokeOpacity}));this.movingDashLine&&(ja.strokeDashArray={beginValue:[10,10],endValue:[10,10],interpolator:function(a,b,c){a=parseInt(100*c)%20;b=[10,10];10<a?b=[a-10,10,20-a,.1]:0<a&&(b=10-a,b=[.1,a,10,0===b?.1:b]);return b}});a=new b.oui.anim.AnimateStyle({targetNode:a,dur:this.duration,animValues:ja,repeatCount:this.repeatCount});Fa.push(a);return Fa}},
covertColor:function(a,b){var c=parseInt(a.substring(1,3),16),Fa=parseInt(a.substring(3,5),16),ja=parseInt(a.substring(5),16);return new b.oui.style.Color(c,Fa,ja)}});a.style.PulseAnimation=a.style.BasicAnimation.extend({initialize:function ea(b){b=b||{};b.styleType="PulseAnimation";ea.base.call(this,b);this.beginSize=a.notNull(b.beginSize)?b.beginSize:10;this.endSize=a.notNull(b.endSize)?b.endSize:20;this.stroke=a.notNull(b.stroke)?b.stroke:"#000000"},draw:function(a,b,c){var ja=a.geo,qa=ja.type;
if("LineString"!==qa&&"MultiLineString"!==qa&&"Polygon"!==qa&&"MultiPolygon"!==qa){b=b.getGraphics();a.screenPoints||a.transformGeometry(ja);var ja=a.screenPoints,Ba=[{shape:{type:"circle",cx:0,cy:0,width:this.beginSize,height:this.beginSize,scaleX:1,scaleY:1},style:{stroke:this.stroke}}];if("MultiPoint"===qa||"OrientedMultiPoint"===qa){qa=b.createGroup();c.group.appendChild(qa);c.group=qa;for(var Na=0,wb=ja.length;Na<wb;Na++)b.drawVectorMarker({x:ja[Na].x,y:ja[Na].y},Ba,c);a.shape=qa}else a.shape=
b.drawVectorMarker({x:ja.x,y:ja.y},Ba,c)}},createAnimation:function(a,b){this.target=a;var c=[],ja=new b.oui.anim.AnimateStyle({targetNode:a,dur:this.duration,repeatCount:this.repeatCount,animValues:{width:{beginValue:this.beginSize,endValue:this.endSize},height:{beginValue:this.beginSize,endValue:this.endSize},strokeOpacity:{beginValue:1,endValue:0}}});ja.addEventListener(b.oui.SyncEvents.END,this.endListener);c.push(ja);return c},endListener:function(a){var b=a.target;a=b.getTargetNode();b=b.getAnimValues();
a.applyStyle({width:b.width.beginValue,height:b.height.beginValue,strokeOpacity:1})}});a.style.Area=a.style.Style.extend({initialize:function ia(b){b=b||{};b.styleType="Area";ia.base.call(this,b);var c=a.util.ValidationUtil.getColor;this.stroke=a.notNull(b.stroke)&&c(b.stroke)?c(b.stroke):a.PaintTypes.NO_PAINT;this.src=a.notNull(b.src)?b.src:a.PaintTypes.NO_PAINT;this.strokeThickness=a.notNull(b.strokeThickness)?parseFloat(b.strokeThickness):1;this.fillOpacity=a.notNull(b.fillOpacity)?b.fillOpacity:
1;this.strokeOpacity=a.notNull(b.strokeOpacity)?b.strokeOpacity:1;this.strokeDashArray=a.notNull(b.strokeDash)?b.strokeDash:[];this.repeatPattern=a.notNull(b.repeatPattern)?b.repeatPattern:!0;a.notNull(this.src)&&this.loadImgFromSource()},loadImgFromSource:function(){var b=this,c=new Image;c.src=this.src;c.onload=function(){a.isNull(b.width)&&(b.width=c.width);a.isNull(b.height)&&(b.height=c.height);b.origConfig&&(b.origConfig.width=c.width,b.origConfig.height=c.height)}},createStyle:function(a){this.fill=
new a.oui.style.PatternPaint({src:this.src})},createFixedImageStyle:function(b,c,ja){c={src:this.src,x:ja.x,y:ja.y,width:ja.width,height:ja.height,preserveAspectRatio:!0,opacity:this.fillOpacity};try{var qa=b.createImage(c);this.imgGroup=b.createGroup();this.imgGroup.appendChild(qa)}catch(Ba){a.util.Logger.warning("MAPVIEWER","OM.style.Area","Cannot create fixed image. Using pattern fill"),this.fill=b.createFillPattern(this.src)}},draw:function(b,c,ja){var qa=b.geo,Ba=a.notNull(ja.type)?ja.type:qa.type;
c=c.getGraphics();ja.screenPoints?qa=ja.screenPoints:(b.screenPoints||b.transformGeometry(qa),qa=b.screenPoints);var Na,wb,x;if(("LineString"===Ba||"MultiLineString"===Ba)&&qa&&0<qa.length)if(x={stroke:this.stroke,strokeOpacity:this.strokeOpacity,strokeThickness:this.strokeThickness,strokeDashArray:this.strokeDashArray},"LineString"===Ba)b.shape=c.drawPath(qa,x,ja);else{Ba=c.createGroup();ja.group.appendChild(Ba);ja.group=Ba;Na=0;for(wb=qa.length;Na<wb;Na++)c.drawPath(qa[Na],x,ja);b.shape=Ba}else if(this.repeatPattern&&
a.isNull(this.fill)&&(this.fill=c.createFillPattern(this.src)),"Point"===Ba||"OrientedPoint"===Ba||"MultiPoint"===Ba||"OrientedMultiPoint"===Ba)if(x=a.gv.defaultMarkerStyleWidth,Na=a.gv.defaultMarkerStyleHeight,x=[{shape:{type:"circle",cx:x/2,cy:Na/2,width:x,height:Na,scaleX:1,scaleY:1},style:this}],"MultiPoint"===Ba||"OrientedMultiPoint"===Ba){Ba=c.createGroup();ja.group.appendChild(Ba);ja.group=Ba;Na=0;for(wb=qa.length;Na<wb;Na++)c.drawVectorMarker({x:qa[Na].x,y:qa[Na].y},x,ja);b.shape=Ba}else b.shape=
c.drawVectorMarker({x:qa.x,y:qa.y},x,ja);else if(qa&&0!==qa.length)if(x={stroke:this.stroke,strokeOpacity:this.strokeOpacity,strokeThickness:this.strokeThickness,strokeDashArray:this.strokeDashArray,fill:this.fill,fillOpacity:this.fillOpacity},"Rectangle"===Ba)if(!1===this.repeatPattern){x.fill=null;Ba={src:this.src,x:qa.x,y:qa.y,width:qa.width,height:qa.height,preserveAspectRatio:!0,opacity:this.fillOpacity};Na=c.createGroup("imageGroup");ja.group.appendChild(Na);ja.group=Na;ja.enableCache=!0;try{c.drawImage(qa,
Ba,ja)}catch(y){a.util.Logger.warning("MAPVIEWER","OM.style.Area","Cannot create nonpattern area style:"),a.util.Logger.warning("MAPVIEWER",y)}Ba=ja.group;Na=c.createGroup();ja.group.appendChild(Na);ja.group=Na;c.drawRectangle(qa,x,ja);Na.appendChild(Ba);b.shape=Ba}else b.shape=c.drawRectangle(qa,x,ja);else if("Polygon"===Ba)b.shape=c.drawPath(qa,x,ja);else if("MultiPolygon"===Ba){Ba=c.createGroup();ja.group.appendChild(Ba);ja.group=Ba;Na=0;for(wb=qa.length;Na<wb;Na++)c.drawPath(qa[Na],x,ja);b.shape=
Ba}},toXMLString:function(){var b;b=""+('\x3cstyle name\x3d"'+this.getStyleName()+'"\x3e');b=b+'\x3cg class\x3d"area" style\x3d"'+(a.notNull(this.stroke)?"stroke:"+this.stroke+";":"");b+=a.notNull(this.strokeOpacity)?"stroke-opacity:"+Math.min(Math.round(255*this.strokeOpacity),255)+";":"";b+=a.notNull(this.fill)?"fill:"+this.fill+";":"";b+=a.notNull(this.fillOpacity)?"fill-opacity:"+Math.min(Math.round(255*this.fillOpacity),255)+";":"";return b+='"\x3e\x3c/g\x3e\x3c/style\x3e'}});a.style.Formatter=
a.Class.extend({initialize:function(b){this.scale=b&&b.scale||"logarithm";this.style=b?b.style:null;this.numClasses=b&&b.numClasses||7;a.isNull(this.numClasses)&&(this.numClasses=0)},resolve:function(a,b,c){return null},getScale:function(){return this.scale},getStyle:function(){return this.style},getNumClasses:function(){return this.numClasses}});a.style.ColorFormatter=a.style.Formatter.extend({initialize:function Fa(b){Fa.base.call(this,b);this.baseColors=b.colors;a.isNull(this.baseColors)&&(this.baseColors=
a.style.colorbrewer.PuBuGn["7"]);this.defaultColor=b.defaultColor;a.isNull(this.defaultColor)&&(a.notNull(this.style)&&a.notNull(this.style.fill)?this.defaultColor=this.style.fill:this.defaultColor=a.PaintTypes.NO_PAINT)},resolve:function(b,c){var qa=this.baseColors,Ba=this.numClasses||qa.length;if(a.isNull(b)||""===b)return this.defaultColor;if(this.scale&&0===this.scale.indexOf("log"))var Na=c.getMin(),wb=c.getMax(),Na=Math.log(Na),Ba=(Math.log(wb)-Na)/Ba,Ba=parseInt((Math.log(b)-Na)/Ba);else Ba=
(c.getMax()-c.getMin())/Ba,Ba=parseInt((b-c.getMin())/Ba);return isNaN(Ba)?this.defaultColor:Ba>=qa.length?qa[qa.length-1]:qa[Ba]},getBaseColors:function(a){return this.baseColors},setColors:function(a){this.baseColors=a},getDefaultColor:function(){return this.defaultColor},setDefaultColor:function(a){this.defaultColor=a}});a.style.SizeFormatter=a.style.Formatter.extend({initialize:function ja(b){ja.base.call(this,b);this.startingSize=b.startingSize;a.isNull(this.startingSize)&&(a.notNull(this.style)?
this.startingSize=this.style.origConfig.width:this.startingSize=15);this.defaultSize=b.defaultSize;a.isNull(this.defaultSize)&&(this.defaultSize=0);this.delta=b.delta||5;this.lengthUnit=a.notNull(b.lengthUnit)?b.lengthUnit:"pixel"},resolve:function(b,c,Ba){b=this.doResolve(b,c);c=this.lengthUnit.toLowerCase();"pixel"!==c&&a.notNull(Ba)&&a.notNull(Ba.parentLayer)&&a.notNull(Ba.parentLayer.parentMap)&&(Ba=a.util.GeomUtil.getCurrentDistancePerPixel(Ba.parentLayer.parentMap.getMapContext()),c=a.gv.getUnitFactor(c),
0!==c&&(Ba/=c),b/=Ba);return b},doResolve:function(b,c){if(a.isNull(b)||""===b)return this.defaultSize;var Ba=this.delta,Na=this.numClasses,wb=this.startingSize;if(this.scale&&0===this.scale.indexOf("log")){var x=c.getMin(),y=c.getMax();if(0>=x){var q=1-x,x=x+q,y=y+q;b+=q}x=Math.log(x);Na=(Math.log(y)-x)/Na;Na=parseInt((Math.log(b)-x)/Na)}else Na=(c.getMax()-c.getMin())/Na,Na=parseInt((b-c.getMin())/Na);isNaN(Na)&&(Na=0);return wb+Ba*Na},getStartingSize:function(){return this.minSize},getDefaultSize:function(){return this.defaultSize}});
a.style.Div=a.style.Style.extend({initialize:function qa(b){qa.base.call(this,b);b=b||{};this.showOnPoint=1;this.lengthUnit=a.notNull(b.lengthUnit)?b.lengthUnit:"pixel";this.width=b.width;this.height=b.height;this.callback=b.customRenderer;this.html=b.html},draw:function(b,c,Na){!1!==this.appliable(b)&&(Na=this.getCustomLayerDiv(b),this.setPosition(Na,b,c),a.notNull(this.html)?Na.html(this.html):this.callback(Na[0],b))},appliable:function(a){switch(a.getGeometry().getType()){case "Point":case "MultiPoint":case "OrientedMultiPoint":case "Polygon":case "MultiPolygon":return!0}return!1},
resolve:function(b,c){if(this.bindings&&0!==this.bindings.length){for(var Na=0,wb=this.bindings.length;Na<wb;Na++){var x=this.bindings[Na],y=this.resolveBinding(x,b);"SIZE"===x.attribute?this.origConfig.width&&this.origConfig.height&&this.origConfig.width!==this.origConfig.height?(this.height=this.origConfig.height*y/this.origConfig.width,this.width=y):this.height=this.width=y:"WIDTH"===x.attribute?this.width=y:"HEIGHT"===x.attribute&&(this.height=y)}(a.isNull(this.width)||isNaN(this.width))&&a.notNull(this.origConfig.width)&&
(this.width=this.origConfig.width);(a.isNull(this.height)||isNaN(this.height))&&a.notNull(this.origConfig.height)&&(this.height=this.origConfig.height);this.realWidth=this.width;this.realHeight=this.height}else a.style.Style.calculateStyleSize(this,c)},setPosition:function(a,b,c){this.resolve(b,c);var wb=this.realWidth,x=this.realHeight,y=c.getTransform(),q=b.parentLayer;c=c.getCenterPoint();var k=this.getCenterPoint(b);b=y.toScreenXLength(k.getX()-c.getX())+q.orgWidth/2;var k=y.toScreenYLength(-(k.getY()-
c.getY()))+q.orgHeight/2,O=y.toScreenXLength(q.dataBufferWindow.x+q.dataBufferWindow.w/2-c.getX()),y=y.toScreenYLength(-(q.dataBufferWindow.y+q.dataBufferWindow.h/2-c.getY()));a.parent().css({left:O,top:y});a.css({left:b-O+"px",top:k-y+"px",width:wb+"px",height:x+"px"})},getCenterPoint:function(b){b=b.getGeometry().getMIR();return new a.geometry.Point((b.getMinX()+b.getMaxX())/2,(b.getMinY()+b.getMaxY())/2,b.srid)},getCustomLayerDiv:function(b){var c=b.parentLayer,Na=c.getDivId("f_"+b.id),wb=a.$("#"+
Na);0>=wb.length&&a.notNull(c.parentMap)&&(Na=a.$("\x3cdiv id\x3d'"+Na+"' style\x3d'position:absolute;overflow:hidden'\x3e"),Na.css({display:"block"}),c.getCustomLayerDiv().append(Na),wb=b.$customDiv=Na);wb.data("f",b);return wb},getBindables:function(){return this.bindableAttrs?this.bindableAttrs:this.bindableAttrs=["Size","Width","Height"]}});a.style.SourceImageFormatter=a.style.Formatter.extend({initialize:function Ba(b){Ba.base.call(this,b);this.defaultSource=b?b.defaultSource:null;a.isNull(this.defaultSource)&&
(a.notNull(this.style)&&a.notNull(this.style.src)?this.defaultSource=this.style.src:this.defaultSource=a.PaintTypes.NO_PAINT);this.baseSources=b?b.sources:null;a.isNull(this.baseSources)&&(this.baseSources=[this.defaultSource])},resolve:function(a,b,c){},getBaseSources:function(a){return this.baseSources},setSources:function(a){this.baseSources=a},getDefaultSource:function(){return this.defaultSource},setDefaultSource:function(a){this.defaultSource=a}});a.style.StackedMarker=a.style.Marker.extend({initialize:function Na(c){c=
c||{};c.styleType="StackedMarker";Na.base.call(this,c);c.styleType="StackedMarker";this.width=a.notNull(c.width)?c.width:null;this.height=a.notNull(c.height)?c.height:null;this.xOffset=a.notNull(c.xOffset)?c.xOffset:0;this.yOffset=a.notNull(c.yOffset)?c.yOffset:0;this.lengthUnit=a.notNull(c.lengthUnit)?c.lengthUnit:"pixel";this.src=a.notNull(c.src)?c.src:null;this.textStyle=a.notNull(c.textStyle)?c.textStyle:null===c.textStyle?null:b;if(this.src&&(a.isNull(this.width)||a.isNull(this.height))){var x=
this,y=new Image;y.src=this.src;y.onload=function(){a.isNull(x.width)&&(x.width=y.width);a.isNull(x.height)&&(x.height=y.height);x.origConfig&&(x.origConfig.width=y.width,x.origConfig.height=y.height)}}(this.markerArray=a.notNull(c.markerArray)?c.markerArray:null)?this.validateMarkers():a.util.Logger.warning(null,"OM.style.StackedMarker","ERROR: Invalid marker array");this.textOffset=c.textOffset?c.textOffset:null;this.showOnPoint=2},validateMarkers:function(){for(var b=0;b<this.markerArray.length;b++){if(!this.markerArray[b]instanceof
a.style.Marker){a.util.Logger.warning(null,"OM.style.StackedMarker","ERROR: Invalid marker array");break}this.markerArray[b].calculateVectorMarkerScale()}},resolve:function(){return this},draw:function(b,c,x){for(var y=c.getGraphics().createGroup(),q=0;q<this.markerArray.length;q++){var k=this.markerArray[q];k.resolve(b);var O=b.geo,u=b.geo.type;if(x.markerPoint&&b.shapeGroup)x.group.appendChild(y),0!==k.width&&0!==k.height&&k.drawMarker(c,y,x.markerPoint,b.markerText);else if(x.sPoint)x.group.appendChild(y),
k.drawMarker(c,y,x.sPoint,b.markerText);else{if("LineString"===u||"MultiLineString"===u)break;if("Polygon"===u||"MultiPolygon"===u)b.screenPoints||(u=null,b.labelBox?u=new a.geometry.Point((b.labelBox[0]+b.labelBox[2])/2,(b.labelBox[1]+b.labelBox[3])/2,O.srid):O.mbr&&(u=new a.geometry.Point((O.mbr.getMinX()+O.mbr.getMaxX())/2,(O.mbr.getMinY()+O.mbr.getMaxY())/2,O.srid)),u=b.transformGeometry(u),b.screenPoints||(b.screenPoints=u)),x.group.appendChild(y),k.drawMarker(c,y,b.screenPoints,b.markerText);
else if(b.screenPoints||b.transformGeometry(O),"Point"===u||"OrientedPoint"===u)if(x.group.appendChild(y),k.drawMarker(c,y,b.screenPoints,b.markerText),k.markerText)k.drawMarker(c,y,b.screenPoints,b.markerText);else if("MultiPoint"===u||"OrientedMultiPoint"===u)for(x.group.appendChild(y),q=0,O=b.screenPoints.length;q<O;q++)k.drawMarker(c,y,b.screenPoints[q],b.markerText)}}b.shape=y}});a.style.GlyphMarker=a.style.Marker.extend({initialize:function wb(x){x=x||{};x.styleType="GlyphMarker";wb.base.call(this,
x);x.styleType="GlyphMarker";this.width=a.notNull(x.width)?x.width:null;this.height=a.notNull(x.height)?x.height:null;this.xOffset=a.notNull(x.xOffset)?x.xOffset:0;this.yOffset=a.notNull(x.yOffset)?x.yOffset:0;this.lengthUnit=a.notNull(x.lengthUnit)?x.lengthUnit:"pixel";this.src=a.notNull(x.src)?x.src:null;this.textStyle=a.notNull(x.textStyle)?x.textStyle:null===x.textStyle?null:b;this.glyph=a.notNull(x.glyph)?x.glyph:"?";if(this.src&&(a.isNull(this.width)||a.isNull(this.height))){var y=this,q=new Image;
q.src=this.src;q.onload=function(){a.isNull(y.width)&&(y.width=q.width);a.isNull(y.height)&&(y.height=q.height);y.origConfig&&(y.origConfig.width=q.width,y.origConfig.height=q.height)}}this.textOffset=x.textOffset?x.textOffset:null;this.showOnPoint=2;this.calculateSurrogates(x.glyph)},calculateSurrogates:function(a){if("U"===a.charAt(0)&&"+"===a.charAt(1)){a="0x"+a.substr(2,a.length-1);a=parseInt(a);var b=Math.floor((a-65536)/1024)+55296,b="0x"+b.toString(16);a="0x"+((a-65536)%1024+56320).toString(16);
b=String.fromCharCode(b);this.glyph=b+=String.fromCharCode(a)}},drawMarker:function(a,b,y,q){if(0!==this.width&&0!==this.height)return a=a.getGraphics().createTextNode(this.glyph,this.textStyle,y.x,y.y),b.appendChild(a),a}});a.Column=a.Class.extend({mixin:a.event.EventSource,initialize:function(b){this.keyGetter=b.keyGetter;this.valueGetter=b.valueGetter;this.valueType=b.type||"number";this.measureName=b.measureName||"Measure";this.measureIndex=a.isNull(b.measureIndex)?1:b.measureIndex;b=b.data;var x;
this.numRows=b.length;this.hash=[];this.min=Number.POSITIVE_INFINITY;this.max=Number.NEGATIVE_INFINITY;for(var y,q=0,k=b.length;q<k;q++)x=b[q],y=this.keyGetter.call(x),x=this.valueGetter.call(x,this.measureIndex),a.isNull(x)||(this.hash[y]=x,x<this.min&&(this.min=x),x>this.max&&(this.max=x))},getSize:function(){return this.numRows},getValueOfRow:function(b){return a.isNull(b)||a.isNull(this.hash)?null:this.hash[b]},getValueType:function(){return this.valueType},getMin:function(){return this.min},
getMax:function(){return this.max},getAverage:function(){return 0},getKeys:function(){return[]},getKeyNames:function(){},isMeasure:function(){return!0},getSampleData:function(a){},getMeasureName:function(){return this.measureName},getMeasureIndex:function(){return this.measureIndex}});a.Feature=a.Class.extend({mixin:a.event.EventSource,initialize:function(b,x,y){this.id=b;this.activeIdx=null;this.geo=x?x:null;this.geo instanceof a.geometry.Geometry||!this.geo||(this.geo=a.geometry.Geometry.createGeometry(this.geo,
this.geo.srid));this.shape=this.group=this.graphics=null;this.attributes=y&&a.notNull(y.attributes)?y.attributes:null;this.renderingStyle=y&&a.notNull(y.renderingStyle)?y.renderingStyle:null;this.label=y&&a.notNull(y.label)?y.label:null;this.labelStyle=y&&a.notNull(y.labelStyle)?y.labelStyle:null;this.labelStyleName=y&&a.notNull(y.labelStyleName)?y.labelStyleName:null;this.draggable=y&&a.notNull(y.draggable)?y.draggable:null;this.customContent=y&&a.notNull(y.customContent)?y.customContent:null;this.displayed=
!1;this.visible=!0;this.editable=!1;this.screenTransformObj=null;this.labelOffsetY=this.labelOffsetX=2;this.hover=this.selected=!1;this.tooltipNode=this.tooltipCache=null;this.scaleY=this.scaleX=1;if(this.attributes)for(var q in this.attributes)b=q.toUpperCase(),b!==q&&(this.attributes[b]=this.attributes[q],this.attributes[q]=null,delete this.attributes[q]);this.columnMap=null;this.tiledFeature=!1;this.tileGeometries={};this.clipMap={};this.zoomLevelsGeometries={};this.zoomLevelsGeomClipArea={}},
setGeometry:function(b){if(a.isNull(b))return!1;a.notNull(this.parentLayer)&&this.parentLayer.useRTree&&this.parentLayer.removeFromRtree(this);if(!this.displayed)return this.geo=b,this.screenPoints=null,!0;var x=this.geo.srid;if(b.srid!==x){var y=this;b.transform(x,function(a){y.setGeometry(a)});return!0}this.clearInfoWindow();this.geo=b;this.getShapeIndex();this.remove();this.screenPoints=null;x=this.parentLayer;b=[];var q=x.getFeatureStyles(this);q&&b.push(q);x.otherStyles&&(b=b.concat(x.otherStyles));
if(0===b.length)if(q=x.getDefaultRenderingStyle(this.geo.type))b.push(q);else return!1;b=this.getAllStyles(b);if(this.parentLayer.featureGroupArr&&0<this.parentLayer.featureGroupArr.length)for(this.shapeArray=[],x=0;x<this.parentLayer.featureGroupArr.length;x++){if(a.isNull(this.activeIdx)||this.activeIdx===x)this.group=this.parentLayer.featureGroupArr[x],this.displayFeature(b,-1),this.shapeArray[x]=this.labelShape}else this.displayFeature(b,-1);this.parentLayer.parentMap.wraparound&&this.parentLayer.refresh();
this.startAnimation();return!0},getGeometry:function(){var b=a.geometry.Geometry;this.geo instanceof b||!this.geo||(this.geo=b.createGeometry(this.geo,this.geo.srid));return this.geo},getAttributes:function(){return this.attributes},getAttributeValue:function(b){if("string"!==typeof b||!this.attributes)return null;var x=this.attributes,y=b.toUpperCase();return a.notNull(x[y])?x[y]:(b=this.getAliasColumnName(b))?(b=b.toUpperCase(),x[b]):null},hasAttributes:function(){return this.attributes?!0:!1},
getAliasColumnName:function(b){if("string"!==typeof b||!this.columnMap)return null;var x=this.columnMap;b=b.toUpperCase();return x&&a.notNull(x[b])?x[b]:null},getRealColumnName:function(a){if("string"!==typeof a)return null;var b=this.columnMap;a=a.toUpperCase();if(b)for(var y in b)if(b.hasOwnProperty(y)&&b[y].toUpperCase()===a)return y;return null},getAllStyles:function(b){for(var x=[],x=[],y=0;y<b.length;y++)a.notNull(b[y].animation)&&x.push(b[y].animation);return x=b.concat(x)},setRenderingStyle:function(b){if((!a.isNull(b)||
!a.isNull(this.parentLayer)&&!a.isNull(this.parentLayer.otherStyles)&&0!==this.parentLayer.otherStyles.length)&&this.renderingStyle!==b&&(this.renderingStyle=b,this.displayed)){this.getShapeIndex();var x=this;a.notNull(this.shape)&&this.shape.addEventListener(a.event.MouseEvent.MOUSE_OUT,function(a){try{a.target=x.shape,x.shape.dispatchEvent(a)}catch(b){}});this.remove();b=[b];this.parentLayer.otherStyles&&(b=b.concat(this.parentLayer.otherStyles));b=this.getAllStyles(b);if(this.parentLayer.featureGroupArr&&
0<this.parentLayer.featureGroupArr.length){this.shapeArray=[];for(var y=0;y<this.parentLayer.featureGroupArr.length;y++)if(a.isNull(this.activeIdx)||this.activeIdx===y)this.group=this.parentLayer.featureGroupArr[y],this.displayFeature(b,-1),this.shapeArray[y]=this.shape}else this.displayFeature(b,-1);this.setShapeIndex()}},getRenderingStyle:function(){return this.renderingStyle},setLabel:function(b){a.isNull(b)||(this.label=b,this.applyToolTip())},setLabelingStyle:function(b){a.isNull(b)||(this.labelStyle=
b)},getLabelingStyle:function(){return this.labelStyle},isVisible:function(){return this.visible},setVisible:function(b){if(!a.isNull(b))if(this.visible=b,this.displayed){var x=this.graphics;x.setVisible(this.shape,b);this.ghostShape&&x.setVisible(this.ghostShape,b);this.labelShape&&x.setVisible(this.labelShape,b)}else b&&this.displayFeature(this.renderingStyle)},bringForward:function(){this.parentLayer&&this.parentLayer.bringFeatureForward(this)},sendBackward:function(){this.parentLayer&&this.parentLayer.sendFeatureBackward(this)},
bringToTop:function(){this.parentLayer&&this.parentLayer.bringFeatureToTop(this)},sendToBottom:function(){this.parentLayer&&this.parentLayer.sendFeatureToBottom(this)},displayFeature:function(b,x,y){var q=this.geo,k=null,c=null;this.tiledFeature&&(k=this.parentLayer.parentMap.getMapContext(),c=k.getZoomLevel(),a.notNull(y)?this.geo=this.tileGeometries[y][this.id]:this.geo=this.getGeometry());var k=this.geo,u=this.typeIs(k);if((!this.editing||"OrientedPoint"!==u)&&b&&0!==b.length){var C=b[0];if(C&&
!(C instanceof a.style.Style)&&C.dataSource&&C.name){var G=this;b=C.url;a.isNull(b)&&(b=this.parentLayer.type===a.layer.VectorLayer.TYPE_JDBC||this.parentLayer.type===a.layer.VectorLayer.TYPE_PREDEFINED?this.parentLayer.serverURL:this.parentLayer.parentMap.mapviewerURL);a.style.StyleStore.getServerSideStyle(C.dataSource,C.name,{url:b,callback:function(a){G.displayFeature([a],x,y)}})}else{var C=this.graphics,R=this.renderingStyle&&this.renderingStyle.cased?this.parentLayer.getLineGroup():this.group,
X=this.screenTransformObj;if(!(a.isNull(C)||a.isNull(R)||a.isNull(k)||a.isNull(X))){1<b.length&&(X=C.createGroup(),R.appendChild(X),R=X);var X=b.length,N=[],r=null;a.notNull(y)&&a.notNull(this.clipMap)&&a.notNull(this.clipMap[y])&&(r=this.transformGeometry(this.clipMap[y]));for(var n=0;n<X;n++){var M=b[n],Z=M.styleType;if(M.showOnPoint)M.realWidth=null,M.realHeight=null,N.push(M);else{if("GeometryCollection"===u){var ba=this.zoomLevelsGeomClipArea["zoomlevel_"+c],Y=C.createGroup(),sa=Y;R.appendChild(Y);
for(var la=0,oa=k.geometries.length;la<oa;la++){var wa=this.transformGeometry(k.geometries[la]);a.isNull(y)&&this.tiledFeature&&(r=this.transformGeometry(ba[la]),Y=C.createGroup(),sa.appendChild(Y));a.notNull(r)&&Y.setClip([r.x,r.y,r.width+.5,r.height+.5]);M.draw(this,this.parentLayer.parentMap.getMapContext(),{group:Y,type:k.geometries[la].type,screenPoints:wa})}this.shape=sa}else ba=null,a.notNull(y)&&this.tiledFeature&&(ba=this.shape,a.isNull(ba)&&(ba=C.createGroup(),R.appendChild(ba)),R=C.createGroup(),
ba.appendChild(R)),a.notNull(r)&&R.setClip([r.x,r.y,r.width+.5,r.height+.5]),M.draw(this,this.parentLayer.parentMap.getMapContext(),{group:R,idx:x}),a.notNull(r)&&R.setClip(null),a.notNull(y)&&this.tiledFeature&&(this.shape=ba);"AnimationColor"!=Z&&"PulseAnimation"!=Z||!a.notNull(this.shape)||(this.animations=[],this.createAnimation(this.shape,M,"MultiLineString"==u||"LineString"==u))}}0<N.length&&(c=this.parentLayer.parentMap.getMapContext().getUniverse().getSRID(),a.notNull(y)&&this.tiledFeature?
(a.isNotNull(this.chartGroup)&&(this.chartGroup.parentNode&&this.chartGroup.parentNode.removeChild(this.chartGroup),this.chartGroup=null),this.chartGroup=C.createGroup(),R.appendChild(this.chartGroup),R=this.chartGroup,this.labelBox=null,this.createLabelBox(q),this.getPointPosition(N,this.labelBox,R,c,q)):(a.isNull(this.labelBox)&&this.createLabelBox(),this.getPointPosition(N,this.labelBox,R,c)));1<X&&(this.shape=R);this.displayed=!0;this.applyToolTip();this.ghostGeom&&(this.drawGhostGeom(this.ghostGeom,
b),this.drawGhostLabel(this.ghostGeom));if(this.shapeGroup&&!this.visible)for(n=1;n<this.shapeGroup.length;n++)this.graphics.setVisible(this.shapeGroup[n],!1);else this.shape&&!this.visible&&this.graphics.setVisible(this.shape,!1);this.ghostShape&&!this.visible&&this.graphics.setVisible(this.ghostShape,!1);this.resumeMoveAnimation();a.notNull(this.parentLayer)&&this.parentLayer.useRTree&&(this.tiledFeature?a.notNull(y)&&(this.parentLayer.addToRtree(this,k),this.parentLayer.updatedSearchWindow(this,
u)):(this.parentLayer.addToRtree(this),this.parentLayer.updatedSearchWindow(this,u)));this.tiledFeature&&(this.geo=q)}}}},getFeatureScreenPosition:function(){return this.featurePosition},transformGeometry:function(a){var b=this.parentLayer.parentMap.getMapContext().getTransform(),y=a.dim?a.dim:2,q=a.type,k=a.coordinates,c,u,C,G,R,X;if("Point"===q)c=b.toScreenPoint(k[0],k[1]);else if("OrientedPoint"===q)c=b.toScreenPoint(k[0],k[1]),u=k[y],C=k[y+1],u=-Math.atan2(C,u),c.angle=u;else if("MultiPoint"===
q||"OrientedMultiPoint"===q)for(c=[],G=0,X=k.length;G<X;G++)R=b.toScreenPoint(k[G][0],k[G][1]),"OrientedMultiPoint"===q&&(u=k[G][y],C=k[G][y+1],u=-Math.atan2(C,u),R.angle=u),c.push(R);else if("LineString"===q)c=(u=b.transformSegment(k,2,y))?[u]:null;else if("MultiLineString"===q)for(c=[],R=0,q=k.length;R<q;R++)(u=b.transformSegment(k[R],2,y))&&c.push([u]);else if("Polygon"==q)for(c=[],G=0,X=k.length;G<X;G++)(u=b.transformSegment(k[G],1,y))&&c.push(u);else if("MultiPolygon"===q)for(c=[],R=0,q=k.length;R<
q;R++){C=[];G=0;for(X=k[R].length;G<X;G++)(u=b.transformSegment(k[R][G],2,y))&&C.push(u);0<C.length&&c.push(C)}else"Rectangle"===q&&(R=b.toScreenPoint(k[0],k[3]),y=b.toScreenXLength(k[2]-k[0]),b=b.toScreenYLength(k[3]-k[1]),c={x:R.x,y:R.y,width:y,height:b});this.geo===a&&(this.screenPoints=c);return this.featurePosition=c},drawSinglePoint:function(a,b,y,q){var k={group:b,id:"pot"};y.angle&&(k.angle=y.angle);k.xOffset=q.xOffset;k.yOffset=q.yOffset;var c;q&&q.src?(k.enableCache=!0,c=a.drawImageMarker({x:y.x,
y:y.y},q,k)):q&&q.resolve&&(q.resolve(this),c=q.drawMarker(this.parentLayer.parentMap.getMapContext(),b,y,null));return c},drawRectangle:function(a,b,y,q,k){var c,u,C,G;if(!this.screenPoints||k)y=y.coordinates,u=this.screenTransformObj.toScreenPoint(y[0],y[3]),c=u.x,u=u.y,C=this.screenTransformObj.toScreenXLength(y[2]-y[0]),G=this.screenTransformObj.toScreenYLength(y[3]-y[1]),k||(this.screenPoints={x:c,y:u,width:C,height:G});C=a.drawRectangle({x:c,y:u,width:C,height:G},q,{group:b,id:"rec"});y=(this.geo.getMBR().getMinX()+
this.geo.getMBR().getMaxX())/2;G=(this.geo.getMBR().getMinY()+this.geo.getMBR().getMaxY())/2;y=this.screenTransformObj.toScreenPoint(y,G);this.parentLayer.leadLine&&(this.line=a.drawPath([[c,u,y.x,y.y]],q,{group:b}),this.line.feature=this);k||(this.shape=C);return C},remove:function(){var a=this.shape;if(a){this.graphics.remove(a);this.shape=null;if(this.shapeGroup)for(var a=this.shapeGroup.length,b=0;b<a;b++)this.shapeGroup[b]&&this.graphics.remove(this.shapeGroup[b]);this.shapeGroup=null;if(this.shapeArray){a=
this.shapeArray.length;for(b=0;b<a;b++)this.shapeArray[b]&&(this.shapeArray[b].feature=null,this.graphics.remove(this.shapeArray[b]));this.shapeArray=null}}},typeIs:function(b){var x=a.geometry;return b instanceof x.Circle?"Circle":b instanceof x.Rectangle?"Rectangle":b.type},move:function(b,x,y){var q=this.parentLayer;a.notNull(q)&&q.removeFromRtree(this);b=-b;var k,c;if(this.displayed){c=this.geo.type;if("GeometryCollection"!=c){var u=this.screenPoints;k=c;if("Point"==k||"OrientedPoint"==k||"Rectangle"==
k)u.x+=b,u.y-=x;else if("MultiPoint"==k||"OrientedMultiPoint"==k){var C=u.length;for(k=0;k<C;k++)u[k].x+=b,u[k].y-=x}else a.util.GeomUtil.moveCoordinates(u,b,-x,null,null,this.parentLayer.parentMap.getMapContext())}b*=y.resolution;u=x*y.resolution*y.stretchRatio;if(this.geo instanceof a.geometry.Geometry)this.geo.move(b,u,this.parentLayer.parentMap.getMapContext());else if("GeometryCollection"!=c)a.util.GeomUtil.moveCoordinates(this.geo.coordinates,b,u,"OrientedPoint"==c||"OrientedMultiPoint"==c?
!0:!1,this.geo.dim,this.parentLayer.parentMap.getMapContext());else for(k=this.geo.geometries,y=k.length,x=0;x<y;x++)c=k[x].type,c="OrientedPoint"==c||"OrientedMultiPoint"==c?!0:!1,a.util.GeomUtil.moveCoordinates(k[x].coordinates,b,u,c,k[x].dim,this.parentLayer.parentMap.getMapContext());this.labelBox&&(this.labelBox=[this.labelBox[0]+b,this.labelBox[1]+u,this.labelBox[2]+b,this.labelBox[3]+u]);a.notNull(q)&&q.addToRtree(this);return this.geo}},addLabel:function(b){if(this.displayed&&this.parentLayer){if(!this.label){if(!this.attributes)return;
this.label=this.parentLayer.labelColumn?this.attributes[this.parentLayer.labelColumn.toUpperCase()]:this.attributes._LABEL_}if(this.label){var x=this.getLabelingStyle();a.isNull(x)&&(x=a.style.StyleStore.defaulTextStyle,this.setLabelingStyle(x));var y=this.geo.type;if(a.notNull(x))if(x.resolve(this),a.style.Style.calculateStyleSize(this.labelStyle,this.parentLayer.parentMap.getMapContext()),"Point"==y||"OrientedPoint"==y)this.addPointLabel(b);else if("Polygon"==y||"MultiPolygon"==y){if(this.addPolygonLabel(b),
!this.labelShape&&(b=this.parentLayer.createShadowGeometry(this)))this.drawGhostGeom(b,[this.renderingStyle]),this.drawGhostLabel(b)}else"LineString"!=y&&"MultiLineString"!=y||this.addLineLabel(b);else a.util.Logger.warning(null,"Feature","No labeling style present for feature")}}},addPointLabel:function(b){var x=this.graphics.getTextSize(this.label,this.labelStyle);x.w=parseInt(x.w)-2;x.h=parseInt(x.h)-4;var y=this.screenPoints.x,q=this.screenPoints.y,k=this.markerSize?this.markerSize.w:this.renderingStyle.width,
c=this.markerSize?this.markerSize.h:this.renderingStyle.height;a.isNull(k)&&!a.isNull(this.markerWidth)&&(k=this.markerWidth);a.isNull(c)&&!a.isNull(this.markerHeight)&&(c=this.markerHeight);var u;"OrientedPoint"===this.geo.type&&(u=-Math.atan2(this.geo.getOrientationY(),this.geo.getOrientationX()));var C={},G=y-k/2-this.labelOffsetX,R=G-x.w,X=q-x.h/2,N=q+x.h/2;C.L=[R,X,G,N];u&&(0>=u&&u>=-Math.PI/2&&(R=y-(k/2+this.labelOffsetX+x.w)*Math.cos(-u),X=q+(k/2+this.labelOffsetX)*Math.sin(-u),G=y-(k/2+this.labelOffsetX)*
Math.cos(-u),N=q+(k/2+this.labelOffsetX+x.w)*Math.sin(-u),C.L=[R,X,G,N],C.LL=[R,N]),u>=-Math.PI&&u<-Math.PI/2&&(R=y+(k/2+this.labelOffsetX)*Math.cos(Math.PI+u),X=q+(k/2+this.labelOffsetX)*Math.sin(Math.PI+u),G=y+(k/2+this.labelOffsetX+x.w)*Math.cos(Math.PI+u),N=q+(k/2+this.labelOffsetX+x.w)*Math.sin(Math.PI+u),C.L=[R,X,G,N],C.LL=[R,X]),u<=Math.PI&&u>=Math.PI/2&&(R=y+(k/2+this.labelOffsetX)*Math.cos(Math.PI-u),X=q-(k/2+this.labelOffsetX+x.w)*Math.sin(Math.PI-u),G=y+(k/2+this.labelOffsetX+x.w)*Math.cos(Math.PI-
u),N=q-(k/2+this.labelOffsetX)*Math.sin(Math.PI-u),C.L=[R,X,G,N],C.LL=[R,N]),u<Math.PI/2&&0<u&&(R=y-(k/2+this.labelOffsetX+x.w)*Math.cos(u),X=q-(k/2+this.labelOffsetX+x.w)*Math.sin(u),G=y-(k/2+this.labelOffsetX)*Math.cos(u),N=q-(k/2+this.labelOffsetX)*Math.sin(u),C.L=[R,X,G,N],C.LL=[R,X]));R=y+k/2+this.labelOffsetX;G=R+x.w;C.R=[R,X,G,N];u&&(0>=u&&u>=-Math.PI/2&&(R=y+(k/2+this.labelOffsetX)*Math.cos(-u),X=q-(k/2+this.labelOffsetX+x.w)*Math.sin(-u),G=y+(k/2+this.labelOffsetX+x.w)*Math.cos(-u),N=q-(k/
2+this.labelOffsetX)*Math.sin(-u),C.R=[R,X,G,N],C.RR=[R,N]),u>=-Math.PI&&u<-Math.PI/2&&(R=y-(k/2+this.labelOffsetX+x.w)*Math.cos(u+Math.PI),X=q-(k/2+this.labelOffsetX+x.w)*Math.sin(u+Math.PI),G=y-(k/2+this.labelOffsetX)*Math.cos(u+Math.PI),N=q-(k/2+this.labelOffsetX)*Math.sin(u+Math.PI),C.R=[R,X,G,N],C.RR=[R,X]),u<=Math.PI&&u>=Math.PI/2&&(R=y-(k/2+this.labelOffsetX+x.w)*Math.cos(Math.PI-u),X=q+(k/2+this.labelOffsetX)*Math.sin(Math.PI-u),G=y-(k/2+this.labelOffsetX)*Math.cos(Math.PI-u),N=q+(k/2+this.labelOffsetX+
x.w)*Math.sin(Math.PI-u),C.R=[R,X,G,N],C.RR=[R,N]),u<Math.PI/2&&0<u&&(R=y+(k/2+this.labelOffsetX)*Math.cos(u),X=q+(k/2+this.labelOffsetX)*Math.sin(u),G=y+(k/2+this.labelOffsetX+x.w)*Math.cos(u),N=q+(k/2+this.labelOffsetX+x.w)*Math.sin(u),C.R=[R,X,G,N],C.RR=[R,X]));R=y-x.w/2;G=R+x.w;N=q-c/2-this.labelOffsetY;X=N-x.h;C.T=[R,X,G,N];R=y-x.w/2;G=R+x.w;X=q+c/2+this.labelOffsetY;N=X+x.h;C.B=[R,X,G,N];q=a.gv.labelDisplayOrder;y=a.gv.orientedLabelDisplayOrder;if(u)for(q=0;q<y.length&&(x=C[y[q]],G=C[y[q]+y[q]],
!this.addLabelNode(b,x,G[0],G[1],{angle:u,w:k,h:c}));q++);else for(k=0;k<q.length&&(x=C[q[k]],!this.addLabelNode(b,x,x[0],x[3]-1));k++);},createLabelBox:function(b){var x=null;if(x=a.notNull(b)?b.getMIR():this.getGeometry().getMIR())this.labelBox=[x.getMinX(),x.getMinY(),x.getMaxX(),x.getMaxY()]},addPolygonLabel:function(a){this.labelBox||this.createLabelBox();if(this.labelBox){var b=this.graphics.getTextSize(this.label,this.labelStyle),y=0<this.label.indexOf("\n")?!0:!1;b.w=parseInt(b.w)-2;b.h=parseInt(b.h)-
4;var q=this.screenTransformObj.toScreenPoint((this.labelBox[0]+this.labelBox[2])/2,(this.labelBox[1]+this.labelBox[3])/2),k=q.x,c=q.y,u=k-b.w/2,C=k+b.w/2,q=c-b.h/2,G=c+b.h/2,R=this.screenTransformObj.toScreenPoint(this.labelBox[0],this.labelBox[1]),X=this.screenTransformObj.toScreenPoint(this.labelBox[2],this.labelBox[3]),N=X.x-R.x,R=R.y-X.y;this.labelStyle.sticky&&(N*=3,R*=1.5);if(!(b.h>R||(b.w<=N&&b.h<=R&&!y&&(C=[u-5,q-5,C+5,G+5],this.addLabelNode(a,C,u,G-1),this.labelShape&&(this.labelShape.feature=
this)),this.labelShape))){u=this.label.split(" ");C=G=0;for(X=u.length;C<X;C++)b=this.graphics.getTextSize(u[C],this.labelStyle),b.w>G&&(G=b.w);if(G>N)if(this.labelStyle.sticky&&y)N*=3,R*=1.5;else return;y=this.graphics.createTextBlock(this.label,this.labelStyle,k,c,N);y.h>R||(C=[k-y.w/2-5,q-5,k+y.w/2+5,q+y.h+5],a.conflicts(C)||(a.insert(C),y.node.translate(0,(b.h-y.h)/2),this.parentLayer.labelGroup.appendChild(y.node),this.labelShape=y.node,this.labelShape.feature=this))}}},addLineLabel:function(a){var b,
y,q;if(this.labelStyle&&"Marker"==this.labelStyle.styleType){b=this.labelStyle.width/2;y=this.labelStyle.height/2;q=4*Math.max(b,y);q=this.getLabelMarkerPos(q);for(var k=0,c=q?3<q.length?3:q.length:0;k<c;k++)this.addMarkerLabelNode(a,[q[k].x-b,q[k].y-y,q[k].x+b,q[k].y+y],q[k])}else y=this.graphics.getTextSize(this.label,this.labelStyle),b=y.w/2,y=y.h/2-2,q=4*Math.max(b,y),this.getLineTextPos(q,b,y,a)},addLabelNode:function(b,x,y,q,k){k&&k.angle&&(x=[x[0]+3,x[1]+3,x[2],x[3]]);if(b.conflicts(x))return!1;
var c,u=this.label,C=0;k&&k.angle?(c=new this.graphics.oui.geom.Matrix,C=k.angle,k.angle>=-Math.PI&&k.angle<-Math.PI/2&&(C=k.angle+Math.PI,u=this.label.split(" ").reverse().join(" ")),k.angle<Math.PI&&k.angle>=Math.PI/2&&(C=k.angle-Math.PI,u=this.label.split(" ").reverse().join(" ")),c.rotate(C,y,q)):k&&k.transform&&(c=k.transform);0<=u.indexOf("\n")?(u=x[3]-x[1],y+=(x[2]-x[0])/2,y=this.graphics.createTextBlock(this.label,this.labelStyle,y,q-u/2).node):y=this.graphics.createTextNode(u,this.labelStyle,
y,q);a.notNull(c)&&y.applyStyle({transform:c});b.insert(x);k&&k.group?k.group.appendChild(y):(this.parentLayer.labelGroup.appendChild(y),this.labelShape=y);return!0},addMarkerLabelNode:function(a,b,y){if(a.conflicts(b))return!1;this.labelShape=this.graphics.createGroup();this.parentLayer.labelGroup.appendChild(this.labelShape);this.labelShape.feature=this;this.labelShape.applyStyle({cursor:this.parentLayer.mouseCursor});this.drawSinglePoint(this.graphics,this.labelShape,y,this.labelStyle);if(null!==
this.labelStyle.textStyle){var q=this.graphics.getTextSize(this.label,{});y=this.graphics.createTextNode(this.label,this.labelStyle.textStyle,y.x-q.w/2,y.y+q.h/2-2);this.labelShape.appendChild(y);a.insert(b)}return!0},getTip:function(){if("string"===typeof this.id&&0===this.id.indexOf("_mul"))return null;var b=this.parentLayer;return!a.isNull(b)&&b.showToolTip?b.toolTipCustomizer?(b=b.toolTipCustomizer(this),"string"===typeof b?b+"":b):this.label?this.label+"":b.labelColumn&&a.notNull(this.attributes)&&
a.notNull(this.attributes[b.labelColumn.toUpperCase()])?this.attributes[b.labelColumn.toUpperCase()]+"":this.attributes&&a.notNull(this.attributes._LABEL_)?this.attributes._LABEL_+"":null:null},applyToolTip:function(){if(this.displayed){var b;b=this.getTip();"string"!==typeof b?a.isNull(this.tooltipCache)||this.tooltipCache.toString()!=b.toString()?(this.tooltipCache=b,this.tooltipNode=b=this.buildVaTooltip(b)):b=this.tooltipNode:a.isNull(this.tooltipNode)||this.tooltipNode!=b?this.tooltipNode=b:
b=this.tooltipNode;if(this.shapeGroup)for(var x=0;x<this.shapeGroup.length;x++)!b||this.renderingStyle&&this.renderingStyle.enableHighlight||this.shapeGroup[x].applyStyle({tooltip:b}),this.shapeGroup[x].feature=this;else this.shape&&(!b||this.renderingStyle&&this.renderingStyle.enableHighlight||this.shape.applyStyle({tooltip:b}),this.shape.feature=this)}},buildVaTooltip:function(b){var x=this.graphics;a.isNull(x)&&(x=this.parentLayer.parentMap.getMapContext().getGraphics());var y=x.createGroup({opacity:1,
visibility:"visible"}),q,k,c;if(a.isNull(b)||a.isNull(b.titlesArray)||a.isNull(b.headersArray)||a.isNull(b.contentsArray))return null;q=b.titlesArray;k=b.headersArray;c=b.contentsArray;Array.isArray(q)||(q=[],q.push(b.title));Array.isArray(k)||(k=[],k.push(b.title));Array.isArray(c)||(c=[],c.push(b.title));if(c.length!==k.length)return null;var u=x.getInnerTooltipStyle(),C=u.titleStyle;b=u.headerStyle;for(var u=u.contentStyle,G={hAlign:b.hAlign},R={hAlign:u.hAlign},x=x.oui.load({name:"mainVBox",type:"vbox",
children:[{name:"titleBox",type:"hbox",layout:{hAlign:C.hAlign}},{name:"headerAndContentBox",type:"hbox",children:[{name:"headerBox",type:"vbox"},{name:"contentBox",type:"vbox"}]}]}),X=0,N=q.length;X<N;X++)x.titleBox.load([{type:"text",textValue:q[X]+" ",fontWeight:C.fontWeight,fontFamily:C.fontFamily,fontStyle:C.fontStyle,fontSize:C.fontSize,fill:C.fill}]);q=0;for(C=k.length;q<C;q++)x.headerAndContentBox.headerBox.load([{type:"text",textValue:k[q]+" ",fontWeight:b.fontWeight,fontFamily:b.fontFamily,
fontStyle:b.fontStyle,fontSize:b.fontSize,fill:b.fill,layout:G}]),x.headerAndContentBox.contentBox.load([{type:"text",textValue:c[q]+" ",fontWeight:u.fontWeight,fontFamily:u.fontFamily,fontStyle:u.fontStile,fontSize:u.fontSize,fill:u.fill,layout:R}]);y.appendChild(x);return y},createAnimation:function(a,b,y){if(a.hasChildNodes())for(a=a.firstChild;a;)this.createAnimation(a,b,y),a=a.nextSibling;else Array.prototype.push.apply(this.animations,b.createAnimation(a,this.graphics,y))},startAnimation:function(){if(this.animations)for(var a=
this.animations.length,b=0;b<a;b++)this.animations[b].beginAt(0)},stopAnimation:function(){if(this.animations)for(var a=this.animations.length,b=0;b<a;b++)this.animations[b].endAt(0)},clearAnimation:function(){if(this.animations)for(var a=this.animations.length,b=0;b<a;b++)this.animations[b].unplug(),this.animations[b].endAt(0)},animateToNewLocation:function(b,x){if(this.moveAnimation)this.stopMoveAnimation();else{this.originalGeo=this.geo;var y=b.coordinates,q,k,c;if("Point"==b.type||"OrientedPoint"==
b.type)this.movePoints=[y[0],y[1]];else if("MultiPoint"==b.type||"OrientedMultiPoint"==b.type){q=y.length;k=[];for(c=0;c<q;c++)k=k.concat(y[c][0],y[c][1]);this.movePoints=k}else if("LineString"==b.type||"MultiLineString"==b.type){q=y.length;k=[];for(c=0;c<q;c++)k.push(y[c]);this.movePoints=k}y=1;try{var u=this.parentLayer.parentMap,C=u.getMapContext(),G=C.getUniverse(),R=C.getZoomLevel();if(G&&G.zoomLevels)var R=u.checkZoomLevel(R),X=G.zoomLevels[R].resolution,N=G.zoomLevels[R].stretchRatio,y=Math.sqrt(Math.pow(X,
2)+Math.pow(X*N,2))/2}catch(r){}(this.movePoints=a.util.GeomUtil.simplifyCoordinates(this.movePoints,y))&&2<=this.movePoints.length&&(this.moveTime=x&&a.notNull(x.time)?x.time:300,this.moveLoop=x&&x.loop,this.moveBound=x&&x.bounce,this.moveOriented="OrientedPoint"===this.geo.type?!0:!1,this.moveStep=x&&x.step?x.step:5,this.animateToNewPoint(0))}},animateToNewPoint:function(b){var x=this.movePoints[b],y=this.movePoints[b+1];this.currentTarget=b;if(this.displayed&&this.shape){var q=this.screenPoints,
k=this.screenTransformObj.toScreenPoint(x,y);b=k.x-q.x;k=k.y-q.y;if(Math.abs(b)<=this.moveStep&&Math.abs(k)<=this.moveStep)this.movePoints&&!this.reverse&&this.movePoints.length>=this.currentTarget+4?this.animateToNewPoint(this.currentTarget+2):this.movePoints&&this.reverse&&0<this.currentTarget?this.animateToNewPoint(this.currentTarget-2):(this.geo=this.moveOriented?new a.geometry.Point(x,y,this.geo.srid,this.geo.coordinates[2],this.geo.coordinates[3]):new a.geometry.Point(x,y,this.geo.srid),this.finishAnimation());
else{var c;if(this.moveOriented){this.geo=new a.geometry.Point(this.geo.getX(),this.geo.getY(),this.geo.srid,b,-k);var u=this.parentLayer;c=u.getFeatureStyles(this);if(a.notNull(this.animations)&&0<this.animations.length){this.screenPoints=null;for(var C={},G=0;G<this.animations.length;G++){var R=this.animations[G].getTargetNode();a.notNull(R)&&(C[R.parentNode._id]=R.parentNode._id)}G=new this.graphics.oui.geom.Matrix;a.style.Style.calculateStyleSize(c,u.parentMap.getMapContext());for(var X,u=0;u<
this.shape.childrenCount;u++)if(R=this.shape.getChildAt(u),a.isNull(C[R._id])){X=R;break}C=X.getLocalBounds();G.rotate(Math.atan2(k,b),C.x+c.realWidth/2,C.y+c.realHeight/2);X.setTransformMatrix(G);this.displayed=!0}else this.remove(),this.screenPoints=null,c.draw(this,this.parentLayer.parentMap.getMapContext(),{group:this.group}),this.displayed=!0,this.applyToolTip()}c=this.shape._style;X=q.x;if(c.width||c.x)X-=c.width/2+c.x;q=q.y;if(c.height||c.y)q-=c.height/2+c.y;this.moveAnimationDef={startX:X,
startY:q,endX:X+b,endY:q+k,moveX:b,moveY:k};q=Math.sqrt(b*b+k*k)/10*this.moveTime/1E3;c=this.shape.getTransformMatrix();X=c.clone();this.moveOriented?(this.moveAnimationDef.angleInRadius=Math.atan2(k,b),1!=this.scaleX&&1!=this.scaleY?(C=this.renderingStyle.realWidth/2,G=this.renderingStyle.realHeight/2,X.rotate(-this.moveAnimationDef.angleInRadius,C,G),X.translate(b/this.scaleX,k/this.scaleY),X.rotate(this.moveAnimationDef.angleInRadius,C,G)):1===c.a&&0===c.b&&0===c.c&&1===c.d?X.translate(b,k):(this.dis=
Math.sqrt(b*b+k*k),X.translate(this.dis,0))):X.translate(b/this.scaleX,k/this.scaleY);this.moveAnimation=new this.graphics.oui.anim.AnimateStyle({targetNode:this.shape,dur:q,animValues:{transform:{beginValue:c,endValue:X,interpolator:function(a,b,x){var y=a.tx,y=(b.tx-y)*x+y,k=a.ty;x=(b.ty-k)*x+k;a=a.clone();a.tx=y;a.ty=x;a.b=b.b;a.c=b.c;a.a=b.a;a.b=b.b;return a}}}});this.moveAnimation.beginAt(0);var N=this;this.moveAnimation.addEventListener(this.graphics.oui.SyncEvents.END,function(){if(!a.isNull(N.moveAnimation)){var b=
N.moveAnimationDef,k=0,c=0,q;if(a.notNull(N.progress)){k=parseInt(b.moveX*N.progress);c=parseInt(b.moveY*N.progress);if(0!==k||0!==c)q=b.startX+k,b=b.startY+c,N.shape&&N.moveOriented&&(new N.graphics.oui.geom.Matrix).translate(q,b),N.parentLayer&&N.parentLayer.parentMap&&N.screenTransformObj&&(q=N.parentLayer.parentMap.getMapContext(),q=q.getUniverse().getZoomLevels(0)[q.getZoomLevel()],b=N.getGeometry(),k=b.getX()+k*q.resolution,c=b.getY()-c*q.resolution*q.stretchRatio,N.moveOriented?(q=N.moveAnimationDef.angleInRadius,
q=N.getOrientation(q),N.geo=new a.geometry.Point(k,c,N.geo.srid,q.x,q.y)):N.geo=new a.geometry.Point(k,c,N.geo.srid),N.screenPoints=N.screenTransformObj.toScreenPoint(N.geo.getX(),N.geo.getY()));N.progress=null}else N.screenTransformObj&&(N.screenPoints=N.screenTransformObj.toScreenPoint(x,y)),N.moveOriented?(q=N.moveAnimationDef.angleInRadius,N.screenPoints.angle=q,q=N.getOrientation(q),N.geo=new a.geometry.Point(x,y,N.geo.srid,q.x,q.y)):N.geo=new a.geometry.Point(x,y,N.geo.srid),N.moveAnimation=
null,N.movePoints&&!N.reverse&&N.movePoints.length>=N.currentTarget+4?N.animateToNewPoint(N.currentTarget+2):N.movePoints&&N.reverse&&0<N.currentTarget?N.animateToNewPoint(N.currentTarget-2):N.finishAnimation()}})}}},finishAnimation:function(){if((this.moveLoop||this.moveBound)&&4<=this.movePoints.length)if(this.moveBound)(this.reverse=!this.reverse)?this.animateToNewPoint(this.movePoints.length-2):this.moveLoop?this.animateToNewPoint(2):this.currentTarget=this.moveTime=this.movePoints=null;else{var b=
this.screenTransformObj.toScreenPoint(this.movePoints[0],this.movePoints[1]),x=b.x-this.screenPoints.x,y=b.y-this.screenPoints.y;this.screenPoints.angle&&this.shape.rotate(180*-this.screenPoints.angle/Math.PI,12.5,5);this.shape.translate(x/this.scaleX,y/this.scaleY);this.screenPoints=b;this.screenPoints.angle=0;this.geo=new a.geometry.Point(this.movePoints[0],this.movePoints[1],this.geo.srid);this.animateToNewPoint(2)}else this.currentTarget=this.moveTime=this.movePoints=null},pauseMoveAnimation:function(){if(this.displayed&&
this.shape&&this.moveAnimation){var a=this.moveAnimation._progress(),b=this.graphics.getLeftTop(this.shape);this.shape.stopPos=b;this.moveAnimation.endAt(0,!1);this.progress=a}},resumeMoveAnimation:function(){this.movePoints&&a.notNull(this.currentTarget)&&this.animateToNewPoint(this.currentTarget)},stopMoveAnimation:function(){this.pauseMoveAnimation();this.moveAnimation=this.currentTarget=this.moveTime=null;a.notNull(this.originalGeo)&&this.setGeometry(this.originalGeo);this.progress=this.movePoints=
this.originalGeo=null},getOrientation:function(a){var b=0,y=0,y=Math.PI/2;a>-y&&a<y?(b=1,y=b*Math.tan(a)):a>y||a<-y?(b=1,y=b*Math.tan(a)):y=a==y?1:-1;return{x:b,y:y}},getPointPosition:function(b,x,y,q,k){var c=null,c=a.notNull(k)?k.type:this.geo.type;this.tiledFeature&&"GeometryCollection"===c&&(c=this.parentLayer.getFeatureGeometryType());if("LineString"!==c&&"MultiLineString"!==c){var u,C,G,R=b.length,X=this.parentLayer.parentMap.getMapContext();if("Point"===c||"MultiPoint"===c||"OrientedPoint"===
c||"OrientedMultiPoint"===c)for(u=0;u<R;u++)if(1===b[u].showOnPoint){q=this.geo;this.tiledFeature&&a.notNull(k)&&"GeometryCollection"===k.type&&(q=k.geometries[0]);x=this.transformGeometry(q);if("MultiPoint"===q.type||"OrientedMultiPoint"===q.type)x=x[0];b[u].draw(this,this.parentLayer.parentMap.getMapContext(),{group:y,sPoint:x})}else b[u].draw(this,this.parentLayer.parentMap.getMapContext(),{group:y});else if(!a.isNull(x))if(2>R)C=(x[0]+x[2])/2,G=(x[1]+x[3])/2,x=new a.geometry.Point(C,G,q),x=this.transformGeometry(x),
b[0].draw(this,X,{group:y,sPoint:x});else{var N=0,r=0,n=0;for(u=c=0;u<R;u++){a.style.Style.calculateStyleSize(b[u],this.parentLayer.parentMap.getMapContext());var N=N+b[u].realWidth,r=r+b[u].realHeight,M=b[u].realWidth*b[u].realHeight;M>n&&(n=M,c=u)}u=X.getUniverse().getZoomLevels()[X.getZoomLevel()];var M=(x[2]-x[0])/u.resolution,Z=(x[3]-x[1])/u.resolution/u.stretchRatio,n=0,ba;N<=M?(ba="H",n=(M-N)/(R+1)):r<=Z?(ba="V",n=(Z-r)/(R+1)):ba=N-M>r-Z?"V":"H";R=[];a.$.extend(!0,R,x);"H"==ba?(N=b[c].realWidth/
2*u.resolution,C=M>b[c].realWidth?x[0]+N+n*u.resolution:(x[0]+x[2])/2-N,G=(x[1]+x[3])/2,R[0]=C+N):"V"==ba&&(N=b[c].realHeight/2*u.resolution*u.stretchRatio,G=Z>b[c].realHeight?x[1]+N+n*u.resolution:(x[1]+x[3])/2-N,C=(x[0]+x[2])/2,R[1]=G+N);x=new a.geometry.Point(C,G,q);x=this.transformGeometry(x);b[c].draw(this,X,{group:y,sPoint:x});this.displayed=!0;this.applyToolTip();b.splice(c,1);this.getPointPosition(b,R,y,q,k)}}},enableFeatureEditing:function(b){if(this.editable!=b&&!(this.geo instanceof a.geometry.Circle)){if("Rectangle"===
this.geo.type){var x=this.geo.coordinates[0],y=this.geo.coordinates[1],c=this.geo.coordinates[2],k=this.geo.coordinates[3];this.geo=new a.geometry.Polygon([[x,y,c,y,c,k,x,k,x,y]])}(this.editable=b)?(this.startDrag||(b=new a.layer.EditableFeature,this.init=b.init,this.startDrag=b.startDrag,this.featureDragging=b.featureDragging,this.endDrag=b.endDrag,this.addEditProperties=b.addEditProperties,this.startEditing=b.startEditing,this.endEditing=b.endEditing,this.deleteEditingProperties=b.deleteEditingProperties,
this.shapePointMoved=b.shapePointMoved,this.possiblePointMoved=b.possiblePointMoved,this.deleteShapePoint=b.deleteShapePoint,this.featurePointMoved=b.featurePointMoved,this.showContextMenu=b.showContextMenu,this.shapePointMoving=b.shapePointMoving,this.possiblePointMoving=b.possiblePointMoving,this.featurePointMoving=b.featurePointMoving,this.calRelatedFeature=b.calRelatedFeature,this.setParentThat=b.setParentThat,this.addResizeHandles=b.addResizeHandles,this.calDistance=b.calDistance,this.isEditProperties=
b.isEditProperties,this.focusProperties=b.focusProperties,this.registerUpdate=b.registerUpdate,this.init(),this.setParentThat(this)),this.startEditing()):(this.setParentThat(this),this.endEditing(),this.relatedFeature=this.edit=null,this.parentLayer.parentMap.enableMapDrag(!0))}},enableFeatureDragging:function(b){this.draggable&&(b=new a.layer.EditableFeature,this.init=b.init,this.startDrag=b.startDrag,this.featureDragging=b.featureDragging,this.endDrag=b.endDrag,this.addEditProperties=b.addEditProperties,
this.startEditing=b.startEditing,this.endEditing=b.endEditing,this.deleteEditingProperties=b.deleteEditingProperties,this.shapePointMoved=b.shapePointMoved,this.possiblePointMoved=b.possiblePointMoved,this.deleteShapePoint=b.deleteShapePoint,this.featurePointMoved=b.featurePointMoved,this.showContextMenu=b.showContextMenu,this.shapePointMoving=b.shapePointMoving,this.possiblePointMoving=b.possiblePointMoving,this.featurePointMoving=b.featurePointMoving,this.calRelatedFeature=b.calRelatedFeature,this.setParentThat=
b.setParentThat,this.addResizeHandles=b.addResizeHandles,this.calDistance=b.calDistance,this.isEditProperties=b.isEditProperties,this.focusProperties=b.focusProperties,this.registerUpdate=b.registerUpdate,this.init(),this.setParentThat(this))},isEditable:function(){return this.editable},clone:function(){var b={};a.$.extend(!0,b,this.geo);var x={};a.$.extend(!0,x,this.attributes);b=this.text?new a.TextFeature(this.id,b,this.text,this.renderingStyle):new a.Feature(this.id,b,{attributes:x,renderingStyle:this.renderingStyle,
label:this.label,labelStyle:this.labelStyle,labelStyleName:this.labelStyleName});this.columns&&(b.columns={},a.$.extend(!0,b.columns,this.columns));!this.renderingStyle&&this.styleName&&(b.styleName=this.styleName);this.mapping&&(b.mapping=!0);return b},clearInfoWindow:function(){var a=this.parentLayer.parentMap;a.infoLayer&&a.infoLayer.deleteInfoWindows()},getLabelMarkerPos:function(b){if(!this.parentLayer.mask){var x=this.parentLayer.parentMap.getMapContext(),y=x.getCenterPoint(),x=x.getDeviceWindow(),
y=this.screenTransformObj.toScreenPoint(y.getX(),y.getY());this.parentLayer.mask={minX:y.x-x.w,minY:y.y-x.h,maxX:y.x+x.w,maxY:y.y+x.h}}if(this.screenPoints&&(y="LineString"==this.geo.type?a.util.GeomUtil.clipLine(this.parentLayer.mask,[this.screenPoints]):a.util.GeomUtil.clipLine(this.parentLayer.mask,this.screenPoints),0<y.length))return a.util.GeomUtil.getPointByPercent(y,.5,b)},getLineTextPos:function(b,x,y,c){if(!this.parentLayer.mask){var k=this.parentLayer.parentMap.getMapContext(),O=k.getCenterPoint(),
k=k.getDeviceWindow(),O=this.screenTransformObj.toScreenPoint(O.getX(),O.getY());this.parentLayer.mask={minX:O.x-k.w,minY:O.y-k.h,maxX:O.x+k.w,maxY:O.y+k.h}}if(this.screenPoints){O="LineString"==this.geo.type?a.util.GeomUtil.clipLine(this.parentLayer.mask,[this.screenPoints]):a.util.GeomUtil.clipLine(this.parentLayer.mask,this.screenPoints);this.labelShape=this.graphics.createGroup();this.parentLayer.labelGroup.appendChild(this.labelShape);for(var k=[],u=O.length,C,G=0;G<u;G++){C=a.util.GeomUtil.getScreenLength(O[G]);
for(var R=!1,X=0,N=k.length;X<N;X++)if(C>k[X].len){R=!0;k.splice(X,0,{idx:G,len:C});break}R||k.push({idx:G,len:C})}G=u=0;for(R=k.length;G<R&&(X=O[k[G].idx],C=k[G].len,C<b/2||(this.testLabelByPercent(X,C,.5,x,y,c)?u++:this.testLabelByPercent(X,C,.4,x,y,c)?u++:this.testLabelByPercent(X,C,.6,x,y,c)&&u++,!(3<u)));G++);return!!u}return!1},testLabelByPercent:function(b,x,y,c,k,O){y=a.util.GeomUtil.getPointByLength(x*y,b);var u=y.pos,C,G;if(y.len>2*c){x=(b[u]+b[u+2])/2;y=(b[u+1]+b[u+3])/2;b=-Math.atan2(b[u+
1]-b[u+3],b[u+2]-b[u]);if(b<-Math.PI/2||b>=Math.PI/2)b+=Math.PI;var R=new this.graphics.oui.geom.Matrix;R.rotate(b,x,y);G=[x-c,y-k,x+c,y+k];G=R.transformAll([G[0],G[1],G[0],G[3],G[2],G[3],G[2],G[1]]);b=Math.ceil(Math.min(G[0],G[2],G[4],G[6]));C=Math.floor(Math.max(G[0],G[2],G[4],G[6]));u=Math.ceil(Math.min(G[1],G[3],G[5],G[7]));G=Math.floor(Math.max(G[1],G[3],G[5],G[7]));G=[b,u,C,G];return this.addLabelNode(O,G,x-c,y+k,{transform:R,group:this.labelShape})}R=a.util.GeomUtil;x=R.getPoinsByLength(b,
u,y.x,y.y,4*c,-2);var X=R.getPoinsByLength(b,u,y.x,y.y,4*c,2);x.x>X.x&&(b=x,x=X,X=b);if(y.x<x.x||y.x>X.x||x.y>X.y&&(y.y>x.y||y.y<X.y)||x.y<X.y&&(y.y<x.y||y.y>X.y))return!1;b=Math.min(x.x,X.x,y.x);C=Math.max(x.x,X.x,y.x);u=Math.min(x.y,X.y,y.y);G=Math.max(x.y,X.y,y.y);var N=Math.max(c/4,k);G=[b-N,u-N,C+N,G+N];return O.conflicts(G)?!1:(O.insert(G),O=R.getCircle(x.x,x.y,y.x,y.y,X.x,X.y),this.addLabelAlongCurve(O,c,k,-Math.atan2((x.y-X.y)/(X.x-x.x))),!0)},addLabelAlongCurve:function(a,b,y,c){var k=this.label.length;
if(!(2>k)&&a.eAngle&&a.sAngle){c=(a.eAngle-a.sAngle)/(k-1);b/=k;for(var O=0;O<k;O++){var u=a.sAngle+c*O,C=Math.cos(u)*a.r+a.x-b,u=Math.sin(u)*a.r+a.y+y-1,C=this.graphics.createTextNode(this.label[O],this.labelStyle,C,u),u=new this.graphics.oui.geom.Matrix;C.applyStyle({transform:u});this.labelShape.appendChild(C)}}},getLabelPosBySlope:function(a){for(var b=[],y=0,c=a.length;y<c;y++){for(var k=a[y],O=k.length,u=(k[O-2]-k[0])/(k[O-1]-k[1]),C=Number.POSITIVE_INFINITY,G=0,R=0;R<O-1;R+=2){var X=(k[R+2]-
k[R])/(k[R+3]-k[R+1]);Math.abs(u-X)<C&&(C=Math.abs(u-X),G=R)}O=(k[G]+k[G+2])/2;u=(k[G+1]+k[G+3])/2;k=-Math.atan2(k[G+1]-k[G+3],k[G+2]-k[G]);if(k<=-Math.PI/2||k>Math.PI/2)k+=Math.PI;b.push({x:O,y:u,angle:k})}return b},isCluster:function(){return this.id&&0===this.id.indexOf("-CL")&&this.cluster?!0:!1},getFeaturesInCluster:function(){return this.isCluster()?this.cluster.featureArray:null},drawGhostGeom:function(b,x){if(b&&x&&0!==x.length){this.removeGhostShape();var y={};this.ghostGeom=b;a.$.extend(!0,
y,x[0]);this.ghostShape=this.drawRectangle(this.graphics,this.group,b,y,!0);this.ghostShape.feature=this;y=this.getTip();this.ghostShape.applyStyle({tooltip:y})}},drawGhostLabel:function(a){if(a&&this.label){var b=(a.getMinX()+a.getMaxX())/2;a=(a.getMinY()+a.getMaxY())/2;b=this.screenTransformObj.toScreenPoint(b,a);this.labelShape=this.graphics.createTextNode(this.label,this.labelStyle,b.x,b.y);b=this.graphics.getWidthHeight(this.labelShape);this.labelShape.translate(-b.w/2,b.h/2-2);this.parentLayer.labelGroup.appendChild(this.labelShape);
this.labelShape.feature=this}},removeGhostShape:function(){this.ghostShape&&(this.ghostShape.feature=null,this.graphics.remove(this.ghostShape),this.graphics.remove(this.line),this.parentLayer.leadLine&&(this.line=this.line.feature=null),this.ghostShape=this.ghostShape.feature=null,this.labelShape&&(this.graphics.remove(this.labelShape),this.labelShape=this.labelShape.feature=null))},enableMarkerDraggable:function(a){this.draggable=a},setMarkerText:function(a){this.markerText=a},getMarkerText:function(){return this.markerText},
setInfoWindowContent:function(a){this.InfoHtml=a},getShapeIndex:function(){this.idx=this.shape&&this.shape.parentNode?this.shape.parentNode.getChildIndex(this.shape):-1},setShapeIndex:function(){if(this.shape&&this.shape.parentNode&&0<=this.idx&&this.shape.parentNode.getChildIndex(this.shape)!=this.idx)if(this.shapeGroup&&1<this.shapeGroup.length)for(var a=this.shapeGroup.length-1;-1<a;a--)this.shapeGroup[a].parentNode.setChildIndex(this.shapeGroup[a],this.idx);else this.shape.parentNode.setChildIndex(this.shape,
this.idx)},isInCluster:function(){return this.inCluster&&this.clusterId?!0:!1},getClusterId:function(){return this.inCluster&&this.clusterId?this.clusterId:null},getClusterFeature:function(){var b=this.clusterFeature;return a.isNull(b)?null:b},getClusteredFeatures:function(){var b=this.cluster;return a.notNull(b)?b.featureArray:null}});a.MapMarker=a.Feature.extend({initialize:function x(b){var c;a.notNull(b)?(b.position&&(c=a.isNull(b.position.srid)?8307:b.position.srid,c=new a.geometry.Point(b.position.x,
b.position.y,c)),this.markerText=b&&a.notNull(b.markerText)?b.markerText:null,this.markerTextStyle=b&&a.notNull(b.markerTextStyle)?b.markerTextStyle:null,x.base.call(this,b.id,c,{renderingStyle:b.renderingStyle,label:b.label,labelStyle:b.labelStyle,draggable:b.draggable}),b.dragStart&&(this.dragStartListener=b.dragStart),b.dragEnd&&(this.dragEndListener=b.dragEnd),b.dragging&&(this.draggingListener=b.dragging)):x.base.call(this)},getLabel:function(){return this.label},setMarkerTextStyle:function(a){this.renderingStyle&&
(this.renderingStyle.textStyle=a)},setID:function(b){a.notNull(b)&&""!==b&&(this.id=b)},getID:function(){return this.id},isDraggable:function(){return!0===this.draggable},setDraggable:function(a){this.draggable=!0===a},setStyle:function(b){a.notNull(b)&&""!==b&&(this.renderingStyle=b)},getStyle:function(){return this.renderingStyle},setPosition:function(b,y,c){var k,O;b&&y?(k=b,O=y,b=a.isNull(c)?8307:c,k=new a.geometry.Point(k,O,b),this.setGeometry(k)):a.util.Logger.warning("MAPVIEWER_9073","OM.MapMarker.setPosition",
"The ["+k+","+O+"],values are not properly specified.")},getPosition:function(){return{x:this.getGeometry().getX(),y:this.getGeometry().getY(),srid:this.getGeometry().getSRID()}},getMarkerX:function(){return this.getGeometry().getX()},getMarkerY:function(){return this.getGeometry().getY()},getMarkerSRID:function(){return this.getGeometry().getSRID()},setDragStartListener:function(a){this.dragStartListener=a},setDraggingListener:function(a){this.draggingListener=a},setDragEndListener:function(a){this.dragEndListener=
a},toJSON:function(){return{position:{x:this.getGeometry().getX(),y:this.getGeometry().getY(),srid:this.getGeometry().getSRID()},renderingStyle:a.isNull(this.renderingStyle)?"undefined":this.renderingStyle,draggable:a.isNull(this.draggable)?"undefined":this.draggable,label:a.isNull(this.label)?"":this.label,labelStyle:a.isNull(this.labelStyle)?null:this.labelStyle,markerText:a.isNull(this.markerText)?"":this.markerText,markerTextStyle:a.isNull(this.markerTextStyle)?null:this.markerTextStyle}}});a.TextFeature=
a.Feature.extend({initialize:function(b,y,c,k){this.id=b;this.geo=y;this.text=c;this.renderingStyle=k?k:new a.style.Text(a.gv.defaultTextStyleConfig);this.editRenderingStyle=a.layer.EditableFeature.textStyle;k instanceof a.style.Style||(this.attributes=k&&a.notNull(k.attributes)?k.attributes:null,this.renderingStyle=k.style?k.style:new a.style.Text(a.gv.defaultTextStyleConfig),this.editRenderingStyle=k.editStyle?k.editStyle:a.layer.EditableFeature.textStyle);this.displayed=!1;this.visible=!0;this.editable=
!1},setText:function(b){a.notNull(b)&&""!==b&&(this.text=b,this.displayed&&(this.remove(),this.displayFeature()))},getText:function(){return this.text},setGeometry:function(a){!a||"Point"!==a.type&&"OrientedPoint"!==a.type||(this.geo=a,this.displayed&&(this.remove(),this.screenPoints=null,this.displayFeature()))},setRenderingStyle:function(b){if((!a.isNull(b)||!a.isNull(this.parentLayer)&&!a.isNull(this.parentLayer.otherStyles)&&0!==this.parentLayer.otherStyles.length)&&this.renderingStyle!==b&&(this.renderingStyle=
b,this.displayed)){this.getShapeIndex();var y=this;a.notNull(this.shape)&&this.shape.addEventListener(a.event.MouseEvent.MOUSE_OUT,function(a){try{a.target=y.shape,y.shape.dispatchEvent(a)}catch(b){}});this.remove();b=[b];this.parentLayer.otherStyles&&(b=b.concat(this.parentLayer.otherStyles));b=this.getAllStyles(b);if(this.parentLayer.featureGroupArr&&0<this.parentLayer.featureGroupArr.length){this.shapeArray=[];for(var c=0;c<this.parentLayer.featureGroupArr.length;c++)if(a.isNull(this.activeIdx)||
this.activeIdx===c)this.group=this.parentLayer.featureGroupArr[c],this.displayFeature(b,-1),this.shapeArray[c]=this.shape}else this.displayFeature(b,-1);this.setShapeIndex()}},setEditRenderingStyle:function(b){a.notNull(b)&&b instanceof a.style.Text&&(this.editRenderingStyle=b)},displayFeature:function(b,y){var c=this.geo,k=this.typeIs(c);if((!this.editing||"OrientedPoint"!==k)&&b&&0!==b.length){var O=b[0];if(O&&!(O instanceof a.style.Style)&&O.dataSource&&O.name){var u=this,k=O.url;a.isNull(k)&&
(k=this.parentLayer.type===a.layer.VectorLayer.TYPE_JDBC||this.parentLayer.type===a.layer.VectorLayer.TYPE_PREDEFINED?this.parentLayer.serverURL:this.parentLayer.parentMap.mapviewerURL);a.style.StyleStore.getServerSideStyle(O.dataSource,O.name,{url:k,callback:function(a){u.displayFeature([a],y)}})}else{var C=this.graphics,O=this.renderingStyle&&this.renderingStyle.cased?this.parentLayer.getLineGroup():this.group,G=this.screenTransformObj;if(!(a.isNull(C)||a.isNull(O)||a.isNull(c)||a.isNull(G))){1<
b.length&&(c=C.createGroup(),O.appendChild(c),O=c);c=b.length;C=[];for(G=0;G<c;G++){var R=b[G],X=R.styleType;R.showOnPoint?(R.realWidth=null,R.realHeight=null,C.push(R)):(R.draw(this,this.parentLayer.parentMap.getMapContext(),{group:O,idx:y}),"AnimationColor"!==X&&"PulseAnimation"!==X||!a.notNull(this.shape)||(this.animations=[],this.createAnimation(this.shape,R,"MultiLineString"==k||"LineString"==k)))}0<C.length&&(G=this.parentLayer.parentMap.getMapContext().getUniverse().getSRID(),a.isNull(this.labelBox)&&
this.createLabelBox(),this.getPointPosition(C,this.labelBox,O,G));1<c&&(this.shape=O);this.displayed=!0;this.applyToolTip();this.ghostGeom&&(this.drawGhostGeom(this.ghostGeom,b),this.drawGhostLabel(this.ghostGeom));if(this.shapeGroup&&!this.visible)for(G=1;G<this.shapeGroup.length;G++)this.graphics.setVisible(this.shapeGroup[G],!1);else this.shape&&!this.visible&&this.graphics.setVisible(this.shape,!1);this.ghostShape&&!this.visible&&this.graphics.setVisible(this.ghostShape,!1);this.resumeMoveAnimation();
a.notNull(this.parentLayer)&&this.parentLayer.useRTree&&(this.parentLayer.addToRtree(this),this.parentLayer.updatedSearchWindow(this,k))}}}},remove:function(){var a=this.shape;if(a){this.graphics.remove(a);this.shape=null;if(this.shapeGroup)for(var a=this.shapeGroup.length,b=0;b<a;b++)this.shapeGroup[b]&&this.graphics.remove(this.shapeGroup[b]);this.shapeGroup=null;if(this.shapeArray){a=this.shapeArray.length;for(b=0;b<a;b++)this.shapeArray[b]&&(this.shapeArray[b].feature=null,this.graphics.remove(this.shapeArray[b]));
this.shapeArray=null}}},toJSON:function(){var b={id:this.id,styleConfig:this.getRenderingStyle().getConfig(),text:this.getText()};b.geometry=this.geo instanceof a.geometry.Geometry?this.geo.toJSON():this.geo;return b}});a.Map=a.Class.extend({mixin:a.event.EventSource,initialize:function(b,y){y&&a.notNull(y.autoLoadCss)&&!1===y.autoLoadCss||(a.util.Logger.info("MAPVIEWER_9050","OM.Map.initialize","Auto loading "+a.gv.cssResourcePath()+"oraclemapsv2.css"),a.util.LoadFileUtil.LoadCss(a.gv.cssResourcePath()+
"oraclemapsv2.css"));a.gv.msgLoaded||a.gv.loadMessage();var c=this;this._decoration={};this.wraparound=!1;y&&!0===y.wraparound&&(this.wraparound=y.wraparound);this.mapBBox=[];a.gv.addMapInstance(this,b);y?(this.vectorlayerInfoWindowMouseEType=y.vectorlayerInfoWindowTrigger===a.event.MouseEvent.MOUSE_OVER||y.vectorlayerInfoWindowTrigger===a.event.MouseEvent.MOUSE_MOVE?a.event.MouseEvent.MOUSE_MOVE:a.event.MouseEvent.MOUSE_CLICK,this.hiDPI=y.hiDPI,this.applicationID=y.applicationID):this.vectorlayerInfoWindowMouseEType=
a.event.MouseEvent.MOUSE_CLICK;this.$containerDiv=a.$(b);this.$containerDiv.empty();this.zoomComplete=!0;this.utfgridHTMLArray=[];this.vctinfoHTMLArray=[];this.vctinfoFeatures={};"CSS1Compat"===document.compatMode&&(0===this.$containerDiv.width()&&(a.isNull(a.util.DomUtil.css(a.$("html")).width)&&(a.util.Logger.info("MAPVIEWER_9050","OM.Map.initialize","Set html width to 100%"),a.$("html").css("width","100%")),a.isNull(a.util.DomUtil.css(a.$("body")).width)&&(a.util.Logger.info("MAPVIEWER_9050","OM.Map.initialize",
"Set body width to 100%"),a.$("body").css("width","100%"))),0===this.$containerDiv.height()&&(a.isNull(a.util.DomUtil.css(a.$("html")).height)&&(a.util.Logger.info("MAPVIEWER_9050","OM.Map.initialize","Set html height to 100%"),a.$("html").css("height","100%")),a.isNull(a.util.DomUtil.css(a.$("body")).height)&&(a.util.Logger.info("MAPVIEWER_9050","OM.Map.initialize","Set body height to 100%"),a.$("body").css("height","100%"))));0!==this.$containerDiv.width()&&0!==this.$containerDiv.height()||a.util.Logger.warning("MAPVIEWER_9050",
"OM.Map.initialize","Size is "+this.$containerDiv.width()+"*"+this.$containerDiv.height());this.$containerDiv.css("-webkit-user-select","none");this.$containerDiv.css({"-moz-user-select":"none"});this.$containerDiv.css({"-ms-touch-action":"none"});a.browser.touchSupported&&this.$containerDiv.css({"-webkit-tap-highlight-color":"rgba(0, 0, 0, 0)"});"absolute"!==this.$containerDiv.css("position")&&this.$containerDiv.css("position","relative");this.mapInstanceId=this.generateMapInstanceId();var k="\x3cdiv id\x3d'oracleMapDiv"+
this.mapInstanceId+"' ";a.gv.tabIndexEnabled&&(k+=" tabindex\x3d'1' ");this._rootDivPos={normal:"position:relative; width:100%; height:100%;",va:"width:100%; height:100%;"};k+="style\x3d'"+this._rootDivPos.normal+"left:0px; top:0px; -moz-user-select: none;-webkit-user-select:none; overflow: hidden;z-index:auto;opacity:1'\x3e\x3c/div\x3e";this.$oracleMapDiv=a.$(k);this.$oracleMapDiv.addClass("omapsv2-root");this.$oracleMapDiv.css("position","relative");this.$containerDiv.append(this.$oracleMapDiv);
this.$topLayerDIV=a.$("\x3cdiv id \x3d'topLayerDIV"+this.mapInstanceId+"'\x3e\x3c/div\x3e");this.$fkGraphicLayersDiv=a.$("\x3cdiv id \x3d'fkGraphicLayersDiv"+this.mapInstanceId+"'\x3e\x3c/div\x3e");this.$tileLayersDiv=a.$("\x3cdiv id \x3d'tileLayersDiv"+this.mapInstanceId+"'\x3e\x3c/div\x3e");this.$oracleMapDiv.append(this.$topLayerDIV);this.$oracleMapDiv.append(this.$fkGraphicLayersDiv);this.$oracleMapDiv.append(this.$tileLayersDiv);this.$topLayerDIV.css({"z-index":"auto",position:"absolute",left:"0px",
top:"0px",width:"100%",height:"100%"});this.$fkGraphicLayersDiv.css({"z-index":"4",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%",overflow:"hidden"});this.$tileLayersDiv.css({"z-index":"1",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%",overflow:"hidden"});for(var k=[],O,u=1;6>=u;u+=1)O="\x3cdiv id\x3d'omv2_anchorBox"+u+"_"+this.mapInstanceId+"' class\x3d'omv2_anchorBox"+u+"'\x3e\x3c/div\x3e",k.push(O);this.anchors=[a.$(k[0]),a.$(k[1]),a.$(k[2]),a.$(k[3]),
a.$(k[4]),a.$(k[5])];this.$heatMapDiv=a.$("\x3cdiv id \x3d'heatMapDiv"+this.mapInstanceId+"'\x3e\x3c/div\x3e");this.$oracleMapDiv.append(this.$heatMapDiv);this.$heatMapDiv.css({"z-index":"2",position:"absolute",left:"0px",top:"0px",width:"100%",height:"100%",overflow:"hidden"});this.graphics=new a.Graphics(this.$fkGraphicLayersDiv[0],{hiDPI:this.hiDPI});this.$fkGraphicLayersDiv.find("svg,canvas").attr("unselectable","on");this.$fkGraphicLayersDiv.find("svg,canvas").css({outline:"none"});this.draggableGroup=
this.graphics.createGroup();this.fixedGroup=this.graphics.createGroup();this.blockerGroup=this.graphics.createGroup();this.graphics.addGroup(this.fixedGroup);this.graphics.addGroup(this.draggableGroup);this.graphics.addGroup(this.blockerGroup);this.useRTree=a.notNull(y&&y.useRTree)?y.useRTree:a.gv.useRTree;(this.updateBlocker=function(){if(c.useRTree&&!a.isNull(c.blockerGroup)){0===c.blockerGroup.childrenCount&&c.graphics.drawRectangle({x:0,y:0,width:c.$containerDiv.width(),height:c.$containerDiv.height()},
{fill:"orange",fillOpacity:0},{group:c.blockerGroup});var b=c.blockerGroup.firstChild;a.notNull(b)&&b.applyStyle({x:0,y:0,width:c.$containerDiv.width(),height:c.$containerDiv.height()})}}).call();c.iterateVectorLayers=function(a){for(var b=c.svgLayers,x=b.length-1;0<=x&&!0!==a(b[x]);x--);};c.search=function(b){var x=null;c.iterateVectorLayers(function(c){x=c.findFeature(b,!1);if(a.notNull(x))return!0});a.isNull(x)&&c.iterateVectorLayers(function(c){x=c.findFeature(b,!0);if(a.notNull(x))return!0});
return x};var C="none",G=function(b,x){if(!a.isNull(b)&&(C!==b._id||"mouseUp"!==x.type||2!==x.button)&&(C=b._id,a.notNull(b))){for(var c=b,y=c.feature;a.isNull(y)&&c.parentNode;)c=c.parentNode,y=c.feature;a.isNull(y)||(y.shape===b||y===b.feature?a.notNull(y.shape)&&y.shape.dispatchEvent(x):(a.notNull(y.shape)&&y.shape.dispatchEvent(x),b.dispatchEvent(x)))}},k=function(b){var x=c.search(b),y=x?x.fkNode:null;a.notNull(x)?a.notNull(x.parentLayer)&&c.graphics.setCursor(c.blockerGroup,x.parentLayer.mouseCursor):
c.graphics.setCursor(c.blockerGroup,c.cursorStyleDefault);a.notNull(x)&&G(y,b);b.type===a.event.MouseEvent.MOUSE_MOVE?(y!==c.lastMoveTarget&&(a.notNull(c.lastMoveTarget)&&(b.target=c.lastMoveTarget,b.relatedTarget=y,G(c.lastMoveTarget,a.$.extend({},b,{type:a.event.MouseEvent.MOUSE_OUT})),G(c.lastMoveTarget,a.$.extend({},b,{type:a.event.MouseEvent.MOUSE_LEAVE}))),a.notNull(y)&&(b.target=y,b.relatedTarget=c.lastMoveTarget,G(y,a.$.extend({},b,{type:a.event.MouseEvent.MOUSE_ENTER})),G(y,a.$.extend({},
b,{type:a.event.MouseEvent.MOUSE_OVER})))),c.lastMoveTarget=y):b.type===a.event.MouseEvent.MOUSE_LEAVE&&(c.lastMoveTarget=null)};c.lastMoveTarget=null;!0===c.useRTree&&(a.browser.touchSupported&&(this.graphics.attachEventListener(a.event.MouseEvent.TOUCH_TAP,k,this.blockerGroup),this.graphics.attachEventListener(a.event.MouseEvent.TOUCH_LONG_PRESS,k,this.blockerGroup),this.graphics.attachEventListener(a.event.MouseEvent.TOUCH_END,k,this.blockerGroup),this.graphics.attachEventListener(a.event.MouseEvent.TOUCH_START,
k,this.blockerGroup)),this.graphics.attachEventListener(a.event.MouseEvent.MOUSE_MOVE,k,this.blockerGroup),this.graphics.attachEventListener(a.event.MouseEvent.MOUSE_CLICK,k,this.blockerGroup),this.graphics.attachEventListener(a.event.MouseEvent.MOUSE_RIGHT_CLICK,k,this.blockerGroup),this.graphics.attachEventListener(a.event.MouseEvent.MOUSE_UP,k,this.blockerGroup),this.graphics.attachEventListener(a.event.MouseEvent.MOUSE_DOWN,k,this.blockerGroup),this.graphics.attachEventListener(a.event.MouseEvent.MOUSE_LEAVE,
k,this.blockerGroup));this.divTop=this.divLeft=0;this.undoManager=new a.UndoManager;this.mouseWheelZoomBehavior=a.Map.ZOOM_CENTER_ON_MOUSE;y&&y.mapviewerURL&&(this.mapviewerURL=y.mapviewerURL);k=function(b){b?a.util.Logger.warning(0,"OM.Map.initialize",b.responseText):a.util.Logger.warning(0,"OM.Map.initialize","")};try{a.notNull(this.mapviewerURL)&&a.isNull(a.gv.defaultDataSource)&&a.util.HttpRequest.send(this.mapviewerURL+"/omserver",{xml_request:'\x3c?xml version\x3d"1.0" standalone\x3d"yes"?\x3e\x3cnon_map_request\x3e\x3clist_data_sources/\x3e\x3c/non_map_request\x3e'},
function(b){b=a.$(b).find("map_data_source");a.notNull(b)&&(a.gv.defaultDataSource=b.attr("name"))},"xml",k)}catch(R){a.util.Logger.warning(0,"OM.Map.initialize",R.stack?R.message+"\nStack: "+R.stack:R.message)}a.isNull(this.mapviewerURL)?this.mapviewerURL=a.gv.localbaseURL():0===this.mapviewerURL.indexOf("http")&&a.gv.setBaseMapViewerURL(this.mapviewerURL);this.disableOverviewMap=!0;y&&!1===y.disableOverviewMap&&(this.disableOverviewMap=y.disableOverviewMap);this.getMapContextToken=function(){var a=
{};return function(){return a}}();var X=this.getMapContextToken();X.universe={};X.graphics=this.graphics;y&&y.universe&&(X.universe=y.universe);X.deviceWindow={x:0,y:0,w:this.$containerDiv.width(),h:this.$containerDiv.height()};this.typeArray=[];this.nameArray=[];this.divLayers=[];this.svgLayers=[];this.layerQueue=[];this.touchStartLocs=[];this.touchStartLocs_backup=[];this.mLocY=this.mLocX=null;this.decorationArray=[];this.toolFeatureLayer=this.defaultFeatureLayer=null;this.enableMapAction={mouse:!0,
click:!0,drag:!0,dbclick:!0,mousewheel:!0};this.zoomEnabled=!0;this._mapCenter=this._zoomLevel=null;this.universeLayerIndex=-1;this.boundingLayerName=null;this.hasExternal=this.resetTag=this.moveflag=this.boundingThemeLoaded=this.boundingThemeLoading=this.initialized=this.displayed=this.inited=!1;this.tileLayerZoomAnimation=!0;this.maskOutInfoWindow=this.infoWindowEventPropogation=!1;this.over=y&&y.over?!0:!1;this.template=null;this.cursorStyleDragging=a.CursorTypes.MOVE;this.cursorStyleDefault=a.CursorTypes.DEFAULT;
if(!1===this.over&&"undefined"===typeof this.mainmap&&(a.isNull(y)||a.notNull(y)&&a.isNull(y.magnifier)))for(k=0;k<this.anchors.length;k++)this.$topLayerDIV.append(this.anchors[k]);this.resizeFun=function(){if(!c.over&&c.$containerDiv&&(X.deviceWindow.w!==c.$containerDiv.width()||X.deviceWindow.h!=c.$containerDiv.height())){var b=c.$containerDiv.width(),x=c.$containerDiv.height();X.deviceWindow.w=b;X.deviceWindow.h=x;0<b&&0<x&&(c.updateBlocker(),c.redrawMap(),b=new a.event.MapEvent(a.event.MapEvent.MAP_RESIZED,
c),c.fire(b.type,b))}};this.resizeTimer=setInterval(this.resizeFun,300);this.$oracleMapDiv[0].addEventListener("mouseover",function(b){var x=a.event,x=new x.MapEvent(x.MouseEvent.MOUSE_OVER,c);x.evt=b;c.fire(x.type,x)},!0);this.$oracleMapDiv[0].addEventListener("mouseout",function(b){var x=a.event,x=new x.MapEvent(x.MouseEvent.MOUSE_OUT,c);x.evt=b;c.fire(x.type,x)},!0);if(!y||!y.magnifier){this.$oracleMapDiv.dblclick(function(b){c.isStoppedEvent(b)||(c.displayed&&c.enableMapAction.dbclick&&c.setMapCenterAndZoomLevel(c.getCursorLocation(),
X.zoomLevel+1,!0),b=new a.event.MapEvent(a.event.MouseEvent.MOUSE_DOUBLE_CLICK,c),c.fire(b.type,b))});this.$oracleMapDiv[0].oncontextmenu=function(a){a.preventDefault()};var N=!1;this.$oracleMapDiv.on("mousewheel DOMMouseScroll",function(a){!c.isStoppedEvent(a)&&c.enableMapAction.mousewheel&&(a.preventDefault(),N||r(a,a.deltaY))});var r=function(b,x){N=!0;setTimeout(function(){N=!1;var y=c.getMapContext(),k=y.getUniverse(),n=k.getZoomLevels(),X=y.getZoomLevel(),r=X;0<x?X++:X--;if(!(0>X||X>=n.length)){b.preventDefault();
var u=c.getCursorLocation();if(k.srid===a.util.BaiduUtil.SRID&&(X=a.util.BaiduUtil.getValidZoomLevel(X),!a.util.GeomUtil.isWithinBBox(u.getX(),u.getY(),k.bound.getMinX(),k.bound.getMinY(),k.bound.getMaxX(),k.bound.getMaxY())))return;if((!c.mouseWheelZoomBehavior||c.mouseWheelZoomBehavior===a.Map.ZOOM_KEEP_MOUSE_POINT)&&c.graphics){var u=n[X].resolution,n=n[r].resolution,y=y.getCenterPoint(),ma=c.getCursorLocation(),r=ma.getX(),ma=ma.getY(),fa=new c.graphics.oui.geom.Matrix;fa.translate(r,ma);fa.scale(u/
n);fa.translate(-r,-ma);u=fa.transform(y.getX(),y.getY());u=new a.geometry.Point(u.x,u.y,k.srid)}c.setMapCenterAndZoomLevel(u,X,!0);k=new a.event.MapEvent(a.event.MouseEvent.WHEEL_SCROLL,c);k.delta=x;c.fire(k.type,k)}},350)};this.$oracleMapDiv.mousedown(function(b){if(!c.isStoppedEvent(b)){1===b.which&&c.enableMapAction.drag&&(c.moveflag=!0);c.mLocX=b.pageX-c.$oracleMapDiv.offset().left;c.mLocY=b.pageY-c.$oracleMapDiv.offset().top;c.mouseDownLocX=c.mLocX;c.mouseDownLocY=c.mLocY;var x=new a.event.MapEvent(a.event.MouseEvent.MOUSE_DOWN,
c);x.evt=b;c.fire(x.type,x)}});this.$oracleMapDiv.mousemove(function(b){if(!c.isStoppedEvent(b)){var x=b.pageX-c.$topLayerDIV.offset().left-c.mLocX,y=b.pageY-c.$topLayerDIV.offset().top-c.mLocY;c.mLocX=b.pageX-c.$oracleMapDiv.offset().left;c.mLocY=b.pageY-c.$oracleMapDiv.offset().top;c.moveflag&&c.enableMapAction.drag&&(c.changeCursor(c.cursorStyleDragging),c.pan(x,y,!1));var k=new a.event.MapEvent(a.event.MouseEvent.MOUSE_MOVE,c);k.evt=b;c.fire(k.type,k);c.utfgridMouseEType!==a.event.MouseEvent.MOUSE_MOVE||
0===x&&0===y||c.utfgridMouseEListener(a.event.MouseEvent.MOUSE_MOVE);c.vectorlayerInfoWindowMouseEType!==a.event.MouseEvent.MOUSE_MOVE||0===x&&0===y||c.vectorLayerInfoWindowListener(a.event.MouseEvent.MOUSE_MOVE)}});this.$oracleMapDiv.mouseup(function(b){if(!c.isStoppedEvent(b)){var x=a.event,y=new x.MapEvent(x.MouseEvent.MOUSE_UP,c);y.evt=b;c.fire(y.type,y);c.mouseUpLocX=c.mLocX;c.mouseUpLocY=c.mLocY;c.mouseDownLocX&&c.mouseDownLocY&&c.moveflag&&c.enableMapAction.drag&&(1<Math.abs(c.mouseUpLocX-
c.mouseDownLocX)||1<Math.abs(c.mouseUpLocY-c.mouseDownLocY))?(y=new x.MapEvent(x.MapEvent.MAP_RECENTERED,c),c.fire(y.type,y)):c.mouseDownLocX&&c.mouseDownLocY&&1>=Math.abs(c.mouseUpLocX-c.mouseDownLocX)&&1>=Math.abs(c.mouseUpLocY-c.mouseDownLocY)&&c.handleMouseClick(b,c);c.mouseDownLocX=null;c.mouseDownLocY=null;c.moveflag=!1;c.changeCursor(c.cursorStyleDefault)}});c.displayUTFGridInfoWindow=function(){var b=null,x=0,y=function(){if(c.utfgridHTMLArray.length<c.utfgrid_lyr_cnt)10<=x?(clearTimeout(b),
a.util.Logger.warning("MAPVIEWER_9081","OM.Map.initialize")):(clearTimeout(b),b=setTimeout(y,50),x+=1);else{for(var k="",n=0,N=c.utfgridHTMLArray.length;n<N;n++){var X=c.utfgridHTMLArray[n];!a.isNull(X)&&0<X.trim().length&&(k+=X.trim())}0<k.trim().length?(k="\x3ctable align\x3d'left' cellspacing\x3d'4' style\x3d'margin: auto;border-collapse: separate;'\x3e"+k+"\x3c/table\x3e",n=c.getCursorLocation(),c.displayInfoWindow(n,k,{title:"Feature Info",builtInInfoWindow:!0})):c.closeInfoWindows();c.utfgridHTMLArray=
[]}};y()};c.displayVectorLayersInfoWindow=function(b){var x=!1;if(a.isNull(b)||1>b.length)c.closeInfoWindows();else{var y,k;if(!0===c.showAllVecFeatureInfo)for(y=0,k=b.length;y<k;y+=1)b[y]&&b[y].feature_layer&&!0===b[y].feature_layer.getEnableInfoWindow()&&b[y].feature_layer.insertFeatureInfo(b[y]);else for(y=b.length-1;0<=y;--y)if(b[y]&&b[y].feature_layer&&!0===b[y].feature_layer.getEnableInfoWindow()){b[y].feature_layer.insertFeatureInfo(b[y]);break}b="";y=0;for(k=c.vctinfoHTMLArray.length;y<k;y++){var n=
c.vctinfoHTMLArray[y];!a.isNull(n)&&0<n.trim().length&&(b+=n.trim())}0<b.trim().length&&(b="\x3ctable align\x3d'left' cellspacing\x3d'4' style\x3d'margin: auto;border-collapse: separate;'\x3e"+b+"\x3c/table\x3e",x=c.getCursorLocation(),c.displayInfoWindow(x,b,{title:"Feature Info",builtInInfoWindow:!0}),x=!0);c.vctinfoHTMLArray=[];c.vctinfoFeatures={};return x}};c.fireUTFGridEvent=function(b){for(var x=0;x<c.divLayers.length;x++){var y=c.divLayers[x];if((y.layerType===a.LayerTypes.TILE||y.layerType===
a.LayerTypes.DYNAMIC_TILE)&&!0===y.enableUTFGrid&&y.mouseETypeUTFGrid===b&&!0===y.getEnableInfoWindow()){var k=new a.event.MapEvent(y.mouseETypeUTFGrid,y);y.fire(k.type,y)}}};c.getVectorLayerHitFeatures=function(b,x){a.isNull(x)&&(x={type:b,clientX:c.mLocX,clientY:c.mLocY});for(var y=[],k,n,N,X=0;X<c.svgLayers.length;X++)if(k=c.svgLayers[X],n=k.findFeatures(x),!a.isNull(n)){var r,ma;r=0;for(ma=n.length;r<ma;r++)N=n[r],a.isNull(N)||N.cluster||(N.feature_layer=k,y.push(N))}return y};this.mapDragOutDiv=
function(){if(c.moveflag&&c.enableMapAction.drag){if(c.mouseDownLocX&&c.mouseDownLocY&&c.moveflag&&c.enableMapAction.drag&&(1<Math.abs(c.mouseUpLocX-c.mouseDownLocX)||1<Math.abs(c.mouseUpLocY-c.mouseDownLocY))){var b=new a.event.MapEvent(a.event.MapEvent.MAP_RECENTERED,c);c.fire(b.type,b)}c.moveflag=!1;c.changeCursor(c.cursorStyleDefault);c.mouseDownLocX=null;c.mouseDownLocY=null}};a.$(document).mouseup(this.mapDragOutDiv).mouseout(this.mapDragOutDiv);this.$fkGraphicLayersDiv.mouseout(function(a){a.stopPropagation()});
this.graphics.oui.rootNode.addEventListener(a.event.MouseEvent.MOUSE_LEAVE,function(){c.graphics.oui&&c.graphics.oui.tree&&c.graphics.oui.tree.canvas&&(c.graphics.oui.tree.canvas.style.cursor=c.cursorStyleDefault)});a.browser.touchSupported&&(this.$oracleMapDiv.bind("touchstart",function(a){c.isStoppedEvent(a)||c.touchStart(a)}),this.$oracleMapDiv.bind("touchmove",function(a){a.preventDefault();c.isStoppedEvent(a)||c.touchMove(a)}),this.$oracleMapDiv.bind("touchend",function(a){c.isStoppedEvent(a)||
c.touchEnd(a)}));if(a.gv.isWin8Touch){var n=this;a.Hammer(this.$oracleMapDiv[0]).on("transformstart",function(a){n.touchStartLocs=[];n.pinchZoomScale=1;var b=n.touchStartLocs;b[0]={x:a.gesture.touches[0].pageX,y:a.gesture.touches[0].pageY};b[1]={x:a.gesture.touches[1].pageX,y:a.gesture.touches[1].pageY};a=b[1].x-b[0].x;b=b[1].y-b[0].y;n.pinchZoomStartDist=Math.sqrt(a*a+b*b)});a.Hammer(this.$oracleMapDiv[0]).on("pinch",function(b){var x=a.util.DomUtil,c=x.getTouchesScale(b);a.isNull(c)&&(b=x.getTouchesPosition(b.gesture),
c=b[0].x-b[1].x,b=b[0].y-b[1].y,c=Math.sqrt(c*c+b*b)/n.pinchZoomStartDist);n.pinchZoomScale=c;if(!(1===c||0>=c||(b=n.zoomLevel,1<c&&b>=n.maxZoom||1>c&&0>=b)))for(n.pinchZooming=!0,n.graphics.setVisible(n.draggableGroup,!1),n.$heatMapDiv.css({visibility:"hidden"}),b=0;b<n.divLayers.length;b++)n.divLayers[b].zoomControl&&n.divLayers[b].zoomControl.scaleTiles(c)});a.Hammer(this.$oracleMapDiv[0]).on("transformend",function(){var a=n.pinchZoomScale;n.pinchZooming&&(a=n.getScaleZoomLevel(a),n.setMapZoomLevel(a),
n.pinchZoomScale=1,n.pinchZooming=!1,n.graphics.setVisible(n.draggableGroup,!0),n.doubleTap=!1)})}this._keyboardSupport={xPanOffset:5,yPanOffset:5,useSmoothPan:!1,actionMap:{tab:function(){},zoomIn:function(){c.zoomIn()},zoomOut:function(){c.zoomOut()},panLeft:function(){c.pan(c._keyboardSupport.xPanOffset,0,c._keyboardSupport.useSmoothPan)},panUp:function(){c.pan(0,c._keyboardSupport.yPanOffset,c._keyboardSupport.useSmoothPan)},panRight:function(){c.pan(-c._keyboardSupport.xPanOffset,0,c._keyboardSupport.useSmoothPan)},
panDown:function(){c.pan(0,-c._keyboardSupport.yPanOffset,c._keyboardSupport.useSmoothPan)},toggleOverview:function(){var a=c.overview;a.minimized?a.restore():a.collapse()},toggleLayerControl:function(){},toggleDecoration:function(){}},keyMap:{107:"zoomIn",109:"zoomOut",37:"panLeft",38:"panUp",39:"panRight",40:"panDown",79:"toggleOverview"}};k=function(a){if(!c.isStoppedEvent(a)&&"keydown"===a.type){var b=c._keyboardSupport.actionMap;if((a=c._keyboardSupport.keyMap[a.keyCode])&&b[a])b[a]()}};this.$oracleMapDiv.keypress(k);
this.$oracleMapDiv.keydown(k);this.$oracleMapDiv.keyup(k)}this.newLayerConfigLoaded=function(b){b.target instanceof a.layer.Layer&&(b.target.lastEvent=b.type);c.initLayers(b)};this.listenerElocationCopyright=function(){var b=new a.control.CopyRight({anchorPosition:a.control.MapDecoration.POSITION_LOWER_RIGHT,textValue:'\x26copy; 2018 Oracle Corporation \x26nbsp;\x26nbsp; \x3ca target\x3d"_blank" href\x3d"http://elocation.oracle.com/elocation/legal.html"\x3eTerms\x3c/a\x3e \x26nbsp;\x26nbsp; Map data \x26copy; 2017 HERE',
fontSize:10,fontFamily:"Arial",fontColor:"black"});c.addMapDecoration(b);this.deleteListener(a.event.LayerEvent.FINISH_GOT_CONFIG,c.listenerElocationCopyright)};this.listenerOSMCopyright=function(){var b=new a.control.CopyRight({anchorPosition:a.control.MapDecoration.POSITION_LOWER_RIGHT,textValue:'\x3ca target\x3d"_blank" href\x3d"http://openmaptiles.org"\x3e \x26copy; OpenMapTiles \x3c/a\x3e \x26nbsp; \x3ca target\x3d"_blank" href\x3d"https://www.openstreetmap.org/copyright"\x3e \x26copy; OpenStreetMap contributors \x3c/a\x3e',
fontSize:10,fontFamily:"Arial",fontColor:"black"});c.addMapDecoration(b);this.deleteListener(a.event.LayerEvent.FINISH_GOT_CONFIG,c.listenerOSMCopyright)};this.layerFinish=function(b){b.target.loaded=!0;b.target.lastEvent=b.type;var x;if(a.Map.isTileLayer(b.target.layerType)){if(!c.divLayers)return;for(x=0;x<c.divLayers.length;x++)if(!c.divLayers[x].loaded)return;b=new a.control.CopyRight({anchorPosition:6,textValue:b.target.tileLayerConfig.copyright,fontSize:12,fontFamily:"Arial"});!c.over&&a.isNull(b.textValue)&&
0<b.textValue.trim().length&&c.addMapDecoration(b);"CopyRight"===b.type&&(c.copyRight=b);c.graphics&&c.graphics.setVisible(c.draggableGroup,!0);c.$heatMapDiv&&c.$heatMapDiv.css({visibility:"visible"})}if(c.divLayers)for(x=0;x<c.divLayers.length;x++)if(!c.divLayers[x].loaded)return;if(c.svgLayers)for(x=0;x<c.svgLayers.length;x++)if(!c.svgLayers[x].loaded&&!c.svgLayers[x].loadError)return;c.boundingLayerName=null;c.boundingThemeLoaded=!1;try{c.refreshVectorLayerLabels(),c.getToolFeatureLayer()}catch(y){a.util.Logger.warning(0,
"OM.Map.layerFinish",y.stack?y.message+"\nStack: "+y.stack:y.message)}finally{b=new a.event.MapEvent(a.event.MapEvent.MAP_AFTER_REFRESH,c),c.fire(b.type,b)}};this.layerErr=function(b){c.overviewLayer===b.target&&(c.overviewLayerErr=!0);c.removeLayer(b.target);a.Map.isTileLayer(b.target.layerType)?0<c.divLayers.length&&c.divLayers[c.universeLayerIndex].getLayerConfig():(b.target.isBoundingTheme()&&(c.boundingLayerName=null,0<=c.universeLayerIndex&&c.divLayers[c.universeLayerIndex].getLayerConfig()),
c.layerFinish(b),0>c.universeLayerIndex&&c.overviewLayerErr&&c.overview&&0<c.svgLayers.length&&(c.overviewLayer=c.svgLayers[c.svgLayers.length-1],c.overview.setOverviewMapOptions({overviewLayer:c.overviewLayer}),c.overview.errLoadLayer()))};this.layerStyleChanged=function(b){var x=new a.event.MapEvent(a.event.MapEvent.MAP_STYLE_CHANGED,c);x.affectLayer=b.target;x.newStyle=b.newStyle;x.attributes=b.attributes;c.fire(x.type,x)};this.nsdpMapped=function(b){var x=new a.event.MapEvent(a.event.MapEvent.I_MAP_NSDP_MAPPED,
c);x.affectLayer=b.target;c.fire(x.type,x)};this.disableOverviewMap||y.magnifier||(this.overview=new a.control.OverviewMap({}),this.overview.mainmap=this,this.addMapDecoration(this.overview),k=this.overview,O=a.event.MapEvent,this.$topLayerDIV.append(this.overview.$DecorationDiv),this.on(O.MAP_RECENTERED,this.overview.setCenterAndZoomlevel,k),this.on(O.I_MAP_CENTER_ZOOM,this.overview.setCenterAndZoomlevel,k),this.on(O.I_MAP_DRAGGING,this.overview.setRectangleFeature,k),this.on(O.MAP_BEFORE_REFRESH,
this.overview.setCenterAndZoomlevel,k),this.on(O.MAP_RESIZED,this.overview.resize,k),this.on(O.MAP_STYLE_CHANGED,this.overview.styleChange,k),this.on(O.I_MAP_NSDP_MAPPED,this.overview.nsdpMapped,k),this.on(O.LAYER_DELETED,this.overview.layerDel,k),this.on(a.event.MapEvent.MAP_DESTROY,this.overview.destroy),this.overviewLayer=null);k=a.event.MapEvent;this.on(k.MAP_INITIALIZED,function(){var b=c.getLabelGridBox();c.grid=new a.util.CoverageGrid(b);for(b=0;b<c.svgLayers.length;b++)c.svgLayers[b].loaded=
!1},this);this.on(k.LAYER_REORDERED,this.changeOverView,this);this.getToolFeatureLayer();!1===this.over&&"undefined"===typeof this.mainmap&&(a.isNull(y)||a.notNull(y)&&a.isNull(y.magnifier))&&(this.progressService=new a.util.Progress,this.progressBar=new a.util.ProgressBar(this),"function"===typeof this.progressService.subscribe&&(this.progressService.subscribe(this.progressBar.updateUi.bind(this.progressBar),"progress"),this.progressService.subscribe(this.progressBar.switchMode.bind(this.progressBar),
"mode")));a.event.EventSource.initProcessedEventStatus()},setUTFGridMouseEType:function(b){for(var c=0;c<this.divLayers.length;c++){var q=this.divLayers[c];q.layerType!==a.LayerTypes.TILE&&q.layerType!==a.LayerTypes.DYNAMIC_TILE||!0!==q.enableUTFGrid||!0!==q.getEnableInfoWindow()||(this.utfgridMouseEType=b===a.event.MouseEvent.MOUSE_OVER||b===a.event.MouseEvent.MOUSE_MOVE?a.event.MouseEvent.MOUSE_MOVE:a.event.MouseEvent.MOUSE_CLICK)}},updateUTFGridLayerListener:function(){this.utfgrid_lyr_cnt=this.getUTFGridLayerCount();
this.utfgridMouseEType=this.getUTFGridMouseEType();this.utfgridMouseEListener=a.util.MiscUtil.debounce(function(a){a===this.utfgridMouseEType&&0<this.utfgrid_lyr_cnt&&(this.fireUTFGridEvent(a),setTimeout(this.displayUTFGridInfoWindow(),10))},500)},vectorLayerInfoWindowListener:a.util.MiscUtil.debounce(function(a){this.displayVectorLayersInfoWindow(this.getVectorLayerHitFeatures(a))},500),updateUTFGridLayerCount:function(){this.utfgrid_lyr_cnt=this.getUTFGridLayerCount()},generateMapInstanceId:function(){var a=
0;return function(){return+ ++a}}(),getUndoManager:function(){return this.undoManager},getMapContext:function(){return a.MapContext(this)},initLayers:function(b){var c=this,q=a.event,k=this.getMapContextToken(),O=function(){for(var b=[],x=0;a.notNull(c.layerQueue)&&x<c.layerQueue.length;x++){var n=c.layerQueue[x];if(a.Map.isTileLayer(n[0].layerType)){for(var X=n[0].getZIndex()-1,u=!1,q=0;q<X;q++)if(!c.divLayers[q].initCalled){u=!0;break}if(u){b.push(c.layerQueue[x]);continue}else{if(!n[1].equals(k.universe)){c.resetUniverse(n[1],
n[0],n[0].tileLayerConfig);return}if(c.divLayers[c.universeLayerIndex]==n[0]&&!c.boundingLayerName&&!c.extentRect&&n[0].initCalled){a.util.Logger.config("","OM.Map.initLayers.deLayerQueue","["+n[0].name+"] layer's initLayer() skipped");continue}}}a.util.Logger.finest("","OM.Map.initLayers.deLayerQueue","Initializing layer: "+n[0].name+" ["+(x+1)+" of "+c.layerQueue.length+"]");n[0].initLayer()}c.overviewLayerErr&&c.overview&&(-1!==c.universeLayerIndex?c.overviewLayer=c.divLayers[c.universeLayerIndex]:
0<c.svgLayers.length&&(c.overviewLayer=c.svgLayers[c.svgLayers.length-1]),c.overview.setOverviewMapOptions({overviewLayer:c.overviewLayer}),c.overview.errLoadLayer());c.layerQueue=b},u=function(b){if(!a.isNull(c.layerQueue)){for(var x=0;x<c.layerQueue.length;x++)if(c.layerQueue[x][0].name===b.target.name)return;x=[b.target];a.Map.isTileLayer(b.target.layerType)&&a.notNull(b.config)&&x.push(new a.universe.Universe(b.config));c.layerQueue.push(x)}};c.extentRect&&(c.boundingLayerName=null);var C,G;if(a.notNull(c.extentRect)&&
-1!==c.universeLayerIndex)if(c.displayed||c.divLayers[c.universeLayerIndex]!=b.target)if(!b&&c.displayed)c.checkCenter(),C=new q.MapEvent(q.MapEvent.MAP_INITIALIZED,c),c.initialized=!0,c.inited=!1,c.fire(C.type,C),O();else if(c.initialized){if(a.Map.isTileLayer(b.target.layerType)&&(u=new a.universe.Universe(b.config),!u.equals(k.universe))){c.resetUniverse(u,b.target,b.config);return}b.target.initLayer();O()}else u(b);else k.universe=(new a.universe.Universe(b.config)).copy(k.universe),c.displayed=
!0,c.setAllInitialParams(),k.zoomLevel=c.checkZoomLevel(k.zoomLevel),u(b),c.zoomToExtent(c.extentRect);else if(a.notNull(c.extentRect))c.displayed?!b&&c.displayed?(C=new q.MapEvent(q.MapEvent.MAP_INITIALIZED,c),c.initialized||(c.initialized=!0,c.inited=!1,c.fire(C.type,C)),O()):c.initialized?b.target.initLayer():u(b):(c.displayed=!0,k.zoomLevel=c.checkZoomLevel(k.zoomLevel),c.setAllInitialParams(),u(b),c.zoomToExtent(c.extentRect));else if(c.boundingLayerName&&-1!=c.universeLayerIndex)if(c.divLayers[c.universeLayerIndex]!=
b.target||c.displayed)if(c.boundingLayerName==b.target.name&&c.displayed)c.boundingThemeLoading?(C=b.bbox,C=b.target.calculateCenterAndZoomLevel(C[0],C[1],C[2],C[3]),c.initialized?(c.setMapCenterAndZoomLevel(C[1],C[0]),b.target.initLayer()):(k.centerPoint=C[1],k.homeCenter=k.centerPoint,k.zoomLevel=c.checkZoomLevel(C[0]),k.homeMapCenter||(k.homeMapCenter=k.homeCenter),c.wraparound&&(k.roundMapCenterPoint=k.homeCenter.clone()),k.homeMapZoomlevel||(k.homeMapZoomlevel=k.zoomLevel),c.checkCenter(),c.boundingThemeLoaded=
!0,C=new q.MapEvent(q.MapEvent.MAP_INITIALIZED,c),c.initialized=!0,c.inited=!1,c.fire(C.type,C),u(b)),O(),c.boundingThemeLoading=!1):(c.boundingThemeLoading=!0,b.target.loadBoundingTheme());else if(c.initialized&&c.boundingThemeLoaded){if(a.Map.isTileLayer(b.target.layerType)&&(u=new a.universe.Universe(b.config),!u.equals(k.universe))){c.resetUniverse(u,b.target,b.config);return}b.target.initLayer();O()}else u(b);else for(k.universe=(new a.universe.Universe(b.config)).copy(k.universe),c.displayed=
!0,u(b),u=0;u<c.layerQueue.length;u++){if(C=c.layerQueue[u],C[0].layerType==a.LayerTypes.VECTOR&&C[0].name==c.boundingLayerName){c.boundingThemeLoading=!0;C[0].loadBoundingTheme();break}}else if(-1!=c.universeLayerIndex)if(c.divLayers&&c.divLayers[c.universeLayerIndex]===b.target&&!c.displayed)if(k.universe=(new a.universe.Universe(b.config)).copy(k.universe),k.zoomLevel=c.checkZoomLevel(k.zoomLevel),c.displayed=!0,G=function(){c.checkCenter();var a=new q.MapEvent(q.MapEvent.MAP_INITIALIZED,c);c.initialized||
(c.initialized=!0,c.inited=!1,c.resetTag&&(a=new q.MapEvent(q.MapEvent.MAP_RESET_UNIVERSE,c)),c.fire(a.type,a));b.target.initLayer();O()},c.setAllInitialParams(),k.centerPoint.srid===k.universe.srid)k.homeCenter=k.centerPoint.clone(),c.wraparound&&(k.roundMapCenterPoint=k.homeCenter.clone()),G();else if(k.universe.srid===a.util.BaiduUtil.SRID)a.notNull(c.bdutil)&&a.util.BaiduUtil.transformGeom({geom:k.centerPoint,toSrid:a.util.BaiduUtil.SRID,callBack:function(a){k.centerPoint=a;k.homeCenter=k.centerPoint.clone();
c.wraparound&&(k.roundMapCenterPoint=k.homeCenter.clone());G()},map:c});else if(k.centerPoint.srid===a.util.BaiduUtil.SRID){var R=function(a){k.centerPoint=a;k.homeCenter=k.centerPoint.clone();c.wraparound&&(k.roundMapCenterPoint=a);G()};a.util.BaiduUtil.transformGeom({geom:k.centerPoint,toSrid:8307,callBack:function(a){a.transform(k.universe.srid,R)},map:c})}else k.centerPoint.transform(k.universe.srid,function(a){k.centerPoint=a;k.homeCenter=k.centerPoint.clone();c.wraparound&&(k.roundMapCenterPoint=
a);G()});else if(c.initialized){if(a.Map.isTileLayer(b.target.layerType)){C=b.target.getZIndex()-1;for(var X=0;X<C;X++)if(!c.divLayers[X].initCalled){u(b);return}u=new a.universe.Universe(b.config);if(!u.equals(k.universe)){c.resetUniverse(u,b.target,b.config);return}}b.target.initLayer();O()}else u(b);else c.boundingLayerName?b.target.name==c.boundingLayerName&&b.bbox?(c.displayed=!0,k.homeMapCenter=k.centerPoint,k.homeMapZoomlevel=k.zoomLevel,a.notNull(b.bbox[0])&&a.notNull(b.bbox[1])&&a.notNull(b.bbox[2])&&
a.notNull(b.bbox[3])?(C=b.target.calculateCenterAndZoomLevel(b.bbox[0],b.bbox[1],b.bbox[2],b.bbox[3]),k.homeCenter=C[1],k.homeMapCenter||(k.homeMapCenter=C[1]),k.homeMapZoomlevel||(k.homeMapZoomlevel=C[0]),c.setMapCenterAndZoomLevel(C[1],C[0])):c.setMapZoomLevel(0),c.checkCenter(),c.boundingThemeLoaded=!0,C=new q.MapEvent(q.MapEvent.MAP_INITIALIZED,c),c.initialized||(c.initialized=!0,c.inited=!1,c.fire(C.type,C)),a.notNull(b.bbox[0])&&a.notNull(b.bbox[1])&&a.notNull(b.bbox[2])&&a.notNull(b.bbox[3])&&
u(b),O()):b.target.name==c.boundingLayerName?(c.boundingThemeLoading=!0,b.target.loadBoundingTheme()):c.initialized&&c.boundingThemeLoaded?(b.target.initLayer(),O()):u(b):(u=this.getMapContext().getUniverse(),c.displayed=!0,k.zoomLevel=c.checkZoomLevel(k.zoomLevel),c.setAllInitialParams(),G=function(){var a=new q.MapEvent(q.MapEvent.MAP_INITIALIZED,c);c.checkCenter();c.initialized||(c.initialized=!0,c.inited=!1,c.fire(a.type,a));b&&b.target.initLayer();O()},k.centerPoint.srid==u.srid?(k.homeCenter=
k.centerPoint.clone(),c.wraparound&&(k.roundMapCenterPoint=k.homeCenter.clone()),G()):k.centerPoint.transform(u.srid,function(a){k.centerPoint=a;k.homeCenter=k.centerPoint.clone();c.wraparound&&(k.roundMapCenterPoint=k.homeCenter.clone());G()}))},init:function(){this.on(a.event.MapEvent.MAP_INITIALIZED,function(a){var b=a.target;b.getMapContext().getTransform();b.changeCursor(b.cursorStyleDefault);a=b.getMapContext().getUniverse().getMapBounds().getWidth();for(var c=b.getMapContext().getWholeMapNum(),
b=b.getMapContext().getBaseWholeMapIndex(),x=0;x<c;x++)this.mapBBox[x]={minX:(x-b)*a-a/2,maxX:(x-b)*a+a/2}});var b=a.event,c=this.getMapContextToken();this.layerQueue=[];if(this.initialized)this.cleanMap();else{var q=this.getMapContextToken();a.notNull(q.centerPoint)&&(q.homeMapCenter=q.centerPoint);this.wraparound&&a.notNull(q.homeMapCenter)&&(c.roundMapCenterPoint=q.homeMapCenter.clone());q.homeMapZoomlevel=q.zoomLevel}if(0===this.divLayers.length&&0===this.svgLayers.length)this.displayed=!0,c.zoomLevel=
this.checkZoomLevel(c.zoomLevel),this.initialized||(this.initialized=!0,this.inited=!1,c=new b.MapEvent(b.MapEvent.MAP_INITIALIZED,this),this.resetTag&&(c=new b.MapEvent(b.MapEvent.MAP_RESET_UNIVERSE,this)),this.fire(c.type,c));else{if(-1!==this.universeLayerIndex&&0<this.divLayers.length)for(b=this.divLayers[this.universeLayerIndex],b.layerType===a.LayerTypes.EXTERNAL&&(b.loaded=!0,b.setContainer(this.$tileLayersDiv[0])),a.isNull(this.overviewLayer)&&(this.overviewLayer=b),this.graphics.setVisible(this.draggableGroup,
!1),this.$heatMapDiv.css({visibility:"hidden"}),b.getLayerConfig(),c=this.universeLayerIndex+1;c<this.divLayers.length;c++)b=this.divLayers[c],b.layerType===a.LayerTypes.EXTERNAL&&(b.loaded=!0,b.setContainer(this.$tileLayersDiv[0])),b.getLayerConfig();for(c=0;c<=this.svgLayers.length-1;c++)a.isNull(this.overviewLayer)&&this.svgLayers[c]!==this.toolFeatureLayer&&this.svgLayers[c]!==this.defaultFeatureLayer&&(this.overviewLayer=this.svgLayers[c]),this.svgLayers[c].getLayerConfig();this.inited=!0;this.updateUTFGridLayerListener()}},
validateUTFGridLayerTriggers:function(){for(var b=null,c=0;c<this.divLayers.length;c++){var q=this.divLayers[c];q.layerType!==a.LayerTypes.TILE&&q.layerType!==a.LayerTypes.DYNAMIC_TILE||!0!==q.enableUTFGrid||!0!==q.getEnableInfoWindow()||!a.notNull(q.mouseETypeUTFGrid)||(a.isNull(b)?b=q.mouseETypeUTFGrid:(q.mouseETypeUTFGrid=b,a.util.Logger.warning("","OM.Map.getUTFGridMouseEType","UTFGrid info window trigger is set to:["+b+"]")))}},getUTFGridMouseEType:function(){for(var b=0;b<this.divLayers.length;b++){var c=
this.divLayers[b];if((c.layerType===a.LayerTypes.TILE||c.layerType===a.LayerTypes.DYNAMIC_TILE)&&!0===c.enableUTFGrid&&!0===c.getEnableInfoWindow()&&a.notNull(c.mouseETypeUTFGrid))return c.mouseETypeUTFGrid}return a.event.MouseEvent.MOUSE_CLICK},getUTFGridLayerCount:function(){for(var b=0,c=0;c<this.divLayers.length;c++){var q=this.divLayers[c];q.layerType!==a.LayerTypes.TILE&&q.layerType!==a.LayerTypes.DYNAMIC_TILE||!0!==q.enableUTFGrid||!0!==q.getEnableInfoWindow()||!0!==q.isVisible()||(b+=1)}return b},
refreshMap:function(){if(this.initialized){var b=new a.event.MapEvent(a.event.MapEvent.MAP_BEFORE_REFRESH,this);this.fire(b.type,b)}},redrawMap:function(){if(this.initialized){this.getMapContextToken().transform=null;this.getMapContext().getTransform();this.wraparound&&(this.getMapContextToken().roundMapCenterPoint=this.getMapContextToken().centerPoint);this.graphics.setLeftTop(this.draggableGroup,0,0);var b=new a.event.MapEvent(a.event.MapEvent.MAP_REDRAW,this);this.fire(b.type,b)}},destroyMap:function(){a.util.Logger.info(null,
"Destorying map instance "+this.mapInstanceId);var b=new a.event.MapEvent(a.event.MapEvent.MAP_DESTROY,this);this.fire(b.type,b);this.deleteAllListeners();this.template&&this.template.destroy();this.graphics&&(this.graphics.clearGroup(this.draggableGroup),this.graphics.clearGroup(this.blockerGroup),this.graphics.clearGroup(this.fixedGroup),this.graphics.removeAll());this.graphics=this.fixedGroup=this.blockerGroup=this.draggableGroup=null;this.undoManager&&this.undoManager.destroy();this.undoManager=
null;this.loadingIcon&&a.$(this.loadingIcon).remove();this.$topLayerDIV&&this.$topLayerDIV.remove();this.$fkGraphicLayersDiv&&this.$fkGraphicLayersDiv.remove();this.$tileLayersDiv&&this.$tileLayersDiv.remove();this.$heatMapDiv&&this.$heatMapDiv.remove();this.loadingIcon&&a.$(this.loadingIcon).empty();this.$oracleMapDiv&&this.$oracleMapDiv.remove();this.$containerDiv&&this.$containerDiv.unbind().empty();this.mapDragOutDiv&&a.$(document).unbind("mouseup",this.mapDragOutDiv).unbind("mouseout",this.mapDragOutDiv);
this.dropOnDoc&&a.$(document).unbind("drop",this.dropOnDoc);this.$heatMapDiv=this.$containerDiv=this.$oracleMapDiv=this.$tileLayersDiv=this.$fkGraphicLayersDiv=this.$topLayerDIV=this.loadingIcon=this.dropOnDoc=this.mapDragOutDiv=null;this.divLayers=[];this.svgLayers=[];this.overview=this.overviewLayer=this.toolFeatureLayer=this.defaultFeatureLayer=null;this.decorationArray=[];this.layerQueue=[];for(var b=a.gv.mapInstances,c=b.length,q=0;q<c;q++)if(b[q]==this){b.splice(q,1);break}},getUniverse:function(){return this.getMapContext().getUniverse()},
setMapCenter:function(a,b){!1!==b&&(b=!0);this.wraparound?this.setMapCenterAndZoomLevel(a,this.getMapContext().getZoomLevel(),b):this.setMapCenterAndZoomLevel(a,null,b)},getMapCenter:function(b){if(a.isNull(b))return this.getMapContext().getCenterPoint();this._noZoomInOut=!0;this.zoomToExtent(b);this._noZoomInOut=!1;return this._mapCenter},setMapZoomLevel:function(a){this.setMapCenterAndZoomLevel(null,a,!0)},getMapZoomLevel:function(b){if(a.isNull(b))return this.getMapContext().getZoomLevel();this._noZoomInOut=
!0;this.zoomToExtent(b);this._noZoomInOut=!1;return this._zoomLevel},setMapScale:function(b,c){var q=this,k=function(){q.deleteListener(a.event.MapEvent.MAP_INITIALIZED,k);var O=q.getMapContext().getUniverse().getSRID();q.setMapResolution(8307==O||8265==O||4326==O?.0254*b/111195/a.gv.DPI:.0254*b/a.gv.DPI,c)};if(this.initialized)k();else this.on(a.event.MapEvent.MAP_INITIALIZED,k)},getMapScale:function(){var b=this.getMapContext(),c=b.getZoomLevel(),b=b.getUniverse().getZoomLevels()[c].resolution;
return a.gv.DPI*b/.0254},setMapResolution:function(a,b,c){var k=this.getMapContext().getUniverse().getZoomLevels();b||(b=null);if(a>k[0].resolution)this._zoomLevel=0,this._noZoomInOut||this.setMapCenterAndZoomLevel(b,0);else{for(var O=0;O<k.length-1;O++)if(k[O+1].resolution<=a&&k[O].resolution>=a){c?(this._zoomLevel=O,this._noZoomInOut||this.setMapCenterAndZoomLevel(b,O)):a/k[O].resolution>=k[O+1].resolution/a?(this._zoomLevel=O,this._noZoomInOut||this.setMapCenterAndZoomLevel(b,O)):(this._zoomLevel=
O+1,this._noZoomInOut||this.setMapCenterAndZoomLevel(b,O+1));return}this._zoomLevel=O;this._noZoomInOut||this.setMapCenterAndZoomLevel(b,O)}},zoomToExtent:function(a){var b=this,c=this.getMapContextToken(),k=c.universe;if(0!==a.getWidth()&&0!==a.getHeight()){var O=function(a){var x=a.getWidth()/c.deviceWindow.w,O=a.getHeight()*k.zoomLevels[c.zoomLevel].stretchRatio/c.deviceWindow.h;b._mapCenter=a.getCenter();x>O?b.setMapResolution(x,a.getCenter(),!0):b.setMapResolution(O,a.getCenter(),!0);b.initialized||
b.initLayers()};b.extentRect=a;this.displayed&&(a.srid==k.srid?O(a):a.transform(k.srid,function(a){O(a)}))}},zoom_debounce:a.util.MiscUtil.debounce(function(a){this.setMapZoomLevel(a);this.curZmLvl=null},500),zoomIn:function(){a.isNull(this.curZmLvl)?this.curZmLvl=this.getMapContext().getZoomLevel():this.curZmLvl+=1;this.zoom_debounce(this.curZmLvl+1)},zoomOut:function(){a.isNull(this.curZmLvl)?this.curZmLvl=this.getMapContext().getZoomLevel():--this.curZmLvl;this.zoom_debounce(this.curZmLvl-1)},
pan:function(b,c,q){if(0!==b||0!==c){var k=b,O=c,u=0,C=this.getMapContextToken(),G=C.universe,R=C.zoomLevel,X=G.zoomLevels[R].resolution,N=G.zoomLevels[R].stretchRatio,r=b*X,n=c*X*N,M=G.bound.getMinX(),Z=G.bound.getMaxX(),u=G.bound.getMinY(),ba=G.bound.getMaxY(),R=C.centerPoint.clone(),Y=new a.geometry.Point(C.centerPoint.getX()-r,C.centerPoint.getY()+n,G.srid),sa;this.wraparound&&(sa=new a.geometry.Point(C.roundMapCenterPoint.getX()-r,C.roundMapCenterPoint.getY()+n,G.srid));var la=C.deviceWindow,
oa=la.w*X,wa=la.h*X*N,la=C.universe.getMapBounds().getWidth();if(this.wrapAroundp){if(Y.getY()<u||Y.getY()>ba)return}else if(Y.getX()<M||Y.getX()>Z||Y.getY()<u||Y.getY()>ba)return;if(Y.getX()+oa/2<Z&&Y.getY()+wa/2<ba&&Y.getX()-oa/2>M&&Y.getY()-wa/2>u||this.wraparound){if(this.wraparound){if(Y.getY()>la/6||Y.getY()<-la/6)if(Y.getY()<u+wa/2||Y.getY()>ba-wa/2)return;Y=C.centerPoint.getX()>la/2?new a.geometry.Point(C.centerPoint.getX()-r-la,C.centerPoint.getY()+n,G.srid):C.centerPoint.getX()<-la/2?new a.geometry.Point(C.centerPoint.getX()-
r+la,C.centerPoint.getY()+n,G.srid):new a.geometry.Point(C.centerPoint.getX()-r,C.centerPoint.getY()+n,G.srid);C.roundMapCenterPoint=sa}C.centerPoint=Y;C.homeCenter=Y.clone();k=this.getMapContext().getWholeMapNum();O=this.getMapContext().getBaseWholeMapIndex();this.mapBBox=[];for(C=0;C<k;C++)this.mapBBox[C]={minX:(C-O)*la-la/2,maxX:(C-O)*la+la/2}}else sa=Y.getX(),la=Y.getY(),0>c&&Y.getY()-wa/2<u?(u=(R.getY()-wa/2-u)/(X*N),c=0<u?-1*Math.min(u,Math.abs(O)):0,la=R.getY()+c*X*N):0<c&&Y.getY()+wa/2>ba&&
(u=(ba-(R.getY()+wa/2))/(X*N),c=0<u?Math.min(u,O):0,la=R.getY()+c*X*N),0<b&&Y.getX()-oa/2<M?this.wraparound?(u=(M+oa/2-R.getX())/X*-1,Math.abs(u)<Math.abs(k)&&(b=u,sa=R.getX()+b*X)):(u=(R.getX()-oa/2-M)/X,b=0<u?Math.min(u,b):0,sa=R.getX()+-1*b*X):0>b&&Y.getX()+oa/2>Z&&(this.wraparound?(u=(R.getX()-(Z-oa/2))/X,Math.abs(u)<Math.abs(k)&&(b=u,sa=R.getX()+b*X)):(u=(Z-(R.getX()+oa/2))/X,b=0<u?-1*Math.min(u,Math.abs(b)):0,sa=R.getX()+-1*b*X)),C.centerPoint.setPoint(sa,la),C.homeCenter.setPoint(sa,la);0===
b&&0===c||!this.initialized||(k=new a.event.MapEvent(a.event.MapEvent.I_MAP_DRAGGING,this),k.xOffset=b,k.yOffset=c,k.preCenter=R,this.doSmoothPan(k,q))}},doSmoothPan:function(b,c){var q=b.xOffset,k=b.yOffset,O=this,u=this.graphics,C=null,G=0,R=0,X=0,N=function(){O.graphics&&(Math.abs(q)>r?(b.xOffset=r*(Math.abs(q)/q),q-=r*(Math.abs(q)/q)):(b.xOffset=q,q=0),Math.abs(k)>r?(b.yOffset=r*(Math.abs(k)/k),k-=r*(Math.abs(k)/k)):(b.yOffset=k,k=0),C=u.getLeftTop(O.draggableGroup),u.setLeftTop(O.draggableGroup,
C.x+b.xOffset,C.y+b.yOffset),O.fire(b.type,b),X++,X<R?setTimeout(N,20):O.moveflag||(b=new a.event.MapEvent(a.event.MapEvent.MAP_RECENTERED,O),O.fire(b.type,b)))},r=Math.floor(a.MapContext(this).getDeviceWidth()/10);!c||Math.abs(q)<r&&Math.abs(k)<r?(C=u.getLeftTop(O.draggableGroup),O.divLayers&&0<O.divLayers.length?b.callback=function(){u.setLeftTop(O.draggableGroup,C.x+q,C.y+k)}:u.setLeftTop(O.draggableGroup,C.x+q,C.y+k),O.fire(b.type,b),O.moveflag||(b=new a.event.MapEvent(a.event.MapEvent.MAP_RECENTERED,
O),O.fire(b.type,b))):(G=Math.abs(q)>Math.abs(k)?q:k,R=Math.abs(G/r),setTimeout(N,20))},checkZoomLevel:function(b){var c=this.getMapContextToken().universe;if(c&&c.getZoomLevelNumber)if(a.notNull(b)){var q=c.getZoomLevelNumber()-1;b>q&&(b=q);0>b&&(b=0)}else b=0;c.srid===a.util.BaiduUtil.SRID&&(b=a.util.BaiduUtil.getValidZoomLevel(b));return b},setMapCenterAndZoomLevel:function(b,c,q){this.zoomComplete=q=!1;this.divLayers&&1===this.divLayers.length&&"google"===this.divLayers[0].tileSource&&this.divLayers[0].mapType===
a.layer.GoogleTileLayer.TYPE_SHADED&&15<=c&&(c=14);this.divLayers&&1===this.divLayers.length&&!0===this.divLayers[0].isBaiduMap&&!1===a.util.BaiduUtil.isZoomLevelValid(c)&&(c=a.util.BaiduUtil.getValidZoomLevel(c));if(!c&&this.wraparound||!c&&this.over)c=0;var k=this,O=this.getMapContextToken();!this.initialized||a.isNull(b)||O.centerPoint.srid===b.srid?this.do_setMapCenterAndZoomLevel(b,c,q):O.centerPoint.srid!==a.util.BaiduUtil.SRID?b.transform(O.universe.srid,function(a){k.do_setMapCenterAndZoomLevel(a,
c,q)}):b.transform(O.universe.srid,function(a){k.do_setMapCenterAndZoomLevel(a,c,q)},null,null,{map:k,inputIsBD09LonLat:!0});setTimeout(function(){if(k.wraparound)for(var b=0;b<k.divLayers.length;b++)k.divLayers[b].mapType!==a.layer.BingTileLayer.TYPE_ROAD&&k.divLayers[b].mapType!==a.layer.BingTileLayer.TYPE_AERIAL||k.redrawMap()},100)},do_setMapCenterAndZoomLevel:function(b,c,q){var k=null,k=null,O=this.getMapContextToken(),u;this.on(a.event.MapEvent.MAP_AFTER_ZOOM,function(){this.wraparound&&this.pan(0,
0);var a=O.universe.getMapBounds().getWidth(),b=this.getMapContext().getWholeMapNum(),c=this.getMapContext().getBaseWholeMapIndex();this.mapBBox=[];for(var x=0;x<b;x++)this.mapBBox[x]={minX:(x-c)*a-a/2,maxX:(x-c)*a+a/2};this.zoomComplete=!0},this);if(this.initialized){if(!a.notNull(c)||!1!==this.zoomEnabled)if(a.notNull(c)&&this.checkZoomLevel(c)!==O.zoomLevel){this.grid&&(this.grid.clear(),u=this.getLabelGridBox(c),this.grid.setBox(u));u=new a.event.MapEvent(a.event.MapEvent.I_MAP_CENTER_ZOOM,this);
k=O.zoomLevel;O.transform=null;O.zoomLevel=this.checkZoomLevel(c);u.beforeZoomLevel=k;u.afterZoomLevel=O.zoomLevel;q=new a.event.MapEvent(a.event.MapEvent.MAP_BEFORE_ZOOM,this);q.beforeZoomLevel=k;q.afterZoomLevel=O.zoomLevel;this.fire(q.type,q);u.preMapCenter=O.centerPoint.clone();b&&b!=O.homeCenter&&(O.centerPoint=b,O.homeCenter=O.centerPoint.clone(),this.wraparound&&(O.roundMapCenterPoint=b));this.checkCenter();for(q=0;q<this.svgLayers.length;q++)this.svgLayers[q].loaded=!1,this.svgLayers[q].clearFeatureShapes();
0<this.divLayers.length&&(this.graphics.setVisible(this.draggableGroup,!1),this.$heatMapDiv.css({visibility:"hidden"}));for(q=0;q<this.divLayers.length;q++)this.divLayers[q].loaded=!1;this.graphics&&this.graphics.clearToolTips();a.isNull(this.graphics)||(this.graphics.setLeftTop(this.draggableGroup,0,0),this.getMapContext().getTransform(),this.fire(u.type,u),u=new a.event.MapEvent(a.event.MapEvent.MAP_AFTER_ZOOM,this),u.beforeZoomLevel=k,u.afterZoomLevel=O.zoomLevel,this.fire(u.type,u))}else{if(b){k=
O.centerPoint.clone();O.centerPoint=b;O.homeCenter=O.centerPoint.clone();this.wraparound&&(O.roundMapCenterPoint=b);b=this.checkCenter(O.centerPoint);u=O.centerPoint;c=Math.round((k.getX()-u.getX())/O.universe.zoomLevels[O.zoomLevel].resolution);var C=Math.round((u.getY()-k.getY())/O.universe.zoomLevels[O.zoomLevel].resolution*O.universe.zoomLevels[O.zoomLevel].stretchRatio);if(0===c&&0===C){u=new a.event.MapEvent(a.event.MapEvent.MAP_RESTRICT_CENTER,this);this.fire(u.type,u);this.zoomComplete=!0;
return}Math.abs(c)>O.deviceWindow.w||Math.abs(C)>O.deviceWindow.h?(this.graphics.setLeftTop(this.draggableGroup,0,0),O.transform=null,u=new a.event.MapEvent(a.event.MapEvent.MAP_BEFORE_REFRESH,this),u.preMapCenter=k,u.restrictCenter=b,u.bigPan=!0,this.fire(u.type,u)):(u=new a.event.MapEvent(a.event.MapEvent.I_MAP_DRAGGING,this),u.xOffset=Math.round(c),u.yOffset=Math.round(C),u.preCenter=k,u.restrictCenter=b,this.doSmoothPan(u,q))}else for(u=0;u<this.divLayers.length;u++)this.divLayers[u].zoomControl&&
this.divLayers[u].zoomControl.reset&&this.divLayers[u].zoomControl.endScaling&&(this.divLayers[u].zoomControl.reset(),this.divLayers[u].zoomControl.endScaling());this.zoomComplete=!0}}else this.zoomComplete=!0,b&&(O.centerPoint=b,O.homeCenter=O.centerPoint.clone(),this.wraparound&&(O.roundMapCenterPoint=b)),a.notNull(c)&&(O.zoomLevel=this.checkZoomLevel(c))},forceBuiltinCopyright:function(a,b){if(a&&a.dataSource&&a.tileLayer&&a.serverURL){var c=a.dataSource.toUpperCase(),k=a.tileLayer.toUpperCase();
if(!(0>a.serverURL.toLowerCase().indexOf("//elocation.oracle.com/mapviewer/mcserver"))){if("ELOCATION_MERCATOR"!==c)return null;"WORLD_MAP"===k||"BI_WORLD_MAP"===k||"BI_WORLD_MAP_LIGHT"===k?a.addListener(b.LayerEvent.FINISH_GOT_CONFIG,this.listenerElocationCopyright):0===k.indexOf("OSM")?a.addListener(b.LayerEvent.FINISH_GOT_CONFIG,this.listenerOSMCopyright):a.addListener(b.LayerEvent.FINISH_GOT_CONFIG,this.listenerElocationCopyright)}}},addLayer:function(b,c,q){var k=this;b.parentMap=this;if(k.inited&&
!k.initialized)setTimeout(function(){k.addLayer(b,c)},50);else if(this.getLayerByName(b.name))a.util.Logger.warning("MAPVIEWER_9102","OM.Map.addLayer");else{a.isNull(c)&&(c="undefined");this.typeArray.push(c);b.customType=c;a.isNull(this.nameArray[c])&&(this.nameArray[c]=[]);this.nameArray[c].push(b.name);var O=a.event;this.on(O.MapEvent.I_MAP_DRAGGING,b.panEvent,b);this.on(O.MapEvent.MAP_RECENTERED,b.recenter,b);this.on(O.MapEvent.I_MAP_CENTER_ZOOM,b.setCenterAndZoomlevel,b);this.on(O.MapEvent.MAP_BEFORE_REFRESH,
b.refreshEvent,b);this.on(O.MapEvent.MAP_REDRAW,b.redraw,b);this.on(O.MapEvent.MAP_DESTROY,b.destroy,b);if(b instanceof a.layer.VectorLayer&&b.useRTree)this.on(O.MapEvent.MAP_BEFORE_ZOOM,b.beforeZoom,b);b.addListener(O.LayerEvent.FINISH_GOT_CONFIG,k.newLayerConfigLoaded);b.addListener(O.LayerEvent.FINISH_LOAD,k.layerFinish);b.addListener(O.LayerEvent.ALL_TILES_LOADED,k.layerFinish);b.addListener(O.LayerEvent.INIT_ERROR,k.layerErr);b.addListener(O.LayerEvent.RENDERING_STYLE_CHANGED,k.layerStyleChanged);
b.addListener(O.LayerEvent.NSDP_MAPPED,k.nsdpMapped);this.forceBuiltinCopyright(b,O);a.isNull(b.serverURL)&&(b.serverURL=this.mapviewerURL);if("invalid url"===b.serverURL)a.util.Logger.alert("MAPVIEWER_9020","OM.Map.addLayer","");else{a.Map.isTileLayer(b.layerType)?(b.layerType===a.LayerTypes.EXTERNAL&&(this.hasExternal=!0),-1===this.universeLayerIndex&&(this.universeLayerIndex=this.divLayers.length),!a.isNull(q)&&q<this.divLayers.length?this.divLayers.splice(q,0,b):(this.divLayers.push(b),this.updateUTFGridLayerListener())):
(b.initGroup(),b.isBoundingTheme()&&!this.initialized?this.boundingLayerName=b.name:b.isBoundingTheme()&&(this.boundingThemeLoading=this.boundingThemeLoaded=!1,this.boundingLayerName=b.name),b.getEnableInfoWindow()&&b.addListener(this.vectorlayerInfoWindowMouseEType,b.insertFeatureInfo),this.svgLayers.push(b));this.initialized&&(b.layerType==a.LayerTypes.EXTERNAL&&(b.loaded=!0),b.layerType==a.LayerTypes.EXTERNAL&&b.setContainer(this.$tileLayersDiv[0]),k.grid&&k.grid.clear(),b.getLayerConfig(),this.overview&&
(this.changeOverView(),this.overview.overFeatureLayer&&this.overview.overFeatureLayer.bringToTop()));q=null;q=a.Map.isTileLayer(b.layerType)?this.divLayers.length:this.svgLayers.length+this.divLayers.length-2;O=new O.MapEvent(O.MapEvent.LAYER_ADDED,k);O.affectedLayer=b;this.fire(O.type,O);for(O=0;O<this.decorationArray.length;O++){var u=this.decorationArray[O];"LayerControl"==u.type&&(u.left=parseInt(u.$DecorationDiv.css("left")),u.top=parseInt(u.$DecorationDiv.css("top")),u.width=u.currentWidth,
this.removeMapDecoration(u),this.addMapDecoration(u))}this.$oracleMapDiv.keydown(function(c){17!=c.keyCode&&91!=c.keyCode&&93!=c.keyCode||!b.selectionEnable||b.multiSelect||(b.multiSelect=!0,b.enableFeatureSelection(!0,a.layer.VectorLayer.MULTIPLE_SELECTION))});this.$oracleMapDiv.keyup(function(c){17!=c.keyCode&&91!=c.keyCode&&93!=c.keyCode||!b.selectionEnable||(b.multiSelect=!1,b.enableFeatureSelection(!0,a.layer.VectorLayer.SINGLE_SELECTION))});this.resetTileLayerZIndex();return q}}},resetTileLayerZIndex:function(){var b;
for(b=0;b<this.divLayers.length;b++){var c;this.divLayers[b].zIndex=b;c=this.divLayers[b].container;a.isNull(c)?(c=this.divLayers[b].jqLayerDiv,a.isNull(c)||(c=c[0].style,a.isNull(c)||(c.zIndex=b))):(c=c.style,a.isNull(c)||(c.zIndex=b))}},removeAllFeatureLayers:function(){for(var a=this.svgLayers,b=a.length-1;0<=b;b--){var c=a[b].name;"ii_oracle_maps_internal_editing"!=c&&"ii_oracle_maps_internal_others"!=c&&this.removeLayer(a[b])}},removeLayer:function(b){var c,q,k;if(b){q=new a.event.MapEvent(a.event.MapEvent.LAYER_DELETED,
b.parentMap);q.affectedLayer=b;b===this.overviewLayer&&(this.userSetOL=!1);c=0;for(k=this.svgLayers.length;c<k;c++)if(this.svgLayers[c]===b){this.deleteLayerListener(b);var O=-1;for(k=0;k<this.nameArray[this.svgLayers[c].customType].length;k++)this.nameArray[this.svgLayers[c].customType][k]===this.svgLayers[c].name&&(O=k);-1<O&&this.nameArray[this.svgLayers[c].customType].splice(O,1);this.svgLayers.splice(c,1);this.fire(q.type,q);this.refreshVectorLayerLabels();b.parentMap=null;for(c=0;c<this.decorationArray.length;c++)q=
this.decorationArray[c],"LayerControl"===q.type&&(q.left=parseInt(q.$DecorationDiv.css("left")),q.top=parseInt(q.$DecorationDiv.css("top")),q.width=q.currentWidth,this.removeMapDecoration(q),this.addMapDecoration(q));return b}c=0;for(k=this.divLayers.length;c<k;c++)if(this.divLayers[c]===b){this.deleteLayerListener(b);this.divLayers.splice(c,1);this.fire(q.type,q);b.parentMap=null;for(k=0;k<this.decorationArray.length;k++)q=this.decorationArray[k],"LayerControl"===q.type&&(this.removeMapDecoration(q),
this.addMapDecoration(q));for(k=0;k<this.typeArray.length;k++)if(c=this.typeArray[k],this.nameArray[c][k]===b.name){this.nameArray[c].splice(k,1);this.typeArray.splice(k,1);break}return b}c=0;for(k=this.divLayers.length;c<k;c++)if(this.divLayers[c].layerType===a.LayerTypes.EXTERNAL){this.hasExternal=!0;break}else this.hasExternal=!1;for(c=0;c<this.decorationArray.length;c++)q=this.decorationArray[c],"LayerControl"===q.type&&(this.removeMapDecoration(q),this.addMapDecoration(q))}this.resetTileLayerZIndex();
this.updateUTFGridLayerListener()},deleteLayerListener:function(b){if(b){this.deleteListener(a.event.MapEvent.I_MAP_DRAGGING,b.panEvent,b);this.deleteListener(a.event.MapEvent.MAP_RECENTERED,b.recenter,b);this.deleteListener(a.event.MapEvent.I_MAP_CENTER_ZOOM,b.setCenterAndZoomlevel,b);this.deleteListener(a.event.MapEvent.MAP_BEFORE_REFRESH,b.refreshEvent,b);this.deleteListener(a.event.MapEvent.MAP_REDRAW,b.redraw,b);this.deleteListener(a.event.MapEvent.MAP_DESTROY,b.destroy,b);var c=a.event.LayerEvent;
b.deleteListener(c.FINISH_GOT_CONFIG,this.newLayerConfigLoaded);b.deleteListener(c.FINISH_LOAD,this.layerFinish);b.deleteListener(c.ALL_TILES_LOADED,this.layerFinish);b.deleteListener(c.INIT_ERROR,this.layerErr);b.deleteListener(c.RENDERING_STYLE_CHANGED,this.layerStyleChanged);b.deleteListener(c.NSDP_MAPPED,this.nsdpMapped);b.clearLayer&&b.clearLayer();b.destroy&&b.destroy();(new a.event.MapEvent(a.event.MapEvent.LAYER_DELETED,this)).affectedLayer=b}},addToolBar:function(c){a.notNull(c)&&(c.map=
this,a.$("#div_"+c.innerID).attr("id")!==b?a.util.Logger.warning("MAPVIEWER-9048","OM.Map.addToolBar","Toolbar ID is already used, please pick a new ID."):(this.addMapDecoration(c.toolBarDecoration),c.positionPending&&c.setPosition(),c.initBuiltInTools(),c.initCustomBts(),this.on(a.event.MapEvent.MAP_CLEAN,c.clearTools,this)))},addMagnifier:function(b){a.notNull(b)&&(this.addMapDecoration(b),b.map=this)},removeToolbar:function(a){this.removeMapDecoration(a.toolBarDecoration);a.destroy();a.map=null},
addNavigationPanelBar:function(){var b=new a.control.NavigationPanelBar;this.addMapDecoration(b)},addScaleBar:function(){var b=new a.control.ScaleBar;this.addMapDecoration(b)},addScaleBarValue:function(b,c){this.ScaleBar||this.addMapDecoration(c);c.$DecorationDiv.css({display:"none"});a.$(b).html(c.getTopScaleValue()+"\x3cbr\x3e"+c.getBottomScaleValue());this.on(a.event.MapEvent.MAP_AFTER_REFRESH,function(){a.$(b).html(c.getTopScaleValue()+"\x3cbr\x3e"+c.getBottomScaleValue())})},addScaleBarUnit:function(b,
c){this.ScaleBar||this.addMapDecoration(c);c.$DecorationDiv.css({display:"none"});a.$(b).html(c.getTopScaleUnit()+"\x3cbr\x3e"+c.getBottomScaleUnit());this.on(a.event.MapEvent.MAP_AFTER_REFRESH,function(){a.$(b).html(c.getTopScaleUnit()+"\x3cbr\x3e"+c.getBottomScaleUnit())})},addScaleBarDiv:function(b,c){this.ScaleBar||this.addMapDecoration(c);c.$DecorationDiv.css({display:"none"});c.getBottomScaleBar()?a.$(b).html(c.getTopScaleBar().prop("outerHTML")+c.getBottomScaleBar().prop("outerHTML")):a.$(b).html(c.getTopScaleBar().prop("outerHTML"));
this.on(a.event.MapEvent.MAP_AFTER_REFRESH,function(){c.getBottomScaleBar()?a.$(b).html(c.getTopScaleBar().prop("outerHTML")+c.getBottomScaleBar().prop("outerHTML")):a.$(b).html(c.getTopScaleBar().prop("outerHTML"))})},addMapDecoration:function(b,c){c?(this._decoration[b.type]=c,b.collapsible=!1,b.draggable=!1):this._decoration[b.type]=null;if(this.graphics&&a.notNull(b)){this.decorationArray=this.decorationArray||[];for(var q=0;q<this.decorationArray.length;q++)if(b.id===this.decorationArray[q].id||
b.mapType===this.decorationArray[q].mapType&&"mapTypeControl"==b.mapType)return;this.decorationArray.push(b);b.map=this;this.initialized||"ToolBar"==b.type?b.display():("CopyRight"===b.type&&(this.copyRight=b),this.on(a.event.MapEvent.MAP_INITIALIZED,b.display,b),this.on(a.event.MapEvent.MAP_RESET_UNIVERSE,b.display,b));this.on(a.event.MapEvent.MAP_DESTROY,b.remove,b);this.on(a.event.MapEvent.MAP_CLEAN,b.clean,b)}},removeMapDecoration:function(b){if(this.decorationArray&&0!==this.decorationArray.length&&
b)for(var c=0;c<this.decorationArray.length;c++)if(this.decorationArray[c].id===b.id){this.decorationArray.splice(c,1);this.deleteListener(a.event.MapEvent.MAP_CLEAN,b._cleanMapDecoration);this.deleteListener(a.event.MapEvent.MAP_DESTROY,b._removeMapDecoration);this.deleteListener(a.event.MapEvent.MAP_INITIALIZED,b.display);this.deleteListener(a.event.MapEvent.MAP_RESET_UNIVERSE,b.display);b.remove();break}},showOverviewMap:function(){this.setOverviewMapOptions({display:!0})},hideOverviewMap:function(){this.setOverviewMapOptions({display:!1})},
setOverviewMapOptions:function(a){a&&a.overviewLayer&&(-1==this.getLayerCurrentIndex(a.overviewLayer)?a.overviewLayer=null:this.userSetOL=!0);this.overview&&this.overview.setOverviewMapOptions(a)},getCursorLocation:function(){return this.getScreenPointLocation(this.mLocX,this.mLocY)},getAbsoluteCursorLocation:function(){return this.getScreenPointLocation(this.mLocX,this.mLocY,!0)},getACL:function(b,c){var q=this.getMapContext(),k=q.getBaseWholeMapIndex(),q=q.getUniverse().getMapBounds().getWidth(),
k=b.getX()+(c-k)*q;return new a.geometry.Point(k,b.getY(),b.srid)},getScreenPointLocation:function(b,c,q){var k=this.getMapContext().getBaseWholeMapIndex(),O=k,u=a.MapContext(this),C=u.getUniverse(),G=u.getZoomLevel(),R=u.getCenterPoint();b-=u.getDeviceWidth()/2;c-=u.getDeviceHeight()/2;var X=null;if(C&&C.zoomLevels){var G=this.checkZoomLevel(G),N=C.zoomLevels[G].resolution,X=C.zoomLevels[G].stretchRatio;b=R.getX()+b*N;c=R.getY()-c*N*X;return this.wraparound?(u=u.getUniverse().getMapBounds().getWidth(),
b<-u/2&&(O=k+Math.floor((b+u/2)/u)),b>u/2&&(O=k+Math.ceil((b-u/2)/u)),q||(b<-u/2&&(b-=u*Math.floor((b+u/2)/u)),b>u/2&&(b-=u*Math.ceil((b-u/2)/u))),q=new a.geometry.Point(b,c,C.srid),q.setPointIndex(O),q):isNaN(b)||isNaN(c)?null:new a.geometry.Point(b,c,C.srid)}return null},getScreenLocation:function(b){var c=a.MapContext(this),q=c.getUniverse();if(q&&q.zoomLevels){var k=this.checkZoomLevel(c.getZoomLevel()),O=q.zoomLevels[k].resolution,q=q.zoomLevels[k].stretchRatio,k=c.getCenterPoint(),u=b.getX();
b=b.getY();u=(u-k.getX())/O+c.getDeviceWidth()/2;c=(k.getY()-b)/O*q+c.getDeviceHeight()/2;return{x:Math.round(u),y:Math.round(c)}}},getMapWindowBoundingBox:function(){var b=a.MapContext(this).getDeviceWindow(),c=this.getScreenPointLocation(0,0),b=this.getScreenPointLocation(b.w,b.h);return a.isNull(c)?null:new a.geometry.Rectangle(c.getX(),c.getY(),b.getX(),b.getY(),b.srid)},getMaxResolution:function(){},getMinResolution:function(){},setMaxResolution:function(){},setMinResolution:function(){},backToHomeMap:function(){var b=
this.getMapContextToken();a.isNull(b.homeMapZoomlevel)&&(b.homeMapZoomlevel=b.zoomLevel);b.homeMapCenter||(b.homeMapCenter=b.centerPoint);this.setMapCenterAndZoomLevel(b.homeMapCenter,b.homeMapZoomlevel,!0)},setLayerIndex:function(b,c){var q=this.divLayers.length,k=this.svgLayers.length,O=this.getLayerCurrentIndex(b);if(O==c)return c;if(a.Map.isTileLayer(b.layerType)){if(1>=c)return this.sendToBottom(b);if(c>=q)return this.bringToTop(b);O--;this.divLayers.splice(O,1);this.divLayers.splice(c-1,0,b);
for(q=0;q<this.divLayers.length;q++)a.$("#tilelayer_"+this.divLayers[q].name).css({"z-index":q})}else{if(c<=q+1)return this.sendToBottom(b);if(c>=q+k-2)return this.bringToTop(b);if(a.isNotNull(b.heatMap)&&null!==b.getRenderingStyle()&&b.getRenderingStyle()instanceof a.style.HeatMap)return c<O?this.sendToBottom(b):this.bringToTop(b);k=c-q-1;this.svgLayers.splice(O-q-1,1);this.svgLayers.splice(k,0,b);this.graphics.setDisplayIndex(b.group,k)}q=new a.event.MapEvent(a.event.MapEvent.LAYER_REORDERED,this);
q.affectedLayer=b;this.fire(q.type,q);return c},getLayerCurrentIndex:function(b){var c,q;if(a.Map.isTileLayer(b.layerType)){q=this.divLayers.length;if(0===q)return-1;for(c=0;c<q;c++)if(this.divLayers[c]==b)return c+1}else{q=this.svgLayers.length;if(0===q)return-1;for(c=0;c<q;c++)if(this.svgLayers[c]==b)return c+this.divLayers.length+1}return-1},bringForward:function(b){var c=this.getLayerCurrentIndex(b);if(!(0>c)){var q=null,k=new a.event.MapEvent(a.event.MapEvent.LAYER_REORDERED,this);k.affectedLayer=
b;if(a.Map.isTileLayer(b.layerType)){if(this.divLayers[this.divLayers.length-1]===b)return this.fire(k.type,k),this.divLayers.length;q=this.divLayers[c];this.divLayers[c]=b;this.divLayers[c-1]=q;for(b=0;b<this.divLayers.length;b++)a.$("#tilelayer_"+this.divLayers[b].name).css({"z-index":b});this.fire(k.type,k);return c+1}if(!(3>this.svgLayers.length)){if(this.svgLayers[this.svgLayers.length-3]==b)return this.fire(k.type,k),this.svgLayers.length-3+this.divLayers.length;if(a.isNotNull(b.heatMap)&&null!==
b.getRenderingStyle()&&b.getRenderingStyle()instanceof a.style.HeatMap)return this.bringToTop(b);q=this.svgLayers[c-this.divLayers.length];this.svgLayers[c-this.divLayers.length]=b;this.svgLayers[c-1-this.divLayers.length]=q;this.graphics.bringForward(b.group);this.fire(k.type,k);return c+1}}},sendBackward:function(b){var c=this.getLayerCurrentIndex(b);if(!(0>c)){var q=new a.event.MapEvent(a.event.MapEvent.LAYER_REORDERED,this);q.affectedLayer=b;var k=null;if(a.Map.isTileLayer(b.layerType)){if(this.divLayers[0]==
b)return this.fire(q.type,q),1;k=this.divLayers[c-2];this.divLayers[c-2]=b;this.divLayers[c-1]=k;for(b=0;b<this.divLayers.length;b++)a.$("#tilelayer_"+this.divLayers[b].name).css({"z-index":b})}else{if(this.svgLayers[0]==b)return this.fire(q.type,q),1+this.divLayers.length;if(a.isNotNull(b.heatMap)&&null!==b.getRenderingStyle()&&b.getRenderingStyle()instanceof a.style.HeatMap)return this.sendToBottom(b);k=this.svgLayers[c-this.divLayers.length-2];this.svgLayers[c-2-this.divLayers.length]=b;this.svgLayers[c-
1-this.divLayers.length]=k;this.graphics.sendBackward(b.group)}this.fire(q.type,q);return c-1}},bringToTop:function(b,c){var q=this.getLayerCurrentIndex(b,c);if(!(0>q)){var k=new a.event.MapEvent(a.event.MapEvent.LAYER_REORDERED,this);k.affectedLayer=b;if(a.Map.isTileLayer(b.layerType)){if(this.divLayers[this.divLayers.length-1]==b)return this.fire(k.type,k),this.divLayers.length;this.divLayers.splice(q-1,1);this.divLayers.push(b);for(q=0;q<this.divLayers.length;q++)a.$("#tilelayer_"+this.divLayers[q].name).css({"z-index":q});
this.fire(k.type,k);return this.divLayers.length}var O=this.divLayers.length;if(this.svgLayers[this.svgLayers.length-2]==b)return c||this.fire(k.type,k),this.svgLayers.length-2+O;c?(this.svgLayers.splice(q-O-1,1),this.svgLayers.push(b)):(this.svgLayers.splice(q-O-1,1),this.svgLayers.splice(this.svgLayers.length-2,0,b));if(b.group)return this.graphics.bringToTop(b.group),a.isNotNull(b.heatMap)&&null!==b.getRenderingStyle()&&b.getRenderingStyle()instanceof a.style.HeatMap&&b.getRenderingStyle().setIsTop(!0),
c?this.svgLayers.length+O:(this.graphics.bringToTop(this.getDefaultFeatureLayer().group),this.graphics.bringToTop(this.getToolFeatureLayer().group),this.fire(k.type,k),this.svgLayers.length+O-2)}},sendToBottom:function(b){var c=this.getLayerCurrentIndex(b);if(!(0>c)){var q=new a.event.MapEvent(a.event.MapEvent.LAYER_REORDERED,this);q.affectedLayer=b;if(a.Map.isTileLayer(b.layerType)){if(this.divLayers[0]===b)return this.fire(q.type,q),1;this.divLayers.splice(c-1,1);this.divLayers.splice(0,0,b);for(b=
0;b<this.divLayers.length;b++)a.$("#tilelayer_"+this.divLayers[b].name).css({"z-index":b});this.fire(q.type,q);return 1}var k=this.divLayers.length;if(2<this.svgLayers.length&&this.svgLayers[0]==b)return this.fire(q.type,q),1+k;if(2>this.svgLayers.length)return-1;this.svgLayers.splice(c-k-1,1);this.svgLayers.splice(0,0,b);this.graphics.sendToBottom(b.group);a.isNotNull(b.heatMap)&&null!==b.getRenderingStyle()&&b.getRenderingStyle()instanceof a.style.HeatMap&&b.getRenderingStyle().setIsTop(!1);this.fire(q.type,
q);return 1+k}},setInfoWindowStyle:function(a){this.infoWindowOptions=a},displayInfoWindow:function(b,c,q){this.isCustomInfoWindow=q&&q.builtInInfoWindow?!1:!0;this.infoWindowOptions&&a.$.each(this.infoWindowOptions,function(a,b){q[a]||(q[a]=b)});this.infoLayer||(this.infoLayer=new a.infowindow.InfoWindow(this,"1",q),this.tab=!1);if(!b||!c)return null;var k=this,O=function(){var u=k.getMapContext().getUniverse();k.deleteListener(a.event.MapEvent.MAP_INITIALIZED,O);(q?q:{}).universe=u;var C=function(a){a&&
(b=a);k.infoLayer.showInfoWindow(c,b,q)};u.srid!=b.srid?b.transform(u.srid,C):C()};if(k.initialized)O();else this.on(a.event.MapEvent.MAP_INITIALIZED,O)},displayTabbedInfoWindow:function(b,c,q){this.infoLayer||(this.infoLayer=new a.infowindow.InfoWindow(this,"1",q),this.tab=!0);if(!b||!c)return null;var k=this,O=this.getMapContext().getUniverse(),u=function(){k.deleteListener(a.event.MapEvent.MAP_INITIALIZED,u);(q?q:{}).universe=O;var C=function(a){a&&(b=a);k.infoLayer.showTabInfoWindow(b,c,q)};O.srid!=
b.srid?b.transform(O.srid,C):C()};if(k.initialized)u();else this.on(a.event.MapEvent.MAP_INITIALIZED,u,this)},printReset:function(){this.$oracleMapDiv[0].className="";this.$printMapDiv&&this.$printMapDiv.empty()},getLabelGridBox:function(a){var b=this.getMapContext();a=b.getUniverse();var b=b.getZoomLevel(),b=a.getZoomLevels()[b],c=a.bound;a=c.getWidth()/b.resolution;b=c.getHeight()/b.resolution/b.stretchRatio;return{minX:0,minY:0,maxX:a,maxY:b}},refreshVectorLayerLabels:function(){if(this.svgLayers&&
!(0>=this.svgLayers.length)){var a=!1,b=this.svgLayers.length,c;for(c=0;c<b;c++)if(this.svgLayers[c].labelsVisible()){a=!0;break}if(a){this.grid.clear();for(c=0;c<b;c++)a=this.svgLayers[c],a.labelsVisible()&&a.clearAllLabels(),a.addMarkerBoundToGrid();for(c=b-1;-1<c;c--)a=this.svgLayers[c],a.isVisible()&&a.labelsVisible()&&a.addLabels()}}},getLayerByName:function(a){for(var b=this.svgLayers.length;b--;)if(this.svgLayers[b].name===a)return this.svgLayers[b];for(b=this.divLayers.length;b--;)if(this.divLayers[b].name===
a)return this.divLayers[b]},getFeatureLayers:function(){return this.svgLayers},getTileLayers:function(){return this.divLayers},getDefaultFeatureLayer:function(){if(!a.gv.internalLayersEnabled)return{};a.notNull(this.defaultFeatureLayer)?this.defaultFeatureLayer.bringToTop(!0):(this.defaultFeatureLayer=new a.layer.VectorLayer("ii_oracle_maps_internal_editing",{def:{type:a.layer.VectorLayer.TYPE_LOCAL}}),this.defaultFeatureLayer.selectionEnable=!1,this.defaultFeatureLayer.setBringToTopOnMouseOver(!1),
this.addLayer(this.defaultFeatureLayer));return this.defaultFeatureLayer},getToolFeatureLayer:function(){if(!a.gv.internalLayersEnabled)return{};a.notNull(this.toolFeatureLayer)?(this.toolFeatureLayer.bringToTop(!0),this.defaultFeatureLayer&&this.getDefaultFeatureLayer()):(this.toolFeatureLayer=new a.layer.VectorLayer("ii_oracle_maps_internal_others",{def:{type:a.layer.VectorLayer.TYPE_LOCAL}}),this.toolFeatureLayer.selectionEnable=!1,this.toolFeatureLayer.setBringToTopOnMouseOver(!1),this.toolFeatureLayer.enableFeatureEditing(!0),
this.addLayer(this.toolFeatureLayer),this.getDefaultFeatureLayer());return this.toolFeatureLayer},touchStart:function(b){b.preventDefault();var c=a.util.DomUtil;this.touchCount=c.getTouchCount(b);if(!(2<this.touchCount)){this.pinchZoomScale=1;var q=this.touchStartLocs;if(1==this.touchCount){c=c.getTouchesPosition(b);q.length=0;q.push(c);this.touchStartLocs_backup.push({x:c.x,y:c.y});var c=this.lastTouchTimeStamp,k=b.timeStamp;this.lastTouchTimeStamp=k;500>k-c&&this.initialized?(this.doubleTap=!0,
b.preventDefault()):this.doubleTap=!1;this.tStartLocsX=q[0].x;this.tStartLocsY=q[0].y}else 2==this.touchCount&&(b=c.getChangedTouchesPosition(b),1==b.length?q.push(b[0]):2==b.length&&(q.length=0,q.push(b[0]),q.push(b[1])),this.doubleTap=!1);2==q.length&&(b=q[1].x-q[0].x,c=q[1].y-q[0].y,this.pinchZoomStartDist=Math.sqrt(b*b+c*c));this.moveflag=!0;b=this.$oracleMapDiv.offset();this.mLocX=q[0].x-b.left;this.mLocY=q[0].y-b.top}},touchMove:function(b){b.preventDefault();if(0!==this.touchStartLocs.length){var c=
a.util.DomUtil,q=this.$oracleMapDiv.offset();this.mLocX=this.touchStartLocs[0].x-q.left;this.mLocY=this.touchStartLocs[0].y-q.top;if(2==this.touchCount||c.getTouchesPosition(b).length){if(q=c.getTouchesScale(b),a.isNull(q)&&(b=c.getTouchesPosition(b),q=b[0].x-b[1].x,b=b[0].y-b[1].y,q=Math.sqrt(q*q+b*b)/this.pinchZoomStartDist),this.pinchZoomScale=q,!(1==q||0>=q||(b=this.getMapZoomLevel(),1<q&&b>=this.maxZoom||1>q&&0>=b)))for(this.pinchZooming=!0,this.graphics.setVisible(this.draggableGroup,!1),this.$heatMapDiv.css({visibility:"hidden"}),
b=0;b<this.divLayers.length;b++)this.divLayers[b].zoomControl&&this.divLayers[b].zoomControl.scaleTiles(q)}else q=c.getTouchesPosition(b),b=q.x-this.touchStartLocs[0].x,c=q.y-this.touchStartLocs[0].y,this.touchStartLocs[0].x=q.x,this.touchStartLocs[0].y=q.y,this.moveflag&&this.enableMapAction.drag&&this.pan(b,c,!1)}},touchEnd:function(b){if(!(b.isDefaultPrevented()||(b.preventDefault(),this.touchCount-=a.util.DomUtil.getTouchCount(b),0<this.touchCount))){var c=this.pinchZoomScale;this.pinchZooming?
(b=this.getScaleZoomLevel(c),this.setMapZoomLevel(b),this.pinchZoomScale=1,this.pinchZooming=!1,this.graphics.setVisible(this.draggableGroup,!0),this.$heatMapDiv.css({visibility:"visible"}),this.doubleTap=!1):(this.doubleTap&&this.enableMapAction.dbclick?(this.setMapCenterAndZoomLevel(this.getCursorLocation(),a.MapContext(this).getZoomLevel()+1,!0),b.preventDefault()):this.moveflag&&(this.moveflag=!1,b=this.touchStartLocs_backup[0].x-this.touchStartLocs[0].x,c=this.touchStartLocs_backup[0].y-this.touchStartLocs[0].y,
Math.sqrt(b*b+c*c)<a.gv.touchMoveThreshold&&this.pan(b,c,!1),this.touchStartLocs_backup.length=0,b=new a.event.MapEvent(a.event.MapEvent.MAP_RECENTERED,this),this.fire(b.type,b)),1===this.touchStartLocs.length&&this.touchStartLocs[0]&&0===this.tStartLocsX-this.touchStartLocs[0].x&&0===this.tStartLocsY-this.touchStartLocs[0].y&&this.handleTouchEnd(this));this.touchStartLocs.length=0}},getScaleZoomLevel:function(a){var b=this.getMapContext(),c=b.getZoomLevel();if(0<a&&(1>a&&.9<a||1<a&&1.1>a))return c;
var k=b.getUniverse().getZoomLevels(),O=k.length-1,b=k[c].resolution/a;if(1>a){for(a=c-1;0<=a;a--)if(c=k[a].resolution,b<=c){k=b/k[a+1].resolution;b=c/b;if(k>b)return a;break}return a+1}for(a=c+1;a<=O;a++)if(c=k[a].resolution,b>=c){k=k[a-1].resolution/b;b/=c;if(k>b)return a;break}return a-1},cleanMap:function(){this.initialized=this.displayed=!1;var b=new a.event.MapEvent(a.event.MapEvent.MAP_CLEAN,this);this.fire(b.type,b);b=0;if(this.graphics)for(this.graphics.clearGroup(this.draggableGroup),this.graphics.clearGroup(this.blockerGroup),
this.graphics.clearGroup(this.fixedGroup),b=0;b<this.svgLayers.length;b++)this.graphics.clearGroup(this.svgLayers[b].group);this.$tileLayersDiv.empty();this.$fkGraphicLayersDiv.unbind();for(b=0;b<this.decorationArray.length;b++){var c=this.decorationArray[b];"OverviewMap"===c.type&&(c.$DecorationBtnDiv.remove(),c.$DecorationDiv.remove())}},checkCenter:function(){if(this.overview||!this.hasExternal){var b=this.getMapContextToken(),c=b.universe,q=b.zoomLevel,k=c.zoomLevels[q].resolution,q=c.zoomLevels[q].stretchRatio,
O=c.bound;b.homeCenter||(b.homeCenter=new a.geometry.Point((O.getMinX()+O.getMaxX())/2,(O.getMinY()+O.getMaxY())/2,c.srid));b.centerPoint=b.homeCenter.clone();this.wraparound&&(b.roundMapCenterPoint=b.homeCenter.clone());var u=b.centerPoint,c=b.deviceWindow,C=u.getX()-c.w/2*k,G=u.getX()+c.w/2*k,R=u.getY()-c.h/2*k*q,u=u.getY()+c.h/2*k*q,X={x:!0,y:!0},N=b.centerPoint.getX(),r=b.centerPoint.getY();this.wraparound||(C<O.getMinX()&&G>O.getMaxX()||G-C>O.getWidth()?N=(O.getMinX()+O.getMaxX())/2:C<O.getMinX()?
N=O.getMinX()+c.w/2*k:G>O.getMaxX()?N=O.getMaxX()-c.w/2*k:X.x=!1);R<O.getMinY()&&u>O.getMaxY()||u-R>O.getHeight()?r=(O.getMinY()+O.getMaxY())/2:R<O.getMinY()?r=O.getMinY()+c.h/2*k*q:u>O.getMaxY()?r=O.getMaxY()-c.h/2*k*q:X.y=!1;b.centerPoint.setPoint(N,r);this.wraparound&&b.roundMapCenterPoint.setPoint(N,r);return X}},resetUniverse:function(b,c){var q=this.getMapContextToken();q.universe.srid!==b.srid&&this.iterateVectorLayers(function(a){a.rtree=null});q.universe=b;q.transform=null;this.graphics.setLeftTop(this.draggableGroup,
0,0);for(var k=this.divLayers.length,k=c.getZIndex()-1;0<k;)this.removeLayer(this.divLayers[0]),k--;this.universeLayerIndex=0;for(var k=this.svgLayers.length,O=0;O<k;O++){var u=this.svgLayers[O];u.dataLoaded=!1;u.loaded=!1;u.heatMap=null;u.renderingStyle&&"HeatMap"==u.renderingStyle.styleType&&u.renderingStyle.containerVectorLayer&&(u.renderingStyle.containerVectorLayer.dataLoaded=!1);u.boundingTheme&&(u.loadedBoundingTheme=!1)}k=q.universe;if(this.overview){var C=this.overview.submap.getMapContextToken(),
O=C.universe;if(this.overview.submap){O.zoomLevels=k.zoomLevels;O.srid=k.srid;O.bound=k.bound;this.overview.layer&&this.overview.layer.parentMap&&(k=this.overview.layer,k.copyFeatures&&this.overview.mainmap.overviewLayer.deleteListener(a.event.LayerEvent.FEATURES_LOADED,k.copyFeatures),this.overview.submap.removeLayer(this.overview.layer));var G=this;q.centerPoint.transform(q.universe.srid,function(a){q.centerPoint=a;C.centerPoint=q.centerPoint;C.homeCenter=q.centerPoint;C.zoomLevel=q.zoomLevel-G.overview.calMapZoomDiff()})}}this.boundingThemeLoaded=
this.boundingThemeLoading=!1;this.extentRect=this.boundingLayerName=null;this.resetTag=!0;this.init()},getMapAsSVG:function(b){var y=this.graphics,q=y.oui,k=q.viewportBounds,O=k.width,u=k.height,C=this.divLayers.length,G=this,R=y.createGroup({x:0,y:0}),X;for(X=0;X<C;X++)this.divLayers[X].exportToSVG(R,O,u);var N=[R,this.draggableGroup];for(X=0;X<this.decorationArray.length;X++){var r=this.decorationArray[X];(r instanceof a.control.ScaleBar||r instanceof a.control.CopyRight)&&r.defaultGroup&&N.push(r.defaultGroup)}var n=
function(){if(G.graphics){for(var a=0;a<C;a++)if(0!==G.divLayers[a].loadImg){c.setTimeout(n,200);return}a=(new q.io.svg.SVGExporter).snapshotNodes(N,k,O,u);a.style="overflow:hidden";a=q.io.XMLConverter.convert(a,"");y.clearGroup(R);b(a)}};c.setTimeout(n,0)},getFlattenedCanvas:function(c,y,q,k){var O=this.graphics.oui.viewportBounds,u=Math.round(O.width),O=Math.round(O.height);y||(y=u);q||(q=O);k=k||{};k.navigationPanelBar=k.navigationPanelBar||!1;k.scaleBar===b&&(k.scaleBar=!0);this.getTileCanvas(y,
q);var C=this;this.drawVectorInPrintCanvas(y,q,function(b){C.drawImageEnd(y,q,b,function(b,k){a.$("#printVC"+C.mapInstanceId).remove();c(b,k)})},k)},getTileCanvas:function(a,b){for(var c=0,k=this.divLayers.length;c<k;c++)this.divLayers[c].isVisible()&&(this.divLayers[c].canvas=document.createElement("canvas"),this.divLayers[c].canvas.width=a,this.divLayers[c].canvas.height=b,this.divLayers[c].drawTilesImages(a,b))},drawVectorInPrintCanvas:function(b,c,q,k){var O=a.$("\x3cdiv id \x3d'printVC"+this.mapInstanceId+
"' style\x3d'visibility:hidden;width:"+b+"px;height:"+c+"px'\x3e\x3c/div\x3e");a.$(document.body).append(O);for(var u=new a.Map(O[0],{universe:this.getMapContext().getUniverse(),hiDPI:!0}),O=this.svgLayers.length,C=0,G=0,R=this.svgLayers.length;G<R;G++){var X=this.svgLayers[G];if("ii_oracle_maps_internal_editing"!==X.name&&"ii_oracle_maps_internal_others"!==X.name)if(X.isVisible()){if(X.clustering&&X.dataBufferWindow){var N=X.maxClusteringLevel,r=X.vCluster.minPointCount,n=X.vCluster.threshold,M=
X.vCluster.clusterStyle,Z=X.zoomInLevels,ba;!1===Z||0===Z?(Z=0,ba=!1):ba=!0;X=X.clone();if("undefined"!==typeof M){var Y=M.marker,Y=new a.style.VariableMarker(M.origConfig);X.enableClustering(!0,{clusterStyle:Y,minPointCount:r,maxClusteringLevel:N,threshold:n,enableZoomIn:ba,zoomInLevels:Z})}else a.util.Logger.severe("CLUSTER_ERROR","OM.Map","Cluster configuration lost")}else X=X.clone();u.addLayer(X);C++}else O--}u.setMapCenter(this.getMapCenter());u.setMapZoomLevel(this.getMapZoomLevel());for(O=
0;O<this.decorationArray.length&&!a.isNull(k);O++)C=this.decorationArray[O],k.navigationPanelBar&&C instanceof a.control.NavigationPanelBar&&C.isVisible()?(G=new a.control.NavigationPanelBar({orientation:C.orientation,style:C.style,anchorPosition:C.anchorPosition}),G.setStyle({position:C.position,backgroundColor:C.backgroundColor,buttonColor:C.buttonColor}),u.addMapDecoration(G)):k.scaleBar&&C instanceof a.control.ScaleBar&&C.isVisible()?(G=new a.control.ScaleBar({format:C.format,anchorPosition:C.anchorPosition}),
G.setStyle({fontSize:C.fontSize,scalebar_color:C.scalebar_color,thickness:C.thickness,maxLength:C.maxLength}),u.addMapDecoration(G)):k.copyRight&&C instanceof a.control.CopyRight&&C.isVisible()&&(C=new a.control.CopyRight({textValue:C.textValue,anchorPosition:C.anchorPosition,fontSize:C.fontSize,fontFamily:C.fontFamily,fill:C.fontColor}),u.addMapDecoration(C));u.on(a.event.MapEvent.MAP_AFTER_REFRESH,function(){u.getVectorCanvas(b,c,q,k)});u.init()},getVectorCanvas:function(b,y,q,k){var O=document.createElement("canvas");
O.width=b;O.height=y;var u=O.getContext("2d"),C,G,R=this;C=0;for(G=this.svgLayers.length;C<G;C++){var X=this.svgLayers[C];X.checkVisible()&&X.heatMap&&(X=X.getHeatmapDivId()+"\x3ecanvas",X=a.$(X)[0],u.drawImage(X,X.offsetLeft,X.offsetTop))}var N=this.$fkGraphicLayersDiv.children()[0];if("CANVAS"==N.tagName){var r=[];for(C=0;C<this.decorationArray.length;C++)if(b=this.decorationArray[C],k&&!1===k.navigationPanelBar&&b instanceof a.control.NavigationPanelBar&&b.isVisible()||k&&!1===k.scaleBar&&b instanceof
a.control.ScaleBar&&b.isVisible()||k&&!1===k.copyRight&&b instanceof a.control.CopyRight&&b.isVisible())b.setVisible(!1),r.push(b);setTimeout(function(){var a=1;!1!==this.hiDPI&&(a=(c.devicePixelRatio||1)/(u.webkitBackingStorePixelRatio||u.mozBackingStorePixelRatio||u.msBackingStorePixelRatio||u.oBackingStorePixelRatio||u.backingStorePixelRatio||1));u.save();u.scale(1/a,1/a);u.drawImage(N,N.offsetLeft,N.offsetTop);u.restore();for(a=r.pop();a;)a.setVisible(!0),a=r.pop();2!==R.svgLayers.length||"ii_oracle_maps_internal_editing"!==
R.svgLayers[0].name&&"ii_oracle_maps_internal_editing"!==R.svgLayers[1].name||"ii_oracle_maps_internal_others"!==R.svgLayers[0].name&&"ii_oracle_maps_internal_others"!==R.svgLayers[1].name||(O=null);q(O)},50)}else{C=[this.draggableGroup,this.fixedGroup];k=this.graphics.oui;C=(new k.io.svg.SVGExporter).snapshotNodes(C,k.viewportBounds,b,y);C.style="overflow:hidden";k=k.io.XMLConverter.convert(C,"");try{u.drawSvg(k,0,0,b,y)}catch(n){a.util.Logger.alert("MAPVIEWER_9040","OM.Map.getMapAsImage")}q(O)}},
drawImageEnd:function(b,c,q,k){var O=document.createElement("canvas"),u=document.createElement("canvas"),C=!0,G=!0;O.width=b;O.height=c;u.width=b;u.height=c;var R=O.getContext("2d"),X=u.getContext("2d"),N=this,r=function(){for(var b=0,c=N.divLayers.length;b<c;b++)if(N.divLayers[b].canvas&&N.divLayers[b].loadingImg){setTimeout(r,100);return}b=0;for(c=N.divLayers.length;b<c;b++)N.divLayers[b].canvas&&(R.drawImage(N.divLayers[b].canvas,0,0),C=!1);a.notNull(q)&&(X.drawImage(q,0,0),G=!1);!0===C&&(O=null);
!0===G&&(u=null);k(O,u)};setTimeout(r,100)},getMapAsServerImage:function(b,c,q,k){var O=this.mapviewerURL+"/omserver";this.getMapAsXML("GIF_URL",function(c){a.util.HttpRequest.send(O,{xml_request:c},function(k){k=a.$(k).find("map_content");a.isNull(k)?a.util.Logger.alert("MAPVIEWER_9009","OM.Map.getMapAsServerImage",c):(k=k.attr("url"),b(k))},"xml")},c,q,k)},deleteFeatureInfoWindow:function(a){this.infoLayer&&this.infoLayer.deleteInfoWindowById(a)},build_decos_xml:function(b){for(var c="",q=0;q<this.decorationArray.length;q++){var k=
this.decorationArray[q];"ScaleBar"!=k.type||!a.isNull(b)&&!1===b.scaleBar||(c+=this.build_scale_bar(k))}return a.notNull(c)&&0<c.length?"\x3cscale_bar"+c+"/\x3e":""},build_scale_bar:function(b){var c="";switch(b.anchorPosition){case a.control.MapDecoration.POSITION_LOWER_LEFT:c+=' position\x3d"SOUTH_WEST"';break;case a.control.MapDecoration.POSITION_LOWER_RIGHT:c+=' position\x3d"SOUTH_EAST"';break;case a.control.MapDecoration.POSITION_UPPER_LEFT:c+=' position\x3d"NORTH_WEST"';break;case a.control.MapDecoration.POSITION_UPPER_RIGHT:c+=
' position\x3d"NORTH_EAST"';break;case a.control.MapDecoration.POSITION_LOWER_CENTER:c+=' position\x3d"SOUTH"';break;case a.control.MapDecoration.POSITION_UPPER_CENTER:c+=' position\x3d"NORTH"'}c="METRIC"===b.format?c+' mode\x3d"METRIC_MODE"':"IMPERIAL"===b.format?c+' mode\x3d"US_MODE"':c+' mode\x3d"DUAL_MODES"';c+=' length_hint\x3d"'+b.maxLength+'"';c=c+' label_font_family\x3d"Serif"'+(' label_font_size\x3d"'+(a.notNull(b.fontSize)?b.fontSize:12)+'"');c+=' color1\x3d"'+b.scaleBarColor+'"';c+=' label_color\x3d"'+
b.fontColor+'"';return c+=' label_font_weight\x3d"'+b.fontWeight+'"'},build_copy_right:function(){return""},getMapAsXML:function(b,c,q,k,O){var u=a.MapContext(this);b||(b="GIF_URL");var C=u.getUniverse().getMapBounds().getWidth();if(u.getQueryWindow().getMinX()<-C/2||u.getQueryWindow().getMaxX()>C/2)q=u.getZoomLevel(),q=this.getLabelGridBox(q).maxX;q||(q=u.getDeviceWidth());k||(k=u.getDeviceHeight());C=a.gv.defaultDataSource;a.isNull(C)&&(O&&O.dataSource?C=O.dataSource:a.util.Logger.warning("MAPVIEWER_9104",
"OM.Map.getMapAsXML"));var G='\x3c?xml version\x3d"1.0" standalone\x3d"yes"?\x3e',G=G+'\x3cmap_request datasource\x3d"'+C+'" format\x3d"'+b+'" width\x3d"'+q+'" height\x3d"'+k+'" antialiase\x3d"true" transparent\x3d"true" srid\x3d"'+u.getUniverse().getSRID()+'"';b=!1;for(var R,C=this.divLayers.length-1;-1<C;C--){var X=this.divLayers[C];if(X.isVisible()&&X.getStaticMapURL&&X.layerType!==a.LayerTypes.DYNAMIC_TILE){b=!0;R=X.getStaticMapURL(q,k);break}}var N=this.getAndCombineDTLURLs(q,k),r=this.build_decos_xml(O),
u=u.getQueryWindow().getHeight(),C=this.getMapCenter(),n='\x3ccenter size\x3d"'+u+'"\x3e\x3cgeoFeature\x3e\x3cgeometricProperty typeName\x3d"center"\x3e\x3cPoint\x3e\x3ccoordinates\x3e'+C.getX()+","+C.getY()+"\x3c/coordinates\x3e\x3c/Point\x3e\x3c/geometricProperty\x3e\x3c/geoFeature\x3e\x3c/center\x3e";b?(R=R.replace(/&/g,"\x26amp;"),R=R.replace(/</g,"\x26lt;"),R=R.replace(/>/g,"\x26gt;"),this.drawVectorInPrintCanvas(q,k,function(b){G+=" bgimage\x3d'"+R+"'";a.isNull(N)||0===N.trim().length?(G+=a.notNull(b)?
' bgimage2\x3d"'+b.toDataURL()+'"':"",G+="\x3e"+n):(G+=a.notNull(b)?' fgimage\x3d"'+b.toDataURL()+'"':"",G+="\x3e"+n+N);G+=r+"\x3c/map_request\x3e";c(G)},O)):this.getFlattenedCanvas(function(b,k){a.isNull(N)||0===N.trim().length?(a.notNull(b)?(G+=' bgimage\x3d"'+b.toDataURL()+'"',a.notNull(k)&&(G+=' fgimage\x3d"'+k.toDataURL()+'"')):a.notNull(k)&&(G+=' bgimage\x3d"'+k.toDataURL()+'"'),G+="\x3e"+n):(a.notNull(b)&&(G+=' bgimage\x3d"'+b.toDataURL()+'"'),a.notNull(k)&&(G+=' fgimage\x3d"'+k.toDataURL()+
'"'),G+="\x3e"+n+N);G+=r+"\x3c/map_request\x3e";c(G)},q,k,O)},getDTLURLs:function(b,c){for(var q=[],k=null,O=0;O<this.divLayers.length;O++)k=this.divLayers[O],k.isVisible()&&k.getStaticMapURL&&k.layerType===a.LayerTypes.DYNAMIC_TILE&&(k=k.getStaticMapURL(b,c),q.push(k));return q},getAndCombineDTLURLs:function(b,c){var q=this.getDTLURLs(b,c);return a.layer.DynamicTileLayer.combineDTLURLs(q)},print:function(){a.$(document.body).css("cursor","wait");this.$oracleMapDiv.css("cursor","wait");var b=this;
this.getMapAsSVG(function(y){a.$(document.body).css("cursor","");b.$oracleMapDiv.css("cursor","");var q=c.open();q.document.write(y);q.print()})},enableMapDrag:function(a){this.enableMapAction.drag=a},enableMapWraparound:function(a){this.wraparound=a},enableMouseWheelZooming:function(a){this.enableMapAction.mousewheel=a},enableMapZoom:function(a){this.zoomEnabled=a;this.overview&&this.overview.enableOverViewMapZoom(a)},enableDoubleClick:function(a){this.enableMapAction.dbclick=a},setMouseWheelZoomBehavior:function(a){this.mouseWheelZoomBehavior=
a},setHomeMap:function(a,b){var c=this.getMapContextToken();a&&(c.homeMapCenter=a);b&&(c.homeMapZoomlevel=b)},enableZoomAnimation:function(a){this.tileLayerZoomAnimation=a},setEnabledZoomLevels:function(b){this.universe&&(this.getMapContextToken().universe=this.universe);if(a.util.ValidationUtil.isNumberArray(b)&&(b.sort(function(a,b){return a-b}),this.enableZoomLevels=b,0===this.divLayers.length&&2<this.svgLayers.length)){b={};for(var c=[],q,k,O=this.getMapContext().getUniverse().getZoomLevels().length,
u=0;u<this.enableZoomLevels.length;u++)O-1<this.enableZoomLevels[u]?(q=this.getMapContext().getUniverse().getZoomLevels()[O-1].resolution,k=this.getMapContext().getUniverse().getZoomLevels()[O-1].stretchRatio):(q=this.getMapContext().getUniverse().getZoomLevels()[this.enableZoomLevels[u]].resolution,k=this.getMapContext().getUniverse().getZoomLevels()[this.enableZoomLevels[u]].stretchRatio),c[u]=new a.universe.ZoomLevel(q,{stretchRatio:k});b.zoomLevels=c;b.srid=this.getMapContext().getUniverse().getSRID();
b.bounds=this.getMapContext().getUniverse().getMapBounds();b.numberOfZoomLevels=this.enableZoomLevels.length;b=new a.universe.Universe(b);this.universe=this.getMapContext().getUniverse();this.getMapContextToken().universe=b}},enableInfoWindowEventPropagation:function(a){this.infoWindowEventPropogation=a},closeInfoWindows:function(){this.infoLayer&&(this.infoLayer.closeInfoWindows(),this.isCustomInfoWindow=this.infoLayer=null)},replaceLayer:function(b,c){for(var q=0,k=this.divLayers.length;q<k;q++)if(this.divLayers[q]==
b){this.divLayers[q]=c;c.parentMap=this;this.overviewLayer=c;q=a.event.MapEvent;k=a.event.LayerEvent;this.on(q.I_MAP_DRAGGING,c.panEvent,c);this.on(q.MAP_RECENTERED,c.recenter,c);this.on(q.I_MAP_CENTER_ZOOM,c.setCenterAndZoomlevel,c);this.on(q.MAP_BEFORE_REFRESH,c.refreshEvent,c);this.on(q.MAP_REDRAW,c.redraw,c);this.on(q.MAP_DESTROY,c.destroy,c);c.addListener(k.FINISH_GOT_CONFIG,this.newLayerConfigLoaded);c.addListener(k.FINISH_LOAD,this.layerFinish);c.addListener(k.ALL_TILES_LOADED,this.layerFinish);
c.addListener(k.INIT_ERROR,this.layerErr);c.addListener(k.RENDERING_STYLE_CHANGED,this.layerStyleChanged);c.addListener(k.NSDP_MAPPED,this.nsdpMapped);c.setContainer&&c.setContainer(this.$tileLayersDiv[0]);this.deleteLayerListener(b);break}},setAllInitialParams:function(){var b=this.getMapContextToken();a.isNull(b.centerPoint)&&(b.centerPoint=new a.geometry.Point((b.universe.bound.getMinX()+b.universe.bound.getMaxX())/2,(b.universe.bound.getMinY()+b.universe.bound.getMaxY())/2,b.universe.srid));a.isNull(b.homeCenter)&&
(b.homeCenter=b.centerPoint);a.isNull(b.zoomLevel)&&(b.zoomLevel=0);b.homeMapCenter||(b.homeMapCenter=b.centerPoint);b.homeMapZoomlevel||(b.homeMapZoomlevel=b.zoomLevel)},changeOverView:function(){if(!this.userSetOL&&this.overview){for(var b=this.divLayers.length-1;0<=b;b--)if(a.notNull(this.divLayers[b].tileLayerConfig)&&!this.divLayers[b].tileLayerConfig.isTransparentImage&&this.overviewLayer!==this.divLayers[b]&&(this.divLayers[b].layerType!==a.LayerTypes.DYNAMIC_TILE||!1===this.divLayers[b].hideInOverviewMap)&&
this.divLayers[b].isVisible()){this.overviewLayer=this.divLayers[b];this.overview.setOverviewMapOptions({overviewLayer:this.overviewLayer});return}if(0<this.divLayers.length)this.overviewLayer!==this.divLayers[0]&&(this.overviewLayer=this.divLayers[0],this.overview.setOverviewMapOptions({overviewLayer:this.overviewLayer}));else if(2<this.svgLayers.length)for(var b=0,c=this.svgLayers.length;b<c;b++)if(this.svgLayers[b]!=this.toolFeatureLayer&&this.svgLayers[b]!=this.defaultFeatureLayer){this.overviewLayer!==
this.svgLayers[b]&&(this.overviewLayer=this.svgLayers[b],this.overview.setOverviewMapOptions({overviewLayer:this.overviewLayer}));break}}},addVectorLayerByURL:function(b,c,q){this.addLayer(new a.layer.VectorLayer(this.generateLayerName(),{def:{type:a.layer.VectorLayer.TYPE_DATAPACK,url:b},renderingStyle:c,boundingTheme:q}),"URL_Layer")},generateLayerName:function(){var a=0;return function(){return"URL_Layer_"+ ++a}}(),enableURLDragDrop:function(a,b){this.drapDrop=a;b&&(b.style&&(this.ddStyle=b.style),
b.zoomToTheme&&(this.ddZoom=b.zoomToTheme))},setMouseCursorStyle:function(b,c){"hand"==b&&(b=a.CursorTypes.POINTER);"dragging"==c?this.cursorStyleDragging=b:"default"==c&&(this.cursorStyleDefault=b,this.changeCursor(b))},changeCursor:function(a){this.$oracleMapDiv.css("cursor",a);this.graphics.oui&&this.graphics.oui.tree&&this.graphics.oui.tree.canvas&&(this.graphics.oui.tree.canvas.style.cursor=a)},isStoppedEvent:function(b){return b.type&&a.event.EventSource.stopEvents[b.type]?(a.event.EventSource.stopEvents[b.type]=
!1,!0):!1},setStoppedEvent:function(b){a.notNull(b)&&(a.event.EventSource.stopEvents[b]=!0)},setTooltipStyle:function(b){if(a.notNull(b)){var c={border:{},text:{},padding:{}},q={titleStyle:{},headerStyle:{},contentStyle:{}};a.notNull(b.titleStyle)&&(q.titleStyle=b.titleStyle,q.titleStyle.hAlign="LEFT"==b.titleStyle.hAlign?0:"CENTER"==b.titleStyle.hAlign?.5:1);a.notNull(b.headerStyle)&&(q.headerStyle=b.headerStyle,q.headerStyle.hAlign="LEFT"==b.headerStyle.hAlign?0:"CENTER"==b.headerStyle.hAlign?.5:
1);a.notNull(b.contentStyle)&&(q.contentStyle=b.contentStyle,q.contentStyle.hAlign="LEFT"==b.contentStyle.hAlign?0:"CENTER"==b.contentStyle.hAlign?.5:1);a.notNull(b.opacity)&&(c.opacity=b.opacity);a.notNull(b.background)&&(c.background=b.background);a.notNull(b.padding)&&(c.padding=b.padding);a.notNull(b.borderColor)&&(c.border.stroke=b.borderColor);a.notNull(b.textColor)&&(c.text.fill=b.textColor);a.notNull(b.rx)&&(c.border.rx=b.rx);a.notNull(b.ry)&&(c.border.ry=b.ry);a.notNull(b.fontSize)&&(c.text.fontSize=
b.textSize);a.notNull(b.fontWeight)&&(c.text.fontWeight=b.fontWeight);a.notNull(b.strokeThickness)&&(c.border.strokeThickness=b.strokeThickness);a.notNull(b.shadow)?c.shadow=b.shadow:c.shadow=null;this.graphics.setTooltipStyle(c);this.graphics.storeCustomTooltipTextStyle(q)}},appendUTFGridLayerHTML:function(b){a.isNull(this.utfgridHTMLArray)?a.util.Logger.warning("MAPVIEWER_9103","OM.Map.appendUTFGridLayerHTML"):this.utfgridHTMLArray.push(b)},enableMultiLayerInfoWindow:function(a){this.showAllVecFeatureInfo=
a?!0:!1},setVectorLayerInfoWindowTrigger:function(b){this.vectorlayerInfoWindowMouseEType=b===a.event.MouseEvent.MOUSE_OVER||b===a.event.MouseEvent.MOUSE_MOVE?a.event.MouseEvent.MOUSE_MOVE:a.event.MouseEvent.MOUSE_CLICK},cleanupVctLyrSelections:function(b){for(var c,q=0;q<this.svgLayers.length;q++)c=this.svgLayers[q],!0!==a.event.EventSource.isProcessedEvent(c,b)?c.deselectFeatures():a.event.EventSource.resetProcessedEvent(c,b)},handleTouchEnd:a.util.MiscUtil.oddNumberClick(function(b){var c=new a.event.MapEvent(a.event.MouseEvent.MOUSE_CLICK,
b);b.fire(c.type,c);b.handleInfoWindow();b.cleanupVctLyrSelections(a.event.MouseEvent.MOUSE_CLICK)}),handleMouseClick:a.util.MiscUtil.oddNumberClick(function(b,c){var q;3==b.which?(q=new a.event.MapEvent(a.event.MouseEvent.MOUSE_RIGHT_CLICK,c),c.fire(q.type,q)):(q=new a.event.MapEvent(a.event.MouseEvent.MOUSE_CLICK,c),c.fire(q.type,q),c.handleInfoWindow(),c.cleanupVctLyrSelections(a.event.MouseEvent.MOUSE_CLICK))}),isVecLayerCustomInfoWindowDisplayed:function(b){if(a.isNull(b)||1>b.length)return!1;
var c,q;c=0;for(q=b.length;c<q;c+=1)if(b[c]&&b[c].feature_layer&&!1===b[c].feature_layer.getEnableInfoWindow()){if(b[c].hasListener(a.event.MouseEvent.MOUSE_CLICK)&&this.infoLayer&&this.isCustomInfoWindow)return!0;var k=b[c].feature_layer;if(k.hasListener(a.event.MouseEvent.MOUSE_CLICK)&&a.event.EventSource.isProcessedEvent(k,a.event.MouseEvent.MOUSE_CLICK)&&this.infoLayer&&this.isCustomInfoWindow)return!0}return!1},setMaskOutInfoWindow:function(b){var c=this;!0===b?c.maskOutInfoWindow=!0:setTimeout(function(){c.maskOutInfoWindow=
!1},1.5*a.event.MouseEvent.DEBOUNCE_MILI_SEC)},getMaskOutInfoWindow:function(){return this.maskOutInfoWindow},handleInfoWindow:function(){var b=!1;if(!0!==this.maskOutInfoWindow){if(this.vectorlayerInfoWindowMouseEType===a.event.MouseEvent.MOUSE_CLICK){var c=this.getVectorLayerHitFeatures(a.event.MouseEvent.MOUSE_CLICK);if(this.isVecLayerCustomInfoWindowDisplayed(c)){a.util.Logger.finest("A custom infowindow is still open.");return}c&&0<c.length&&(b=this.displayVectorLayersInfoWindow(c))}!1===b&&
this.closeInfoWindows();!0!==b&&this.utfgridMouseEType===a.event.MouseEvent.MOUSE_CLICK&&(this.fireUTFGridEvent(a.event.MouseEvent.MOUSE_CLICK),setTimeout(this.displayUTFGridInfoWindow(),10))}}});a.Map.setProxyPath=function(b){b&&0===b.indexOf("/")&&(a.gv.proxyPath=b)};a.Map.getProxyPath=function(){return a.gv.proxyPath};a.Map.isTileLayer=function(b){return b===a.LayerTypes.TILE||b===a.LayerTypes.DYNAMIC_TILE||b===a.LayerTypes.WMTS_TILE||b===a.LayerTypes.EXTERNAL};a.Map.setErrorHandler=function(b){a.util.Logger.errorHandler=
b};a.Map.setAPIKey=function(b,c){var q=a.util.HttpRequest.getDomain(c);a.gv.mvKeyMap[q]=b};a.Map.setLocale=function(b,c){var q;q=a.notNull(c)?b+"-"+c:b;a.gv.loadMessage(q)};a.Map.ZOOM_KEEP_MOUSE_POINT=1;a.Map.ZOOM_CENTER_ON_MOUSE=2;a.Map.ZOOM_KEEP_CENTER=3;a.server.ServerMapRequest=a.Class.extend({initialize:function(b){a.isNull(b)&&(b="http://"+document.location.host+"/mapviewer");this.baseURL=b;this.basemap=this.bgcolor=this.transparent=this.antialiase=this.datasource=null;this.themesArray=[];this.stylesArray=
[];this.enableUTFGrid=this.format=this.tileServerURL=this.isclienttilereq=this.height=this.width=null;this.grid_res=4;this.srid=this.maxY=this.maxX=this.minY=this.minX=null},setImageFormat:function(a){this.format=a},setImageWidth:function(a){this.width=a},setImageHeight:function(a){this.height=a},setBasemap:function(a){this.basemap=a},setUTFGridResolution:function(a){this.grid_res=a},setClientTileRequest:function(a){this.isclienttilereq=a},setBBox:function(b,c,q,k,O){this.minX=b;this.minY=c;this.maxX=
q;this.maxY=k;this.srid=a.notNull(O)?O:8307},setEnableUTFGrid:function(a){this.enableUTFGrid=a},setMapServerURL:function(a){this.baseURL=a},validateTheme:function(b){if(a.notNull(this.themesArray)&&0<this.themesArray.length)for(var c=0,q=this.themesArray.length;c<q;c++)if(b.name===this.themesArray[c].name)return a.util.Logger.warning("MAPVIEWER_9085","OM.server.ServerMapRequest","Theme ["+b.name+"] already existed."),!1;return!0},validateStyle:function(b){if(a.notNull(this.stylesArray)&&0<this.stylesArray.length)for(var c=
0,q=this.stylesArray.length;c<q;c++)if(b.styleName===this.stylesArray[c].styleName)return a.util.Logger.warning("MAPVIEWER_9086","OM.server.ServerMapRequest","Style ["+b.styleName+"] already existed."),!1;return!0},addTheme:function(b){a.notNull(b)&&"[object Object]"===Object.prototype.toString.call(b)?this.validateTheme(b)&&this.themesArray.push(b):a.util.Logger.warning("MAPVIEWER_9087","OM.server.ServerMapRequest",b)},addThemes:function(b){if(a.notNull(b)&&"[object Array]"===Object.prototype.toString.call(b))for(var c=
0,q=b.length;c<q;c++)this.addTheme(b[c]);else a.util.Logger.warning("MAPVIEWER_9088","OM.server.ServerMapRequest",b.stringify())},addStyle:function(b){a.notNull(b)&&"[object Object]"===Object.prototype.toString.call(b)?this.validateStyle(b)&&this.stylesArray.push(b):a.util.Logger.warning("MAPVIEWER_9089","OM.server.ServerMapRequest",b)},addStyles:function(b){if(a.notNull(b)&&"[object Array]"===Object.prototype.toString.call(b))for(var c=0,q=b.length;c<q;c++)this.addStyle(b[c]);else a.util.Logger.warning("MAPVIEWER_9088",
"OM.server.ServerMapRequest",b.stringify())},setProperties:function(a){for(var b in a)if(a.hasOwnProperty(b))if("datasource"===b||"dataSource"===b)this.datasource=a[b];else if("antialiase"===b||"antiAliase"===b)this.antialiase=a[b];else if("transparent"===b)this.transparent=a[b];else if("bgcolor"===b||"bgColor"===b)this.bgcolor=a[b];else if("basemap"===b||"baseMap"===b)this.basemap=a[b];else if("width"===b||"imageWidth"===b)this.width=Number(a[b]);else if("height"===b||"imageHeight"===b)this.height=
Number(a[b]);else if("utfgridresolution"===b||"UTFGridResolution"===b)this.greid_res=a[b];else if("enableutfgrid"===b||"enableUTFGrid"===b)this.enableUTFGrid=a[b];else if("isclienttilereq"===b||"isClientTileReq"===b)this.isclienttilereq=a[b];else if("applicationId"===b||"applicationID"===b)this.applicationID=a[b];else if("tileserverurl"===b||"tileServerURL"===b)this.tileServerURL=a[b]},toXMLString_Themes:function(b){if(a.isNull(this.themesArray)||1>this.themesArray.length)return"";for(var c="\x3cthemes\x3e",
q=0,k=this.themesArray.length;q<k;q++){var O=this.themesArray[q];a.notNull(O)&&(c=O.type===a.server.ServerTheme.TYPE_GEORASTER?c+O.toXMLString(b):c+O.toXMLString())}return c+"\x3c/themes\x3e"},toXMLString_Styles:function(){if(a.isNull(this.stylesArray)||1>this.stylesArray.length)return"";for(var b="\x3cstyles\x3e",c=0,q=this.stylesArray.length;c<q;c++)b+=this.stylesArray[c].toXMLString();return b+"\x3c/styles\x3e"},hasTheme:function(b){"string"!==typeof b&&a.util.Logger.warning("MAPVIEWER_9090","OM.server.ServerMapRequest",
b);if(a.isNull(this.themesArray))return!1;for(var c=0,q=this.themesArray.length;c<q;c++)if(this.themesArray[c].name.toLowerCase()===b.toLowerCase())return!0},getTheme:function(b){for(var c=0,q=this.themesArray.length;c<q;c++)if(b===this.themesArray[c].name)return this.themesArray[c];a.util.Logger.warning("MAPVIEWER_9091","OM.server.ServerMapRequest","Theme ["+b+"] not found.");return null},getThemes:function(){return this.themesArray},setBindingParameters:function(b){for(var c=null,q=0,k=b.length;q<
k;q++){var c=b[q],O;for(O in c){var u=this.getTheme(O.trim());a.notNull(u)&&u.setBindingParameters(c[O.trim()])}}},clone:function(){var b={};a.$.extend(b,this);return b},getServerURL:function(){return!0===this.isclienttilereq||"true"===this.isclienttilereq?a.notNull(this.tileServerURL)?this.tileServerURL:this.baseURL+"/omserver":a.isNull(this.baseURL)?"http://"+document.location.host+"/mapviewer/omserver":this.baseURL+"/omserver"},toXMLString:function(){var b=this.getServerURL(),c;c='\x3cmap_request width\x3d"'+
(a.notNull(this.width)?this.width+'"':'"600"');c+=' height\x3d"'+(a.notNull(this.height)?this.height+'"':'"400"');c+=!0===this.isclienttilereq||"true"===this.isclienttilereq?' isclienttilereq\x3d"true"':"";c+=' format\x3d"'+(a.isNull(this.format)?'PNG_STREAM"':this.format+'"');c+=a.isNull(this.datasource)?"":' datasource\x3d"'+this.datasource+'"';c+=a.isNull(this.bgcolor)?"":' bgcolor\x3d"'+encodeURIComponent(this.bgcolor)+'"';c+=a.isNull(this.basemap)?"":' basemap\x3d"'+this.basemap+'"';c+=a.isNull(this.transparent)?
"":' transparent\x3d"'+this.transparent+'"';c+=a.isNull(this.antialiase)?"":' antialiase\x3d"'+this.antialiase+'"';c+=a.isNull(this.applicationID)?"":' applicationID\x3d"'+this.applicationID+'"';c=c+"\x3e"+('\x3cbox srsName\x3d"'+(a.isNull(this.srid)?"SDO:8307":"SDO:"+this.srid+'"\x3e'));c+="\x3ccoordinates\x3e"+this.minX+","+this.minY+","+this.maxX+","+this.maxY+"\x3c/coordinates\x3e";c+="\x3c/box\x3e";var q=this.srid;a.isNull(q)&&(q=8307);var q=new a.geometry.Rectangle(this.minX,this.minY,this.maxX,
this.maxY,q),q=this.toXMLString_Themes(q),k=this.toXMLString_Styles(),b=b+'?xml_request\x3d\x3c?xml version\x3d"1.0" standalone\x3d"yes"?\x3e'+c+encodeURIComponent(q)+encodeURIComponent(k);this.enableUTFGrid&&(c=' grid_id\x3d"'+a.util.MiscUtil.md5Hash(b)+'" grid_res\x3d"'+this.grid_res+'"',q=b.indexOf("PNG_STREAM"),b=b.substring(0,q+11)+c+b.substring(q+11));return b+"\x3c/map_request\x3e"}});a.server.ServerFeature=a.Class.extend({initialize:function(a){this.name=a;this.dataSource=null},setDataSourceName:function(a){this.dataSource=
a},getDataSourceName:function(){return this.dataSource},toXMLString:function(){return"\x3cfeature /\x3e"}});a.server.ServerTheme=a.Class.extend({initialize:function(a,b){this.name=a;this.type=b;this.dataSource=null},setDataSourceName:function(a){this.dataSource=a},getDataSourceName:function(){return this.dataSource},setName:function(a){this.name=a}});a.server.ServerTheme.TYPE_JDBC="jdbc";a.server.ServerTheme.TYPE_PREDEFINED="predefined";a.server.ServerTheme.TYPE_GEORASTER="georaster";a.server.ServerTheme.TYPE_IMAGE=
"image";a.server.ServerTheme.TYPE_NETWORK="network";a.server.ServerTheme.TYPE_TOPOLOGY="topology";a.server.ServerTheme.TYPE_WFS="wfs";a.server.ServerTheme.TYPE_WMS="wms";a.server.ServerTheme.TYPE_WMTS="wmts";a.server.ServerTheme.TYPE_MAPCACHE="mapcache";a.server.ServerPredefinedTheme=a.server.ServerTheme.extend({initialize:function y(b){y.base.call(this,b,a.server.ServerTheme.TYPE_PREDEFINED);this.bindingParams=null},toXMLString:function(){var b=this.name;if(a.isNull(b))a.util.Logger.warning("MAPVIEWER_9092",
"OM.server.ServerPredefinedTheme");else{var c=this.bindingParams,b='\x3ctheme name\x3d"'+b.toUpperCase()+'"\x3e';if(a.notNull(c)){for(var k="",O=0,u=c.length;O<u;O++){var C=c[O],G=C.value,C=C.type;a.notNull(G)&&a.notNull(C)?k+='\x3cparameter value\x3d"'+G+'" type\x3d"'+C+'"/\x3e':a.util.Logger.warning("MAPVIEWER_9093","OM.server.ServerPredefinedTheme")}a.notNull(k)&&(k="\x3cbinding_parameters\x3e"+k+"\x3c/binding_parameters\x3e");b+=k}return b+"\x3c/theme\x3e"}},setBindingParameters:function(b){a.isNull(b)||
0===b.length?a.util.Logger.warning("MAPVIEWER_9094","OM.server.ServerPredefinedTheme",b.stringify()):this.bindingParams=b}});a.server.ServerJDBCTheme=a.server.ServerTheme.extend({initialize:function q(b){q.base.call(this,b,a.server.ServerTheme.TYPE_JDBC);this.sql=this.executeAsis=this.label_style=this.label_column=this.jdbc_srid=this.yColumn=this.xColumn=this.geomColumn=null;this.executeAsis=!1;this.geomColumn=null;this.infoColumns=[];a.util.Logger.warning("MAPVIEWER_9083","OM.server.ServerJDBCTheme.initialize")},
addInfoColumn:function(a){this.infoColumns.push(a)},setQuery:function(a){this.sql=a},setExecuteAsis:function(a){this.executeAsis=!0===a||"true"===a},setXColumnName:function(a){this.xColumn=a},setYColumnName:function(a){this.yColumn=a},setRenderingStyleName:function(a){this.renderingStyleName=a},setLabelColumnName:function(a){this.label_column=a},setLabelStyleName:function(a){this.label_style=a},setRenderingStyleValueColumns:function(a){this.renderingStyleValueColumns=a},setSRID:function(a){this.jdbc_srid=
a},setGeometryColumnName:function(a){this.geomColumn=a},toXMLString_JDBC_Query:function(){var b;b="\x3cjdbc_query"+(a.notNull(this.dataSource)?' datasource\x3d"'+this.dataSource+'"':"");b+=a.notNull(this.geomColumn)?' spatial_column\x3d"'+this.geomColumn+'"':"";b+=a.notNull(this.xColumn)?' x_column\x3d"'+this.xColumn+'"':"";b+=a.notNull(this.yColumn)?' y_column\x3d"'+this.yColumn+'"':"";b+=a.notNull(this.jdbc_srid)?' jdbc_srid\x3d"'+this.jdbc_srid+'"':"";b+=a.notNull(this.label_column)?' label_column\x3d"'+
this.label_column+'"':"";b+=a.notNull(this.label_style)?' label_style\x3d"'+this.label_style+'"':"";b+=!0===this.executeAsis?' asis\x3d"true"':"";b=b+"\x3e"+(a.notNull(this.sql)?this.sql:"");var c="";if(0<this.infoColumns.length){for(var O=this.infoColumns,u=0,C=O.length;u<C;u++)var G=O[u],c=c+('\x3cfield column\x3d"'+G.column+'" name\x3d"'+G.name+'"/\x3e');c="\x3chidden_info\x3e"+c+"\x3c/hidden_info\x3e"}b+=c;return b+="\x3c/jdbc_query\x3e"},toXMLString_Rendering:function(){if(a.isNull(this.renderingStyleName))return"";
var b;b="\x3crendering\x3e\x3cstyle "+('name\x3d"'+this.renderingStyleName+'"');a.notNull(this.renderingStyleValueColumns)&&(b+=' value_columns\x3d"'+this.renderingStyleValueColumns+'"');return b+"/\x3e\x3c/rendering\x3e"},toXMLString:function(){if(a.isNull(this.name))return a.util.Logger.warning("MAPVIEWER_9095","OM.server.ServerJDBCTheme"),"";var b=this.name,c=this.toXMLString_JDBC_Query(),O=this.toXMLString_Rendering(),b='\x3ctheme name\x3d"'+b.toUpperCase()+'"\x3e';return b+(c+O+"\x3c/theme\x3e")}});
a.server.ServerJDBCGeorasterTheme=a.server.ServerTheme.extend({initialize:function k(b){k.base.call(this,b,a.server.ServerTheme.TYPE_GEORASTER);this.polygonMaskSRID=this.polygonMask=this.rasterBands=this.rasterPyramid=this.rasterTable=this.rasterId=this.jdbc_srid=this.georColumn=this.baseTable=null;this.transparentNoData=!1;this.pmaskJoinGeorColumn=this.pmaskJoinColumn=this.pmaskQCondition=this.pmaskGeomColumn=this.pmaskTable=this.alphaBand=null;this.reprojMode="BILINEAR";this.filterReprojResult=
!1;this.renderInterpolationHint="NEAREST_NEIGHBOR";this.sql=null;this.executeAsis=!1;this.bitmapMasks=this.imgOperationParameters=this.imgOperationNames=this.bindingParameters=null;this.isVirtualMosaic=!1;this.vmParams={tables:null,sql:null,colorBalance:"NONE",fillGap:!0,noData:!0,resampling:"BILINEAR",resamplingTolerance:.5,resolutionFilter:!0,minStretchValue:0,maxStretchValue:255,mean:1,standardDeviation:1,commonPointRule:"START",srid:8307}},setQuery:function(a){this.sql=a},setExecuteAsis:function(a){this.executeAsis=
!0===a||"true"===a},setSRID:function(a){this.jdbc_srid=a},setBaseTable:function(a){this.baseTable=a},setGeorasterColumn:function(a){this.georColumn=a},setRasterId:function(a){this.rasterId=a},setRasterDataTable:function(a){this.rasterTable=a},setRasterPyramid:function(a){this.rasterPyramid=a},setRasterBands:function(a){this.rasterBands=a},setAlphaBand:function(a){this.alphaBand=a},setPolygonMaskCoordinates:function(a){this.polygonMask=a},setPolygonMaskSRID:function(a){this.polygonMaskSRID=a},clearPolygonMaskTableParameters:function(){this.pmaskJoinGeorColumn=
this.pmaskJoinColumn=this.pmaskQCondition=this.pmaskGeomColumn=this.pmaskTable=null},setPolygonMaskTableParameters:function(a,b,c,C,G){this.pmaskTable=a;this.pmaskGeomColumn=b;this.pmaskQCondition=c;this.pmaskJoinColumn=C;this.pmaskJoinGeorColumn=G},setImageOperations:function(a,b){this.imgOperationNames=a;this.imgOperationParameters=b},setBindingParameters:function(b){a.isNull(b)||0===b.length?a.util.Logger.warning("MAPVIEWER_9094","OM.server.ServerJDBCGeorasterTheme",b.stringify()):this.bindingParameters=
b},setAsVirtualMosaic:function(a){this.isVirtualMosaic=a},setVMapplyResolutionFilter:function(a){this.vmParams.resolutionFilter=a},setVMcolorBalance:function(a){this.vmParams.colorBalance=a},setVMcommonPointRule:function(a){this.vmParams.commonPointRule=a},setVMfillGap:function(a){this.vmParams.fillGap=a},setVMincludeNODATA:function(a){this.vmParams.noData=a},setVMmaxStretchValue:function(a){this.vmParams.maxStretchValue=a},setVMmean:function(a){this.vmParams.mean=a},setVMminStretchValue:function(a){this.vmParams.minStretchValue=
a},setVMresamplingMode:function(a){this.vmParams.resampling=a},setVMresamplingTolerance:function(a){this.vmParams.resamplingTolerance=a},setVMsql:function(a){this.vmParams.sql=a},setVMsrid:function(a){this.vmParams.srid=a},setVMstandardDeviation:function(a){this.vmParams.standardDeviation=a},setVMtables:function(a){this.vmParams.tables=a},toXMLString_JDBC_Query:function(){var b;b="\x3cjdbc_georaster_query"+(a.notNull(this.dataSource)?' datasource\x3d"'+this.dataSource+'"':"");b+=a.notNull(this.baseTable)?
' georaster_table\x3d"'+this.baseTable+'"':"";b+=a.notNull(this.georColumn)?' georaster_column\x3d"'+this.georColumn+'"':"";b+=a.notNull(this.jdbc_srid)?' jdbc_srid\x3d"'+this.jdbc_srid+'"':"";b+=a.notNull(this.rasterId)?' raster_id\x3d"'+this.rasterId+'"':"";b+=a.notNull(this.rasterTable)?' raster_table\x3d"'+this.rasterTable+'"':"";b+=a.notNull(this.rasterPyramid)?' raster_pyramid\x3d"'+this.rasterPyramid+'"':"";b+=a.notNull(this.rasterBands)?' raster_bands\x3d"'+this.rasterBands+'"':"";b+=a.notNull(this.polygonMask)?
' polygon_mask\x3d"'+this.polygonMask+'"':"";b+=a.notNull(this.polygonMaskSRID)?' polygon_mask_srid\x3d"'+this.polygonMaskSRID+'"':"";b+=a.notNull(this.pmaskTable)?' polygon_mask_table\x3d"'+this.pmaskTable+'"':"";b+=a.notNull(this.pmaskGeomColumn)?' polygon_mask_geomcolumn\x3d"'+this.pmaskGeomColumn+'"':"";b+=a.notNull(this.pmaskQCondition)?' polygon_mask_condition\x3d"'+this.pmaskQCondition+'"':"";b+=a.notNull(this.pmaskJoinColumn)?' polygon_mask_joingeomcolumn\x3d"'+this.pmaskJoinColumn+'"':"";
b+=a.notNull(this.pmaskJoinGeorColumn)?' polygon_mask_joingeorcolumn\x3d"'+this.pmaskJoinGeorColumn+'"':"";b+=!0===this.transparentNoData?' transparent_nodata\x3d"true"':"";b+=a.notNull(this.alphaBand)?' alpha_band\x3d"'+this.alphaBand+'"':"";b+=a.notNull(this.reprojMode)&&"BILINEAR"!==this.reprojMode?' reproj_mode\x3d"'+this.reprojMode+'"':"";b+=!0===this.filterReprojResult?' filter_reproj\x3d"true"':"";b+=a.notNull(this.renderInterpolationHint)&&"NEAREST_NEIGHBOR"!==this.renderInterpolationHint?
' render_interpolation_hint\x3d"'+this.renderInterpolationHint+'"':"";b+=!0===this.executeAsis?' asis\x3d"true"':"";b=b+"\x3e"+(a.notNull(this.sql)?this.sql:"");return b+="\x3c/jdbc_georaster_query\x3e"},toXMLString_Binding_Parameters:function(b){var c="",u=this.bindingParameters;if(a.notNull(u)){for(var C=0,G=u.length;C<G;C++){var R=u[C],X=R.value,R=R.type;a.notNull(X)&&a.notNull(R)?"tile_mbr"!==R.toLowerCase()?c+='\x3cparameter value\x3d"'+X+'" type\x3d"'+R+'"/\x3e':a.isNull(b)?c+='\x3cparameter value\x3d"'+
X+'" type\x3d"'+R+'"/\x3e':(X="srid\x3d"+b.getSRID()+":coords\x3d"+b.getMinX()+","+b.getMinY()+","+b.getMaxX()+","+b.getMaxY(),c+='\x3cparameter value\x3d"'+X+'" type\x3d"Rectangle"/\x3e'):a.util.Logger.warning("MAPVIEWER_9093","OM.server.ServerJDCGeorasterTheme")}a.notNull(c)&&0<c.length&&(c="\x3cbinding_parameters\x3e"+c+"\x3c/binding_parameters\x3e")}return c},toXMLString_Image_Operations:function(){var b="";if(a.notNull(this.imgOperationNames)&&0<this.imgOperationNames.length){for(var b=b+"\x3coperations\x3e",
c=0;c<this.imgOperationNames.length;c++){var u=this.imgOperationNames[c],b=b+('\x3coperation name\x3d"'+u+'"\x3e');if(a.notNull(this.imgOperationParameters)&&(u=this.imgOperationParameters[u],a.notNull(u)))for(var C=0;C<u.length;C++)b+='\x3cparameter name\x3d"'+u[C].name+'" value\x3d"'+u[C].value+'"/\x3e';b+="\x3c/operation\x3e"}b+="\x3c/operations\x3e"}return b},toXMLString_Virtual_Mosaic_Parameters:function(){var a="";if(this.isVirtualMosaic){a=a+"\x3cvirtual_mosaic"+(' srid\x3d"'+this.vmParams.srid+
'"');this.vmParams.colorBalance&&"NONE"!==this.vmParams.colorBalance.toUpperCase()&&(a+=' color_balance\x3d"'+this.vmParams.colorBalance+'"',"LINEARSTRETCHING"===this.vmParams.colorBalance.toUpperCase()?(a+=' min_stretch_value\x3d"'+this.vmParams.minStretchValue+'"',a+=' max_stretch_value\x3d"'+this.vmParams.maxStretchValue+'"'):"NORMALIZATION"===this.vmParams.colorBalance.toUpperCase()&&(a+=' mean\x3d"'+this.vmParams.mean+'"',a+=' standard_deviation\x3d"'+this.vmParams.standardDeviation+'"'));this.vmParams.commonPointRule&&
"START"!==this.vmParams.commonPointRule.toUpperCase()&&(a+=' common_point_rule\x3d"'+this.vmParams.commonPointRule+'"');this.vmParams.fillGap||(a+=' fill_gap\x3d"false"');this.vmParams.noData&&(a+=' nodata_cell\x3d"true"');this.vmParams.resolutionFilter||(a+=' resolution_filter\x3d"false"');this.vmParams.resampling&&"BILINEAR"!==this.vmParams.resampling.toUpperCase()&&(a+=' resampling_mode\x3d"'+this.vmParams.resampling+'"');.5!==this.vmParams.resamplingTolerance&&(a+=' resampling_tolerance\x3d"'+
this.vmParams.resamplingTolerance+'"');a+="\x3e";if(null!==this.vmParams.sql)a+="\x3csql\x3e"+this.vmParams.sql+"\x3c/sql\x3e";else{for(var a=a+"\x3ctables\x3e",b=0;b<this.vmParams.tables.length;b++)a+='\x3ctable name\x3d"'+this.vmParams.tables[b].name+'" georaster_column\x3d"'+this.vmParams.tables[b].georaster_column+'"',null!==this.vmParams.tables[b].query_condition&&"undefined"!==typeof this.vmParams.tables[b].query_condition&&(a+=' query_condition\x3d"'+this.vmParams.tables[b].query_condition+
'"'),a+=" /\x3e";a+="\x3c/tables\x3e\n"}a+="\x3c/virtual_mosaic\x3e"}return a},toXMLString:function(b){if(a.isNull(this.name))return a.util.Logger.warning("MAPVIEWER_9095","OM.server.ServerJDBCGeorasterTheme"),"";var c=this.name,u=this.toXMLString_JDBC_Query(),C=this.toXMLString_Image_Operations();b=this.toXMLString_Binding_Parameters(b);var G=this.toXMLString_Virtual_Mosaic_Parameters(),c='\x3ctheme name\x3d"'+c.toUpperCase()+'"\x3e\n';return c+(u+C+b+G+"\x3c/theme\x3e")}});a.wmts.WMTSUtil=a.wmts.WMTSUtil||
{};a.wmts.WMTSUtil.deriveSRID=function(b){if(a.isNull(b))console.log("warning");else{var c=b.replace(/urn:(.-)?ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$2:$4"),u=c.indexOf(":");if(0>u)return-1;b=c.substring(0,u).toUpperCase();c=c.substring(u+1).toUpperCase();if("OGC"===b||"CRS"===b){if("84"===c||"CRS84"===c)return 8307}else if("EPSG"===b)return"3857"===c?3857:"4326"===c?8307:parseInt(c)}};a.wmts.WMTSUtil.findIndex=function(a,b){var c;return a.every(function(C,G){c=G;return!b(C,G,a)})?-1:c};a.wmts.WMTSUtil.find=
function(b,c){if(a.isNull(b))return null;for(var u=b.length>>>0,C,G=0;G<u;G++)if(C=b[G],c(C,G,b))return C;return null};a.wmts.WMTSUtil.includes=function(a,b){return 0<=a.indexOf(b)};a.wmts.WMTSUtil.linearFindNearest=function(a,b,c){var C=a.length;if(a[0]<=b)return 0;if(!(b<=a[C-1]))if(0<c)for(c=1;c<C;++c){if(a[c]<b)return c-1}else if(0>c)for(c=1;c<C;++c){if(a[c]<=b)return c}else for(c=1;c<C;++c){if(a[c]==b)return c;if(a[c]<b)return a[c-1]-b<b-a[c]?c-1:c}return C-1};a.wmts.WMTSUtil.isSorted=function(a,
b,c){var C=b||ol.array.numberSafeCompareFunction;return a.every(function(b,O){if(0===O)return!0;var X=C(a[O-1],b);return!(0<X||c&&0===X)})};a.wmts.WMTSUtil.RequestEncoding={KVP:"KVP",REST:"REST"};a.wmts.WMTSUtil.readHref=function(a){return a.getAttributeNS("http://www.w3.org/1999/xlink","href")};a.wmts.WMTSUtil.boundingExtent=function(b){for(var c=[Infinity,Infinity,-Infinity,-Infinity],u=0,C=b.length;u<C;++u)a.wmts.WMTSUtil.extendCoordinate(c,b[u]);return c};a.wmts.WMTSUtil.extendCoordinate=function(a,
b){b[0]<a[0]&&(a[0]=b[0]);b[0]>a[2]&&(a[2]=b[0]);b[1]<a[1]&&(a[1]=b[1]);b[1]>a[3]&&(a[3]=b[1])};a.wmts.WMTSUtil.TileGrid=function(c){this.resolutions_=c.resolutions;console.assert(a.wmts.WMTSUtil.isSorted(this.resolutions_,function(a,b){return b-a},!0),17);this.origin_=c.origin!==b?c.origin:null;this.origins_=null;c.origins!==b&&(this.origins_=c.origins,console.assert(this.origins_.length==this.resolutions_.length,20));var O=c.extent;O===b||this.origin_||this.origins_||(this.origin_=a.wmts.Extent.getTopLeft(O));
console.assert(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18);this.tileSizes_=null;c.tileSizes!==b&&(this.tileSizes_=c.tileSizes,console.assert(this.tileSizes_.length==this.resolutions_.length,19));this.tileSize_=c.tileSize!==b?c.tileSize:this.tileSizes_?null:256;console.assert(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22);this.extent_=O!==b?O:null};a.wmts.WMTSUtil.optionsFromCapabilities=function(c,O){console.assert(O.layer,'config "layer" must not be null');
var u=a.wmts.WMTSUtil.find(c.Contents.Layer,function(a,b,c){return a.Identifier==O.layer});console.assert(u,"found a matching layer in Contents/Layer");console.assert(0<u.TileMatrixSetLink.length,"layer has TileMatrixSetLink");var C=c.Contents.TileMatrixSet,G,R;G=1<u.TileMatrixSetLink.length?"projection"in O?a.wmts.WMTSUtil.findIndex(u.TileMatrixSetLink,function(b,c,k){return a.wmts.WMTSUtil.find(C,function(a){return a.Identifier==b.TileMatrixSet}).SupportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,
"$1:$3")==O.projection}):a.wmts.WMTSUtil.findIndex(u.TileMatrixSetLink,function(a,b,c){return a.TileMatrixSet==O.matrixSet}):0;0>G&&(G=0);R=u.TileMatrixSetLink[G].TileMatrixSet;console.assert(R,"TileMatrixSet must not be null");var X=u.Format[0];"format"in O&&(X=O.format);G=a.wmts.WMTSUtil.findIndex(u.Style,function(a,b,c){return"style"in O?a.Title==O.style:a.isDefault});0>G&&(G=0);G=u.Style[G].Identifier;var N={};"Dimension"in u&&u.Dimension.forEach(function(c,k,n){k=c.Identifier;n=c.Default;n!==
b?console.assert(a.wmts.WMTSUtil.includes(c.Value,n),"default value contained in values"):n=c.Value[0];console.assert(n!==b,"value could be found");N[k]=n});var r=a.wmts.WMTSUtil.find(c.Contents.TileMatrixSet,function(a,b,c){return a.Identifier==R});console.assert(r,"found matrixSet in Contents/TileMatrixSet");var n=a.wmts.WMTSUtil.deriveSRID(r.SupportedCRS),M=a.universe.Universe.getSpecs(n),Z=u.WGS84BoundingBox,ba=u.BoundingBox;a.isNull(Z)&&a.isNull(ba)&&(ba=a.notNull(M.bounds)?M.bounds.coordinates:
null,ba=a.notNull(ba)?[ba[0],ba[1],ba[2],ba[3]]:null);console.assert(a.notNull(Z)||a.notNull(ba),"Data bounding box cannot be retrieved");var n=a.notNull(Z)?new a.geometry.Rectangle(Z[0],Z[1],Z[2],Z[3],8307):new a.geometry.Rectangle(ba[0],ba[1],ba[2],ba[3],n),r=a.wmts.WMTSUtil.createFromCapabilitiesMatrixSet(r,n.getMBR()),Y=[],n=O.requestEncoding,n=n!==b?n:"";console.assert(a.wmts.WMTSUtil.includes(["REST","RESTful","KVP",""],n),'requestEncoding (%s) is one of "REST", "RESTful", "KVP" or ""',n);if("OperationsMetadata"in
c&&"GetTile"in c.OperationsMetadata){Z=c.OperationsMetadata.GetTile.DCP.HTTP.Get;console.assert(1<=Z.length);for(var ba=0,sa=Z.length;ba<sa;++ba){var la=a.wmts.WMTSUtil.find(Z[ba].Constraint,function(a){return"GetEncoding"==a.name}).AllowedValues.Value;console.assert(1<=la.length);""===n&&(n=la[0]);if(n===a.wmts.WMTSUtil.RequestEncoding.KVP)a.wmts.WMTSUtil.includes(la,a.wmts.WMTSUtil.RequestEncoding.KVP)&&Y.push(Z[ba].href);else break}}0===Y.length&&(n=a.wmts.WMTSUtil.RequestEncoding.REST,u.ResourceURL.forEach(function(a){"tile"===
a.resourceType&&(X=a.format,Y.push(a.template))}));console.assert(0<Y.length,"At least one URL found");return{urls:Y,layer:O.layer,matrixSet:R,format:X,projection:M,requestEncoding:n,tileGrid:r,style:G,dimensions:N}};a.wmts.WMTSUtil.readDecimal=function(b){b=a.util.XMLUtil.getAllTextContent(b,!1);return parseFloat(b)};a.wmts.WMTSUtil.readNonNegativeInteger=function(b){b=a.util.XMLUtil.getAllTextContent(b,!1);return parseInt(b)};a.wmts.WMTSUtil.readString=function(b){return a.util.XMLUtil.getAllTextContent(b,
!1).trim()};a.wmts.WMTSUtil.createFromCapabilitiesMatrixSet=function(b,c){var u=[],C=[],G=[],R=[],X=[],N=a.wmts.WMTSUtil.deriveSRID(b.SupportedCRS),r=a.universe.Universe.getMPU(N);b.TileMatrix.sort(function(a,b){return b.ScaleDenominator-a.ScaleDenominator});b.TileMatrix.forEach(function(a,b,c){C.push(a.Identifier);b=2.8E-4*a.ScaleDenominator/r;c=a.TileWidth;var k=a.TileHeight;G.push(a.TopLeftCorner);u.push(b);R.push(c===k?c:[c,k]);X.push([a.MatrixWidth,-a.MatrixHeight])});return{extent:c,origins:G,
resolutions:u,matrixIds:C,tileSizes:R,sizes:X}};a.wmts.WMTSOws=a.wmts.OWSFormat||{};a.wmts.WMTSOws.NAMESPACE="http://www.opengis.net/ows/1.1";a.wmts.WMTSOws.readFromDocument=function(a){console.assert(a.nodeType==Node.DOCUMENT_NODE,"doc.nodeType should be DOCUMENT");for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType==Node.ELEMENT_NODE)return this.readFromNode(a);return null};a.wmts.WMTSOws.readFromNode=function(b){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");return(b=
a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.PARSERS_,b,[]))?b:null};a.wmts.WMTSOws.readAddress_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("Address"==b.localName,"localName should be Address");return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.ADDRESS_PARSERS_,b,c)};a.wmts.WMTSOws.readAllowedValues_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("AllowedValues"==
b.localName,"localName should be AllowedValues");return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.ALLOWED_VALUES_PARSERS_,b,c)};a.wmts.WMTSOws.readConstraint_=function(c,O){console.assert(c.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("Constraint"==c.localName,"localName should be Constraint");var u=c.getAttribute("name");return u?a.util.XMLUtil.pushParseAndPop({name:u},a.wmts.WMTSOws.CONSTRAINT_PARSERS_,c,O):b};a.wmts.WMTSOws.readContactInfo_=function(b,c){console.assert(b.nodeType==
Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("ContactInfo"==b.localName,"localName should be ContactInfo");return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.CONTACT_INFO_PARSERS_,b,c)};a.wmts.WMTSOws.readDcp_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("DCP"==b.localName,"localName should be DCP");return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.DCP_PARSERS_,b,c)};a.wmts.WMTSOws.readGet_=function(c,
O){console.assert(c.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("Get"==c.localName,"localName should be Get");var u=a.wmts.WMTSUtil.readHref(c);return u?a.util.XMLUtil.pushParseAndPop({href:u},a.wmts.WMTSOws.REQUEST_METHOD_PARSERS_,c,O):b};a.wmts.WMTSOws.readHttp_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("HTTP"==b.localName,"localName should be HTTP");return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.HTTP_PARSERS_,
b,c)};a.wmts.WMTSOws.readOperation_=function(c,O){console.assert(c.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("Operation"==c.localName,"localName should be Operation");var u=c.getAttribute("name"),C=a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.OPERATION_PARSERS_,c,O);if(!C)return b;O[O.length-1][u]=C};a.wmts.WMTSOws.readOperationsMetadata_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("OperationsMetadata"==
b.localName,"localName should be OperationsMetadata");return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.OPERATIONS_METADATA_PARSERS_,b,c)};a.wmts.WMTSOws.readPhone_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("Phone"==b.localName,"localName should be Phone");return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.PHONE_PARSERS_,b,c)};a.wmts.WMTSOws.readServiceIdentification_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,
"node.nodeType should be ELEMENT");console.assert("ServiceIdentification"==b.localName,"localName should be ServiceIdentification");return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.SERVICE_IDENTIFICATION_PARSERS_,b,c)};a.wmts.WMTSOws.readServiceContact_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("ServiceContact"==b.localName,"localName should be ServiceContact");return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.SERVICE_CONTACT_PARSERS_,
b,c)};a.wmts.WMTSOws.readServiceProvider_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("ServiceProvider"==b.localName,"localName should be ServiceProvider");return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSOws.SERVICE_PROVIDER_PARSERS_,b,c)};a.wmts.WMTSOws.readValue_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("Value"==b.localName,"localName should be Value");return a.wmts.WMTSUtil.readString(b)};
a.wmts.WMTSOws.PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{ServiceIdentification:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSOws.readServiceIdentification_),ServiceProvider:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSOws.readServiceProvider_),OperationsMetadata:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSOws.readOperationsMetadata_)});a.wmts.WMTSOws.ADDRESS_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{DeliveryPoint:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),
City:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),AdministrativeArea:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),PostalCode:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),Country:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),ElectronicMailAddress:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString)});a.wmts.WMTSOws.ALLOWED_VALUES_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,
{Value:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSOws.readValue_)});a.wmts.WMTSOws.CONSTRAINT_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{AllowedValues:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSOws.readAllowedValues_)});a.wmts.WMTSOws.CONTACT_INFO_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{Phone:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSOws.readPhone_),Address:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSOws.readAddress_)});
a.wmts.WMTSOws.DCP_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{HTTP:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSOws.readHttp_)});a.wmts.WMTSOws.HTTP_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{Get:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSOws.readGet_),Post:b});a.wmts.WMTSOws.OPERATION_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{DCP:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSOws.readDcp_)});a.wmts.WMTSOws.OPERATIONS_METADATA_PARSERS_=
a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{Operation:a.wmts.WMTSOws.readOperation_});a.wmts.WMTSOws.PHONE_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{Voice:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),Facsimile:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString)});a.wmts.WMTSOws.REQUEST_METHOD_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{Constraint:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSOws.readConstraint_)});
a.wmts.WMTSOws.SERVICE_CONTACT_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{IndividualName:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),PositionName:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),ContactInfo:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSOws.readContactInfo_)});a.wmts.WMTSOws.SERVICE_IDENTIFICATION_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{Title:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),
ServiceTypeVersion:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),ServiceType:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString)});a.wmts.WMTSOws.SERVICE_PROVIDER_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{ProviderName:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),ProviderSite:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readHref),ServiceContact:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSOws.readServiceContact_)});
a.wmts.WMTSContents=a.wmts.WMTSContents||{};a.wmts.WMTSContents.NAMESPACE="http://www.opengis.net/wmts/1.0";a.wmts.WMTSContents.readFromDocument=function(a){console.assert(a.nodeType==Node.DOCUMENT_NODE,"doc.nodeType should be DOCUMENT");for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType==Node.ELEMENT_NODE)return this.readFromNode(a);return null};a.wmts.WMTSContents.readFromNode=function(b){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("Capabilities"==
b.localName,"localName should be Capabilities");var c=b.getAttribute("version").trim(),u=a.wmts.WMTSOws.readFromNode(b);if(!u)return null;u.version=c;return(u=a.util.XMLUtil.pushParseAndPop(u,a.wmts.WMTSContents.PARSERS_,b,[]))?u:null};a.wmts.WMTSContents.readContents_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("Contents"==b.localName,"localName should be Contents");return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSContents.CONTENTS_PARSERS_,
b,c)};a.wmts.WMTSContents.readLayer_=function(b,c){console.assert(b.nodeType==Node.ELEMENT_NODE,"node.nodeType should be ELEMENT");console.assert("Layer"==b.localName,"localName should be Layer");return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSContents.LAYER_PARSERS_,b,c)};a.wmts.WMTSContents.readTileMatrixSet_=function(b,c){return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSContents.TMS_PARSERS_,b,c)};a.wmts.WMTSContents.readStyle_=function(c,O){var u=a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSContents.STYLE_PARSERS_,
c,O);if(!u)return b;var C="true"===c.getAttribute("isDefault");u.isDefault=C;return u};a.wmts.WMTSContents.readTileMatrixSetLink_=function(b,c){return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSContents.TMS_LINKS_PARSERS_,b,c)};a.wmts.WMTSContents.readDimensions_=function(b,c){return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSContents.DIMENSION_PARSERS_,b,c)};a.wmts.WMTSContents.readResourceUrl_=function(a,b){var c=a.getAttribute("format"),C=a.getAttribute("template"),G=a.getAttribute("resourceType"),
R={};c&&(R.format=c);C&&(R.template=C);G&&(R.resourceType=G);return R};a.wmts.WMTSContents.readWgs84BoundingBox_=function(c,O){var u=a.util.XMLUtil.pushParseAndPop([],a.wmts.WMTSContents.WGS84_BBOX_READERS_,c,O);return 2!=u.length?b:a.wmts.WMTSUtil.boundingExtent(u)};a.wmts.WMTSContents.readBoundingBox_=function(c,O){var u=a.util.XMLUtil.pushParseAndPop([],a.wmts.WMTSContents.BBOX_READERS_,c,O);return 2!=u.length?b:a.wmts.WMTSUtil.boundingExtent(u)};a.wmts.WMTSContents.readLegendUrl_=function(b,c){var u=
{};u.format=b.getAttribute("format");u.href=a.notNull(a.wmts.WMTSContents.XLink)?a.wmts.WMTSContents.XLink.readHref(b):null;return u};a.wmts.WMTSContents.readCoordinates_=function(c,O){var u=a.wmts.WMTSUtil.readString(c).split(" ");if(!u||2!=u.length)return b;var C=+u[0],u=+u[1];return isNaN(C)||isNaN(u)?b:[C,u]};a.wmts.WMTSContents.readTileMatrix_=function(b,c){return a.util.XMLUtil.pushParseAndPop({},a.wmts.WMTSContents.TM_PARSERS_,b,c)};a.wmts.WMTSContents.PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSContents.NAMESPACE,
{Contents:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSContents.readContents_)});a.wmts.WMTSContents.CONTENTS_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSContents.NAMESPACE,{Layer:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSContents.readLayer_),TileMatrixSet:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSContents.readTileMatrixSet_)});a.wmts.WMTSContents.LAYER_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSContents.NAMESPACE,{Style:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSContents.readStyle_),
Format:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSUtil.readString),TileMatrixSetLink:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSContents.readTileMatrixSetLink_),Dimension:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSContents.readDimensions_),ResourceURL:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSContents.readResourceUrl_)},a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{Title:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),Abstract:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),
WGS84BoundingBox:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSContents.readWgs84BoundingBox_),BoundingBox:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSContents.readBoundingBox_),Identifier:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString)}));a.wmts.WMTSContents.STYLE_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSContents.NAMESPACE,{LegendURL:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSContents.readLegendUrl_)},a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,
{Title:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),Identifier:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString)}));a.wmts.WMTSContents.TMS_LINKS_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSContents.NAMESPACE,{TileMatrixSet:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString)});a.wmts.WMTSContents.DIMENSION_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSContents.NAMESPACE,{Default:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),
Value:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSUtil.readString)},a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{Identifier:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString)}));a.wmts.WMTSContents.WGS84_BBOX_READERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{LowerCorner:a.util.XMLUtil.makeArrayPusher(a.wmts.WMTSContents.readCoordinates_),UpperCorner:a.util.XMLUtil.makeArrayPusher(a.wmts.WMTSContents.readCoordinates_)});a.wmts.WMTSContents.BBOX_READERS_=
a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{LowerCorner:a.util.XMLUtil.makeArrayPusher(a.wmts.WMTSContents.readCoordinates_),UpperCorner:a.util.XMLUtil.makeArrayPusher(a.wmts.WMTSContents.readCoordinates_)});a.wmts.WMTSContents.TMS_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSContents.NAMESPACE,{WellKnownScaleSet:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),TileMatrix:a.util.XMLUtil.makeObjectPropertyPusher(a.wmts.WMTSContents.readTileMatrix_)},a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,
{SupportedCRS:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString),Identifier:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString)}));a.wmts.WMTSContents.TM_PARSERS_=a.util.XMLUtil.makeStructureNS(a.wmts.WMTSContents.NAMESPACE,{TopLeftCorner:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSContents.readCoordinates_),ScaleDenominator:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readDecimal),TileWidth:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readNonNegativeInteger),
TileHeight:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readNonNegativeInteger),MatrixWidth:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readNonNegativeInteger),MatrixHeight:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readNonNegativeInteger)},a.util.XMLUtil.makeStructureNS(a.wmts.WMTSOws.NAMESPACE,{Identifier:a.util.XMLUtil.makeObjectPropertySetter(a.wmts.WMTSUtil.readString)}));a.layer.Layer=a.Class.extend({mixin:a.event.EventSource,initialize:function(a){this.name=
a;this.group=null;this.visible=!0;this.minVisibleLevel=0;this.maxVisibleLevel=100;this.minVisibleScale=0;this.maxVisibleScale=1E9;this.zIndex=this.parentMap=this.visibleBound=null;this.opacity=1;this.layerType=null;this.customType="";this.loaded=!1;this.serverURL=null;this.infoWindow=!0},init:function(){},initLayer:function(b){this.initCalled=!0;this.init(b);b=a.event.LayerEvent;var c=new b(b.LAYER_INITIALIZED,this);this.parentMap&&(c.mapContext=this.parentMap.getMapContext(),this.fire(b.LAYER_INITIALIZED,
c))},panEvent:function(a){this.pan(a.xOffset,a.yOffset,a)},refreshEvent:function(a){this.refresh(a,!0)},setCenterAndZoomlevel:function(){},recenter:function(){},pan:function(){},enableInfoWindow:function(a){this.infoWindow=a},getEnableInfoWindow:function(){return this.infoWindow},destroy:function(){this.parentMap=null;this.deleteAllListeners()},isVisible:function(b){if(this.real)return this.real.isVisible();if(a.isNull(b)||isNaN(b))b=this.parentMap.getMapContext().getZoomLevel();return this.isInZoomLevelRange(b)?
this.visible:!1},setVisible:function(b){if(!b||this.isInZoomLevelRange()){if(this.real)return this.real.setVisible(b);var c=a.event.LayerEvent,u=new c(c.LAYER_VISIBILITY_CHANGED,this),C=this.visible;this.visible!==b&&(this.visible=b,this.setVisibleImpl?this.setVisibleImpl():this.visible?(this.group&&this.parentMap&&this.parentMap.graphics&&this.parentMap.graphics.applyStyle(this.group,{display:!0}),this.parentMap&&this.parentMap.displayed&&this.refresh(null,!1)):this.group&&this.parentMap&&this.parentMap.graphics&&
this.parentMap.graphics.applyStyle(this.group,{display:!1}),u.newVisibility=b,u.oldVisibility=C,this.parentMap&&(u.mapContext=this.parentMap.getMapContext()),this.fire(c.LAYER_VISIBILITY_CHANGED,u))}},refresh:function(){if(this.real)return this.real.refresh();var b=0<arguments.length?arguments[0]:null;if(1<arguments.length&&arguments[1]){var c=a.event.LayerEvent,b=new c(c.BEFORE_REFRESH,this);this.parentMap&&(b.mapContext=this.parentMap.getMapContext());this.fire(c.BEFORE_REFRESH,b)}},redraw:function(){if(this.real)return this.real.redraw(arguments);
0<arguments.length&&this.refresh(arguments[0],!1)},setZoomLevelRange:function(a,b){if(this.real)return this.real.setZoomLevelRange(a,b);this.minVisibleLevel=a;this.maxVisibleLevel=b;this.displayed&&this.refresh(null,!1)},isInZoomLevelRange:function(b){if(a.isNull(this.parentMap)||a.isNull(this.parentMap.getMapContext()))return!1;if(a.isNull(b)||isNaN(b))b=this.parentMap.getMapContext().getZoomLevel();return b>=this.minVisibleLevel&&b<=this.maxVisibleLevel},setVisibleBound:function(b){if(this.real)return this.real.setVisibleBound(b);
!b instanceof a.geometry.Rectangle||(this.visibleBound=b,this.displayed&&(this.changeVisibleBound?this.changeVisibleBound():this.refresh()))},bringForward:function(){if(this.real)return this.real.bringForward();if(this.parentMap)return this.parentMap.bringForward(this)},sendBackward:function(){if(this.real)return this.real.sendBackward();if(this.parentMap)return this.parentMap.sendBackward(this)},bringToTop:function(){if(this.real)return this.real.bringToTop();var a=!1;0<arguments.length&&(a=arguments[0]);
if(this.parentMap)return this.parentMap.bringToTop(this,a)},sendToBottom:function(){if(this.real)return this.real.sendToBottom();if(this.parentMap)return this.parentMap.sendToBottom(this)},setZIndex:function(a){if(this.real)return this.real.setZIndex(a);if(this.parentMap)return this.parentMap.setLayerIndex(this,a)},getZIndex:function(){if(this.real)return this.real.getZIndex();if(this.parentMap)return this.parentMap.getLayerCurrentIndex(this)},getName:function(){return this.name},setName:function(a){this.name=
a},setOpacity:function(b){if(a.util.ValidationUtil.isNumber(b)){if(this.real)return this.real.setOpacity(b);1<b||0>b||(this.opacity=b,this.displayed&&this.changeOpacity&&this.changeOpacity())}},getOpacity:function(){return this.real?this.real.getOpacity():this.opacity},getLayerConfig:function(){},getDataSouce:function(){return this.dataSource},clone:function(b){var c={};a.$.extend(c,this);c.name=b?b:c.name+"_clone"+Math.round(1E3*Math.random());c.deleteAllListeners();this.layerType===a.LayerTypes.VECTOR&&
this.renderingStyle&&this.renderingStyle.styleType&&"Area"===this.renderingStyle.styleType&&(this.renderingStyle.fill=null);return c},startNewTask:function(){var b=new a.util.Task(this.parentMap.progressService);b.start();return b}});a.layer.TileLayer=a.layer.Layer.extend({initialize:function O(b,c){O.base.call(this,b,c);if(c){this.dataSource=c.dataSource;this.tileLayer=c.tileLayer;if(a.notNull(c.tileServerURL)&&(this.serverURL=c.tileServerURL,a.notNull(c.subdomains))){var G=[],R=this.serverURL;c.subdomains.forEach(function(a){G.push(R.replace("://",
"://"+a+"."))});this.serverArray=G;this.serverCounter=0}this.tileImagesURL=c.tileImagesURL;this.tileLayerConfig=c.tileLayerConfig;this.getTileURL=c.getTileURL;this.mapSource=this.dataSource+"."+this.tileLayer;(this.isLocalTileLayer=c.isLocalTileLayer)&&c.isInZXYOrder&&(this.isInZXYOrder=c.isInZXYOrder);!0===c.enableUTFGrid||"true"===c.enableUTFGrid?(this.enableUTFGrid=!0,this.mouseETypeUTFGrid=c.infoWindowTrigger===a.event.MouseEvent.MOUSE_OVER||c.infoWindowTrigger===a.event.MouseEvent.MOUSE_MOVE?
a.event.MouseEvent.MOUSE_MOVE:a.event.MouseEvent.MOUSE_CLICK,this.utfgridResolution=this.getUTFGridResolution(c.utfGridResolution),this.enableInfoWindow(!0)):(this.enableUTFGrid=!1,this.enableInfoWindow(!1));!1!==c.enableUTFGridInfoWindow&&"false"!==c.enableUTFGridInfoWindow||this.enableInfoWindow(!1)}this.layerType=a.notNull(this.layerType)?this.layerType:a.LayerTypes.TILE;this.zIndex=0;this.initError=!1;this.TILING_FACTOR=20;this.UTFGRID_RESOLUTION=4;this.maxMeshY=this.meshLength=0;this.xFactors=
[];this.yFactors=[];this.addListener(a.event.LayerEvent.TILE_IMG_LOADED,this.tileImgLoadedHandler);this.addListener(a.event.LayerEvent.TILE_IMG_LOAD_ERROR,this.tileImgLoadedHandler);this.initRequiredBinds=this.requiredBinds=this.tilesPercent=this.tilesImgLoaded=0;this.initTask=null},setCenterAndZoomlevel:function(b){var c=this.parentMap.getMapContext().getCenterPoint(),C=b.preMapCenter;a.notNull(b.beforeZoomLevel)&&this.zoom(b.beforeZoomLevel,b.afterZoomLevel,C,c)},getLayerConfig:function(a,b){this.getTileLayerConfig(a,
b)},getTileLayerConfig:function(b,c){null===this.initTask&&(this.initTask=new a.util.Task(this.parentMap.progressService),this.initTask.start());var C;if(!this.tileLayerConfig){C=this.dataSource+"."+this.tileLayer;var G=a.gv.CacheConfig[C];G&&(this.tileLayerConfig=G)}if(this.tileLayerConfig)if(G=new a.event.LayerEvent(a.event.LayerEvent.FINISH_GOT_CONFIG,this),G.config=this.getEnabledConfig(this.tileLayerConfig),G.mapContext=this.parentMap.getMapContext(),this.initTask.update(.25),this.fire(a.event.LayerEvent.FINISH_GOT_CONFIG,
G),c)c(this.tileLayerConfig);else return this.tileLayerConfig;else{var R=this,G=this.parentMap,X;if(R.layerType===a.LayerTypes.WMTS_TILE)R.getTileLayerConfigFromWMTS(b,c);else if(this.isLocalTileLayer){var N=this.tileImagesURL+"/instance.json",R=this;X=function(){if(R.parentMap&&R.parentMap.graphics){R.initError=!0;a.util.Logger.alert("MAPVIEWER_9044","OM.layer.Tilelayer.getTileLayerConfig","["+N+"]");var b=a.event,c=new b.LayerEvent(b.LayerEvent.INIT_ERROR,R);R.parentMap&&(c.mapContext=R.parentMap.getMapContext(),
R.initTask.abort(),R.fire(b.LayerEvent.INIT_ERROR,c))}};a.util.HttpRequest.send(N,{},function(b){if(R.parentMap&&R.parentMap.graphics){try{b=JSON.parse(b)}catch(X){a.util.Logger.alert("MAPVIEWER_9044","OM.layer.Tilelayer.getTileLayerConfig","")}var N=b[0].coordSys,r=new a.layer.TileLayerConfig;r.bounds=new a.geometry.Rectangle(N.minX,N.minY,N.maxX,N.maxY,N.srid);r.srid=N.srid;r.tileImageFormat=b[0].format;r.isTransparentImage=b[0].transparent;r.copyright=b[0].copyright;var N=b[0].zoomLevels,O=N.length;
if(N&&0<O){r.tileImageWidth=N[0].tileImageWidth;r.tileImageHeight=N[0].tileImageHeight;r.zoomLevels=Array(O);for(var C=0;C<O;C++){var G=N[C].tileWidth/r.tileImageWidth;r.zoomLevels[C]={resolution:G,stretchRatio:N[C].tileHeight/r.tileImageHeight/G,infotip:""}}}b[0].customTags&&(r.customTags=b[0].customTags);r.isXYZStorageScheme="true"===b[0].xyzStorageScheme||!0===b[0].xyzStorageScheme;r.isInZXYOrder="true"===b[0].inZXYOrder||!0===b[0].inZXYOrder;R.tileLayerConfig=r;b=new a.event.LayerEvent(a.event.LayerEvent.FINISH_GOT_CONFIG,
R);b.config=R.getEnabledConfig(r);b.mapContext=R.parentMap.getMapContext();R.initTask.update(.25);R.fire(a.event.LayerEvent.FINISH_GOT_CONFIG,b);c&&c(r)}},"text",X)}else{var r='\x3c?xml version\x3d"1.0" standalone\x3d"yes"?\x3e\x3cmap_cache_admin_request\x3e\x3cget_client_config map_cache_names\x3d"'+C+'" format\x3d"JSON"'+(a.notNull(G.applicationID)?' applicationID\x3d"'+G.applicationID+'"':"")+"/\x3e\x3c/map_cache_admin_request\x3e",G=this.serverURL=this.getTileServerURL();X=function(){if(R.parentMap&&
R.parentMap.graphics){R.initError=!0;a.util.Logger.alert("MAPVIEWER_9001","OM.layer.Tilelayer.getTileLayerConfig","["+C+"]");var b=a.event,c=new b.LayerEvent(b.LayerEvent.INIT_ERROR,R);R.parentMap&&(c.mapContext=R.parentMap.getMapContext(),R.initTask.abort(),R.initTask=null,R.fire(b.LayerEvent.INIT_ERROR,c))}};r={xml_request:r};if(0<=G.indexOf("elocation.oracle.com")||0<=G.indexOf("maps.oracle.com"))r.$enableXHR=!0;a.util.HttpRequest.send(G,r,function(b){if(R.parentMap&&R.parentMap.graphics)if(b&&
b[0]){a.gv&&a.isNull(a.gv.defaultDataSource)&&(a.gv.defaultDataSource=R.dataSource);var N=b[0].coordSys,r=new a.layer.TileLayerConfig;r.bounds=new a.geometry.Rectangle(N.minX,N.minY,N.maxX,N.maxY,N.srid);r.srid=N.srid;r.tileImageFormat=b[0].format;r.isTransparentImage=b[0].transparent;r.copyright=b[0].copyright;var N=b[0].zoomLevels,O=N.length;if(N&&0<O){r.tileImageWidth=N[0].tileImageWidth;r.tileImageHeight=N[0].tileImageHeight;r.zoomLevels=Array(O);!R.enableUTFGrid||!0!==b[0].utfgrid&&"true"!==
b[0].utfgrid?R.enableUTFGrid=!1:R.getUTFGridResolution(b[0].utfGridResolution);for(var G=0;G<O;G++){var sa=N[G].tileWidth/r.tileImageWidth;r.zoomLevels[G]={resolution:sa,stretchRatio:N[G].tileHeight/r.tileImageHeight/sa,infotip:""}}}b[0].customTags&&(r.customTags=b[0].customTags);R.setTileLayerConfig(r);if(b[0].clientTileAccess){var la;b=b[0].clientTileAccess;a.isNull(b.mapTypeList)&&a.notNull(b.map_type_values)&&(b.mapTypeList=b.map_type_values);b.lib_url&&b.key&&(b.lib_url=b.lib_url.replace("\x3d$$key$$",
"\x3d"+b.key));b.mapTypeVisible="false"==b.mapTypeVisible||"false"==b.map_type_visible?!1:!0;var oa;if("google"==b.type)oa={libURL:b.lib_url,mapTypeList:b.mapTypeList.replace(/MVGoogleTileLayer/g,"OM.layer.GoogleTileLayer"),mapTypeVisible:b.mapTypeVisible},b.appID&&(oa.appID=b.appID),b.key&&(oa.key=b.key),b.client&&(oa.clientID=b.client),la=new a.layer.GoogleTileLayer(R.name,oa);else if("tomtom"==b.type)a.util.Logger.alert("MAPVIEWER_9201","OM.layer.Tilelayer.getTileLayerConfig","["+C+"]");else if("bing"==
b.type||"bingV7"==b.type)oa={key:b.key,libURL:b.lib_url,mapTypeList:b.mapTypeList.replace(/MVBingTileLayer/g,"OM.layer.BingTileLayer"),mapTypeVisible:b.mapTypeVisible},b.appID&&(oa.appID=b.appID),la=new a.layer.BingTileLayer(R.name,oa);else if("mapviewer"==b.type){b.appID&&(oa.appID=b.appID);la=b.dataSource||"";oa=b.tile_layer_name;N=b.tileServerURL;O=-1;a.notNull(oa)&&(O=oa.indexOf("."),0<O&&(la=oa.substring(0,O),oa=oa.substring(O+1)));O=N.length;O-=9;G=N.indexOf("/mcserver",O);if(-1===G||G!==O)O=
N.indexOf("/mcserver"),N=N.substring(0,O+9);O={};a.notNull(la)&&(O.dataSource=la);O.tileLayer=oa;O.tileServerURL=N;la=new a.layer.TileLayer(R.name,O)}else"here"==b.type?(oa={appID:b.appID,appCode:b.appCode,libURL:b.libURL,mapTypeList:b.mapTypeList.replace(/MVHereTileLayer/g,"OM.layer.HereTileLayer"),mapTypeVisible:b.mapTypeVisible},la=new a.layer.HereTileLayer(R.name,oa)):"openstreetmap"==b.type?la=new a.layer.OSMTileLayer(R.name,oa):"locationbox"==b.type&&a.util.Logger.alert("MAPVIEWER_9201","OM.layer.Tilelayer.getTileLayerConfig",
"["+C+"]");b.default_map_type&&("OM.layer.GoogleTileLayer.TYPE_ROAD"==b.default_map_type&&la.setMapType(a.layer.GoogleTileLayer.TYPE_ROAD),"OM.layer.GoogleTileLayer.TYPE_SATELLITE"==b.default_map_type&&la.setMapType(a.layer.GoogleTileLayer.TYPE_SATELLITE),"OM.layer.GoogleTileLayer.TYPE_SHADED"==b.default_map_type&&la.setMapType(a.layer.GoogleTileLayer.TYPE_SHADED),"OM.layer.BingTileLayer.TYPE_ROAD"==b.default_map_type&&la.setMapType(a.layer.BingTileLayer.TYPE_ROAD),"OM.layer.BingTileLayer.TYPE_SATELLITE"==
b.default_map_type&&la.setMapType(a.layer.BingTileLayer.TYPE_SATELLITE),"OM.layer.BingTileLayer.TYPE_HYBRID"==b.default_map_type&&la.setMapType(a.layer.BingTileLayer.TYPE_HYBRID),"OM.layer.BingTileLayer.TYPE_SHADED"==b.default_map_type&&la.setMapType(a.layer.BingTileLayer.TYPE_SHADED),"OM.layer.NokiaTileLayer.TYPE_ROAD"==b.default_map_type&&la.setMapType(a.layer.NokiaTileLayer.TYPE_ROAD),"OM.layer.NokiaTileLayer.TYPE_HYBRID"==b.default_map_type&&la.setMapType(a.layer.NokiaTileLayer.TYPE_HYBRID),"OM.layer.NokiaTileLayer.TYPE_TERRAIN"==
b.default_map_type&&la.setMapType(a.layer.NokiaTileLayer.TYPE_TERRAIN));la.tileLayerConfig=r;oa=R.parentMap;oa.replaceLayer(R,la);R.real=la;b=new a.event.LayerEvent(a.event.LayerEvent.FINISH_GOT_CONFIG,la);b.config=la.getEnabledConfig(r);b.mapContext=oa.getMapContext();R.initTask.complete();R.initTask=null;la.fire(a.event.LayerEvent.FINISH_GOT_CONFIG,b)}else b=new a.event.LayerEvent(a.event.LayerEvent.FINISH_GOT_CONFIG,R),b.config=R.getEnabledConfig(r),b.mapContext=R.parentMap.getMapContext(),R.initTask.update(.25),
R.fire(a.event.LayerEvent.FINISH_GOT_CONFIG,b);c&&c(r)}else return X(),null},"json",function(b){if(R.parentMap&&R.parentMap.graphics){R.initError=!0;if(b&&b.responseText)try{var c=a.$(a.$.parseXML(b.responseText)).find("oms_error");0<c.length&&a.util.Logger.alert("MAPVIEWER_9009","OM.layer.Tilelayer.getTileLayerConfig",c.text())}catch(N){a.util.Logger.alert("MAPVIEWER_9009","OM.layer.Tilelayer.getTileLayerConfig",b.responseText)}else a.util.Logger.alert("MAPVIEWER_9009","OM.layer.Tilelayer.getTileLayerConfig",
"["+C+"]");b=a.event;c=new b.LayerEvent(b.LayerEvent.INIT_ERROR,R);R.parentMap&&(c.mapContext=R.parentMap.getMapContext(),R.initTask.abort(),R.fire(b.LayerEvent.INIT_ERROR,c))}})}}},init:function(){null===this.initTask&&(this.initTask=this.startNewTask());var b=0,c=this.parentMap.getMapContext();this.winWidth=c.getDeviceWidth();this.winHeight=c.getDeviceHeight();var C=c.getCenterPoint(),G=C.getX(),R=C.getY(),X=this.getRealZoomLevel(c.getZoomLevel());if(this.checkVisible(X)){this.tileImageWidth=this.tileLayerConfig.tileImageWidth;
this.tileImageHeight=this.tileLayerConfig.tileImageHeight;this.bufferX=Math.ceil(this.tileImageWidth/2);this.bufferY=Math.ceil(this.tileImageHeight/2);this.tileNumX=Math.ceil((this.winWidth+2*this.bufferX)/this.tileImageWidth);this.centerMesh=null;this.centerMesh=new a.layer.Mesh(this.tileLayerConfig,G,R,X);var N=this.tileLayerConfig.bounds;this.tileNumInCSBoun=Math.ceil((N.getMaxX()-N.getMinX())/this.centerMesh.mw);var X=this.tileLayerConfig.zoomLevels[X],r=X.resolution,n=X.resolution*X.stretchRatio;
this.pixPerX=this.tileImageWidth/this.centerMesh.mw;this.pixPerY=this.tileImageHeight/this.centerMesh.mh;this.coverPixel=(this.centerMesh.mw*this.tileNumInCSBoun-(this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX()))*this.pixPerX;this.parentMap.wraparound&&(this.tileNumX=this.tileNumX+Math.ceil(this.tileNumX/this.tileNumInCSBoun*this.coverPixel/(this.tileImageWidth/2))+1);this.tileNumY=Math.ceil((this.winHeight+2*this.bufferY)/this.tileImageHeight);this.tileMinY=this.tileMinX=
0;this.initTileArray();X=Math.floor(this.tileNumX/2);N=Math.floor(this.tileNumY/2);G=this.winWidth/2-(G-this.centerMesh.minX)/r;for(R=this.winHeight/2+(R-this.centerMesh.minY)/n-this.tileImageHeight;;){var M=G-X*this.tileImageWidth;if(0<M)X++;else if(r=R-N*this.tileImageHeight,0<r)N++;else{var Z=G+(this.tileNumX-X)*this.tileImageWidth-this.winWidth;if(0>Z)X--;else if(n=R+(this.tileNumY-N)*this.tileImageHeight-this.winHeight,0>n)N--;else if(M=Z+M,r=n+r,M>this.tileImageWidth)X++;else if(M<-1*this.tileImageWidth)X--;
else if(r>this.tileImageHeight)N++;else if(r<-1*this.tileImageHeight)N--;else break}}this.origLeft=G-X*this.tileImageWidth;this.origTop=R-N*this.tileImageHeight;this.divLeft=this.origLeft;this.divTop=this.origTop;C=c.getTransform().toScreenPoint(C.getX(),C.getY());this.offsetX=C.x-c.getDeviceWidth()/2;this.offsetY=C.y-c.getDeviceHeight()/2;this.jqLayerDiv.css({left:this.divLeft,top:this.divTop});this.createImageNode(X,N,this.tileImageWidth,this.tileImageHeight,X*this.tileImageWidth,N*this.tileImageHeight);
b++;this.centerMesh.moveMeshCode(-1,1);c=Math.max(X,this.tileNumX-X);C=Math.max(N,this.tileNumY-N);for(r=1;r<=Math.max(c,C);r++){G=X-r;for(R=N-r;G<=X+r;G++)0>G||G>=this.tileNumX||0>R||R>=this.tileNumY||(this.createImageNode(G,R,this.tileImageWidth,this.tileImageHeight,G*this.tileImageWidth,R*this.tileImageHeight),b++),this.centerMesh.moveMeshCode(1,0);this.centerMesh.moveMeshCode(-(2*r+1),-1);G=X-r;for(R=N-r+1;R<=N+r-1;R++)0>G||G>=this.tileNumX||0>R||R>=this.tileNumY||(this.createImageNode(G,R,this.tileImageWidth,
this.tileImageHeight,G*this.tileImageWidth,R*this.tileImageHeight),b++),this.centerMesh.moveMeshCode(0,-1);G=X-r;for(R=N+r;G<=X+r;G++)0>G||G>=this.tileNumX||0>R||R>=this.tileNumY||(this.createImageNode(G,R,this.tileImageWidth,this.tileImageHeight,G*this.tileImageWidth,R*this.tileImageHeight),b++),this.centerMesh.moveMeshCode(1,0);this.centerMesh.moveMeshCode(-1,1);G=X+r;for(R=N+r-1;R>=N-r+1;R--)0>G||G>=this.tileNumX||0>R||R>=this.tileNumY||(this.createImageNode(G,R,this.tileImageWidth,this.tileImageHeight,
G*this.tileImageWidth,R*this.tileImageHeight),b++),this.centerMesh.moveMeshCode(0,1);this.centerMesh.moveMeshCode(-(2*r+1),1)}this.centerMesh.moveMeshCode(r,-r);this.centerMesh.moveMeshCode(-X+Math.floor(this.tileNumX/2),N-Math.floor(this.tileNumY/2));this.zoomControl||(this.zoomControl=new a.layer.TileZoomAnimation(this));this.zoomControl.tileInitialized();this.displayed=!0;if(!this.hasListener(this.mouseETypeUTFGrid))this.on(this.mouseETypeUTFGrid,this.getAndStoreUTFGridAttr);this.initRequiredBinds=
b}else this.jqLayerDiv&&(this.visible=!1,this.jqLayerDiv.css("visibility","hidden")),b=a.event,X=new b.LayerEvent(b.LayerEvent.FINISH_LOAD,this),X.mapContext=this.parentMap.getMapContext(),null!==this.initTask&&(this.initTask.complete(),this.initTask=null),this.fire(b.LayerEvent.FINISH_LOAD,X)},getAndStoreUTFGridAttr:function(){if(!a.isNull(this.isVisible())&&!1!==this.isVisible()){var b=this.getFeatureInfo(),c="";if(b&&!a.$.isEmptyObject(b))for(var C in b)if("string"===typeof C&&0<C.trim().length){var G=
b[C];if(!a.isNull(G)){var c=c+("\x3ctr bgcolor\x3d'#bbbbbb'\x3e\x3ctd colspan\x3d'2' align\x3d'left'\x3e"+C+"\x3c/td\x3e\x3c/tr\x3e"),R;for(R in G)c+="\x3ctr bgcolor\x3d'#dddddd'\x3e\x3ctd align\x3d'right'\x3e"+R+"\x3c/td\x3e\x3ctd align\x3d'left'\x3e"+G[R]+"\x3c/td\x3e\x3c/tr\x3e"}}this.parentMap.appendUTFGridLayerHTML(c)}},buildUTFGridReq:function(a){var b=a.indexOf("/omserver");if(-1==b)return null;var c=a.substring(0,b),b=a.indexOf(" grid_id\x3d")+9,G=a.indexOf(" grid_res");a=a.substring(b+1,
G-1);return c+"/images/utfgrid/utfgrid"+a+".json"},getUpperLeftTileCode:function(a,b){var c=this.centerMesh.mX,G=this.centerMesh.mY,R=Math.max(a,this.tileNumX-a),X=Math.max(b,this.tileNumY-b),R=Math.max(R,X),c=c-Math.min(a,R),G=G+Math.min(b,R),R=[];R.push(c);R.push(G);return R},initTileArray:function(){this.clearLayer();this.jqLayerDiv=a.$("\x3cdiv id \x3d'tilelayer_"+this.name+"'\x3e\x3c/div\x3e");this.jqLayerDiv.css({position:"absolute","z-index":this.getZIndex()-1});this.parentMap.$tileLayersDiv.append(this.jqLayerDiv);
this.transImgURL=a.util.MiscUtil.transparentImgURL;var b,c,C;for(b=0;b<this.tileNumX;b++){C=[];for(c=0;c<this.tileNumY;c++)C.push(this.initTileNode());this.tileArray.push(C)}},initTileNode:function(b){var c=function(a){a.preventDefault();return!1},C=function(a){a.preventDefault()},G=a.util.DomUtil.createImageNode(this.transImgURL,this.tileLayerConfig.isTransparentImage),G=a.$(G);a.browser.touchSupported?(G.bind("click",c),G.bind("focus",c)):(G.bind("mouseout",c),G.bind("mousedown",C));a.notNull(b)&&
(a.$(G).css("top",a.$(b.node).css("top")),a.$(G).css("left",a.$(b.node).css("left")),a.$(G).css("position",a.$(b.node).css("position")),a.$(G).css("z-index",a.$(b.node).css("z-index")),a.$(G).css("opacity",a.$(b.node).css("opacity")));this.jqLayerDiv.append(G);b={};b.node=G;b.grid=null;b.gridsrc=null;return b},createImageNode:function(b,c,C,G,R,X){0===b&&0===c&&this.transImgURL&&(this.leftNum=this.centerMesh.mX,this.topNum=this.centerMesh.mY);var N=this.meshImgPath(this.centerMesh.mX,this.centerMesh.mY),
r=this.tileArray[b][c].node;a.isNull(r)&&(r=a.util.DomUtil.createImageNode(null,this.isTransparent),r=a.$(r),this.jqLayerDiv.append(r),this.tileArray[b][c].node=r);r.css({position:"absolute",left:R,top:X});a.browser.msie&&r.css({width:C,height:G});this.zoomControl&&this.zoomControl.zooming&&r.css("display","none");a.browser.mobileWebkit&&!a.browser.android&&r.css("-webkit-transform","translate3d(0,0,0)");this.enableUTFGrid&&(C=this.isDynamicTileLayer?this.buildUTFGridReq(N):this.meshUTFGridPath(this.centerMesh.mX,
this.centerMesh.mY),this.tileArray[b][c].gridsrc=C);this.bindAndLoadTile(this.tileArray[b][c]);a.util.DomUtil.setImageSrc(r,N,this.opacity);r[0].mx=this.centerMesh.mX;r[0].my=this.centerMesh.mY},fetchUTFGrid:function(b){a.isNull(b.gridsrc)?b.grid={}:a.$.ajax({dataType:"text",url:b.gridsrc,data:"",cache:!0,success:function(c){a.isNull(c)?a.util.Logger.warning("MAPVIEWER_9065","OM.layer.TileLayer.fetchUTFGrid",b.gridsrc):b.grid=c}})},cloneGrid:function(b){var c;if(a.isNull(b)||"object"!=typeof b)return b;
if(b instanceof Object){c={};for(var C in b)b.hasOwnProperty(C)&&(c[C]=this.cloneGrid(b[C]));return c}throw Error("Unable to copy utfgrid Object{grid:'', src:''}! Its type isn't supported.");},decodeCharVal:function(b){if(a.notNull(b))return b=b.charCodeAt(0),93<=b&&b--,35<=b&&b--,b-32},featureInfoToJSON:function(b,c,C){if(b.length!==c.length&&b.length!==C.length)return a.util.Logger.warning("MAPVIEWER_9080","OM.layer.Tilelayer.featureInfoToJSON"),null;c={};for(var G=0;G<C.length;G++)C[G]&&(c[b[G]]=
C[G]);return c},getFeatureInfo:function(){var b,c,C,G,R,X,N,r=[],n=[],M=[];b=this.parentMap.mLocX-this.divLeft;c=this.parentMap.mLocY-this.divTop;X=parseInt(b/this.tileImageWidth);R=parseInt(c/this.tileImageHeight);b-=X*this.tileImageWidth;c-=R*this.tileImageHeight;try{N=JSON.parse(this.tileArray[X][R].grid);if(a.isNull(N))return;var Z=parseInt(N.resolution);C=parseInt(b/Z);G=parseInt(c/Z)}catch(ba){return}for(var Y in N)if("rows"!==Y&&"columns"!==Y&&"resolution"!==Y){r.push(Y);try{var sa=this.decodeCharVal(N[Y].grid[G][C]);
if(a.notNull(sa)){n.push(sa);var la=N[Y].data[sa];a.isNull(la)?M.push(""):M.push(la)}}catch(oa){}}return this.featureInfoToJSON(r,n,M)},meshImgPath:function(b,c){if(this.parentMap.wraparound){if(0>c||c>=(this.tileLayerConfig.bounds.getMaxY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh)return this.transImgURL;if(0>b)for(;!(b=parseInt(Math.ceil((this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw))+b,0<=b););else if(b>=(this.tileLayerConfig.bounds.getMaxX()-
this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw)for(;!(b-=parseInt(Math.ceil((this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw)),b<(this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw););}else if(0>b||b>=(this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw||0>c||c>=(this.tileLayerConfig.bounds.getMaxY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh)return this.transImgURL;
if(this.visibleBound){var C=Math.floor((this.visibleBound.getMinX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw),G=Math.ceil((this.visibleBound.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw),R=Math.floor((this.visibleBound.getMinY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh),X=Math.ceil((this.visibleBound.getMaxY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh);if(b<C||b>=G||c<R||c>=X)return this.transImgURL}C=this.centerMesh.zoom;if(this.getTileURL){var G=
this.tileLayerConfig.zoomLevels[C],X=this.tileLayerConfig.tileImageWidth*G.resolution,G=this.tileLayerConfig.tileImageHeight*G.resolution*G.stretchRatio,R=this.tileLayerConfig.bounds.getMinX()+b*X,X=R+X,N=this.tileLayerConfig.bounds.getMinY()+c*G,G=new a.geometry.Rectangle(R,N,X,N+G,this.tileLayerConfig.srid);return(C=this.getTileURL(C,b,c,G))?C:this.transImgURL}R=G=null;if(this.isLocalTileLayer)return G=Math.ceil((this.tileLayerConfig.bounds.getMaxX()-this.tileLayerConfig.bounds.getMinX())/this.centerMesh.mw)-
1,this.maxMeshY=R=Math.ceil((this.tileLayerConfig.bounds.getMaxY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh)-1,this.tileLayerConfig.isXYZStorageScheme?(R=this.tileImagesURL+"/"+C+"/",R=this.tileLayerConfig.isInZXYOrder?R+(b+"/"+(this.maxMeshY-c)+"."+this.tileLayerConfig.tileImageFormat):R+(this.maxMeshY-c+"/"+b+"."+this.tileLayerConfig.tileImageFormat)):(G=Math.max(G,R),this.calcMeshCode(b,c,G),R=this.tileImagesURL+"/"+this.getMeshStr(C)+"."+this.tileLayerConfig.tileImageFormat),
R;if(this.isDynamicTileLayer)return this.getDynamicTL_URL(b,c,C);if(this.isWMSTileLayer)return this.getWMSTL_URL(b,c,C);if(this.layerType===a.LayerTypes.WMTS_TILE)return this.getWMTS_URL(b,c,C);G=this.mapSource?this.mapSource.toUpperCase():this.dataSource.toUpperCase()+"."+this.tileLayer.toUpperCase();R=this.serverURL;a.notNull(this.serverArray)&&(R=this.serverArray[this.serverCounter],this.serverCounter+=1,this.serverCounter%=this.serverArray.length);R=R+"?request\x3dgettile\x26format\x3d"+this.tileLayerConfig.tileImageFormat;
R+="\x26zoomlevel\x3d"+C+"\x26mapcache\x3d"+G+"\x26mx\x3d"+b+"\x26my\x3d"+c;this.reloadNumber&&(R+="\x26reload\x3d"+this.reloadNumber);return R},meshUTFGridPath:function(b,c){var C=this.tileLayerConfig.bounds,G=C.getMinX(),R=C.getMaxX(),X=C.getMinY(),N=C.getMaxY();if(this.parentMap.wraparound){if(0>c||c>=(N-X)/this.centerMesh.mh)return this.transUTFGridURL;if(0>b)for(;!(b=parseInt(Math.ceil((R-G)/this.centerMesh.mw))+b,0<=b););else if(b>=(R-G)/this.centerMesh.mw)for(;!(b-=parseInt(Math.ceil((R-G)/
this.centerMesh.mw)),b<(R-G)/this.centerMesh.mw););}else if(0>b||b>=(R-G)/this.centerMesh.mw||0>c||c>=(N-X)/this.centerMesh.mh)return this.transUTFGridURL;if(this.visibleBound){var C=Math.floor((this.visibleBound.getMinX()-G)/this.centerMesh.mw),r=Math.ceil((this.visibleBound.getMaxX()-G)/this.centerMesh.mw),n=Math.floor((this.visibleBound.getMinY()-X)/this.centerMesh.mh),M=Math.ceil((this.visibleBound.getMaxY()-X)/this.centerMesh.mh);if(b<C||b>=r||c<n||c>=M)return this.transUTFGridURL}C=this.centerMesh.zoom;
if(this.getTileURL)return N=this.tileLayerConfig.zoomLevels[C],R=this.tileLayerConfig.tileImageWidth*N.resolution,G+=b*R,X+=c*this.tileLayerConfig.tileImageHeight*N.resolution*N.stretchRatio,X=new a.geometry.Rectangle(G,X,G+R,X+R,this.tileLayerConfig.srid),(X=this.getTileURL(C,b,c,X))?X:this.transUTFGridURL;r=r=null;this.isLocalTileLayer?(G=Math.ceil((R-G)/this.centerMesh.mw)-1,this.maxMeshY=X=Math.ceil((N-X)/this.centerMesh.mh)-1,this.tileLayerConfig.isXYZStorageScheme?(r=this.tileImagesURL+"/"+
C+"/",r=this.tileLayerConfig.isInZXYOrder?r+(b+"/"+(this.maxMeshY-c)+".json"):r+(this.maxMeshY-c+"/"+b+".json")):(X=Math.max(G,X),this.calcMeshCode(b,c,X),r=this.tileImagesURL+"/"+this.getMeshStr(C)+".json")):(r=this.mapSource?this.mapSource.toUpperCase():this.dataSource.toUpperCase()+"."+this.tileLayer.toUpperCase(),X=this.serverURL,a.notNull(this.serverArray)&&(X=this.serverArray[this.serverCounter],this.serverCounter+=1,this.serverCounter%=this.serverArray.length),r=X+"?request\x3dgetutfgrid\x26format\x3djson"+
("\x26zoomlevel\x3d"+C+"\x26mapcache\x3d"+r+"\x26mx\x3d"+b+"\x26my\x3d"+c),this.reloadNumber&&(r+="\x26reload\x3d"+this.reloadNumber));return r},bindAndLoadTile:function(b){null===this.initTask&&(this.initTask=this.startNewTask());var c=this,C=a.$(b.node);C.imgLoadFinished=!1;C.bind("load",function(){C.imgLoadFinished=!0;C.unbind("load");C.css("display","");c.enableUTFGrid&&c.fetchUTFGrid(b);var G=new a.event.LayerEvent(a.event.LayerEvent.TILE_IMG_LOADED,c);c.fire(a.event.LayerEvent.TILE_IMG_LOADED,
G)});C.bind("error",function(){C.unbind("error");C.imgLoadFinished=!0;var b=new a.event.LayerEvent(a.event.LayerEvent.TILE_IMG_LOAD_ERROR,c);c.fire(a.event.LayerEvent.TILE_IMG_LOAD_ERROR,b)})},getTileXOffset:function(a){a+=this.tileMinX;for(var b=0;;){var c=a-b*this.tileImageWidth;if(0<c)b++;else{var G=a+(this.tileNumX-b)*this.tileImageWidth-this.winWidth;if(0>G)b--;else if(c=G+c,c>this.tileImageWidth)b++;else if(c<-1*this.tileImageWidth)b--;else return b}}},getTileYOffset:function(a){a+=this.tileMinY;
for(var b=0;;){var c=a-b*this.tileImageHeight;if(0<c)b++;else{var G=a+(this.tileNumY-b)*this.tileImageHeight-this.winHeight;if(0>G)b--;else if(c=G+c,c>this.tileImageHeight)b++;else if(c<-1*this.tileImageHeight)b--;else return b}}},pan:function(b,c,C){if(!a.isNull(this.jqLayerDiv)&&(C.callback&&C.callback(),null===this.initTask&&(this.initTask=this.startNewTask()),!a.isNull(this.parentMap)))if(b=this.getRealZoomLevel(this.parentMap.getMapContext().getZoomLevel()),this.checkVisible(b)){b=this.parentMap.getMapContext();
c=b.getCenterPoint();b=b.getTransform().toScreenPoint(c.getX(),c.getY());C=this.origLeft-b.x+this.winWidth/2+this.offsetX;var G=this.origTop-b.y+this.winHeight/2+this.offsetY;b=this.getTileXOffset(C);c=this.getTileYOffset(G);var R=this.tileMinY-c*this.tileImageHeight;this.divLeft=C+(this.tileMinX-b*this.tileImageWidth);this.divTop=G+R;this.jqLayerDiv.css({left:C,top:G});if(0!==b||0!==c){C=this.centerMesh.mX-Math.floor(this.tileNumX/2);var G=this.centerMesh.mY+Math.floor(this.tileNumY/2),R=0,X,N,r,
n,M,Z,ba,Y,sa=this.tileArray[0].length;if(0!==b)for(X=0;0<b?X<b:X>b;0<b?X++:X--)if(M=0<b?this.tileMinX-(X+1)*this.tileImageWidth:this.tileMinX+(this.tileNumX-X)*this.tileImageWidth,0<b?this.leftNum--:this.leftNum++,0<b){r=this.tileArray.pop();n=[];for(N=0;N<sa;N++)Z=r[N],n.push(this.initTileNode(Z));for(N=0;N<sa;N++){ba=n[N];a.util.DomUtil.setImageSrc(ba.node,null);if(0===c||0<c&&N<n.length-c||0>c&&N>=-c)Y=C-X-1,r=G-N,Z=this.meshImgPath(Y,r),a.util.DomUtil.setImageSrc(ba.node,Z),ba.node[0].mx=Y,ba.node[0].my=
r,this.enableUTFGrid&&(r=this.isDynamicTileLayer?this.buildUTFGridReq(Z):this.meshUTFGridPath(Y,r),ba.gridsrc=r),this.bindAndLoadTile(ba),R++;this.parentMap.wraparound?(Z=this.tileArray[0][N],r=Y,ba.node[0].style.left=0===r%this.tileNumInCSBoun?parseInt(Z.node[0].style.left)-this.tileImageWidth+this.coverPixel+"px":parseInt(Z.node[0].style.left)-this.tileImageWidth+"px"):a.$(ba.node).css("left",M)}this.tileArray.unshift(n)}else{r=this.tileArray.shift();n=[];for(N=0;N<sa;N++)Z=r[N],n.push(this.initTileNode(Z));
for(N=0;N<sa;N++){ba=n[N];a.util.DomUtil.setImageSrc(ba.node,null);if(0===c||0<c&&N<n.length-c||0>c&&N>=-c)Y=C+this.tileNumX-X,r=G-N,Z=this.meshImgPath(Y,r),a.util.DomUtil.setImageSrc(ba.node,Z),ba.node[0].mx=Y,ba.node[0].my=r,this.enableUTFGrid&&(r=this.isDynamicTileLayer?this.buildUTFGridReq(Z):this.meshUTFGridPath(Y,r),ba.gridsrc=r),this.bindAndLoadTile(ba),R++;this.parentMap.wraparound?(Z=this.tileArray[this.tileArray.length-1][N],r=Y,ba.node[0].style.left=r%this.tileNumInCSBoun==this.tileNumInCSBoun-
1||-1==r%this.tileNumInCSBoun?parseInt(Z.node[0].style.left)+this.tileImageWidth-this.coverPixel+"px":parseInt(Z.node[0].style.left)+this.tileImageWidth+"px"):a.$(ba.node).css("left",M)}this.tileArray.push(n)}if(0!==c)for(N=0;0<c?N<c:N>c;0<c?N++:N--)for(0<c?(sa=this.tileMinY-(N+1)*this.tileImageHeight,this.topNum++):(sa=this.tileMinY+(this.tileNumY-N)*this.tileImageHeight,this.topNum--),X=0;X<this.tileArray.length;X++)n=this.tileArray[X],0<c?(Y=C-b+X,r=G+N+1,Z=n.pop(),Z=this.initTileNode(Z),M=Z.node,
a.util.DomUtil.setImageSrc(M,null),n.unshift(Z),a.$(M).css("top",sa),Z=this.meshImgPath(Y,r),a.util.DomUtil.setImageSrc(M,Z),M[0].mx=Y,M[0].my=r,this.enableUTFGrid&&(r=this.isDynamicTileLayer?this.buildUTFGridReq(Z):this.meshUTFGridPath(Y,r),n[0].gridsrc=r),this.bindAndLoadTile(n[0])):(Y=C-b+X,r=G-this.tileNumY+N,Z=n.shift(),Z=this.initTileNode(Z),M=Z.node,a.util.DomUtil.setImageSrc(M,null),n.push(Z),a.$(M).css("top",sa),Z=this.meshImgPath(Y,r),a.util.DomUtil.setImageSrc(M,Z),M[0].mx=Y,M[0].my=r,
this.enableUTFGrid&&(r=this.isDynamicTileLayer?this.buildUTFGridReq(Z):this.meshUTFGridPath(Y,r),n[n.length-1].gridsrc=r),this.bindAndLoadTile(n[n.length-1])),R++;this.requiredBinds+=R;this.tileMinX=this.parentMap.wraparound?parseInt(this.tileArray[0][0].node[0].style.left):this.tileMinX-b*this.tileImageWidth;this.tileMinY-=c*this.tileImageHeight;this.centerMesh.moveMeshCode(-b,c)}}else Y=a.event,b=new Y.MapEvent(Y.LayerEvent.FINISH_LOAD,this),b.mapContext=this.parentMap.getMapContext(),this.fire(Y.LayerEvent.FINISH_LOAD,
b)},refresh:function u(b,c){if(!a.isNull(this.parentMap)&&(a.isNull(c)&&(c=!0),u.base.call(this,b,c),this.reloadNumber=Math.round(1E10*Math.random()),this.parentMap&&(this.parentMap.getMapContext().getTransform(),this.clearLayer(),this.init()),c)){var R=new a.event.LayerEvent(a.event.LayerEvent.AFTER_REFRESH,this);this.parentMap&&(R.mapContext=this.parentMap.getMapContext());this.fire(a.event.LayerEvent.AFTER_REFRESH,R)}},checkVisible:function(a){if(this.initError||!this.isVisible(a)||a>=this.tileLayerConfig.zoomLevels.length)return!1;
if(this.parentMap.enableZoomLevels){for(var b=0;b<this.parentMap.enableZoomLevels.length;b++)if(this.parentMap.enableZoomLevels[b]==a)return!0;return!1}return!0},clearLayer:function(){this.jqLayerDiv&&this.zoomControl&&!this.zoomControl.zooming&&(this.jqLayerDiv.remove(),this.jqLayerDiv=null);this.tileArray=[]},changeOpacity:function(){for(var b=this.tileArray.length,c=a.util.DomUtil.changeOpacity,G=0;G<b;G++)for(var R=this.tileArray[G].length,X=0;X<R;X++)c(this.tileArray[G][X].node,this.opacity)},
zoom:function(b,c,G,R){b=this.getRealZoomLevel(b);c=this.getRealZoomLevel(c);this.checkVisible(b)?(this.zoomControl||(this.zoomControl=new a.layer.TileZoomAnimation(this)),this.checkVisible(c)?this.parentMap.tileLayerZoomAnimation?this.zoomControl.scaling?(this.init(),this.zoomControl.endScaling()):this.zoomControl.showTiles(b,c,G,R):(this.init(),this.zoomControl.tileInitialized()):(this.clearLayer(),this.zoomControl.tileInitialized())):this.init()},getTileServerURL:function(){this.serverURL==this.parentMap.mapviewerURL&&
(this.serverURL+="/mcserver");return this.serverURL},setVisibleImpl:function(){this.jqLayerDiv&&this.jqLayerDiv.css("visibility",this.visible?"visible":"hidden");this.visible&&this.init()},getCustomTags:function(){return this.tileLayerConfig&&this.tileLayerConfig.customTags?this.tileLayerConfig.customTags:{}},destroy:function C(){this.clearLayer();this.zoomContorl&&this.zoomControl.destroy();this.zoomControl=this.initError=null;C.base.call(this)},getEnabledConfig:function(b){if(this.parentMap.enableZoomLevels){var c=
new a.layer.TileLayerConfig;c.bounds=b.bounds;c.srid=b.srid;c.tileImageFormat=b.tileImageFormat;c.isTransparentImage=b.isTransparentImage;c.tileImageWidth=b.tileImageWidth;c.tileImageHeight=b.tileImageHeight;c.customTags=b.customTags;c.zoomLevels=[];for(var R=[],X=0;X<this.parentMap.enableZoomLevels.length;X++)if(!(b.zoomLevels.length<=this.parentMap.enableZoomLevels[X]||0>this.parentMap.enableZoomLevels[X])){var N=b.zoomLevels[this.parentMap.enableZoomLevels[X]];N?(R.push(this.parentMap.enableZoomLevels[X]),
c.zoomLevels.push(N)):a.util.Logger.warning("MAPVIEWER_9039","OM.layer.Tilelayer.setEnabledZoomLevels","["+this.parentMap.enableZoomLevels[X]+"]")}this.parentMap.enableZoomLevels=R;return c}return b},getRealZoomLevel:function(a){return this.parentMap.enableZoomLevels?(a>=this.parentMap.enableZoomLevels.length&&(a=this.parentMap.enableZoomLevels.length),this.parentMap.enableZoomLevels[a]):a},exportToSVG:function(b){var c=parseInt(this.jqLayerDiv.css("left")),R=parseInt(this.jqLayerDiv.css("top")),
X=this.parentMap.graphics;X.setLeftTop(b,c,R);var N=this;N.loadImg=0;this.jqLayerDiv.find("img").each(function(){var r=this.src,n=a.$(this);c=parseInt(n.css("left"));R=parseInt(n.css("top"));N.loadImg++;X.drawImage({x:c,y:R},{src:r,width:256,height:256},{group:b}).handleEvent=function(a){this.resourceUpdate(a);N.loadImg--}});return b},drawTilesImages:function(a,b){var c=this.parentMap.getMapCenter(),c=this.serverURL+"?request\x3dgetmap\x26mapcache\x3d"+this.dataSource+"."+this.tileLayer+"\x26zoomlevel\x3d"+
this.parentMap.getMapZoomLevel()+"\x26cx\x3d"+c.getX()+"\x26cy\x3d"+c.getY()+"\x26width\x3d"+a+"\x26height\x3d"+b;this.loadingImg=!0;var X=this,N=new Image;N.onload=function(){X.loadingImg=!1;X.canvas.getContext("2d").drawImage(N,0,0,a,b)};N.onerror=function(){X.loadingImg=!1;X.canvas=null};N.src=c},clone:function G(a){a=G.base.call(this,a);a.displayed&&(a.jqLayerDiv=null,a.displayed=!1,a.zoomControl=null);return a},prepareDrag:function(){var a=this.jqLayerDiv[0];this.downLoc={l:a.offsetLeft,t:a.offsetTop}},
calcMeshCode:function(a,b,c){c=Math.ceil(Math.log(c)/Math.log(this.TILING_FACTOR));this.meshLength=Math.max(1,c);this.xFactors.length=this.meshLength;this.yFactors.length=this.meshLength;this.factors(a,this.xFactors);this.factors(b,this.yFactors)},factors:function(a,b){for(var c=0;c<this.meshLength;c++){var N=a/this.TILING_FACTOR;b[this.meshLength-1-c]=Math.floor(a%this.TILING_FACTOR);a=N}},getMeshStr:function(a){a="/"+a;for(var b=0;b<this.meshLength;b++)b<this.meshLength&&(a+="/"),a+=this.xFactors[b]+
"_"+this.yFactors[b];return a},tileImgLoadedHandler:function(b){if(b instanceof a.event.LayerEvent&&(b.type===a.event.LayerEvent.TILE_IMG_LOADED||b.type===a.event.LayerEvent.TILE_IMG_LOAD_ERROR)){b=this.requiredBinds+this.initRequiredBinds;0===b&&(b=1);this.tilesImgLoaded++;this.tilesPercent=this.tilesImgLoaded/b*100;if(this.tilesImgLoaded>=b)b=new a.event.LayerEvent(a.event.LayerEvent.ALL_TILES_LOADED,this),this.initRequiredBinds=this.requiredBinds=this.tilesImgLoaded=0,null!==this.initTask&&(this.initTask.complete(),
this.initTask=null);else if(b=new a.event.LayerEvent(a.event.LayerEvent.TILE_IMG_LOADING,this),null!==this.initTask){var c=this.getTilesPercentStatus();0<c?this.initTask.update(c/100):this.initTask.update(.25)}this.lastEvent=b.type}},getTilesPercentStatus:function(){return this.tilesPercent},setEnableUTFGridInfoWindow:function(a){this.enableUTFGridInfoWindow(a)},enableUTFGridInfoWindow:function(b){this.enableInfoWindow(b);this.parentMap&&a.notNull(this.isVisible())&&!0===this.isVisible()&&this.parentMap.updateUTFGridLayerCount()},
setInfoWindowTrigger:function(b){this.mouseETypeUTFGrid=b===a.event.MouseEvent.MOUSE_OVER||b===a.event.MouseEvent.MOUSE_MOVE?a.event.MouseEvent.MOUSE_MOVE:a.event.MouseEvent.MOUSE_CLICK;this.parentMap.validateUTFGridLayerTriggers();this.parentMap.updateUTFGridLayerListener()},setVisible:function R(a){R.base.call(this,a);this.parentMap&&(this.parentMap.changeOverView(),this.parentMap.updateUTFGridLayerCount())},getUTFGridResolution:function(b){var c;if(a.isNull(b))return this.UTFGRID_RESOLUTION;try{return c=
parseInt(b),a.isNull(c)||1>c?this.UTFGRID_RESOLUTION:c}catch(N){return this.UTFGRID_RESOLUTION}},setTileLayerConfig:function(a){this.tileLayerConfig=a},getTileLayerConfigFromWMTS:function(b,c){var N=this;a.util.HttpRequest.send(this.getCapabilitiesURL,"request\x3dwmts\x26service\x3dgetCapabilites",function(b){if(N.parentMap&&N.parentMap.graphics)if(b){b=a.wmts.WMTSContents.readFromDocument(b);b=a.wmts.WMTSUtil.optionsFromCapabilities(b,{layer:N.layerID,matrixSet:N.matrixSetID});b=N.buildConfig(b);
N.setTileLayerConfig(b);var n=new a.event.LayerEvent(a.event.LayerEvent.FINISH_GOT_CONFIG,N);n.config=b;n.mapContext=N.parentMap.getMapContext();N.initTask.update(.25);N.fire(a.event.LayerEvent.FINISH_GOT_CONFIG,n);c&&c(b)}else return N.parentMap&&N.parentMap.graphics&&(N.initError=!0,a.util.Logger.alert("MAPVIEWER_9001","OM.layer.Tilelayer.getTileLayerConfigFromWMTS","["+N.name+"]"),b=a.event,n=new b.LayerEvent(b.LayerEvent.INIT_ERROR,N),N.parentMap&&(n.mapContext=N.parentMap.getMapContext(),N.initTask.abort(),
N.initTask=null,N.fire(b.LayerEvent.INIT_ERROR,n))),null},"XML",function(b){if(N.parentMap&&N.parentMap.graphics){N.initError=!0;if(b&&b.responseText)try{var c=a.$(a.$.parseXML(b.responseText)).find("oms_error");0<c.length&&a.util.Logger.alert("MAPVIEWER_9009","OM.layer.Tilelayer.getTileLayerConfig",c.text())}catch(X){a.util.Logger.alert("MAPVIEWER_9009","OM.layer.Tilelayer.getTileLayerConfig",b.responseText)}else a.util.Logger.alert("MAPVIEWER_9009","OM.layer.Tilelayer.getTileLayerConfig","["+N.name+
"]");b=a.event;c=new b.LayerEvent(b.LayerEvent.INIT_ERROR,N);N.parentMap&&(c.mapContext=N.parentMap.getMapContext(),N.initTask.abort(),N.fire(b.LayerEvent.INIT_ERROR,c))}})}});a.layer.TileLayerConfig=function(a){this.tileImageHeight=this.tileImageWidth=256;this.tileImageFormat="PNG";this.enableUTFGrid=this.isInZXYOrder=this.isXYZStorageScheme=this.isTransparentImage=!1;this.utfgridResolution=4;a&&(this.srid=a.srid,this.zoomLevels=a.zoomLevels,this.bounds=a.bounds,a.tileImageWidth&&(this.tileImageWidth=
a.tileImageWidth),a.tileImageHeight&&(this.tileImageHeight=a.tileImageHeight),a.tileImageFormat&&(this.tileImageFormat=a.tileImageFormat),a.isTransparentImage&&(this.isTransparentImage=a.isTransparentImage),a.customTags&&(this.customTags=a.customTags),a.isXYZStorageScheme&&(this.isXYZStorageScheme=a.isXYZStorageScheme,a.isInZXYOrder&&(this.isInZXYOrder=a.isInZXYOrder)),a.enableUTFGrid&&(this.enableUTFGrid=!0,this.utfgridResolution=a.utfgridResolution))};a.layer.TileLayerConfig.prototype.equals=function(a){if(this.srid!=
a.srid||this.zoomLevels&&a.zoomLevels&&this.zoomLevels.length!=a.zoomLevels.length)return!1;for(var b=this.zoomLevels.length,c=0;c<b;c++)if(this.zoomLevels[c].resolution!=a.zoomLevels[c].resolution||this.zoomLevels[c].stretchRatio!=a.zoomLevels[c].stretchRatio)return!1;return!0};a.layer.TileLayerConfig.CONFIG_ELOCATION=new a.layer.TileLayerConfig;a.layer.TileLayerConfig.CONFIG_S_ELOCATION=new a.layer.TileLayerConfig;a.layer.TileLayerConfig.CONFIG_GOOGLE=new a.layer.TileLayerConfig;a.layer.TileLayerConfig.CONFIG_TOMTOM=
new a.layer.TileLayerConfig;a.layer.TileLayerConfig.CONFIG_LOCATIONBOX=new a.layer.TileLayerConfig;a.layer.TileLayerConfig.CONFIG_WGS84_WORLD=new a.layer.TileLayerConfig;a.layer.TileLayerConfig.CONFIG_OSM=new a.layer.TileLayerConfig;a.layer.TileLayerConfig.CONFIG_BAIDU=new a.layer.TileLayerConfig;a.layer.TileLayerConfig.setConstants=function(){var b=a.layer.TileLayerConfig,c=new a.universe.WorldMercatorUniverse;b.CONFIG_ELOCATION.zoomLevels=c.getZoomLevels();b.CONFIG_ELOCATION.srid=c.getSRID();b.CONFIG_ELOCATION.bounds=
c.getMapBounds();b.CONFIG_ELOCATION.tileImageFormat="PNG";b.CONFIG_ELOCATION.isTransparentImage=!1;c=new a.universe.WorldMercatorUniverse;b.CONFIG_S_ELOCATION.zoomLevels=c.getZoomLevels();b.CONFIG_S_ELOCATION.srid=c.getSRID();b.CONFIG_S_ELOCATION.bounds=c.getMapBounds();b.CONFIG_S_ELOCATION.tileImageFormat="PNG";b.CONFIG_S_ELOCATION.isTransparentImage=!1;c=new a.universe.WorldMercatorUniverse;b.CONFIG_GOOGLE.zoomLevels=c.getZoomLevels();b.CONFIG_GOOGLE.srid=c.getSRID();b.CONFIG_GOOGLE.bounds=c.getMapBounds();
c=new a.universe.BaiduUniverse;b.CONFIG_BAIDU.zoomLevels=c.getZoomLevels();b.CONFIG_BAIDU.srid=c.getSRID();b.CONFIG_BAIDU.bounds=c.getMapBounds();a.notNull(a.universe.TomTomUniverse)&&(c=new a.universe.TomTomUniverse,b.CONFIG_TOMTOM.zoomLevels=c.getZoomLevels(),b.CONFIG_TOMTOM.srid=c.getSRID(),b.CONFIG_TOMTOM.bounds=c.getMapBounds());a.notNull(a.universe.LocationBoxUniverse)&&(c=new a.universe.LocationBoxUniverse,b.CONFIG_LOCATIONBOX.zoomLevels=c.getZoomLevels(),b.CONFIG_LOCATIONBOX.srid=c.getSRID(),
b.CONFIG_LOCATIONBOX.bounds=c.getMapBounds());c=new a.universe.LatLonUniverse;b.CONFIG_WGS84_WORLD.zoomLevels=c.getZoomLevels();b.CONFIG_WGS84_WORLD.srid=c.getSRID();b.CONFIG_WGS84_WORLD.bounds=c.getMapBounds();c=new a.universe.OSMUniverse;b.CONFIG_OSM.zoomLevels=c.getZoomLevels();b.CONFIG_OSM.srid=c.getSRID();b.CONFIG_OSM.bounds=c.getMapBounds()};a.layer.TileLayerConfig.setConstants();a.layer.TileZoomAnimation=a.Class.extend({initialize:function(b){this.tdiff=this.ldiff=0;this.tileLayer=b;this.aniDiv=
this.tileArray=null;this.zooming=!1;this.timeouts=[];this.imageWidth=b.tileLayerConfig.tileImageWidth;this.imageHeight=b.tileLayerConfig.tileImageHeight;this.animate=!a.browser.msie||"transition"in document.documentElement.style?!0:!1},computeTilesOffset:function(){var b=this.tileLayer.jqLayerDiv;b&&(b=a.util.DomUtil.getElementPos(b),this.ldiff=-b.left,this.tdiff=-b.top)},getScreenXY:function(a,b,c){var r=this.tileLayer.tileLayerConfig.zoomLevels[c];c=1/r.resolution;var r=c/r.stretchRatio,n=this.newCenter;
return{x:(a-n.getX())*c,y:(n.getY()-b)*r}},copyTiles:function(a){if(this.aniDiv&&this.aniDiv.parent())return!1;this.oldLevel=a;this.aniDiv=this.tileLayer.jqLayerDiv;this.tileArray=this.tileLayer.tileArray;this.aniDiv.css("zIndex",this.tileLayer.zIndex+1);return!0},transformTiles:function(b,c){var N=this.getScreenXY(this.oldCenter.getX(),this.oldCenter.getY(),b),r=this.getScreenXY(this.newCenter.getX(),this.newCenter.getY(),b),n=this.tileLayer.tileLayerConfig,M=n.zoomLevels[b],Z=n.zoomLevels[c],ba=
n.bounds,n=this.getLeftTopTile(),Y=n.x*this.imageWidth*M.resolution+ba.getMinX(),sa=(n.y+1)*this.imageHeight*M.resolution*M.stretchRatio+ba.getMinY(),ba=this.getScreenXY(Y,sa,b),Y=this.getScreenXY(Y,sa,c),M=M.resolution/Z.resolution,N="translate3d("+(-1*(r.x-N.x+ba.x-Y.x)-n.l*(M-1))+"px,"+(-1*(r.y-N.y+ba.y-Y.y)-n.t*(M-1))+"px, 0px) scale("+M+")",la=this;a.browser.webkit3d?(this.aniDiv.css("-webkit-transition","-webkit-transform 0.25s cubic-bezier(0,0,0.5,1)"),this.aniDiv.bind("webkitTransitionEnd",
function(){la.zooming=!1}),this.aniDiv.css("-webkit-transform",N)):(this.aniDiv.css("transition","transform 0.25s cubic-bezier(0,0,0.5,1)"),this.aniDiv.bind("transitionend",function(){la.zooming=!1}),this.aniDiv.css("transform",N));this.zooming=!0},getLeftTopTile:function(){var a=this.tileArray,a=a[0][0].node[0].src!==this.tileLayer.transImgURL?a[0][0].node:a[1][0].node[0].src!==this.tileLayer.transImgURL?a[1][0].node:a[0][1].node[0].src!==this.tileLayer.transImgURL?a[0][1].node:a[1][1].node,b=a.position();
return{x:a[0].mx,y:a[0].my,l:b.left,t:b.top}},showTiles:function(b,c,N,r){if(!this.tileLayer.isVisible()||a.isNull(this.tileLayer.tileArray)||this.tileLayer.tileLayerConfig.isTransparentImage)this.reset();else{var n=new a.util.Task(this.tileLayer.parentMap.progressService);n.start();this.newCenter=r;this.oldCenter=N;this.animate?(n.update(.2),this.computeTilesOffset(),n.update(.35),this.copyTiles(b),n.update(.5),this.transformTiles(this.oldLevel,c),this.tileLayer.init(),this.tileLayer.jqLayerDiv.css("visibility",
"hidden")):(this.tileLayer.jqLayerDiv.css("visibility","hidden"),this.tileLayer.init());n.update(.7);n.complete()}},reset:function(){this.tdiff=this.ldiff=0;this.aniDiv&&this.aniDiv.parent()&&this.aniDiv.remove();this.aniDiv=this.tileArray=null;this.zooming=!1;for(var a=0;a<this.timeouts.length;a++)clearTimeout(this.timeouts[a]);this.timeouts=[];this.tileLayer.isVisible()&&this.tileLayer.init()},tileInitialized:function(){if(this.tileLayer&&this.tileLayer.parentMap)if(!this.hasTilesLoadFinished()&&
!this.tileLayer.isLocalTileLayer||this.zooming){var b=this,c=setTimeout(function(){b.tileInitialized()},70);this.timeouts.push(c)}else{this.aniDiv&&this.startClear();this.tileLayer.jqLayerDiv&&this.tileLayer.jqLayerDiv.css("visibility",this.tileLayer.visible?"visible":"hidden");var c=a.event,N=new c.LayerEvent(c.LayerEvent.FINISH_LOAD,this.tileLayer);N.mapContext=this.tileLayer.parentMap.getMapContext();this.tileLayer.fire(c.LayerEvent.FINISH_LOAD,N)}},hasTilesLoadFinished:function(){if(!this.tileArray&&
!this.tileLayer.tileArray)return!0;if(!this.tileLayer.isLocalTileLayer)for(var a=0;a<this.tileLayer.tileArray.length;a++)for(var b=0;b<this.tileLayer.tileArray[a].length;b++)if(!this.hasTileLoaded(this.tileLayer.tileArray[a][b].node))return!1;return!0},hasTileLoaded:function(b){return b[0].src===a.util.MiscUtil.transparentImgURL?!0:a.browser.msie?b.imgLoadFinished:1>=Math.abs(b[0].offsetWidth-this.imageWidth)},startClear:function(){if(a.browser.msie)for(var b=0;b<this.tileLayer.tileArray.length;b++)for(var c=
0;c<this.tileLayer.tileArray[b].length;c++)this.tileLayer.tileArray[b][c].node.css("display","");this.aniDiv&&this.aniDiv.css("zIndex",this.tileLayer.zIndex);this.clearCloneTiles()},clearCloneTiles:function(){if(this.tileLayer&&this.tileLayer.parentMap)if(this.hasTilesLoadFinished()){var b;for(b=0;b<this.tileLayer.tileArray.length;b++)for(var c=0;c<this.tileLayer.tileArray[b].length;c++)this.tileLayer.tileArray[b][c].node.css("display","");this.removeCloneTiles();for(b=0;b<this.timeouts.length;b++)clearTimeout(this.timeouts[b]);
this.timeouts=[];b=a.event;c=new b.LayerEvent(b.LayerEvent.FINISH_LOAD,this.tileLayer);c.mapContext=this.tileLayer.parentMap.getMapContext();this.tileLayer.fire(b.LayerEvent.FINISH_LOAD,c)}else{var N=this;b=setTimeout(function(){N.clearCloneTiles()},70);this.timeouts.push(b)}},removeCloneTiles:function(){this.aniDiv&&this.aniDiv.parent()&&(this.aniDiv.remove(),this.aniDiv=null);this.zooming=!1},scaleTiles:function(b){if(this.scaling||this.tileLayer.isVisible()&&!a.isNull(this.tileLayer.tileArray)){var c,
N,r;if(!this.scaling)for(this.computeTilesOffset(),this.copyTiles(),this.scaling=!0,c=0;c<this.tileArray.length;c++)for(N=0;N<this.tileArray[c].length;N++){r=this.tileArray[c][N].node;var n=a.util.DomUtil.getElementPos(a.$(r));r.origLeft=n.left;r.origTop=n.top}c=this.tileLayer.tileLayerConfig;var n=c.tileImageWidth*b,M=c.tileImageWidth*b;c=this.tileLayer.parentMap.getMapContext();var Z=c.getDeviceWidth()/2+this.ldiff,ba=c.getDeviceHeight()/2+this.tdiff;for(c=0;c<this.tileArray.length;c++)for(N=0;N<
this.tileArray[c].length;N++)r=this.tileArray[c][N].node,this.scaleTile(r,b,n,M,Z,ba)}else this.reset()},scaleTile:function(b,c,N,r,n,M){b.zoomFinished=!0;1!=c&&(n-=(n-b.origLeft)*c,c=M-(M-b.origTop)*c,a.$(b).css({left:n,top:c,width:N+1,height:r+1}))},endScaling:function(){this.scaling=!1;var b=this.tileLayer.jqLayerDiv;if(b){var c=a.util.DomUtil.getElementPos(b),N=c.left,c=c.top,r=a.util.DomUtil.getElementPos(b.parent().parent());b.css({left:N+r.left,top:c+r.Top})}this.startClear()},destroy:function(){this.tileLayer=
null}});a.layer.Mesh=function(a,b,c,r){var n=a.zoomLevels[r];this.mw=a.tileImageWidth*n.resolution;this.mh=a.tileImageHeight*n.resolution*n.stretchRatio;a=a.bounds;this.mX=Math.floor((b-a.getMinX())/this.mw);this.mY=Math.floor((c-a.getMinY())/this.mh);this.zoom=r;this.minX=this.mX*this.mw+a.getMinX();this.minY=this.mY*this.mh+a.getMinY()};a.layer.Mesh.prototype.moveMeshCode=function(a,b){this.mX+=a;this.mY+=b};a.layer.VectorLayer=a.layer.Layer.extend({initialize:function X(b,c){if(a.isNull(c)||a.isNull(c.def)||
a.isNull(c.def.type))throw Error("Invalid or null VectorLayer options found.");this.displayFeaturesTask=this.initTask=this.boundingDataTask=null;this.editingMenuContextEnabled=this.displayFeaturesTaskEnabled=!0;var n=c.def;this.options=c;X.base.call(this,b);this.options&&this.options.renderingStyle&&(this.opacity=a.notNull(this.options.renderingStyle.opacity)?this.options.renderingStyle.opacity:this.opacity);this.useRTree=a.notNull(c&&c.useRTree)?c.useRTree:a.gv.useRTree;this.layerType=a.LayerTypes.VECTOR;
this.initError=this.dataLoaded=this.cachingEnabled=!1;this.name=b;var M=a.layer.VectorLayer;this.type=n.type;a.isNull(n.xRatio)||!a.util.ValidationUtil.isNumber(n.xRatio)||1>n.xRatio?this.xRatio=2:this.xRatio=n.xRatio;a.isNull(n.yRatio)||!a.util.ValidationUtil.isNumber(n.yRatio)||1>n.yRatio?this.yRatio=2:this.yRatio=n.yRatio;this.searchBuffer=a.browser.touchSupported?10:5;this.enableXHR=n&&n.enableXHR?!0:!1;this.selectArray=[];this.jsonp=!1;"undefined"!==typeof n.jsonp&&(this.jsonp=n.jsonp);this.flag=
!0;this.bfMbr=this.mbr=null;var Z=n.dataSource||n.datasource;if(this.type===M.TYPE_PREDEFINED)this.dataSource=Z,this.themeName=n.theme,n.url&&(this.serverURL=n.url),a.isNull(n.loadOnDemand)?this.loadOnDemand=!0:this.loadOnDemand=n.loadOnDemand,this.workspace=n.workspace,this.featureArray=[];else if(this.type===M.TYPE_LOCAL)for(this.featureArray=[],M=n.features?n.features.length:0,Z=0;Z<M;Z++){var ba=n.features[Z];this.isValidId(ba.id)?this.featureArray.push(ba):a.util.Logger.warning("MAPVIEWER_9005",
"OM.layer.VectorLayer")}else this.type===M.TYPE_JDBC?(this.dataSource=Z,this.sql=n.sql,this.serverURL=n.url,this.featureArray=[],this.geometryColumn=n.geometryColumn,this.labelColumn=n.labelColumn?n.labelColumn.toUpperCase():null,this.keyColumn=n.keyColumn?n.keyColumn.toUpperCase():null,this.baseTable=n.baseTable?n.baseTable.toUpperCase():null,a.isNull(n.loadOnDemand)?this.loadOnDemand=!0:this.loadOnDemand=n.loadOnDemand,this.workspace=n.workspace,this.jdbcSrid=a.notNull(n.jdbcSrid)?n.jdbcSrid:8307):
this.type===M.TYPE_DATAPACK?(this.serverURL=(M=n.dataPackUrl||n.url)?M:"invalid url",this.featureArray=[],this.geometryColumn=n.geometryColumn,this.labelColumn=n.labelColumn?n.labelColumn.toUpperCase():null):this.type===M.TYPE_GEORSS&&(this.serverURL=n.url);c.renderingStyle&&c.renderingStyle.effects&&0<c.renderingStyle.effects.length&&(this.visualFilter=c.renderingStyle.effects[0]);if(this.renderingStyle=c.renderingStyle)this.renderingStyle=c.renderingStyle;this.styleAttributes=c.styleAttributes;
this.boundingTheme=c.boundingTheme;this.enableInfoWindow(a.isNull(c.infoWindow)?!0:c.infoWindow);this.boundingZoomLevel=null;this.selectionEnable=!1;this.selectionMode=a.layer.VectorLayer.SINGLE_SELECTION;this.keepSelected=!1;this.bringToTopFlag=!0;this.selectedFeatures=[];this.featureEditable=!1;this.hoverStyle=this.hoverFeature=null;this.mapping=this.hoverEnable=!1;this.showToolTip=!0;this.mouseCursor=a.CursorTypes.POINTER;this.areaIdx=this.loadingStyle=0;this.attributeTypes=this.undoManager=this.changeManager=
null;this.notNullAttributes=[];this.rtree=null;this.segmentRtree={};this.sharedBoundary=!1;this.selectionChecker=null;this.pointerSensitivity=!0;this.tileFeatureGroup={}},setRenderingStyle:function(b,c){if(b)if(this.parentMap&&this.isServerSideStyle(b,"rendering"))c&&(this.styleAttributes=c);else{var r=this.renderingStyle,n=this.styleAttributes;this.renderingStyle=b;this.heatMap=null;c&&(this.styleAttributes=c,b instanceof a.style.BucketStyle&&!b.isServerSide&&(this.loadOnDemand?b.generateBuckets(this.featureArray,
this.styleAttributes,!0):b.generateBuckets(this.featureArray,this.styleAttributes,!1)));b.effects&&0<b.effects.length&&this.setVisualFilter(b.effects[0]);!this.visible&&this.displayed&&(this.parentMap.graphics.remove(this.realGroup),this.clearFeatureShapes(),this.displayed=!1);this.displayed&&(this.parentMap.graphics.remove(this.realGroup),this.clearFeatureShapes(),this.displayFeatures(!1),"POINT"!=this.getFeatureGeometryType()&&"PieChart"!=this.renderingStyle.styleType&&"BarChart"!=this.renderingStyle.styleType||
this.parentMap.refreshVectorLayerLabels());r==b&&a.util.MiscUtil.arraysAreEqual(n,this.styleAttributes)||(r=new a.event.LayerEvent(a.event.LayerEvent.RENDERING_STYLE_CHANGED,this),r.newStyle=b,r.attributes=c,this.parentMap&&(r.mapContext=this.parentMap.getMapContext()),this.fire(a.event.LayerEvent.RENDERING_STYLE_CHANGED,r))}},getAllFeatures:function(){return this.featureArray},size:function(){return this.featureArray?this.featureArray.length:0},getRenderingStyle:function(){return this.renderingStyle},
setLabelingStyle:function(b){if(b&&(!this.parentMap||!this.isServerSideStyle(b,"label"))){this.labelingStyle=b;this.setLabelsVisible(!0);if(this.displayed){for(var c=this.featureArray?this.featureArray.length:0,r=0;r<c;r++)this.featureArray[r].setLabelingStyle(this.labelingStyle);this.parentMap.refreshVectorLayerLabels()}c=a.event.LayerEvent;r=new c(c.LABELING_STYLE_CHANGED,this);r.style=b;this.parentMap&&(r.mapContext=this.parentMap.getMapContext());this.fire(c.LABELING_STYLE_CHANGED,r)}},getLabelingStyle:function(){return this.labelingStyle},
setLabelColumn:function(a){this.labelColumn=a},getLabelColumn:function(){return this.labelColumn},getSelectedFeatures:function(){return this.selectedFeatures},setSelectStyle:function(b){if(b&&(!this.parentMap||!this.isServerSideStyle(b,"select"))){this.enableFeatureSelection(!0);this.selectionStyle=b;b.effects&&0<b.effects.length&&this.setSelectVisualFilter(b.effects[0]);var c=a.event.LayerEvent,r=new c(c.SELECTION_STYLE_CHANGED,this);r.style=b;this.parentMap&&(r.mapContext=this.parentMap.getMapContext());
this.fire(c.SELECTION_STYLE_CHANGED,r)}},getSelectStyle:function(){return this.selectionStyle},setHoverStyle:function(b){if(b&&(!this.parentMap||!this.isServerSideStyle(b,"hover"))){this.enableFeatureHover(!0);b.effects&&0<b.effects.length&&this.setHoverVisualFilter(b.effects[0]);this.hoverStyle=b;var c=a.event.LayerEvent,r=new c(c.SELECTION_STYLE_CHANGED,this);r.style=b;this.parentMap&&(r.mapContext=this.parentMap.getMapContext());this.fire(c.HOVER_STYLE_CHANGED,r)}},getHoverStyle:function(){return this.hoverStyle},
setHoverVisualFilter:function(a){this.hoverFilter=a},clearSelectedFeatures:function(){for(var a=this.selectedFeatures?this.selectedFeatures.length:0;0<a;a--){var b=this.selectedFeatures.pop();b.enableFeatureEditing(!1);this.resetFeatureStates(b)}},resetFeatureStates:function(a){a.selected=!1;a.hover=!1;a.selectShape&&(a.graphics.remove(a.selectShape),a.selectShape=null);a.hoverShape&&(a.graphics.remove(a.hoverShape),a.hoverShape=null);a.setRenderingStyle(a.oldStyle);var b=this.parentMap.graphics;
a.shape&&(this.graphicFilter&&!this.visualFilter.applyToLayer?b.applyStyle(a.shape,{filter:this.graphicFilter}):b.applyStyle(a.shape,{filter:b.oui.filters.NONE}))},setSelectionChecker:function(a){"function"===typeof a&&(this.selectionChecker=a)},getSelectionChecker:function(){return this.selectionChecker},setPointerSensitivity:function(a){this.pointerSensitivity=a;this.realGroup&&this.realGroup.applyStyle({pointerSensitivity:a})},getPointerSensitivy:function(){return this.pointerSensitivity},selectFeature:function(b){if(!b||
!b.draggable)if(!this.selectionEnable||!this.selectionStyle&&!this.featureEditable)return;var c;if(!a.notNull(this.selectionChecker)||this.selectionChecker.call(this,b)){if(b.parentFeature)return b=b.parentFeature,b.parentLayer.selectFeature(b),b;if(!b.selected&&b.displayed){this.selectionMode===a.layer.VectorLayer.SINGLE_SELECTION&&this.clearSelectedFeatures();b.hoverShape&&(b.graphics.remove(b.hoverShape),b.hoverShape=null);this.selectionStyle&&(b.oldStyle||(b.oldStyle=b.renderingStyle?b.renderingStyle:
this.getDefaultRenderingStyle(b.geo.type)),"PulseAnimation"==this.selectionStyle.styleType||"AnimationColor"==this.selectionStyle.styleType?(c=b.shape,b.displayFeature([this.selectionStyle]),b.selectShape=b.shape,b.shape=c):(c=this.getHoverSelectStyle(this.selectionStyle,b),b.setRenderingStyle(c)));if(b.displayed&&b.shape){c=this.parentMap.graphics;if(this.selectVisualFilter){var r=c.getGraphicFilter(this.selectVisualFilter);c.applyStyle(b.shape,{filter:r})}else c.applyStyle(b.shape,{filter:c.oui.filters.NONE});
b.startAnimation()}this.featureEditable&&b.enableFeatureEditing(!0);b.draggable&&b.enableFeatureDragging(!0);this.selectedFeatures.push(b);b.selected=!0;this.bringToTopFlag&&(b.getShapeIndex(),b.bringToTop());c=a.event.LayerEvent;r=new c(c.FEATURE_SELECTED,this);r.selectedFeature=b;r.mapContext=this.parentMap.getMapContext();this.fire(c.FEATURE_SELECTED,r)}else this.keepSelected||this.deselectFeature(b);return b}},hover:function(a){if(!this.hoverEnable||a.hover||a.selected)return null;this.deHover(this.hoverFeature);
a.oldStyle||(a.oldStyle=a.renderingStyle?a.renderingStyle:this.getDefaultRenderingStyle(a.geo.type));if(this.hoverStyle)if("PulseAnimation"===this.hoverStyle.styleType||"AnimationColor"===this.hoverStyle.styleType){var b=a.shape;a.displayFeature([this.hoverStyle]);a.hoverShape=a.shape;a.shape=b}else b=this.getHoverSelectStyle(this.hoverStyle,a),a.setRenderingStyle(b);a.displayed&&a.shape&&(this.hoverFilter?(b=this.parentMap.graphics.getGraphicFilter(this.hoverFilter),this.parentMap.graphics.applyStyle(a.shape,
{filter:b})):this.parentMap.graphics.applyStyle(a.shape,{filter:this.parentMap.graphics.oui.filters.NONE}),a.startAnimation());this.hoverFeature=a;a.hover=!0;return a},deHover:function(a){if(a&&a.hover){var b=a.selected;a.editable||(a.hoverShape?(a.graphics.remove(a.hoverShape),a.hoverShape=null):b||(a.setRenderingStyle(a.oldStyle),this.bringSelectedFeaturesToTop(),a.displayed&&a.shape&&(b=this.parentMap.graphics,this.graphicFilter&&!this.visualFilter.applyToLayer?b.applyStyle(a.shape,{filter:this.graphicFilter}):
b.applyStyle(a.shape,{filter:b.oui.filters.NONE}))),this.hoverFeature&&(this.hoverFeature.hover=!1,this.hoverFeature=null))}},bringSelectedFeaturesToTop:function(){var b=this.getSelectedFeatures();if(a.notNull(b))for(var c=0;c<b.length;c++){var r=b[c];if(a.isNull(r.parentLayer)){a.util.Logger.warning(null,"VectorLayer.bringSelectedFeaturesToTop","Feature has no parent layer, possibly because feature ID is no longer valid: "+r.id);break}this.bringFeatureToTop(r)}},deselectFeature:function(b){var c;
if(b.selected){b.enableFeatureEditing(!1);b.selectShape&&(b.graphics.remove(b.selectShape),b.selectShape=null);b.hover?(this.hoverStyle&&("PulseAnimation"===this.hoverStyle.styleType||"AnimationColor"===this.hoverStyle.styleType?(c=b.shape,b.displayFeature([this.hoverStyle]),b.hoverShape=b.shape,b.shape=c):(c=this.getHoverSelectStyle(this.hoverStyle,b),b.setRenderingStyle(c))),b.displayed&&b.shape&&(c=this.parentMap.graphics,this.hoverFilter?c.applyStyle(b.shape,{filter:this.hoverGraphicFilter}):
c.applyStyle(b.shape,{filter:c.oui.filters.NONE}),b.startAnimation())):(b.oldStyle&&b.setRenderingStyle(b.oldStyle),b.displayed&&b.shape&&(c=this.parentMap.graphics,this.graphicFilter&&!this.visualFilter.applyToLayer?c.applyStyle(b.shape,{filter:this.graphicFilter}):c.applyStyle(b.shape,{filter:c.oui.filters.NONE})));b.selected=!1;this.bringSelectedFeaturesToTop();c=this.selectedFeatures?this.selectedFeatures.length:0;for(var r=0;r<c;r++)if(this.selectedFeatures[r]===b){this.selectedFeatures.splice(r,
1);break}c=a.event.LayerEvent;r=new c(c.FEATURE_DESELECTED,this);r.deselectedFeature=b;r.mapContext=this.parentMap.getMapContext();this.fire(c.FEATURE_DESELECTED,r)}return b},enableFeatureSelection:function(b,c){if(this.selectionEnable=b)this.selectionMode=c==a.layer.VectorLayer.MULTIPLE_SELECTION||c==a.layer.VectorLayer.SINGLE_SELECTION?c:a.layer.VectorLayer.SINGLE_SELECTION},getSelectionMode:function(){return this.selectionMode},setKeepSelected:function(a){this.keepSelected=a},enableFeatureHover:function(a){this.hoverEnable=
a},enableFeatureEditing:function(b){if(this.featureEditable===b)return!0;var c=a.layer.VectorLayer;if(b){if(this.parentMap&&this.parentMap.wraparound)return a.util.Logger.warning("MAPVIEWER_9105","OM.layer.VectorLayer.enableFeatureEditing"),!1;if(this.type===c.TYPE_JDBC||this.type===c.TYPE_PREDEFINED){if(a.isNull(this.keyColumn)||a.isNull(this.baseTable)||a.isNull(this.geometryColumn))return a.util.Logger.alert("MAPVIEWER_9052","OM.layer.VectorLayer.enableFeatureEditing",""),!1;if("ROWID"===this.keyColumn.toUpperCase())return a.util.Logger.alert("MAPVIEWER_9053",
"OM.layer.VectorLayer.enableFeatureEditing",""),!1}}if(this.featureEditable=b)return this.selectionEnable=!0,this.changeManager=new a.edit.EditChangeManager({layer:this}),this.undoManager=new a.UndoManager,this.createRtree(),this.enableInfoWindow(!1),!0;if(this.selectedFeatures)for(b=this.selectedFeatures.length,c=0;c<b;c++)this.selectedFeatures[c].enableFeatureEditing(!1);this.undoManager=this.changeManager=null;!1===this.useRTree&&(this.rtree=null);this.segmentRtree={};this.enableInfoWindow(!0);
return!0},getUndoManager:function(){return this.undoManager},isFeatureEditable:function(){return this.featureEditable},saveEditing:function(b){if(a.notNull(this.changeManager)&&this.changeManager.hasChanges){var c=a.layer.VectorLayer;if(this.type===c.TYPE_PREDEFINED||this.type===c.TYPE_JDBC){var c=this.serverURL+"/dataserver/"+this.dataSource,r={},n=a.util.HttpRequest.getDomain(this.serverURL);n||(n=a.util.HttpRequest.localDomain);if(n=a.gv.mvKeyMap[n])r.key=n;this.sessionId&&(r.ssid=this.sessionId);
var n='\x3c?xml version\x3d"1.0" standalone\x3d"yes"?\x3e\n\x3cedit_request\x3e\n\t\x3csave_session_layer',n=n+(' data_source\x3d"'+this.dataSource+'"'),n=n+' editor\x3d"dummy"\x3e\n',n=n+"\t\t\x3clayer ",n=n+('base_table\x3d"'+this.baseTable+'" '),n=n+('key_column\x3d"'+this.keyColumn+'" '),n=n+('spatial_column\x3d"'+this.geometryColumn+'" '),M="geometry";a.notNull(this.spatialType)&&(M=this.spatialType);n+='spatial_type\x3d"'+this.spatialType+'" ';this.workspace&&"LIVE"!==this.workspace.toUpperCase()&&
(n+='workspace\x3d"'+this.workspace+'"');var n=n+"\x3e\n",n=n+"\t\t\t\x3cinsert_features\x3e\n",Z=this.changeManager.getNewFeatures(),ba="string";if(a.notNull(Z)&&0<Z.length)for(var Y=0;Y<Z.length;Y++){var sa=Z[Y];if(!a.isNull(sa)){n+='\t\t\t\t\x3cfeature key\x3d"'+sa.id+'"\x3e\n';ba="string";a.notNull(this.attributeTypes[this.keyColumn])&&(ba=this.attributeTypes[this.keyColumn]);n+='\t\t\t\t\t\x3cattribute name\x3d"'+this.keyColumn+'" type\x3d"'+ba+'"\x3e\n';n+="\t\t\t\t\t\t\x3cvalue\x3e"+sa.id+
"\x3c/value\x3e\n";n+="\t\t\t\t\t\x3c/attribute\x3e\n";if(a.notNull(this.attrNames))for(var la=0;la<this.attrNames.length;la++)if(this.attrNames[la]!==this.keyColumn){var oa=sa.getAttributeValue(this.attrNames[la]);if(a.notNull(oa)){ba="string";a.notNull(this.attributeTypes[this.attrNames[la]])&&(ba=this.attributeTypes[this.attrNames[la]]);var wa=this.attrNames[la],ma=sa.getRealColumnName(wa);a.notNull(ma)&&(wa=ma);n+='\t\t\t\t\t\x3cattribute name\x3d"'+wa+'" type\x3d"'+ba+'"\x3e\n';n+="\t\t\t\t\t\t\x3cvalue\x3e"+
oa+"\x3c/value\x3e\n";n+="\t\t\t\t\t\x3c/attribute\x3e\n"}}n+='\t\t\t\t\t\x3cattribute name\x3d"'+this.geometryColumn+'" type\x3d"'+M.toLowerCase()+'"\x3e\n';n+="\t\t\t\t\t\t\x3cvalue\x3e"+sa.geo.toGML()+"\x3c/value\x3e\n";n+="\t\t\t\t\t\x3c/attribute\x3e\n";n+="\t\t\t\t\x3c/feature\x3e\n"}}n+="\t\t\t\x3c/insert_features\x3e\n";n+="\t\t\t\x3cupdate_features\x3e\n";Z=this.changeManager.getModifiedFeatures();if(a.notNull(Z)&&0<Z.length)for(Y=0;Y<Z.length;Y++)if(sa=Z[Y],!a.isNull(sa)){n+='\t\t\t\t\x3cfeature key\x3d"'+
sa.id+'"\x3e\n';ba="string";a.notNull(this.attributeTypes[this.keyColumn])&&(ba=this.attributeTypes[this.keyColumn]);n+='\t\t\t\t\t\x3cattribute name\x3d"'+this.keyColumn+'" type\x3d"'+ba+'"\x3e\n';n+="\t\t\t\t\t\t\x3cvalue\x3e"+sa.id+"\x3c/value\x3e\n";n+="\t\t\t\t\t\x3c/attribute\x3e\n";la=this.changeManager.getChangedAttributesOfModifiedFeature(sa.id);if(a.notNull(la))for(oa=0;oa<la.length;oa++)if(la[oa]!==this.keyColumn&&(wa=sa.getAttributeValue(la[oa]),a.notNull(wa))){ba="string";a.notNull(this.attributeTypes[la[oa]])&&
(ba=this.attributeTypes[la[oa]]);var ma=la[oa],fa=sa.getRealColumnName(ma);a.notNull(fa)&&(ma=fa);n+='\t\t\t\t\t\x3cattribute name\x3d"'+ma+'" type\x3d"'+ba+'"\x3e\n';n+="\t\t\t\t\t\t\x3cvalue\x3e"+wa+"\x3c/value\x3e\n";n+="\t\t\t\t\t\x3c/attribute\x3e\n"}this.changeManager.hasSpatialAttributeChanged(sa.id)&&(n+='\t\t\t\t\t\x3cattribute name\x3d"'+this.geometryColumn+'" type\x3d"'+M+'"\x3e\n',n+="\t\t\t\t\t\t\x3cvalue\x3e"+sa.geo.toGML()+"\x3c/value\x3e\n",n+="\t\t\t\t\t\x3c/attribute\x3e\n");n+=
"\t\t\t\t\x3c/feature\x3e\n"}n+="\t\t\t\x3c/update_features\x3e\n";n+="\t\t\t\x3cdelete_features\x3e\n";M=this.changeManager.getRemovedFeatures();if(a.notNull(M)&&0<M.length)for(ba=0;ba<M.length;ba++)Z=M[ba],a.isNull(Z)||(n+='\t\t\t\t\x3cfeature key\x3d"'+Z.id+'"/\x3e\n');n+="\t\t\t\x3c/delete_features\x3e\n";n+="\t\t\x3c/layer\x3e\n";n+="\t\x3c/save_session_layer\x3e\n";n+="\x3c/edit_request\x3e\n";r.xml_request=n;var w=this;r.refresh=Math.round(1E5*Math.random());a.notNull(this.saveDataRequest)&&
this.saveDataRequest.abort();this.saveDataRequest=this.sendHttpRequest(c,r,function(c){c=c.documentElement.getElementsByTagName("save_session_layer");var N=!1;if(a.notNull(c)){var L=c[0].attributes.getNamedItem("data_source").value,r=c[0].attributes.getNamedItem("layer").value,N=c[0].attributes.getNamedItem("success").value;"true"===N?(w.changeManager.clearChanges(),w.undoManager=new a.UndoManager,a.util.Logger.info("MAPVIEWER_9058","OM.layer.VectorLayer.saveEditing","["+L+","+r+","+N+"]")):a.util.Logger.warning("MAPVIEWER_9057",
"OM.layer.VectorLayer.saveEditing","["+L+","+r+","+N+","+c[0].childNodes[1].childNodes[1].textContent+"]")}else a.util.Logger.warning("MAPVIEWER_9057","OM.layer.VectorLayer.saveEditing","Unexpected response.");w.saveDataRequest=null;a.notNull(b)&&b(N)},"xml",function(b){w.saveDataRequest=null;b&&a.util.Logger.alert("MAPVIEWER_9057","OM.layer.VectorLayer.saveEditing",b.responseText)},!1)}else a.util.Logger.warning("MAPVIEWER_9056","OM.layer.VectorLayer.saveEditing",""),a.notNull(b)&&b(!1)}else a.notNull(b)&&
b(!1)},setBoundingTheme:function(a){this.boundingTheme=a},zoomToTheme:function(){var a=this;this.parentMap&&this.parentMap.initialized?(this.bfMbr=this.mbr=null,this.loadBoundingTheme(function(b,c,n,M){(b=a.calculateCenterAndZoomLevel(b,c,n,M))&&1<b.length&&a.parentMap.setMapCenterAndZoomLevel(b[1],b[0])})):setTimeout(function(){a.zoomToTheme()},300)},centerToTheme:function(){var a=this;this.parentMap&&this.parentMap.initialized?this.loadBoundingTheme(function(b,c,n,M){(b=a.calculateCenterAndZoomLevel(b,
c,n,M))&&1<b.length&&a.parentMap.setMapCenter(b[1])}):setTimeout(function(){a.centerToTheme()},300)},setBringToTopOnMouseOver:function(a){this.bringToTopFlag=a},getFeatureGeometryType:function(){if(this.type!=a.layer.VectorLayer.TYPE_LOCAL&&this.featureArray&&0<this.featureArray.length){var b=this.featureArray[0].geo;if("Point"==b.type||"OrientedPoint"==b.type||"MultiPoint"==b.type||"OrientedMultiPoint"==b.type)return"POINT";if("LineString"==b.type||"MultiLineString"==b.type)return"LINESTRING";if("Polygon"==
b.type||"MultiPolygon"==b.type)return"POLYGON"}return""},setSelectVisualFilter:function(a){this.selectVisualFilter=a},setVisualFilter:function(b){this.visualFilter=b;if(this.displayed&&this.visualFilter)if(this.graphicFilter=this.parentMap.graphics.getGraphicFilter(this.visualFilter),this.visualFilter.applyToLayer)this.parentMap.graphics.applyStyle(this.realGroup,{filter:this.graphicFilter});else{b=this.featureArray?this.featureArray.length:0;for(var c=0;c<b;c++){var r=this.featureArray[c];r.shape&&
this.parentMap.graphics.applyStyle(r.shape,{filter:this.graphicFilter})}}else this.displayed&&a.isNull(this.visualFilter)&&(this.graphicFilter=null,this.parentMap.graphics.applyStyle(this.realGroup,{filter:this.parentMap.graphics.oui.filters.NONE}))},getSelectVisualFilter:function(){return this.selectVisualFilter},getVisualFilter:function(){return this.visualFilter},setLabelsVisible:function(a){this.showLabels=a},labelsVisible:function(){return this.showLabels},getExtent:function(){if(!this.mbr){var b=
this.featureArray?this.featureArray.length:0,c={minX:null,minY:null,maxX:null,maxY:null},r={minX:null,minY:null,maxX:null,maxY:null},n=a.geometry.Geometry.calculateMBR,M=this.renderingStyle,Z=a.notNull(M)&&a.notNull(M.hasBinding)&&M.hasBinding(),ba=a.notNull(this.nsdpData)&&a.notNull(this.nsdpKey),Y=function(a,b){var c,r,N,w;a.getMBR?(w=a.getMBR(),c=w.getMinX(),N=w.getMinY(),r=w.getMaxX(),w=w.getMaxY()):(w=n(a.coordinates,a.type,a.dimension),c=w.minX,N=w.minY,r=w.maxX,w=w.maxY);if(null===b.minX||
c<b.minX)b.minX=c;if(null===b.minY||N<b.minY)b.minY=N;if(null===b.maxX||r>b.maxX)b.maxX=r;if(null===b.maxY||w>b.maxY)b.maxY=w},sa=this.parentMap.getMapContext().getUniverse().getSRID(),la=!1,oa=!1,wa=function(a){Y(a,c);(la||oa)&&Y(a,r)},ma,fa,w=a.util.BaiduUtil.SRID;for(ma=0;ma<b;ma++)fa=this.featureArray[ma],la=Z&&M.isFeatureBound(fa),oa=ba?a.notNull(this.getNsdpDataForFeature(fa)):!1,fa=fa.getGeometry(),sa!==fa.srid?sa!==w?fa.transform(sa,wa):fa.transform(sa,wa,null,null,{map:this.parentMap,inputIsBD09LonLat:!0}):
(Y(fa,c),(la||oa)&&Y(fa,r));a.notNull(c.minX)&&a.notNull(c.minY)&&a.notNull(c.maxX)&&a.notNull(c.maxY)?this.mbr=new a.geometry.Rectangle(c.minX,c.minY,c.maxX,c.maxY,sa):this.mbr=null;Z||ba?a.notNull(r.minX)&&a.notNull(r.minY)&&a.notNull(r.maxX)&&a.notNull(r.maxY)?this.bfMbr=new a.geometry.Rectangle(r.minX,r.minY,r.maxX,r.maxY,sa):this.bfMbr=null:this.bfMbr=this.mbr}return this.mbr},getAttributeNames:function(){return this.attrNames},setNSDP:function(b){if(b&&b.keyColumn){this.clearNSDP();this.nsdpKey=
b.keyColumn;this.nsdpKey=this.nsdpKey.toUpperCase();this.nsdp=b;"undefined"===typeof this.nsdp.ignoreCase&&(this.nsdp.ignoreCase=!0);a.isNull(this.nsdp.fullDisplay)&&(this.nsdp.fullDisplay=!1);var c=this,r=function(b){a.util.Logger.finest("","OM.VectorLayer.setNSDP","parsing NSDP XML data...");var r=null;"string"===typeof b&&(b=a.$.trim(b),b=a.$.parseXML(b));var r=a.$(b),n=0;c.nsdpTitleArray=[];r.find("th").each(function(){var b=a.$(this).text();c.nsdpTitleArray.push(b);a.util.Logger.finest("title["+
n+"]:"+b);n+=1});a.util.Logger.finest("Total "+n+" column(s) found");n=0;c.nsdpData={};r.find("tr").each(function(){var b=0,r=null,M={};a.$(this).find("td").each(function(){if(0===b)r=a.$(this).text();else{var n=c.nsdpTitleArray[b].toUpperCase();M[n]=a.$(this).text()}b++});r&&(r=c.nsdp.ignoreCase?r.toUpperCase():r,c.nsdpData[r]=M,a.util.Logger.finest("Values for key '"+r+"' added into layer '"+c.name+"'"),n+=1)});a.util.Logger.finest("Total "+n+" key/value pair(s) added into layer '"+c.name+"'");
c.parentMap&&c.name===c.parentMap.boundingLayerName&&c.loadBoundingTheme();c.displayed&&(c.renderingStyle instanceof a.style.BucketStyle&&c.renderingStyle.clearBuckets(),c.redraw(!1))},n=function(r){a.util.Logger.finest("JSON data to be parsed: "+JSON.stringify(r));a.util.Logger.finest("parsing NSDP JSON data...");"string"===typeof r&&(r=a.$.parseJSON(r));if(r.items&&0!==r.items.length){r=r.items;var n=r.length,M=0;c.nsdpData={};c.nsdpTitleArray=[];var sa=b.keyAttr,la=!1;a.isNull(sa)&&(sa=b.keyColumn);
a.notNull(r[0][sa])&&(la=!0);for(var oa in r[0])c.nsdpTitleArray.push(oa),a.util.Logger.finest("attribute["+M+"]:"+oa),M+=1,la||oa.toUpperCase()!=sa.toUpperCase()||(la=!0,sa=oa);a.util.Logger.finest("Total "+M+" attribute(s) found");for(la=M=0;la<n;la++){var wa=r[la][sa];if(!a.isNull(wa)){var ma={};for(oa in r[la])oa!=sa&&(ma[oa.toUpperCase()]=r[la][oa]);wa=c.nsdp.ignoreCase&&wa.toUpperCase?wa.toUpperCase():wa;c.nsdpData[wa]=ma;a.util.Logger.finest("Values for key '"+wa+"' added into layer '"+c.name+
"'");M+=1}}a.util.Logger.finest("Total "+M+" key/value pair(s) added into layer '"+c.name+"'");c.displayed&&(c.renderingStyle instanceof a.style.BucketStyle&&c.renderingStyle.clearBuckets(),c.redraw(!1))}};if(b&&b.url){a.$.ajaxSetup({async:!1});try{a.$.get(b.url,null,function(a){try{r(a)}catch(b){n(a)}},"text").fail(function(){a.util.Logger.warning("MAPVIEWER_9042","OM.layer.VectorLayer.setNSDP",b.url)})}catch(M){a.util.Logger.warning(null,"OM.layer.VectorLayer.setNSDP","Exception when loading nsdp url data.")}finally{a.$.ajaxSetup({async:!0})}}else b&&
b.xml?(a.util.Logger.finest("XML string to be parsed: "+b.xml),r(a.util.XMLUtil.parse(b.xml))):b&&b.json&&n(b.json)}},getNSDPString:function(){if(!this.nsdp)return"";var b;b='{"nsdp_id":"defaultNSDP",'+('"nsdp_theme":"'+this.name+'",');b+='"nsdp_keycol":"'+this.nsdpKey+'"';a.notNull(this.fullDisplay)&&!1===this.fullDisplay&&(b+=',"nsdp_smfo":"true"');b+=',"nsdp_params":[';var c,r;a.notNull(this.nsdp.xml)?(c="xml",r=this.nsdp.xml,r=r.replaceAll('"','\\"')):a.notNull(this.nsdp.json)?(c="json",r=this.nsdp.json,
"object"===typeof r&&(r=JSON.stringify(r)),r=r.replaceAll('"','\\"')):a.notNull(this.nsdp.url)&&(c="url",r=this.nsdp.url,r=r.replaceAll('"','\\"'));b+='{"'+c+'":"'+r+'"}';return b+="]}"},applyFilter:function(b,c){if("undefined"===typeof c||c){if(b.filterMode===a.filter.Filter.CLIENT_SIDE)return this.filterArray||(this.filterArray=[]),this.filterArray.push(b),this.replace=!1,this.doFilter(),this.loadOnDemand=!1,this}else if(b.filterMode==a.filter.Filter.CLIENT_SIDE){var r=this.clone();r.loadOnDemand=
!1;r.filterArray=this.filterArray?a.$.extend([],this.filterArray):[];r.filterArray.push(b);this.replace=!1;r.doFilter();return r}},removeFilter:function(a){if(this.filterArray)for(var b=this.filterArray.length;-1<b;b--)if(a==this.filterArray[b]){this.filterArray.splice(b,1);break}},removeFilterAll:function(){this.filterArray=[]},doFilter:function(a,b){if(this.filterArray&&0!==this.filterArray.length||b){var c=this.filterArray;this.replace&&(c=[b]);for(var n=0;n<c.length;n++){var M=c[n];if(a){if(!M.evaluate(a))return!0}else if(this.featureArray&&
0!==this.featureArray.length)for(var Z=this.featureArray.length-1;-1<Z;Z--){var ba=this.featureArray[Z];this.replace&&ba.selected||(M.evaluate(ba)?this.replace&&this.selectFeature(ba):this.replace||this.removeFeature(ba))}else break}}},selectFeatureByFilter:function(b){if(b&&(this.enableFeatureSelection(!0,a.layer.VectorLayer.MULTIPLE_SELECTION),b.filterMode==a.filter.Filter.CLIENT_SIDE))return this.replace=!0,this.doFilter(null,b),this.loadOnDemand=this.replace=!1,this},addToRtree:function(b,c){if(!(!1===
this.featureEditable&&!1===this.useRTree||a.isNull(b))){var r=a.isNull(c)?b.getGeometry():c;a.isNull(r)||(r=a.notNull(r.mbr)?r.mbr:a.notNull(r.getMBR)?r.getMBR():null,r={x:r.getMinX(),y:r.getMinY(),w:r.getWidth(),h:r.getHeight()},this.containsKey(b,r)||(a.isNull(this.rtree)&&(this.rtree=new a.RTree(10)),this.rtree.insert(r,b),b.rtreeKeys.push(r)))}},containsKey:function(b,c){a.isNull(b.rtreeKeys)&&(b.rtreeKeys=[]);a.isNull(c)&&(c={});for(var r=b.rtreeKeys,n=0;n<r.length;n++)if(r[n].x===c.x&&r[n].y===
c.y&&r[n].w===c.w&&r[n].h===c.h)return!0;return!1},removeFromRtree:function(b){if(!(!1===this.useRTree||a.isNull(b)||a.isNull(this.rtree)||a.isNull(b.rtreeKeys))){for(var c=b.rtreeKeys,r=0;r<c.length;r++)this.rtree.remove(c[r],b);b.rtreeKeys=[]}},beforeZoom:function(){this.pixMaxYDistance=this.pixMaxXDistance=null},updatedSearchWindow:function(b,c){if(a.notNull(b.shape)&&(c===a.GeomTypes.POINT||c===a.GeomTypes.ORIENTEDPOINT||c===a.GeomTypes.MULTIPOINT||c===a.GeomTypes.ORIENTEDMULTIPOINT)){var r=b.getGeometry(),
n=b.shape.getLayoutBounds();if(c===a.GeomTypes.MULTIPOINT||c===a.GeomTypes.ORIENTEDMULTIPOINT)r=r.coordinates,r=new a.geometry.Point(r[0][0],r[0][1]),1<b.shape.childrenCount&&(n=b.shape.getChildAt(0).getLayoutBounds());if(a.notNull(n)&&a.notNull(this.parentMap)){var M=this.parentMap,r=M.getScreenLocation(r),M=M.graphics.getLeftTop(M.draggableGroup);n.x=M.x+n.x;n.y=M.y+n.y;M=Math.abs(n.x-r.x)+n.width/2;n=Math.abs(n.y-r.y)+n.height/2;if(a.isNull(this.pixMaxXDistance)||this.pixMaxXDistance<M)this.pixMaxXDistance=
M;if(a.isNull(this.pixMaxYDistance)||this.pixMaxYDistance<n)this.pixMaxYDistance=n}}},getSearchWindow:function(b){var c,r;c=a.notNull(this.pixMaxXDistance)?2*this.pixMaxXDistance:this.searchBuffer;r=a.notNull(this.pixMaxYDistance)?2*this.pixMaxYDistance:this.searchBuffer;r=this.pixToCoord(c,r);return a.notNull(r)?(c=r.width,r=r.height,{x:b.getX()-c/2,y:b.getY()-r/2,w:c,h:r,srid:this.parentMap.getMapContext().getUniverse().srid}):null},pixToCoord:function(a,b){var c=this.parentMap,n=c.getMapContext(),
M=n.getUniverse(),n=n.getZoomLevel();if(M&&M.zoomLevels)return n=c.checkZoomLevel(n),c=M.zoomLevels[n].resolution,M=M.zoomLevels[n].stretchRatio,{width:Math.abs(a*c),height:Math.abs(b*c*M)}},findFeature:function(b,c){if(a.isNull(this.rtree))return null;try{var r=null,n=a.util.DomUtil.getTouchesClientPosition(b);a.notNull(n.x)&&(b.clientX=n.x,b.clientY=n.y);if(a.isNull(b.clientX)||a.isNull(b.clientY))return null;for(var M=this.parentMap.getScreenPointLocation(b.clientX,b.clientY),Z=this.getSearchWindow(M),
ba=this.rtree.search(Z),n=0;n<ba.length;n++)if(r=ba[n],this.pointInFeature(b.clientX,b.clientY,r))return r;if(!1===c)return null;for(n=0;n<ba.length;n++)if(r=ba[n],this.pointNearFeature(M,r))return r.fkNode=r.shape,r}catch(Y){}return null},findFeatures:function(b,c){!0!==c&&(c=!1);if(a.isNull(this.rtree))return null;var r=[],n=null;try{var M=a.util.DomUtil.getTouchesClientPosition(b);a.notNull(M.x)&&(b.clientX=M.x,b.clientY=M.y);for(var Z=this.parentMap.getScreenPointLocation(b.clientX,b.clientY),
ba=this.getSearchWindow(Z),Y=this.rtree.search(ba),M=0;M<Y.length;M++)n=Y[M],this.pointInFeature(b.clientX,b.clientY,n)&&r.push(n);if(0<r.length)return r;if(!1===c)return null;for(M=0;M<Y.length;M++)n=Y[M],this.pointNearFeature(Z,n)&&(n.fkNode=n.shape,r.push(n))}catch(sa){}return 0<r.length?r:null},pointInFeature:function(b,c,r){if(a.notNull(r)&&a.notNull(r.shape)){if(this.pointInShape(b,c,r.shape,r)||this.pointInShape(b,c,r.ghostShape,r))return!0;if(a.notNull(r.shapeArray))for(var n=0;n<r.shapeArray.length;n++)if(this.pointInShape(b,
c,r.shapeArray[n],r))return!0}return!1},pointInShape:function(b,c,r,n){return a.isNull(r)?!1:(b=r.hitTest(b,c))?(n.fkNode=b,b.feature=n,!0):!1},pointNearFeature:function(b,c){var r=c.getGeometry(),n=r.coordinates,M=r.getType(),Z=null,ba=Number.MAX_VALUE,Y=[];switch(M){case a.GeomTypes.POINT:case a.GeomTypes.ORIENTEDPOINT:Z=this.minDistance({x:b.getX(),y:b.getY()},[{x:r.getX(),y:r.getY()}]);break;case a.GeomTypes.MULTIPOINT:case a.GeomTypes.ORIENTEDMULTIPOINT:Y=[];for(r=0;r<n.length;r++)for(M=n[r],
Z=0;Z<M.length;Z+=2)Y.push({x:M[Z],y:M[Z+1]});Z=this.minDistance({x:b.getX(),y:b.getY()},Y);break;case a.GeomTypes.LINESTRING:for(r=0;r<n.length-2;r+=2)Y.push([{x:n[r],y:n[r+1]},{x:n[r+2],y:n[r+3]}]);Z=this.minPointSegmentDistance({x:b.getX(),y:b.getY()},Y);break;case a.GeomTypes.MULTILINESTRING:for(r=0;r<n.length;r++)for(M=n[r],Z=0;Z<M.length-2;Z+=2)Y.push([{x:M[Z],y:M[Z+1]},{x:M[Z+2],y:M[Z+3]}]);Z=this.minPointSegmentDistance({x:b.getX(),y:b.getY()},Y)}a.notNull(Z)&&a.notNull(c.parentLayer)&&a.notNull(c.parentLayer.parentMap)&&
(ba=c.parentLayer.parentMap.getMapContext().getTransform().toScreenXLength(Z));return ba<=this.searchBuffer},minDistance:function(b,c){for(var r=Number.MAX_VALUE,n=0;n<c.length;n++)r=Math.min(r,a.util.GeomUtil.distance(b.x,b.y,c[n].x,c[n].y));return r},minPointSegmentDistance:function(b,c){for(var r=Number.MAX_VALUE,n=0;n<c.length;n++)r=Math.min(r,a.util.GeomUtil.pointSegmentDistance(b.x,b.y,c[n][0].x,c[n][0].y,c[n][1].x,c[n][1].y));return r},addFeature:function(b){if(!this.doFilter(b))if(this.featureArray||
(this.featureArray=[]),this.isValidId(b.id)){if(this.featureArray.push(b),b.parentLayer=this,this.addToRtree(b),this.displayed){var c=b.geo,r=this,n=function(c){var n=a.notNull(c.mbr)?c.mbr:a.notNull(c.getMBR)?c.getMBR():null;b.geo=c;c=r.parentMap.getMapZoomLevel();r.clustering&&c<=r.maxClusteringLevel&&r.vCluster.addFeature(b);if(!b.displayed){c=r.parentMap.getMapContext();var N=c.getWholeMapNum(),M=c.getBaseWholeMapIndex();a.notNull(r.featureGroupArr)&&0<r.featureGroupArr.length&&(a.notNull(b.activeIdx)?
r.realGroup=r.featureGroupArr[b.activeIdx]:r.realGroup=r.featureGroupArr[0]);a.isNull(r.realGroup)&&(r.realGroup=r.parentMap.graphics.createGroup(),r.realGroup.applyStyle({cursor:r.mouseCursor}),r.pointerSensitivity||r.realGroup.applyStyle({pointerSensitivity:!1}),r.group.appendChild(r.realGroup));b.group=r.realGroup;b.screenTransformObj=r.parentMap.getMapContext().getTransform();b.graphics=r.parentMap.graphics;b.parentLayer=r;r.display(b,n);var la,oa,wa;if(1<N&&(a.isNull(r.featureGroupArr)&&(r.featureGroupArr=
[]),a.notNull(b.activeIdx)&&(N=b.activeIdx+1),a.isNull(r.featureGroupArr[N-1])&&(r.featureGroupArr[N-1]=r.realGroup,la=c.getUniverse().getZoomLevels()[c.getZoomLevel()].resolution,oa=c.getUniverse().getMapBounds().getWidth(),wa=(c.getCenterPoint().getX()-c.getRoundMapCenterPoint().getX())/la,r.realGroup.translate((N-1-M)*oa/la-wa,0)),!a.notNull(b.activeIdx)))for(var ma=1;ma<N;ma++)b.shapeArray||(b.shapeArray=[]),b.shapeArray.push(b.shape),a.notNull(r.featureGroupArr[ma])?r.realGroup=r.featureGroupArr[ma]:
(r.realGroup=r.parentMap.graphics.createGroup(),r.realGroup.applyStyle({cursor:r.mouseCursor}),r.pointerSensitivity||r.realGroup.applyStyle({pointerSensitivity:!1}),r.group.appendChild(r.realGroup),r.featureGroupArr[ma]=r.realGroup,la=c.getUniverse().getZoomLevels()[c.getZoomLevel()].resolution,oa=c.getUniverse().getMapBounds().getWidth(),wa=(c.getCenterPoint().getX()-c.getRoundMapCenterPoint().getX())/la,r.realGroup.translate((ma-M)*oa/la-wa,0)),r.display(b,n)}},M=this.parentMap.getMapContext().getUniverse().getSRID();
M!=c.srid?M!==a.util.BaiduUtil.SRID?c.transform(M,n):c.transform(M,n,null,null,{map:this.parentMap}):n(c);this.labelsVisible()&&b.label&&this.parentMap.refreshVectorLayerLabels()}}else a.util.Logger.warning("MAPVIEWER_9005","OM.layer.VectorLayer.addFeature")},addFeatures:function(b){this.featureArray||(this.featureArray=[]);for(var c=b?b.length:0,r=0;r<c;r++)this.isValidId(b[r].id)&&!this.doFilter(b[r])?this.featureArray.push(b[r]):a.util.Logger.warning("MAPVIEWER_9005","OM.layer.VectorLayer.addFeatures")},
clearFeature:function(b){this.parentMap&&this.parentMap.deleteFeatureInfoWindow(this.name+"_"+b.id);b.clearAnimation();b.animations=null;b.moveAnimation&&b.pauseMoveAnimation();b.selected&&this.deselectFeature(b);b.shape&&(b.shape.feature=null,this.parentMap.graphics.remove(b.shape),b.shape=null);if(b.shapeArray){for(var c=b.shapeArray.length,r=0;r<c;r++)b.shapeArray[r]&&(b.shapeArray[r].feature=null,this.parentMap.graphics.remove(b.shapeArray[r]));b.shapeArray=null}if(b.shapeGroup){c=b.shapeGroup.length;
for(r=1;r<c;r++)b.shapeGroup[r].feature=null,this.parentMap.graphics.remove(b.shapeGroup[r]);b.shapeGroup=null}b.labelShape&&(b.labelShape.feature=null,this.parentMap.graphics.remove(b.labelShape));if(b.labelShapeArr){for(c=0;c<b.labelShapeArr.length;c++)this.parentMap.graphics.remove(b.labelShapeArr[c]);b.labelShapeArr=null}b.group=null;b.screenTransformObj=null;b.graphics=null;b.parentLayer=null;b.displayed=!1;b.inCluster=!1;this.removeFromRtree(b);a.notNull(b.$customDiv)&&(b.$customDiv.remove(),
b.$customDiv=null)},removeFeature:function(b){var c,r;b&&b.editable&&b.featureEditingProperties&&b.deleteEditingProperties();c=this.featureArray?this.featureArray.length:0;for(r=0;r<c;r++)if(this.featureArray[r]===b)return this.featureArray.splice(r,1),a.notNull(this.rtree)&&a.notNull(b.geo)&&(c=a.notNull(b.geo.mbr)?b.geo.mbr:a.notNull(b.geo.getMBR)?b.geo.getMBR():null,a.notNull(c)&&(c={x:c.getMinX(),y:c.getMinY(),w:c.getWidth(),h:c.getHeight()},this.rtree.remove(c,b),a.notNull(this.segmentRtree)&&
a.notNull(this.segmentRtree[b.id])&&delete this.segmentRtree[b.id])),this.clearFeature(b),b;return null},removeAllFeatures:function(){var b=this.featureArray?this.featureArray.length:0;a.isNotNull(this.parentMap)&&this.parentMap.graphics.clearGroup(this.group);for(var c=b-1;0<=c;c--){var r=this.featureArray.pop();this.clearFeature(r)}a.notNull(this.rtree)&&(this.rtree=new a.RTree(10));this.segmentRtree={};this.realGroup=null;this.featureArray=[];return b},initGroup:function(){this.parentMap&&this.parentMap.graphics&&
(this.group=this.parentMap.graphics.createGroup({opacity:this.opacity,visibility:!0}),this.parentMap.draggableGroup.appendChild(this.group))},init:function(){var b=this.parentMap.getMapContext(),c=b.getDeviceWidth(),b=b.getDeviceHeight();this.serverURL||this.type!=a.layer.VectorLayer.TYPE_JDBC&&this.type!=a.layer.VectorLayer.TYPE_PREDEFINED||(this.serverURL=this.parentMap.mapviewerURL);this.renderingStyle&&this.isServerSideStyle(this.renderingStyle,"rendering");this.labelStyle&&this.isServerSideStyle(this.labelStyle,
"label");this.hoverStyle&&this.isServerSideStyle(this.hoverStyle,"hover");this.selectionStyle&&this.isServerSideStyle(this.selectionStyle,"select");if(this.otherStyles&&0<this.otherStyles.length)for(var r=0;r<this.otherStyles.length;r++)this.isServerSideStyle(this.otherStyles[r],"secondary")&&(this.otherStyles.splice(r,1),r--);var n=this.parentMap.graphics;this.group&&(this.clearFeatureShapes(),0===this.group.childrenCount&&this.parentMap.draggableGroup.appendChild(this.group));var r=a.event.MouseEvent,
M=this;M.timeStamp=0;if(this.useRTree){this.tooltipTimer=new a.util.TimerManager;var Z=n.oui.tooltipManager._properties.showDelay,ba=n.oui.tooltipManager._properties.hideDelay,Y=n.oui.tooltipManager._properties.dismissDelay;this.on(a.event.MouseEvent.MOUSE_MOVE,function(){M.showToolTip&&M.tooltipTimer.reset("show")});this.on(a.event.MouseEvent.MOUSE_OUT,function(){M.showToolTip&&(M.tooltipTimer.cancel("show"),M.tooltipTimer.cancel("dismiss"),M.tooltipTimer.schedule("hide",ba,function(){n.oui.tooltipManager.hideTooltip()}))});
this.on(a.event.MouseEvent.MOUSE_OVER,function(b){if(M.showToolTip){var c=b.feature,r=b.evt;M.tooltipTimer.cancel("hide");M.tooltipTimer.cancel("dismiss");M.tooltipTimer.schedule("show",Z,function(){if(M.showToolTip){var b=c.getTip();b&&0<b.length?(M.parentMap.graphics.oui.tooltipManager.showTooltip(r.target,b,r.clientX,r.clientY),M.tooltipTimer.schedule("dismiss",Y,function(){n.oui.tooltipManager.hideTooltip()})):a.util.Logger.info("","layer.tooltipTimer.schedule","Tooltip string is not defined properly.")}})}})}var sa=
function(b){var c=b.type;a.event.EventSource.setProcessedEventStatus(M,c,!0);var r=M.getTargetFeature(b.target),n=M.parentMap.getMapContext();if(!a.isNull(r)){var N=a.event.MouseEvent;if((c===N.MOUSE_CLICK||c===N.MOUSE_DOWN)&&2===b.button||c===N.TOUCH_LONG_PRESS)c=N.MOUSE_RIGHT_CLICK;if(M.parentMap.enableMapAction.mouse){var J=new N(c,r);J.evt=b;J.mapContext=n;r.fire(c,J);J=new N(c,M);J.evt=b;J.feature=r;if((c===N.MOUSE_OVER||c===N.MOUSE_OUT)&&null!==b.relatedTarget){var L=M.getTargetFeature(b.relatedTarget);
if(r===L)return}c===N.MOUSE_OVER?(M.hoverEnable&&M.hover(r),M.bringToTopFlag&&(r.getShapeIndex(),r.bringToTop())):c===N.MOUSE_OUT?(M.bringToTopFlag&&r.setShapeIndex(),M.hoverEnable&&M.deHover(r)):c!==N.MOUSE_CLICK||r.multi?c===N.TOUCH_END&&M.parentMap.enableMapAction.mouse?(M.endFeatureDragging(b),b.stopPropagation()):c===N.MOUSE_UP&&"overview_rectangle"===J.feature.id&&!0===J.feature.dragging&&(M.endFeatureDragging(b),b.stopPropagation()):M.handleVectorMouseClick(oa,M,r);b.type===N.TOUCH_TAP&&M.handleVectorTouchTap(oa,
M,r,"touch tapped");J.mapContext=n;setTimeout(function(){M.fire(c,J)},a.event.MouseEvent.DELAY_MILI_SEC)}}};n.attachEventListener(r.MOUSE_OVER,sa,this.group);n.attachEventListener(r.MOUSE_OUT,sa,this.group);var la=function(b){if(2!==b.button){M.lastMouseDown=M.parentMap.getCursorLocation();var c=M.getTargetFeature(b.target);c&&(c&&c.editable?(M.focusFeature=c,c.startDrag(b,!0)):c&&c.draggable?(M.selectFeature(c),M.focusFeature=c,c.startDrag&&(c.startDrag(b,!0),c.dragStartListener&&(b.markerX=c.getMarkerX(),
b.markerY=c.getMarkerY(),b.markerSRID=c.getMarkerSRID(),c.dragStartListener.call(this,b)))):c&&a.notNull(c.parentFeature)&&(M.focusFeature=c.parentFeature,c.parentFeature.startDrag(b,!1)),M.curTopFeature=c)}};a.browser.touchSupported&&(n.attachEventListener(r.TOUCH_TAP,sa,this.group),n.attachEventListener(r.TOUCH_LONG_PRESS,sa,this.group),n.attachEventListener(r.TOUCH_END,sa,this.group),n.attachEventListener(r.TOUCH_START,function(b){b.preventDefault();var c=a.util.DomUtil;1==c.getTouchCount(b)&&
(b.button=0,c=c.getTouchesClientPosition(b),b.clientX=c.x,b.clientY=c.y,la(b))},this.group));n.attachEventListener(r.MOUSE_CLICK,sa,this.group);n.attachEventListener(r.MOUSE_RIGHT_CLICK,sa,this.group);n.attachEventListener(r.MOUSE_UP,sa,this.group);n.attachEventListener(r.MOUSE_DOWN,sa,this.group);n.attachEventListener(a.event.MouseEvent.MOUSE_DOWN,la,this.group);n.attachEventListener(r.MOUSE_MOVE,sa,this.group);M.draggingFeature=function(b){if(a.notNull(M.focusFeature)&&(M.focusFeature.featureDragging(b),
M.focusFeature.draggingListener)){var c=M.focusFeature.parentLayer.parentMap.getMapContext(),r=c.getUniverse().getZoomLevels(0)[c.getZoomLevel()],c=(M.focusFeature.mouseLocX-M.focusFeature.startX)*r.resolution,r=-(M.focusFeature.mouseLocY-M.focusFeature.startY)*r.resolution;b.markerX=M.focusFeature.getMarkerX()+c;b.markerY=M.focusFeature.getMarkerY()+r;b.markerSRID=M.focusFeature.getMarkerSRID();M.focusFeature.draggingListener.call(this,b)}};M.draggingFeature_touch=function(b){var c=a.util.DomUtil.getTouchesPosition(b);
b.pageX=c.x;b.pageY=c.y;M.draggingFeature(b)};M.draggingFeature_win8Touch=function(a){a.pageX=a.gesture.touches[0].pageX;a.pageY=a.gesture.touches[0].pageY;M.draggingFeature(a)};this.parentMap.$oracleMapDiv.mousemove(M.draggingFeature);if(a.gv.isWin8Touch)a.Hammer(this.parentMap.$oracleMapDiv[0]).on("drag",M.draggingFeature_win8Touch);this.parentMap.$oracleMapDiv.bind("touchmove",M.draggingFeature_touch);M.endFeatureDragging=function(b){if(a.notNull(M.focusFeature)){var c=M.focusFeature;c.endDragOrietation?
(b.focusFeature=c,c.endDragOrietation(b)):(c.endDrag(b),c.dragEndListener&&(b.markerX=c.getMarkerX(),b.markerY=c.getMarkerY(),b.markerSRID=c.getMarkerSRID(),c.draggingListener?setTimeout(function(){c.dragEndListener.call(this,b)},100):c.dragEndListener.call(this,b)));a.notNull(M.curTopFeature)&&(c.focusProperties(M.curTopFeature),M.curTopFeature=null);M.focusFeature=null}};M.endFeatureDragging_touch=function(b){var c=a.util.DomUtil.getTouchesPosition(b);b.pageX=c.x;b.pageY=c.y;M.endFeatureDragging(b)};
a.$(document).mouseup(M.endFeatureDragging);a.$(document).mouseout(M.endFeatureDragging);this.parentMap.$oracleMapDiv.bind("touchend",M.endFeatureDragging_touch);this.orgWidth=c;this.orgHeight=b;if(this.type!==a.layer.VectorLayer.TYPE_PREDEFINED&&this.type!==a.layer.VectorLayer.TYPE_JDBC&&this.type!==a.layer.VectorLayer.TYPE_DATAPACK&&this.type!==a.layer.VectorLayer.TYPE_GEORSS&&this.type!==a.layer.VectorLayer.TYPE_MAPBOX||this.boundingTheme&&this.loadedBoundingTheme)if(this.setWindow(),this.checkVisible())this.displayFeatures();
else{var oa=new a.event.LayerEvent(a.event.LayerEvent.FINISH_LOAD,this);oa.mapContext=this.parentMap.getMapContext();this.initTask.complete();this.initTask=null;this.fire(a.event.LayerEvent.FINISH_LOAD,oa)}else this.setWindow(),this.refreshImpl()},redrawFeature:function(a){this.removeFeature(a);this.addFeature(a)},setWindow:function(){var a=this.parentMap.getMapContext(),b=a.getUniverse(),c=b.getZoomLevels();c&&(c=c[a.getZoomLevel()],b=b.bound,this.minX=b.getMinX(),this.minY=b.getMinY(),this.windowW=
b.getWidth(),this.windowH=b.getHeight(),this.orgDraggbleGroupPos=this.parentMap.graphics.getLeftTop(this.parentMap.draggableGroup),a=a.getCenterPoint(),this.parentMap.graphics.setLeftTop(this.group,0,0),b=this.orgWidth*this.xRatio*c.resolution,c=this.orgHeight*this.yRatio*c.resolution*c.stretchRatio,this.dataBufferWindow={x:a.getX()-b/2,y:a.getY()-c/2,w:b,h:c})},refresh:function N(b,c){a.isNull(c)&&(c=!0);N.base.call(this,b,c);this.reloadNumber=Math.round(1E10*Math.random());this.refreshImpl(b,c)},
emptyCustomLayer:function(){var b=this.getCustomLayerDiv();0<b.length&&b.children().each(function(b,c){a.$(c).data("f").displayed=!1;a.$(c).remove()})},refreshImpl:function(b,c,n){if(!a.isNull(this.group)){var M=b&&b.type===a.event.MapEvent.MAP_BEFORE_REFRESH?b.bigPan:!1;c?(M||(this.loaded=!1),this.clearFeatureShapes(),this.clearAllLabels(),M||(this.dataLoaded=!1)):b&&null!==b.beforeZoomLevel&&null!==b.afterZoomLevel&&b.beforeZoomLevel!==b.afterZoomLevel?this.setWindow():this.loadOnDemand?(this.loaded=
!1,this.clearFeatureShapes(),this.clearAllLabels(),this.dataLoaded=!1):this.clearAllLabels();if(this.checkVisible()){b=this.parentMap.getMapContext();var Z=b.getUniverse(),M=Z.getZoomLevels()[b.getZoomLevel()],ba=b.getCenterPoint();b=this.orgWidth*this.xRatio*M.resolution;M=this.orgHeight*this.yRatio*M.resolution*M.stretchRatio;this.dataBufferWindow={x:ba.getX()-b/2,y:ba.getY()-M/2,w:b,h:M};this.emptyCustomLayer();var Y=this,Z=Z.getSRID(),ba=null;if(this.loadOnDemand){var ba=this.visibleBound?Math.max(this.dataBufferWindow.x,
this.visibleBound.getMinX()):this.dataBufferWindow.x,sa=this.visibleBound?Math.max(this.dataBufferWindow.y,this.visibleBound.getMinY()):this.dataBufferWindow.y;b=this.visibleBound?Math.min(this.dataBufferWindow.x+b,this.visibleBound.getMaxX()):this.dataBufferWindow.x+b;M=this.visibleBound?Math.min(this.dataBufferWindow.y+M,this.visibleBound.getMaxY()):this.dataBufferWindow.y+M;ba=new a.geometry.Rectangle(ba,sa,b,M,Z)}(this.loadOnDemand||!this.dataLoaded&&this.type!==a.layer.VectorLayer.TYPE_LOCAL)&&
!1!==n?(a.isNull(this.boundingDataTask)&&(this.boundingDataTask=this.startNewTask()),a.isNull(Y.getDataRequest)&&this.getThemeData(ba,function(){a.notNull(Y.boundingDataTask)&&(Y.boundingDataTask.complete(),Y.boundingDataTask=null);Y.mapping=!1;Y.renderingStyle instanceof a.style.BucketStyle&&!Y.renderingStyle.isServerSide&&Y.renderingStyle.generateBuckets(Y.featureArray,Y.styleAttributes,!0);Y.displayFeatures(c)})):this.displayFeatures(c)}else n=a.event,b=new n.MapEvent(n.LayerEvent.FINISH_LOAD,
this),b.mapContext=this.parentMap.getMapContext(),null!==this.initTask&&(this.initTask.complete(),this.initTask=null),this.fire(n.LayerEvent.FINISH_LOAD,b)}},delayDisplayFeatures:function(a){var b=this,c=function(a){0<b.loadingStyle?setTimeout(c,100,a):b.displayFeatures(a)};c(a)},setDisplayFeaturesTaskEnabled:function(a){this.displayFeaturesTaskEnabled=a},isDisplayFeaturesTaskEnabled:function(){return this.displayFeaturesTaskEnabled},displayFeatures:function(b){a.util.Logger.finest(null,"VectorLayer",
"["+this.name+"] displayFeatures called.");if(0<this.loadingStyle)this.delayDisplayFeatures(b);else{this.displayFeaturesTaskEnabled&&a.isNull(this.displayFeaturesTask)&&(this.displayFeaturesTask=this.startNewTask());this.loading=!0;this.loaded=!1;this.displayCount=0;a.util.Logger.fine("","OM.VectorLayers.displayFeatures","["+this.name+"] displaying Features");this.visualFilter&&(this.graphicFilter=this.parentMap.graphics.getGraphicFilter(this.visualFilter));var c=this.parentMap.graphics,n=!1;a.isNull(this.realGroup)&&
(n=!0,this.realGroup=c.createGroup(),this.realGroup.applyStyle({cursor:this.mouseCursor}),this.pointerSensitivity||this.realGroup.applyStyle({pointerSensitivity:!1}));this.graphicFilter&&this.visualFilter.applyToLayer&&this.parentMap.graphics.applyStyle(this.realGroup,{filter:this.graphicFilter});this.renderingStyle&&"HeatMap"==this.renderingStyle.styleType?(this.displayHeatMap(),a.notNull(this.displayFeaturesTask)&&(this.displayFeaturesTask.complete(),this.displayFeaturesTask=null)):(c=this.parentMap.getMapContext().getZoomLevel(),
this.clustering&&c<=this.maxClusteringLevel&&this.vCluster.displayAsCluster(this.dataBufferWindow),this.mappingNSDP(),this.mfMarker&&(this.vmf||(this.vmf=new a.layer.VectorLayerMultiFeature(this),this.vmf.checkLocation()),this.vmf.display()),a.notNull(this.displayFeaturesTask)&&this.displayFeaturesTask.update(.65),this.displayBatch(0,n,this,b))}},displayBatch:function(b,r,n,M){a.util.Logger.finest(null,"VectorLayer","["+this.name+"] displayBatch called with start\x3d"+b+".");if(n.group){n.renderingStyle&&
n.renderingStyle instanceof a.style.BucketStyle&&(!n.styleAttributes||0===n.styleAttributes.length)&&(!n.nsdpTitleArray||1>n.nsdpTitleArray.length)&&a.util.Logger.warning("MAPVIEWER_9042","OM.layer.VectorLayer.displayBatch","");var Z,ba=n.featureArray?n.featureArray.length:0;a.util.Logger.finest(null,"VectorLayer","["+this.name+"] feature count: "+ba+".");var Y=n.parentMap.getMapContext().getUniverse().getSRID(),sa,la,oa=a.util.BaiduUtil.SRID,wa=function(b){return function(){var c=b.getGeometry(),
L=function(L){var r=a.notNull(L.mbr)?L.mbr:a.notNull(L.getMBR)?L.getMBR():null;b.srid=Y;b.geo=L;if(la.labelBox){L=b.labelBox;L=new a.geometry.LineString([L[0],L[1],L[2],L[3]],c.srid);var w=function(a){a=a.coordinates;b.labelBox=[a[0],a[1],a[2],a[3]];n.display(b,r)};Y!==oa?L.transform(Y,w):L.transform(Y,w,null,null,{map:n.parentMap})}else n.display(b,r)};Y!==oa?c.transform(Y,L):c.transform(Y,L,null,null,{map:n.parentMap})}()},ma=function(){fa(sa,!1,n,M)};a.notNull(n.featureArray)&&a.util.Logger.finest("",
"OM.VectorLayer.displayBatch","Number of features in layer: "+n.featureArray.length);console&&console.time&&"finest"===a.gv.getLogLevel()&&a.util.Logger.finest("","OM.VectorLayer.displayBatch",console.time("["+this.name+"] displayFeatures"));for(sa=b;sa<ba;sa+=1)if(la=n.featureArray[sa],(la.displayed||la.multi)&&1==n.parentMap.getMapContext().getWholeMapNum()||a.notNull(la.activeIdx)&&la.activeIdx!==this.areaIdx||la.inCluster)la.removeGhostShape();else{if(n.enableBatch&&(n.displayCount++,n.displayCount>
n.numberInBatch)){if(r)n.group.appendChild(n.realGroup);else for(;b<=sa;b++)la=n.featureArray[b],la.displayed&&la.startAnimation();n.displayCount=0;var fa=n.displayBatch;c.setTimeout(ma,1E3);return}var w=la.geo;la.displayed&&(la.shapeArray?la.shapeArray.push(la.shape):la.shapeArray=[la.shape]);Y!==w.srid?wa(la):this.type!==a.layer.VectorLayer.TYPE_LOCAL?("Circle"===w.type&&(w=la.getGeometry()),Z=null,n.loadOnDemand||w.mbr||(Z=w.coordinates?a.geometry.Geometry.calculateMBR(w.coordinates,w.type):a.geometry.Geometry.calculateGeomCollectionMBR(w.geometries,
w.type),w.mbr=new a.geometry.Rectangle(Z.minX,Z.minY,Z.maxX,Z.maxY,w.srid)),n.display(la,w.mbr)):(Z=a.notNull(w.mbr)?w.mbr:a.notNull(w.getMBR)?w.getMBR():null,n.display(la,Z))}n.displayed=!0;console&&console.timeEnd&&"finest"===a.gv.getLogLevel()&&a.util.Logger.finest("","OM.VectorLayer.displayBatch",console.timeEnd("["+this.name+"] displayFeatures"));r&&n.group.appendChild(n.realGroup);for(sa=b;sa<ba;sa++)la=n.featureArray[sa],la.displayed&&la.startAnimation();n.displayEnd(M)}},displayEnd:function(b){a.util.Logger.finest(null,
"VectorLayer","["+this.name+"] displayEnd called.");this.bringSelectedFeaturesToTop();this.getShadowArea();var c=this.parentMap.getMapContext(),n=c.getWholeMapNum();if(1<n){var M=c.getBaseWholeMapIndex();a.isNull(this.areaIdx)&&(this.areaIdx=0);this.featureGroupArr||(this.featureGroupArr=[]);this.featureGroupArr.push(this.realGroup);var Z=c.getUniverse().getZoomLevels()[c.getZoomLevel()].resolution,ba=c.getUniverse().getMapBounds().getWidth(),c=(c.getCenterPoint().getX()-c.getRoundMapCenterPoint().getX())/
Z;this.realGroup.translate((this.areaIdx-M)*ba/Z-c,0);this.areaIdx++;if(this.areaIdx<n){this.realGroup=this.parentMap.graphics.createGroup();this.lineGroup=null;this.realGroup.applyStyle({cursor:this.mouseCursor});this.pointerSensitivity||this.realGroup.applyStyle({pointerSensitivity:!1});this.displayBatch(0,!0,this,!1);return}}n=this.parentMap.getMapContext().getZoomLevel();this.clustering&&n<=this.maxClusteringLevel&&this.vCluster.showClusterInWrapAround();a.util.Logger.finest("","OM.VectorLayer.displayEnd",
"["+this.name+"] display features completed");this.loading=!1;n=a.event.LayerEvent;M=this.parentMap.getMapContext();null!==this.initTask&&(this.initTask.complete(),this.initTask=null);a.notNull(this.displayFeaturesTask)&&(this.displayFeaturesTask.complete(),this.displayFeaturesTask=null);Z=new n(n.FINISH_LOAD,this);Z.mapContext=M;this.fire(n.FINISH_LOAD,Z);Z=new n(n.FEATURES_DISPLAYED,this);Z.mapContext=M;this.fire(n.FEATURES_DISPLAYED,Z);b&&(Z=new n(n.FEATURES_DISPLAYED,this),Z.mapContext=this.parentMap.getMapContext(),
this.fire(n.AFTER_REFRESH,Z))},display:function(b,c,n){var M=this.dataBufferWindow;if(a.notNull(c)&&(c.getMaxX()<M.x||c.getMaxY()<M.y||c.getMinX()>M.x+M.w||c.getMinY()>M.y+M.h))if(this.parentMap.wraparound){var Z=this.parentMap.getMapContext().getUniverse().getMapBounds().getWidth();if(!(a.notNull(c)&&c.getMaxX()<M.x&&c.getMaxX()+Z>M.x||a.notNull(c)&&c.getMinX()>M.x+M.w&&c.getMinX()-Z<M.x+M.w))return}else return;if(!(a.notNull(c)&&this.visibleBound&&(c.getMinX()>this.visibleBound.getMaxX()||c.getMinY()>
this.visibleBound.getMaxY()||c.getMaxX()<this.visibleBound.getMinX()||c.getMaxY()<this.visibleBound.getMinY())||this.mapping&&!b.mapping&&!this.nsdp.fullDisplay)){b.group=this.realGroup;b.screenTransformObj=this.parentMap.getMapContext().getTransform();b.screenPoints=null;b.graphics=this.graphics?this.graphics:this.parentMap.graphics;b.parentLayer=this;var ba=this.getFeatureStyles(b);b.oldStyle=null;b.hover=!1;b.selected&&(b.oldStyle=ba,b.selected&&this.selectionStyle&&(c={},"PulseAnimation"===this.selectionStyle.styleType||
"AnimationColor"===this.selectionStyle.styleType?(c=b.shape,b.displayFeature([this.selectionStyle],null,n),b.selectShape=b.shape,b.shape=c,c=b.oldStyle):c=this.getHoverSelectStyle(this.selectionStyle,b),ba=c,this.parentMap.wraparound&&(b.renderingStyle=ba)));null!==ba?(b.setRenderingStyle(ba),ba=[ba]):ba=[];this.otherStyles&&(ba=ba.concat(this.otherStyles));if(0===ba.length)if(c=this.getDefaultRenderingStyle(b.geo.type))ba.push(c),b.setRenderingStyle(c);else return;ba=b.getAllStyles(ba);a.notNull(this.labelingStyle)?
a.isNull(b.getLabelingStyle())&&b.setLabelingStyle(this.labelingStyle):!b.labelStyle&&b.labelStyleName&&(c=a.style.StyleStore.getServerSideStyle(this.dataSource,b.labelStyleName),b.setLabelingStyle(c));var Y=this,sa=function(){if("Marker"!==ba[0].styleType||!ba[0].src||null!==ba[0].width&&null!==ba[0].height)if(b.displayFeature(ba,null,n),b.startAnimation(),Y.selectVisualFilter&&b.selected){var a=Y.parentMap.graphics.getGraphicFilter(Y.selectVisualFilter);Y.parentMap.graphics.applyStyle(b.shape,{filter:a})}else Y.graphicFilter&&
!Y.visualFilter.applyToLayer&&b.shape&&Y.parentMap.graphics.applyStyle(b.shape,{filter:this.graphicFilter});else setTimeout(sa,300)};sa()}},mappingNSDP:function(){if(!this.mapping&&(this.nsdpTitleArray&&(this.attrNames?(this.nsdpTitleArray[0].toUpperCase()==this.nsdpKey&&this.nsdpTitleArray.shift(),this.attrNames=this.attrNames.concat(this.nsdpTitleArray)):this.nsdpTitleArray[0].toUpperCase()==this.nsdpKey&&(this.attrNames=this.nsdpTitleArray.slice(1))),this.nsdpData&&this.nsdpKey)){for(var b=this.featureArray?
this.featureArray.length:0,c=0;c<b;c++){var n=this.featureArray[c],M=this.getNsdpDataForFeature(n);if(a.notNull(M)){a.$.extend(n.attributes,M);n.columns=[];for(var Z in M)n.columns.push(Z);n.mapping=!0}else n.mapping=!1}this.mapping=!0;b=a.event.LayerEvent;c=new b(b.NSDP_MAPPED,this);this.fire(b.NSDP_MAPPED,c)}},getNsdpDataForFeature:function(b){var c=null;a.notNull(b.attributes)&&(c=b.getAttributeValue(this.nsdpKey));a.isNull(c)&&(c=b.id);var c=this.nsdp.ignoreCase?c.toUpperCase():c,n=this.nsdpData[c];
a.isNull(n)&&(c=b.attributes._LABEL_,a.notNull(c)&&(c=this.nsdp.ignoreCase?c.toUpperCase():c,n=this.nsdpData[c]));return n},clearNSDP:function(){if(this.nsdpTitleArray){var a=this.nsdpTitleArray.length;this.attrNames.splice(this.attrNames.length-a,a);if(this.nsdpData&&this.mapping){for(var b=this.featureArray?this.featureArray.length:0,c=0;c<b;c++){var M=this.featureArray[c];if(M.mapping)for(var Z=0;Z<a;Z++)M.attributes[this.nsdpTitleArray[Z].toUpperCase()]=null;M.mapping=!1}this.mapping=!1}}},isValidId:function(a){for(var b=
this.featureArray?this.featureArray.length:0,c=0;c<b;c++)if(this.featureArray[c].id==a)return!1;return!0},getFeature:function(a){for(var b=this.featureArray?this.featureArray.length:0,c=0;c<b;c++)if(this.featureArray[c].id==a)return this.featureArray[c];return null},getFeaturesByAttribute:function(a,b){var c,M,Z,ba=!1,Y,sa,la,oa=this.featureArray?this.featureArray.length:0;if(0===oa)return null;a=a.toUpperCase();this.getAttributeNames().forEach(function(b){a===b.toUpperCase()&&(ba=!0)});if(!ba)return null;
var wa=b instanceof Array;wa&&(la=b.length);c=[];for(Z=0;Z<oa;Z++)if(M=this.featureArray[Z],(sa=M.getAttributeValue(a))&&wa)for(Y=0;Y<la;Y++)b[Y]===sa&&c.push(M);return c},getAllThemeData:function(a,b){this.getThemeData(null,a,b)},sendHttpRequest:function(b,c,n,M,Z,ba,Y){return a.util.HttpRequest.send(b,c,n,M,Z,ba,Y)},getThemeData:function(b,c,n){if(!this.usedInOverview)if(this.initError)c();else if(this.type===a.layer.VectorLayer.TYPE_GEORSS)this.getGeoRss(b,c,n);else if(this.type!==a.layer.VectorLayer.TYPE_LOCAL&&
this.loadOnDemand&&a.isNull(this.sessionId))this.getSessionId(b,c);else{a.notNull(this.getDataRequest)&&this.getDataRequest.abort();this.loading=!0;var M=this,Z=this.serverURL;this.type!==a.layer.VectorLayer.TYPE_DATAPACK&&(Z+="/dataserver/"+this.dataSource);var ba={};M.lastEvent=a.event.LayerEvent.VECTOR_LAYER_LOADING_THEME;(M.type===a.layer.VectorLayer.TYPE_PREDEFINED||M.type===a.layer.VectorLayer.TYPE_JDBC)&&M.parentMap&&a.notNull(M.boundingDataTask)&&M.boundingDataTask.update(.5);var Y=this.parentMap;
Y&&Y.applicationID&&(ba.applicationID=Y.applicationID);this.options&&(this.options.simplify&&(ba.simplify=this.options.simplify,this.options.threshold&&(ba.threshold=this.options.threshold),this.options.simplifyAlgorithm&&(ba.simplifyAlgorithm=this.options.simplifyAlgorithm)),this.options.dadp&&(ba.dadp=this.options.dadp));this.type===a.layer.VectorLayer.TYPE_PREDEFINED?(ba.t=this.themeName,a.notNull(this.workspace)&&"LIVE"!==this.workspace.toUpperCase()&&(ba.workspace=this.workspace)):this.type===
a.layer.VectorLayer.TYPE_JDBC&&(a.notNull(this.workspace)&&"LIVE"!==this.workspace.toUpperCase()&&(ba.workspace=this.workspace),ba.t=this.name,ba.sql=this.sql,this.keyColumn&&(ba.id_col=this.keyColumn),this.baseTable&&(ba.base_table=this.baseTable),this.geometryColumn&&(ba.geom_col=this.geometryColumn),this.jdbcSrid&&(ba.jdbc_srid=this.jdbcSrid));a.$.extend(ba,this.queryParameter);if(b)if(b.srid===a.util.BaiduUtil.SRID){var sa=new BMap.Pixel(b.getMinX(),b.getMinY());b=new BMap.Pixel(b.getMaxX(),b.getMaxY());
sa=Y.bdutil.project.pointToLngLat(sa);Y=Y.bdutil.project.pointToLngLat(b);ba.bbox=sa.lng+","+sa.lat+","+Y.lng+","+Y.lat}else ba.bbox=b.getMinX()+","+b.getMinY()+","+b.getMaxX()+","+b.getMaxY();Y=a.util.HttpRequest.getDomain(this.serverURL);Y||(Y=a.util.HttpRequest.localDomain);if(Y=a.gv.mvKeyMap[Y])ba.key=Y;this.type!==a.layer.VectorLayer.TYPE_DATAPACK&&(ba.include_label_box="true",Y=null,this.parentMap&&(Y=this.parentMap.getMapContext().getUniverse().getSRID()),Y&&(Y===a.util.BaiduUtil.SRID?(ba.to_srid=
8307,ba.bbox_srid=8307):(ba.to_srid=Y,ba.bbox_srid=Y)),this.sessionId&&(ba.ssid=this.sessionId),this.nsdp&&(ba.nsdp=this.getNSDPString()));this.type!==a.layer.VectorLayer.TYPE_DATAPACK&&(ba.refresh=Math.round(1E5*Math.random()));var Y=M.type===a.layer.VectorLayer.TYPE_DATAPACK?!0:!1,la=function(b){M.initError=!0;M.getDataRequest=null;b&&a.util.Logger.alert("MAPVIEWER_9006","OM.layer.VectorLayer.getThemeData",b.responseText);n&&n();b=a.event;var c=new b.LayerEvent(b.LayerEvent.INIT_ERROR,M);a.notNull(M.parentMap)&&
(c.mapContext=M.parentMap.getMapContext());null!==M.initTask&&(M.initTask.abort(),M.initTask=null);M.fire(b.LayerEvent.INIT_ERROR,c)};this.enableXHR&&(ba.$enableXHR=!0);sa=this.jsonp?"jsonp":"text";a.util.Logger.fine("","VectorLayer.getThemeData","["+M.name+"] Sending data loading request.");this.getDataRequest=this.sendHttpRequest(Z,ba,function(b){if(M.parentMap&&M.parentMap.graphics){M.dataLoaded=!0;var n,ma=!1;"string"===typeof b&&(M.lastEvent=a.event.LayerEvent.VECTOR_LAYER_PARSING_THEME,a.notNull(M.boundingDataTask)||
(M.boundingDataTask=M.startNewTask()),M.boundingDataTask.update(.75),b=b.trim(),ma=0===b.indexOf("{")||0===b.indexOf("["));try{"object"!==typeof b&&(b=a.$.parseJSON(b))}catch(fa){a.notNull(M.boundingDataTask)&&M.boundingDataTask.abort();ma&&a.util.Logger.warning(null,"OM.layer.VectorLayer.getThemeData",fa);try{b=a.$(a.$.parseXML(b));var w=b.find("oms_error");if(0<w.length){a.util.Logger.alert("MAPVIEWER_9007","OM.layer.VectorLayer.getThemeData",w.text());la();return}n=new a.layer.KMLParser(M);var z=
n.parse(b,c);z||(n=new a.layer.GeoRSSParser(M),z=n.parse(b,c),z||(a.util.Logger.alert("MAPVIEWER_9008","OM.layer.VectorLayer.getThemeData"),la()));return}catch(N){la();return}}M.getDataRequest=null;try{n=new a.layer.GeoJSONParser(M);n.parse(b,c,la);a.notNull(M.boundingDataTask)&&(M.boundingDataTask.complete(),M.boundingDataTask=null);var L=new a.event.LayerEvent(a.event.LayerEvent.FEATURES_LOADED,M);M.fire(a.event.LayerEvent.FEATURES_LOADED,L)}catch(K){a.util.Logger.warning("MAPVIEWER_9101","OM.layer.VectorLayer.getThemeData",
K.message),la()}}},sa,la,Y)}},getGeoRss:function(b,c,n){if(this.initError)c();else{this.loading=!0;var M=this;b=this.serverURL;var Z=function(b){M.initError=!0;M.getDataRequest=null;b&&a.util.Logger.alert("MAPVIEWER_9008","OM.layer.VectorLayer.getThemeData",b.responseText);n&&n();b=a.event;var c=new b.LayerEvent(b.LayerEvent.INIT_ERROR,M);c.mapContext=M.parentMap.getMapContext();M.fire(b.LayerEvent.INIT_ERROR,c)};this.attrNames=["link","updated","content","summary"];this.getDataRequest=this.sendHttpRequest(b,
{},function(b){var N=a.$(b).find("oms_error");0<N.length?(a.util.Logger.alert("MAPVIEWER_9008","OM.layer.VectorLayer.getThemeData",N.text()),Z()):(new a.layer.GeoRSSParser(M)).parse(b,c,n)||Z()},"xml",Z,!0,!0)}},isBoundingTheme:function(){return this.boundingTheme},loadBoundingTheme:function(b){var c=this,n=this.parentMap.getMapContext();this.orgWidth=this.orgWidth?this.orgWidth:n.getDeviceWidth();this.orgHeight=this.orgHeight?this.orgHeight:n.getDeviceHeight();var M=new a.event.LayerEvent(a.event.LayerEvent.FINISH_GOT_CONFIG,
this);a.notNull(this.boundingDataTask)&&(this.boundingDataTask=this.startNewTask());var Z=c.renderingStyle&&c.renderingStyle.hasBinding(),ba=a.notNull(c.nsdpData)&&a.notNull(c.nsdpKey),n=function(n){n||(n=(n=c.getExtent())?n.coordinates:null,(Z||ba)&&a.notNull(c.bfMbr)&&(n=c.bfMbr.coordinates));n?(c.dataLoaded=!0,b?b(n[0],n[1],n[2],n[3]):(M.bbox=[n[0],n[1],n[2],n[3]],M.mapContext=c.parentMap.getMapContext(),c.fire(a.event.LayerEvent.FINISH_GOT_CONFIG,M),a.notNull(c.boundingDataTask)&&(c.boundingDataTask.complete(),
c.boundingDataTask=null))):(c.dataLoaded=!1,Y())},Y=function(){c.loadedBoundingTheme=!0;a.util.Logger.warning("MAPVIEWER_9049","OM.layer.VectorLayer.loadBoundingTheme",c.name);var n=c.parentMap.getMapContext(),Y=n.getUniverse().getMapBounds();b?b(Y.getMinX(),Y.getMinY(),Y.getMaxX(),Y.getMaxY()):(M.bbox=[Y.getMinX(),Y.getMinY(),Y.getMaxX(),Y.getMaxY()],M.mapContext=n,a.notNull(c.boundingDataTask)&&(c.boundingDataTask.abort(),c.boundingDataTask=null),c.fire(a.event.LayerEvent.FINISH_GOT_CONFIG,M))},
sa;this.mbr?(sa=this.mbr,n([sa.getMinX(),sa.getMinY(),sa.getMaxX(),sa.getMaxY()])):!this.loadOnDemand&&this.dataLoaded||this.type===a.layer.VectorLayer.TYPE_LOCAL?(sa=this.getExtent(),(Z||ba)&&a.notNull(this.bfMbr)&&(sa=this.bfMbr),a.isNull(sa)&&(sa=this.parentMap.getMapContext().getUniverse().getMapBounds()),n([sa.getMinX(),sa.getMinY(),sa.getMaxX(),sa.getMaxY()])):this.getAllThemeData(n,Y)},calculateCenterAndZoomLevel:function(b,c,n,M){var Z=this.parentMap.getMapContext(),ba=Z.getUniverse();if(0===
b&&0===c&&0===n&&0===M)return[Z.getZoomLevel(),Z.getCenterPoint()];if(this.type===a.layer.VectorLayer.TYPE_LOCAL)M=this.getExtent(),this.renderingStyle&&this.renderingStyle.hasBinding()&&a.notNull(this.bfMbr)&&(M=this.bfMbr),a.isNull(M)&&(M=this.parentMap.getMapContext().getUniverse().getMapBounds()),b=M.getMinX(),c=M.getMinY(),n=M.getMaxX(),M=M.getMaxY();else if(a.isNull(this.mbr)){var Y=ba.getSRID();this.mbr=new a.geometry.Rectangle(b,c,n,M,Y)}for(var Y=(n-b)/Z.getDeviceWidth(),Z=(M-c)/Z.getDeviceHeight(),
sa=ba.getZoomLevels(),la=ba.getZoomLevelNumber(),oa=null,wa=0;wa<la;wa++)if(Y>sa[wa].resolution||Z>sa[wa].resolution*sa[wa].stretchRatio){oa=0===wa?0:wa-1;break}a.isNull(oa)&&(oa=a.gv.pointZoomLevel===a.gv.MID_ZOOM?Math.floor(la/2):la-1);this.loadedBoundingTheme=!0;this.boundingZoomLevel=oa;return[oa,new a.geometry.Point((b+n)/2,(c+M)/2,ba.getSRID())]},getLayerConfig:function(){var b=new a.event.LayerEvent(a.event.LayerEvent.FINISH_GOT_CONFIG,this);b.mapContext=this.parentMap.getMapContext();this.initTask=
this.startNewTask();this.initTask.update(.25);this.fire(a.event.LayerEvent.FINISH_GOT_CONFIG,b)},setCenterAndZoomlevel:function(a){this.refreshImpl(a,!1)},recenter:function(a){if(this.displayed){var b=this.dataBufferWindow,c=b.x+b.w/2,M=b.y+b.h/2,b=this.parentMap.getMapContext(),Z=b.getUniverse(),ba=b.getRoundMapCenterPoint(),Y=b.getCenterPoint(),Z=Z.getZoomLevels()[b.getZoomLevel()];this.refreshCenterX||(this.refreshCenterX=c);c=this.parentMap.wraparound?Math.abs(ba.getX()-this.refreshCenterX)/Z.resolution:
Math.abs(Y.getX()-c)/Z.resolution;M=Math.abs(Y.getY()-M)/Z.resolution*Z.stretchRatio;Y=(this.orgHeight*this.yRatio-this.orgHeight)/2;(this.orgWidth*this.xRatio-this.orgWidth)/2<c||Y<M?(this.clearFeatureShapes(),this.featureGroupArr?this.featureGroupArr.length=0:this.featureGroupArr=[],this.parentMap.wraparound&&(this.refreshCenterX=b.getRoundMapCenterPoint().getX()),this.loaded=!1,this.areaIdx=0,this.refreshImpl(a,!1)):this.refreshShadowGeom()}else this.parentMap&&this.parentMap.initialized&&(this.loaded=
!1,this.refreshImpl(a,!1))},checkVisible:function(){return this.isInZoomLevelRange()&&this.isVisible()?!0:!1},clearFeatureShapes:function(){this.parentMap.graphics.clearGroup(this.group);for(var b=(this.featureArray?this.featureArray.length:0)-1;0<=b;b--){var c=this.featureArray[b];c.clearAnimation();c.animations=null;c.moveAnimation&&(this.parentMap.wraparound?c.stopMoveAnimation():c.pauseMoveAnimation());c.group=null;c.screenTransformObj=null;c.graphics=null;c.displayed=!1;c.inCluster=!1;c.markerSize=
null;if(c.shapeGroup){for(var n=c.shapeGroup.length,M=0;M<n;M++)c.shapeGroup[M].feature=null;c.shapeGroup=null}else c.shape&&(this.parentMap.graphics.remove(c.shape),c.shape.feature=null,c.shape=null);c.labelShape&&(c.labelShape.feature=null);c.labelShape=null;c.ghostShape&&(c.ghostShape.feature=null);c.ghostShape=null;c.ghostGeom=null;a.notNull(c.shapeArray)&&(c.shapeArray=null);a.notNull(c.chartGroup)&&(c.chartGroup=null)}this.featureGroupArr=this.labelGroup=this.realGroup=this.lineGroup=null;this.vCluster&&
this.vCluster.clearAllClusterFeatures();this.heatMap&&(b=a.$(this.getHeatmapDivId()),0<b.length&&b.empty());this.areaIdx=0;this.emptyCustomLayer();this.displayed=!1;this.tileFeatureGroup={}},getCustomLayerDiv:function(){var b=this.getCustomLayerDivId(),c=a.$("#"+b);0>=c.length&&a.notNull(this.parentMap)&&(b=a.$("\x3cdiv id\x3d'"+b+"' style\x3d'position:absolute;'\x3e"),b.css({display:"block",left:"0px",top:"0px",width:"0px",height:"0px","z-index":5}),this.parentMap.$topLayerDIV.append(b),b.on("mouseout",
function(a){a.stopPropagation()}),c=b);return c},getHeatmapDivId:function(){return"#"+this.getDivId("heatmap_")},getCustomLayerDivId:function(){return this.getDivId("customDiv")},getDivId:function(a){return(a+this.parentMap.mapInstanceId+"_"+this.name).replace(/([ #;?%&,.+*~\':"!^$[\]()=>|\/@])/g,"\\$1")},showInfoWindow:function(b,c){var n="",M=b.attributes;if(M||this.type===a.layer.VectorLayer.TYPE_LOCAL){var Z=0,ba,Y;if(b.InfoHtml)n=b.InfoHtml;else if(this.attrNames&&0<this.attrNames.length){for(var sa=
this.attrNames.length,la=[],oa=0;oa<sa;oa++){ba=this.attrNames[oa];var wa=ba.toUpperCase();Y="#bbbbbb";0===Z%2&&(Y="#dddddd");"_LABEL_"!=wa&&b.attributes[wa]&&-1===la.indexOf(wa)&&(Z++,(ma=b.attributes[wa])?"string"!==typeof ma||a.util.DomUtil.isHtml(ma)||(ma=ma.replace(/\s/g,"\x26nbsp;")):ma="",n+="\x3ctr bgcolor\x3d'"+Y+"'\x3e\x3ctd align\x3d'right'\x3e"+ba+"\x3c/td\x3e\x3ctd align\x3d'left'\x3e"+ma+"\x3c/td\x3e\x3c/tr\x3e",la.push(wa))}n="\x3ctable cellspacing\x3d'2' style\x3d'margin: auto;border-spacing: 2px;border-collapse: separate;'\x3e"+
n+"\x3c/table\x3e"}else if(this.type===a.layer.VectorLayer.TYPE_DATAPACK||this.type===a.layer.VectorLayer.TYPE_LOCAL){for(ba in b.attributes){var ma=b.attributes[ba];ma&&("string"===typeof ma&&(ma=ma.replace(/\s/g,"\x26nbsp;")),Y="#bbbbbb",0===Z%2&&(Y="#dddddd"),Z++,"_LABEL_"!==ba&&(n+="\x3ctr bgcolor\x3d'"+Y+"'\x3e\x3ctd align\x3d'right'\x3e"+ba+"\x3c/td\x3e\x3ctd align\x3d'left'\x3e"+ma+"\x3c/td\x3e\x3c/tr\x3e"))}if(0===Z)return;n="\x3ctable cellspacing\x3d'2' style\x3d'margin: auto;border-spacing: 2px;border-collapse: separate;'\x3e"+
n+"\x3c/table\x3e"}else return;Z={};b.label?(M=(b.label+"").replace(/ /g,"\x26nbsp;"),Z.title=M):M&&a.notNull(M._LABEL_)&&(M=(b.attributes._LABEL_+"").replace(/ /g,"\x26nbsp;"),Z.title=M);M=this.parentMap;c||(c=M.getCursorLocation());Z.id=this.name+"_"+b.id;a.notNull(c)?M.displayInfoWindow(c,n,Z):M.displayInfoWindow(b.getGeometry(),n,Z)}},getSessionId:function(a,b){var c=this;this.sendHttpRequest(this.serverURL+"/dataserver/"+this.dataSource,{get_session_id:"yes"},function(M){c.sessionId=M;c.getThemeData(a,
b)},"text")},removeGraphics:function(){this.clearSelectedFeatures();if(this.group){var a=this.parentMap.graphics;this.clearFeatureShapes();a.remove(this.group);this.group=null}},changeVisibleBound:function(){this.type!=a.layer.VectorLayer.TYPE_PREDEFINED||this.loadOnDemand||this.clearFeatureShapes();this.refreshImpl()},changeOpacity:function(){this.parentMap&&this.parentMap.graphics&&this.parentMap.graphics.applyStyle(this.group,{opacity:this.opacity});if(this.parentMap&&this.heatMap&&a.notNull(this.heatmapStore)){var b=
this.heatmapStore,c=b.srcHeatmapCanvas,n=b.dstHeatmapCanvas;if(!a.isNull(c)&&!a.isNull(n)){var M=n.getContext("2d"),Z=M.globalAlpha;M.globalAlpha=this.opacity;M.clearRect(0,0,n.width,n.height);M.drawImage(c,b.srcx,b.srcy,b.srcw,b.srch,b.dstx,b.dsty,b.dstw,b.dsth);M.globalAlpha=Z}}},getNSDPXML:function(){if(!this.nsdp)return"";var a;a='\x3cns_data_provider provider_id\x3d"defaultNSDP"\x3e'+('\x3cfor_theme name\x3d"'+this.name+'"/\x3e');a+='\x3cjoin spatial_key_column\x3d"'+this.nsdpKey+'"/\x3e';a+=
"\x3cparameters\x3e";this.nsdp.xml?a+='\x3cparameter name\x3d"xml" value\x3d"'+this.nsdp.xml.replace(/</g,"\x26lt;")+'"/\x3e':this.nsdp.url&&(a+='\x3cparameter name\x3d"xml_url" value\x3d"'+this.nsdp.url+'"/\x3e');return a+="\x3c/parameters\x3e\x3c/ns_data_provider\x3e"},selectAllFeatures:function(){for(var a=this.featureArray?this.featureArray.length:0,b=0;b<a;b++){var c=this.featureArray[b];this.selectionEnable&&!c.selected&&(c.oldStyle||(c.oldStyle=c.renderingStyle),c.setRenderingStyle(this.selectionStyle),
this.selectedFeatures?this.selectedFeatures.push(c):this.selectedFeatures=Array(c),c.selected=!0)}return null},addMarkerBoundToGrid:function(){var b=this.getFeatureGeometryType();if(""!==b&&"LINESTRING"!==b&&"POLYGON"!==b){for(var b=this.featureArray?this.featureArray.length:0,c=0;c<b;c++){var n=this.featureArray[c];if(n.displayed&&n.screenPoints){var M=n.screenPoints.x,Z=n.screenPoints.y,ba,Y;n.markerSize?(ba=n.markerSize.w,Y=n.markerSize.h):(Y=n.renderingStyle?n.renderingStyle:this.otherStyles&&
0<this.otherStyles.length?this.otherStyles[0]:this.getDefaultRenderingStyle(n.geo.type),a.notNull(Y.lengthUnit)?(ba=Y.realWidthInPx?Y.realWidthInPx:Y.width,Y=Y.realHeightInPx?Y.realHeightInPx:Y.height):(ba=Y.realWidth?Y.realWidth:Y.width,Y=Y.realHeight?Y.realHeight:Y.height),n.markerSize={w:ba,h:Y});this.parentMap.grid.insert([M-ba/2,Z-Y/2,M+ba/2,Z+Y/2])}}this.vCluster&&this.vCluster.addClusterFeatureToLabelGrid()}},addLabels:function(){if(this.group){var a=this.featureArray?this.featureArray.length:
0,b=this.parentMap.getMapContext(),c=b.getWholeMapNum(),M=b.getBaseWholeMapIndex();this.labelGroupArray?this.labelGroupArray.length=0:this.labelGroupArray=[];for(var Z=0;Z<c;Z++)if(this.labelGroup||(this.labelGroup=this.parentMap.graphics.createGroup({opacity:this.opacity,visibility:!0}),this.group.appendChild(this.labelGroup)),1<c){var ba=b.getUniverse().getZoomLevels()[b.getZoomLevel()].resolution,Y=b.getUniverse().getMapBounds().getWidth(),sa=(b.getCenterPoint().getX()-b.getRoundMapCenterPoint().getX())/
ba;this.labelGroup.translate((Z-M)*Y/ba-sa,0);this.labelGroupArray||(this.labelGroupArray=[]);this.labelGroupArray.push(this.labelGroup);this.labelGroup=null}this.shadow&&this.getShadowArea();1<c&&(this.labelGroup=this.labelGroupArray[0]);for(b=0;b<a;b++)if(M=this.featureArray[b],!M.labelShape&&(M.addLabel(this.parentMap.grid),M.labelShape))for(M.labelShapeArr=[],Z=1;Z<c;Z++)if(ba=this.parentMap.graphics.cloneText(M.labelShape))ba.applyStyle({cursor:this.mouseCursor}),ba.feature=M,this.labelGroupArray[Z].appendChild(ba),
M.labelShapeArr.push(ba)}},clearAllLabels:function(){this.mask=null;this.labelGroup&&this.parentMap.graphics.clearGroup(this.labelGroup);if(this.labelGroupArray){for(var a=0;a<this.labelGroupArray.length;a++)this.parentMap.graphics.clearGroup(this.labelGroupArray[a]);this.labelGroupArray.length=0}for(var a=this.featureArray?this.featureArray.length:0,b=0;b<a;b++){var c=this.featureArray[b];c.labelShape&&(c.labelShape.feature=null,c.labelShape=null)}},enableDisplayInBatch:function(a,b){if(this.enableBatch=
a)this.batchInterval=b&&b.interval?b.interval:200,this.numberInBatch=b&&b.numberInBatch?b.numberInBatch:100},enableClustering:function(b,c){if(this.clustering=b)this.vCluster=new a.layer.VectorLayerCluster(this,c),a.notNull(c)?a.notNull(c.clickBehavior)&&"select"===c.clickBehavior?this.vClusterClickToZoomToMBR=!1:this.vClusterClickToZoomToMBR=!0:this.vClusterClickToZoomToMBR=!0;this.maxClusteringLevel=c&&c.maxClusteringLevel?c.maxClusteringLevel:100;this.clickZoomInLevels=-1;c&&!1===c.enableZoomIn?
this.clickZoomInLevels=0:c&&c.zoomInLevels&&(this.clickZoomInLevels=parseInt(c.zoomInLevels))},getFeatureIndex:function(a){var b=this.featureArray.length;if(0===b)return-1;for(var c=0;c<b;c++)if(this.featureArray[c]==a)return c+1;return-1},bringFeatureForward:function(a){var b=a.parentLayer.parentMap.getMapContext().getGraphics();if(a.displayed&&a.shape){if(a.shapeGroup&&1<a.shapeGroup.length)for(var c=0;c<a.shapeGroup.length;c++)b.bringForward(a.shapeGroup[c]);else b.bringForward(a.shape);a.labelShape&&
b.bringForward(a.labelShape)}},sendFeatureBackward:function(a){var b=a.parentLayer.parentMap.getMapContext().getGraphics();if(a.displayed&&a.shape)if(a.labelShape&&b.sendBackward(a.labelShape),a.shapeGroup&&1<a.shapeGroup.length)for(var c=0;c<a.shapeGroup.length;c++)b.sendBackward(a.shapeGroup[c]);else b.sendBackward(a.shape)},bringFeatureToTop:function(a){var b=a.parentLayer.parentMap.getMapContext().getGraphics();if(a.displayed&&a.shape){if(a.shapeGroup&&1<a.shapeGroup.length)for(var c=0;c<a.shapeGroup.length;c++)b.bringToTop(a.shapeGroup[c]);
else b.bringToTop(a.shape);a.labelShape&&b.bringToTop(a.labelShape)}},sendFeatureToBottom:function(a){var b=a.parentLayer.parentMap.getMapContext().getGraphics();if(a.displayed&&a.shape)if(a.labelShape&&b.sendToBottom(a.labelShape),a.shapeGroup&&1<a.shapeGroup.length)for(var c=0;c<a.shapeGroup.length;c++)b.sendToBottom(a.shapeGroup[c]);else b.sendToBottom(a.shape)},getTargetFeature:function(b){if(a.isNull(b))return null;for(var c=b.feature;a.isNull(c)&&b.parentNode;)b=b.parentNode,c=b.feature;return c},
getLineGroup:function(){if(!this.lineGroup){this.lineGroup=[];for(var a=this.parentMap.graphics,b=0;4>b;b++)this.lineGroup[b]=a.createGroup(),this.realGroup.appendChild(this.lineGroup[b])}return this.lineGroup},redraw:function(a){var b=this.parentMap.getMapContext();this.orgWidth=b.getDeviceWidth();this.orgHeight=b.getDeviceHeight();this.setWindow();this.clearFeatureShapes();this.refreshImpl(null,null,a)},calculateLayerGradientBound:function(){var a=this.parentMap.getMapContext(),b=a.getUniverse(),
c=a.getMapCenter(),b=b.getZoomLevels()[a.getZoomLevel()],a=(c.getX()-this.minX)/b.resolution,c=(c.getY()-this.minY)/b.resolution/b.stretchRatio;return{x1:a-this.orgWidth/2,y1:c-this.orgHeight/2,x2:a+this.orgWidth/2,y2:c+this.orgHeight/2,useObjectBoundingBox:!1}},clearLayer:function(){this.removeGraphics();var b=this.featureArray?this.featureArray.length:0;if(this.type===a.layer.VectorLayer.TYPE_LOCAL)for(--b;0<=b;b--)this.featureArray[b].deleteAllListeners();else this.featureArray=null;this.transform=
null;this.dataLoaded=!1;this.bfMbr=this.mbr=this.vCluster=null;this.vmf&&(this.vmf.destroy(),this.vmf=null);this.draggingFeature&&(this.parentMap.$oracleMapDiv.unbind("mousemove",this.draggingFeature),this.parentMap.$oracleMapDiv.unbind("touchmove",this.draggingFeature_touch),a.Hammer(this.parentMap.$oracleMapDiv[0]).off("drag",this.draggingFeature_win8Touch));this.draggingFeature=null;this.endFeatureDragging&&(a.$(document).unbind("mouseup",this.endFeatureDragging),a.$(document).unbind("mouseout",
this.endFeatureDragging),this.parentMap.$oracleMapDiv.unbind("touchend",this.endFeatureDragging_touch));this.toolTipCustomizer=this.endFeatureDragging=null},destroy:function r(){this.clearLayer();r.base.call(this)},addSecondaryStyle:function(a){this.parentMap&&this.isServerSideStyle(a,"secondary")||(this.otherStyles?this.otherStyles.push(a):this.otherStyles=[a])},removeSecondaryStyle:function(a){if(null===this.otherStyles)return null;for(var b=this.otherStyles.length,c=0;c<b;c++)if(this.otherStyles[c]===
a)return this.otherStyles.splice(c,1),a;return null},setVisibleImpl:function(){a.isNull(this.parentMap)||(this.heatMap&&a.$(this.getHeatmapDivId()).toggle(this.visible),this.getCustomLayerDiv().toggle(this.visible),this.group&&this.parentMap&&this.parentMap.graphics&&this.parentMap.graphics.applyStyle(this.group,{display:this.visible}),this.visible&&this.parentMap&&this.parentMap.displayed&&!this.displayed&&(this.type===a.layer.VectorLayer.TYPE_LOCAL||this.dataLoaded||this.initError?this.displayFeatures():
this.refresh(null,!1)),this.parentMap&&this.parentMap.displayed&&this.parentMap.refreshVectorLayerLabels())},clone:function n(b,c,ba){var Y=n.base.call(this,b);Y.getDataRequest=null;Y.boundingTheme=!1;Y.sessionId=null;this.renderingStyle&&"HeatMap"==this.renderingStyle.styleType&&this.renderingStyle.containerVectorLayer&&(Y.renderingStyle=this.renderingStyle.clone(),Y.renderingStyle.containerVectorLayer=Y.renderingStyle.containerVectorLayer.clone("over_"+Y.renderingStyle.containerVectorLayer.name,
!0,!0),Y.heatMap=null);if(Y.displayed||Y.dataLoaded)for(Y.featureArray=[],b=this.featureArray.length,c=0;c<b;c++)ba=this.featureArray[c].clone(),ba.parentLayer=Y,Y.featureArray.push(ba);else c&&(Y.usedInOverview=!0,Y.containerLayer=ba,b=a.event,Y.copyFeatures=function(a){a=a.target;Y.featureArray=[];for(var b=a.featureArray.length,c=0;c<b;c++){var n=a.featureArray[c].clone();Y.featureArray.push(n)}Y.dataLoaded=!0;Y.containerLayer||Y.displayFeatures()},this.on(b.LayerEvent.FEATURES_LOADED,Y.copyFeatures));
Y.displayed=!1;Y.group=null;Y.realGroup=null;Y.labelGroup=null;Y.lineGroup=null;Y.graphics=null;return Y},displayHeatMap:function(){this.loaded=!1;var b=this.featureArray?this.featureArray.length:0,c=this.parentMap.getMapContext(),Z=c.getUniverse().getSRID(),ba=c.getTransform();this.yRatio=this.xRatio=1.2;this.setWindow();var Y=this.orgWidth*this.xRatio,sa=this.orgHeight*this.yRatio,la=ba.toScreenPoint(this.dataBufferWindow.x,this.dataBufferWindow.y+this.dataBufferWindow.h);this.heatMap||(this.heatMap=
this.createVectorLayerHeatMap());this.styleAttributes&&0<this.styleAttributes.length&&(this.heatMap.isValued=!0);a.style.Style.calculateStyleSize(this.renderingStyle,c);this.heatMap.init(Y,sa,la.x,la.y,this.renderingStyle.spotlightRadius);for(var oa=this,wa=0,c=function(a){return function(){ma.transform(Z,function(b){wa--;a.srid=Z;a.geo=b;oa.addFeatureToHeatMap(a,la)})}()},ba=0;ba<b;ba++){var Y=this.featureArray[ba],ma=Y.getGeometry();if(this.type===a.layer.VectorLayer.TYPE_MAPBOX){if("POINT"!==this.getFeatureGeometryType())continue}else if("Point"!=
ma.type&&"OrientedPoint"!=ma.type&&"MultiPoint"!=ma.type&&"OrientedMultiPoint"!=ma.type)continue;Z!==ma.srid?(wa++,c(Y)):oa.addFeatureToHeatMap(Y,la)}var fa=function(b,c,L,n,w,fa,p,ma,S,M){var v="heatmap_"+oa.parentMap.mapInstanceId+"_"+oa.name,wa=a.$("#"+v);0===wa.length?(wa=a.$("\x3cdiv id\x3d'"+v+"' style\x3d'position:absolute;'\x3e"),oa.parentMap.$heatMapDiv.append(wa)):wa.empty();oa.renderingStyle.isTop?oa.parentMap.$heatMapDiv.css({"z-index":"5"}):oa.parentMap.$heatMapDiv.css({"z-index":"2"});
wa.css({display:"block",left:"0px",top:"0px",width:oa.orgWidth+"px",height:oa.orgHeight+"px"});var v=oa.parentMap.getMapContext(),Y=v.getUniverse(),ra=v.getZoomLevel(),ra=Y.getZoomLevels()[ra],Z=v.getCenterPoint(),Y=(oa.dataBufferWindow.x-Z.getX())/ra.resolution+v.getDeviceWidth()/2,v=(Z.getY()-oa.dataBufferWindow.y-oa.dataBufferWindow.h)/ra.resolution/ra.stretchRatio+v.getDeviceHeight()/2;b.style.cssText="position:absolute;left:"+Y+"px;top:"+v+"px;";v=b.getContext("2d");Y=v.globalAlpha;v.globalAlpha=
oa.opacity;v.clearRect(0,0,b.width,b.height);v.drawImage(c,L,n,w,fa,p,ma,S,M);wa[0].appendChild(b);v.globalAlpha=Y;oa.heatmapStore={srcHeatmapCanvas:c,dstHeatmapCanvas:b,srcx:L,srcy:n,srcw:w,srch:fa,dstx:p,dsty:ma,dstw:S,dsth:M};oa.displayed=!0;a.util.Logger.finest("","OM.VectorLayer.displayHeatMap","["+oa.name+"] display heat map completed");oa.displayEnd()},w=function(){0!==wa||oa.heatMap.loadingBoundaray?setTimeout(w,100):oa.heatMap.drawHeatMap(fa)};w()},createVectorLayerHeatMap:function(){return new a.layer.VectorLayerHeatMap(this.renderingStyle,
this)},addFeatureToHeatMap:function(b){b.parentLayer=this;var c=1,c=b.geo;if(!a.isNull(c)){var Z=[c];"GeometryCollection"===c.type&&(Z=a.notNull(c.geometries)&&0<c.geometries.length?c.geometries:null);if(!a.isNull(Z)){var ba=this.parentMap.getMapContext().getTransform(),c=a.notNull(this.styleAttributes)&&0<this.styleAttributes.length?Number(b.getAttributeValue(this.styleAttributes[0])):this.renderingStyle.getDataValueFromBinding(b);if(isNaN(c)||a.isNull(c))c=1;for(var Y=this.dataBufferWindow,sa,la,
oa=this.parentMap.getMapContext().getZoomLevel(),wa=0;wa<Z.length;wa++){var ma=Z[wa];if("Point"===ma.type||"OrientedPoint"===ma.type){if(sa=ma.coordinates[0],la=ma.coordinates[1],!(sa<Y.x||la<Y.y||sa>Y.x+Y.w||la>Y.y+Y.h)){if(b.tiledFeature&&(ma=b.zoomLevelsGeomClipArea["zoomlevel_"+oa][wa],sa<ma.getMinX()||sa>ma.getMaxX()||la<ma.getMinY()||la>ma.getMaxY()))continue;sa=ba.toHeatMapPoint(sa,la,0,0,this.heatMap.scale);this.heatMap.addData(sa.x,sa.y,c)}}else if("MultiPoint"==ma.type||"OrientedMultiPoint"==
ma.type)for(var fa=ma.coordinates.length,w=0;w<fa;w++)if(sa=ma.coordinates[w][0],la=ma.coordinates[w][1],!(sa<Y.x||la<Y.y||sa>Y.x+Y.w||la>Y.y+Y.h)){if(b.tiledFeature){var z=b.zoomLevelsGeomClipArea["zoomlevel_"+oa][wa];if(sa<z.getMinX()||sa>z.getMaxX()||la<z.getMinY()||la>z.getMaxY())continue}sa=this.screenTransformObj.toHeatMapPoint(sa,la,0,0,this.heatMap.scale);this.heatMap.addData(sa.x,sa.y,c)}}}}},pan:function(){if(!a.isNull(this.parentMap)&&this.displayed){var b=this.parentMap.getMapContext(),
c=b.getCenterPoint(),Z=this.dataBufferWindow.x+this.dataBufferWindow.w/2-c.getX(),c=this.dataBufferWindow.y+this.dataBufferWindow.h/2-c.getY(),b=b.getTransform(),Z=b.toScreenXLength(Z),c=b.toScreenYLength(-c);this.heatMap&&(b=a.$(this.getHeatmapDivId()),0<b.length&&b.css({left:Z,top:c}));b=this.getCustomLayerDiv();0<b.length&&b.css({left:Z,top:c})}},getHoverSelectStyle:function(b,c){if("Color"!=b.styleType)return b;var Z=c.oldStyle,ba=c.geo.type;if(Z.resolve){var Y=Z.resolve(c);Y&&(Z=Y)}Y={};"Marker"!=
Z.styleType||"Point"!=ba&&"MultiPoint"!=ba&&"OrientedPoint"!=ba&&"OrientedMultiPoint"!=ba?"Line"!=Z.styleType||"LineString"!=ba&&"MultiLineString"!=ba?"LinearGradient"==Z.styleType||"RadialGradient"==Z.styleType?(a.$.extend(Y,Z,b.origConfig),Y.stops1&&(Y.stops=Y.stops1)):(a.$.extend(Y,Z,b.origConfig),Y.bindings=b.bindings):(ba={},a.$.extend(ba,Z,b.origConfig),Y=new a.style.Line(ba)):Z.vectorDef&&0<Z.vectorDef.length&&Z.vectorDef[0].style?(a.$.extend(!0,Y,Z),a.$.extend(Y.vectorDef[0].style,b.origConfig),
Y.bindings=[]):Y=b;return Y},setToolTipCustomizer:function(a){a&&"function"===typeof a&&(this.toolTipCustomizer=a)},enableToolTip:function(a){this.showToolTip=a;this.displayed&&this.redraw()},enableIndicatorFeatures:function(a,b){if(this.shadow=a)this.setLabelsVisible(!0),this.leadLine=b&&b.leadLine?b.leadLine:!1,this.maxIndicators=b&&b.maxIndicators?b.maxIndicators:8,0===b.maxIndicators&&(this.maxIndicators=0),this.shadowLev={},this.shadowLev.min=b&&b.enabledZoomLevels&&b.enabledZoomLevels.min?b.enabledZoomLevels.min:
0,this.shadowLev.max=b&&b.enabledZoomLevels&&b.enabledZoomLevels.max?b.enabledZoomLevels.max:9,this.indicatorSize={},this.indicatorSize.w=b&&b.indicatorSize&&b.indicatorSize.width/10?b.indicatorSize.width/10:4,this.indicatorSize.h=b&&b.indicatorSize&&b.indicatorSize.height/10?b.indicatorSize.height/10:3,this.indicatorPos=b&&b.position?b&&b.position:3,"object"!=typeof this.indicatorPos&&(this.shadowAnchor=this.indicatorPos)},getShadowArea:function(){if(this.shadow){this.ghostNum=-1;var b=this.parentMap.getMapContext(),
c=b.getUniverse(),Z,ba;if(b.getZoomLevel()<=this.shadowLev.max&&b.getZoomLevel()>=this.shadowLev.min){if(1===this.shadowAnchor||3===this.shadowAnchor)Z=b.getDeviceWidth()/2-5,ba=b.getDeviceHeight()/2;if(4===this.shadowAnchor||6===this.shadowAnchor)Z=b.getDeviceWidth()/2-5,ba=b.getDeviceHeight()/2-10;var Y=b.getZoomLevel();Z*=c.getZoomLevels()[Y].resolution;ba=ba*c.getZoomLevels()[Y].resolution*c.getZoomLevels()[Y].stretchRatio;this.transformLon=10*c.getZoomLevels()[Y].resolution;this.transformLat=
10*c.getZoomLevels()[Y].resolution*c.getZoomLevels()[Y].stretchRatio;b=b.getCenterPoint();Y=Math.round(this.maxIndicators/2);1===this.shadowAnchor?this.shadowArea=new a.geometry.Rectangle(b.getX()-Z,b.getY()+ba,b.getX()-Z+this.indicatorSize.w*this.transformLon,b.getY()+ba+this.indicatorSize.h*this.transformLat,c.srid):3===this.shadowAnchor?this.shadowArea=new a.geometry.Rectangle(b.getX()+Z-this.indicatorSize.w*this.transformLon,b.getY()+ba,b.getX()+Z,b.getY()+ba+this.indicatorSize.h*this.transformLat,
c.srid):4===this.shadowAnchor?this.shadowArea=new a.geometry.Rectangle(b.getX()+Z-this.indicatorSize.w*this.transformLon,b.getY()-ba+Y*this.indicatorSize.h*this.transformLat+Y*this.transformLat,b.getX()+Z,b.getY()-ba+Y*this.indicatorSize.h*this.transformLat+Y*this.transformLat+this.indicatorSize.h*this.transformLat,c.srid):6===this.shadowAnchor?this.shadowArea=new a.geometry.Rectangle(b.getX()-Z,b.getY()-ba+Y*this.indicatorSize.h*this.transformLat+Y*this.transformLat,b.getX()-Z+this.indicatorSize.w*
this.transformLon,b.getY()-ba+Y*this.indicatorSize.h*this.transformLat+Y*this.transformLat+this.indicatorSize.h*this.transformLat,c.srid):this.indicatorPos&&this.indicatorPos instanceof a.geometry.Point&&(this.shadowArea=new a.geometry.Rectangle(this.indicatorPos.getX(),this.indicatorPos.getY(),this.indicatorPos.getX()+this.indicatorSize.w*this.transformLon,this.indicatorPos.getY()+this.indicatorSize.h*this.transformLat))}else this.shadowArea=null}},createShadowGeometry:function(b){if(!this.shadowArea)return null;
var c=this.maxIndicators,Z=b.getGeometry(),ba=Z.getMBR();if(Z.getType()===a.GeomTypes.POLYGON||Z.getType()===a.GeomTypes.MULTIPOLYGON||Z.mbr){var Y=this.parentMap.getMapContext().getQueryWindow();if(!(ba.getMaxX()>Y.getMaxX()||ba.getMinX()<Y.getMinX()||ba.getMinY()<Y.getMinY()||ba.getMaxY()>Y.getMaxY())){this.ghostNum++;var sa;if(0!==c){if(this.ghostNum<Math.round(c/2)||this.leadLine&&this.ghostNum<c)sa=new a.geometry.Rectangle(this.shadowArea.getMinX(),this.shadowArea.getMinY()-(this.indicatorSize.h+
1)*this.transformLat,this.shadowArea.getMaxX(),this.shadowArea.getMaxY()-(this.indicatorSize.h+1)*this.transformLat,Z.srid);else if(this.ghostNum==Math.round(c/2)&&1!==c){if(3==this.shadowAnchor||4==this.shadowAnchor)sa=new a.geometry.Rectangle(this.shadowArea.getMinX()-(this.indicatorSize.w+1)*this.transformLon,this.shadowArea.getMinY(),this.shadowArea.getMaxX()-(this.indicatorSize.w+1)*this.transformLon,this.shadowArea.getMaxY(),Z.srid);1!=this.shadowAnchor&&6!=this.shadowAnchor&&this.shadowAnchor||
(sa=new a.geometry.Rectangle(this.shadowArea.getMinX()+(this.indicatorSize.w+1)*this.transformLon,this.shadowArea.getMinY(),this.shadowArea.getMaxX()+(this.indicatorSize.w+1)*this.transformLon,this.shadowArea.getMaxY(),Z.srid))}else Math.round(c/2)<this.ghostNum&&this.ghostNum<c&&(sa=new a.geometry.Rectangle(this.shadowArea.getMinX(),this.shadowArea.getMinY()+(this.indicatorSize.h+1)*this.transformLat,this.shadowArea.getMaxX(),this.shadowArea.getMaxY()+(this.indicatorSize.h+1)*this.transformLat,Z.srid));
this.shadowArea=sa;this.addToRtree(b,sa);return sa}}}},refreshShadowGeom:function(){if(this.shadow&&this.showLabels){var a=this.featureArray,b=a.length;this.getShadowArea();for(var c=0;c<b;c++){var ba=a[c];if(ba.displayed&&ba.label&&(ba.removeGhostShape(),!ba.labelShape)){var Y=this.createShadowGeometry(ba);Y&&(ba.drawGhostGeom(Y,[ba.renderingStyle]),ba.drawGhostLabel(Y))}}}},createRtree:function(){if(!a.notNull(this.rtree)){console&&console.time&&"finest"===a.gv.getLogLevel()&&a.util.Logger.finest("",
"OM.VectorLayer.createRtree",console.time("start of createRtree"));this.rtree=new a.RTree(10);for(var b=this.featureArray.length,c=0;c<b;c++)this.addToRtree(this.featureArray[c]);console&&console.timeEnd&&"finest"===a.gv.getLogLevel()&&a.util.Logger.finest("","OM.VectorLayer.createRtree",console.timeEnd("end of createRtree"))}},searchFeatures:function(b){return a.isNull(this.rtree)||a.isNull(b)?null:this.rtree.search(b)},setQueryParameters:function(){if(!(0>=arguments.length)){this.queryParameter=
{paramnum:arguments.length};for(var b=0;b<arguments.length;b++)if(a.isNull(arguments[b]))this.queryParameter["param"+(b+1)]=null;else{var c=arguments[b];if("object"!==typeof c)this.queryParameter["param"+(b+1)]=c;else if(c instanceof a.geometry.Geometry)this.queryParameter["param"+(b+1)]=c.toString(),this.queryParameter["paramtype"+(b+1)]="geometry";else{if(a.isNull(c.type)){var Z=a.util.ValidationUtil;"object"===typeof c.value?Z.isNumberArray(c.value)?c.type="narray":c.type="sarray":Z.isNumber2(c.value)?
c.type="number":c.type="string"}a.isNull(c.sqlType)&&("sarray"===c.type?c.sqlType="MV_STRINGLIST":"narray"===c.type&&(c.sqlType="MV_NUMBERLIST"));"sarray"===c.type?this.queryParameter["param"+(b+1)]='"'+c.value.join('","')+'"':"narray"===c.type&&(this.queryParameter["param"+(b+1)]=c.value.join(","));this.queryParameter["sqltype"+(b+1)]=c.sqlType;this.queryParameter["paramtype"+(b+1)]=c.type}}}},setMultiFeatureMarker:function(a){this.mfMarker=a},getFeatureStyles:function(b){var c=null,c=this.renderingStyle?
this.renderingStyle:b.styleName?a.style.StyleStore.getServerSideStyle(this.dataSource,b.styleName):b.oldStyle?b.oldStyle:b.renderingStyle;if(this.loadOnDemand)for(var Z=this.selectedFeatures.length,ba=0;ba<Z;ba++)this.selectedFeatures[ba].id==b.id&&(b.selected=!0,this.selectedFeatures[ba]=b);c&&c.stylelist&&1<c.stylelist.length&&(b.lineGroup=this.getLineGroup());return c},getDefaultRenderingStyle:function(b){switch(b){case "Point":case "MultiPoint":case "OrientedPoint":case "OrientedMultiPoint":return a.style.StyleStore.defaultMarkerStyle;
case "LineString":case "MultiLineString":return a.style.StyleStore.defaultLineStyle;case "Polygon":case "MultiPolygon":case "Rectangle":case "GeometryCollection":return a.style.StyleStore.defaultPolygonStyle}return null},setMouseCursorStyle:function(a){this.mouseCursor="object"===typeof a?{definition:[{type:"image",src:a.src}],hotspotX:a.hotspotX,hotspotY:a.hotspotY}:a;this.realGroup&&this.realGroup.applyStyle({cursor:this.mouseCursor})},isServerSideStyle:function(b,c){if(!(b instanceof a.style.Style)&&
b.dataSource&&b.name){var Z=this,ba=b.url;a.isNull(ba)&&(ba=this.type===a.layer.VectorLayer.TYPE_JDBC||this.type===a.layer.VectorLayer.TYPE_PREDEFINED||this.type===a.layer.VectorLayer.TYPE_MAPBOX?this.serverURL:this.parentMap.mapviewerURL);Z.loadingStyle++;a.style.StyleStore.getServerSideStyle(b.dataSource,b.name,{url:ba,callback:function(b){Z.loadingStyle--;"rendering"===c?a.isNull(b)?Z.renderingStyle=b:Z.setRenderingStyle(b,Z.styleAttributes):"hover"===c?Z.setHoverStyle(b):"select"===c?Z.setSelectStyle(b):
"secondary"===c?Z.otherStyles.push(b):"label"===c&&Z.setLabelingStyle(b)}});return!0}return!1},getAttributeType:function(b){if("string"!==typeof b)return null;var c=this.attributeTypes;b=b.toUpperCase();return c&&a.notNull(c[b])?c[b]:null},hasSharedBoundary:function(){return this.sharedBoundary},setSharedBoundary:function(a){this.sharedBoundary=a},getFeatureAttributesInHTML:function(b){var c="",Z="";if(b.attributes||this.type===a.layer.VectorLayer.TYPE_LOCAL){var ba=0,Y;if(b.InfoHtml)Z=b.InfoHtml;
else if(this.attrNames&&0<this.attrNames.length)for(var sa=this.attrNames.length,la=[],oa=0;oa<sa;oa++){Y=this.attrNames[oa];var wa=Y.toUpperCase(),c="\x3ctr bgcolor\x3d'#bbbbbb'\x3e\x3ctd colspan\x3d'2' align\x3d'left'\x3eLAYER NAME: "+this.name+"\x3c/td\x3e\x3c/tr\x3e";b.attributes[wa]&&-1===la.indexOf(wa)&&((wa=b.attributes[wa])?"string"!==typeof wa||a.util.DomUtil.isHtml(wa)||(wa=wa.replace(/\s/g,"\x26nbsp;")):wa="",Z+="\x3ctr bgcolor\x3d'#dddddd'\x3e\x3ctd align\x3d'right'\x3e"+Y.toUpperCase()+
"\x3c/td\x3e\x3ctd align\x3d'left'\x3e"+wa+"\x3c/td\x3e\x3c/tr\x3e",ba+=1)}else if(this.type===a.layer.VectorLayer.TYPE_DATAPACK||this.type===a.layer.VectorLayer.TYPE_LOCAL){c="\x3ctr bgcolor\x3d'#bbbbbb'\x3e\x3ctd colspan\x3d'2' align\x3d'left'\x3eLAYER NAME: "+this.name+"\x3c/td\x3e\x3c/tr\x3e";for(Y in b.attributes)if(wa=b.attributes[Y])"string"===typeof wa&&(wa=wa.replace(/\s/g,"\x26nbsp;")),Z+="\x3ctr bgcolor\x3d'#dddddd'\x3e\x3ctd align\x3d'right'\x3e"+Y.toUpperCase()+"\x3c/td\x3e\x3ctd align\x3d'left'\x3e"+
wa+"\x3c/td\x3e\x3c/tr\x3e",ba+=1;if(0===ba)return}return 0<Z.trim().length?c+Z.trim():null}},isInternalUtilLayer:function(){if("ii_oracle_maps_internal_editing"===this.name||"ii_oracle_maps_internal_others"===this.name)return!0},insertFeatureInfo:function(b){if(!a.isNull(b)&&!a.isNull(b.id)){var c=this.parentMap;if(!0===this.getEnableInfoWindow()&&!a.isNull(b)&&!a.isNull(c)&&!a.notNull(c.vctinfoFeatures[b.id])){var Z=this.getFeatureAttributesInHTML(b);a.isNull(Z)||0>=Z.trim().length||(c.vctinfoHTMLArray.push(Z),
c.vctinfoFeatures[b.id]=b.id)}}},deselectFeatures:function(){for(var a=this.selectedFeatures?this.selectedFeatures.length:0;0<a;a--){var b=this.selectedFeatures.pop();this.deselectFeature(b);b.enableFeatureEditing(!1);this.resetFeatureStates(b)}},handleVectorTouchTap:a.util.MiscUtil.oddNumberClick(function(b,c,Z){c.selectionEnable&&!Z.cluster&&c.selectFeature(Z);c.featureEditable&&(a.event.EventSource.stopEvents[b.type]=!0);Z.parentFeature&&"OrientedPoint"===Z.parentFeature.getGeometry().type&&(b=
Z.parentFeature,b.parentLayer.deselectFeature(b))}),handleVectorMouseClick:a.util.MiscUtil.oddNumberClick(function(b,c,Z){c.selectionEnable&&(Z.cluster?(a.isNull(c.vClusterClickToZoomToMBR)||!0!==c.vClusterClickToZoomToMBR)&&c.selectFeature(Z):c.selectFeature(Z));c.featureEditable&&a.notNull(b)&&a.notNull(b.type)&&(a.event.EventSource.stopEvents[b.type]=!0);Z.parentFeature&&"OrientedPoint"===Z.parentFeature.getGeometry().type&&(b=Z.parentFeature,b.parentLayer.deselectFeature(b))}),enableEditingMenuContext:function(a){this.editingMenuContextEnabled=
a},isEditingMenuContextEnabled:function(){return this.editingMenuContextEnabled}});a.layer.VectorLayer.SINGLE_SELECTION=0;a.layer.VectorLayer.MULTIPLE_SELECTION=1;a.layer.VectorLayer.TYPE_PREDEFINED=0;a.layer.VectorLayer.TYPE_JDBC=1;a.layer.VectorLayer.TYPE_DATAPACK=2;a.layer.VectorLayer.TYPE_LOCAL=3;a.layer.VectorLayer.TYPE_GEORSS=4;a.layer.VectorLayer.TYPE_WFS=5;a.layer.VectorLayer.TYPE_MAPBOX=6;a.layer.VectorLayer.ERROR_COUNT=5;a.layer.MarkerLayer=a.layer.VectorLayer.extend({initialize:function M(b){M.base.call(this,
b,{def:{type:a.layer.VectorLayer.TYPE_LOCAL}});this.markerStyle=new a.style.Marker({width:50,height:50,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAG3klEQVRoQ+2XaWwUZRzG37n26LWUAi0toi1IImhiggqioiEhqYkJH5SEIyECMSAYTCiKHAot5xflC2CQ+EFEjgBRULlrLeEoJKACBakNaaDHUloshXZLa3d8nndmyrZAod3tasgOeTvnzjy///P83xkU8ZgsymPCIWIg/zcnY47EHOmhCsSi1UOF7fZtY450u3Q99MOYI/6bzSMVoWWHW2BTtO5P87mKwr1PtxwpqWjcXXOrafSvl81eQphtGhTczZS7vK0prH0Fa1Med86HHn89U63rk+g5MiQjblw4MF0GKa9t/vzQ6bIZeQUivqG00NLcyRIMEqTjRdi3D7XUVYg18yY0jB3+5IYBKa6c7sJ0GaSkMlD88ffXhx4vPNBWZefhJsoO2VKkaartNYXAKArOWdZJyGfTVPHl/PEXhqR7h0UN5PK1pqq pm6rSLp46bD3TSlFbhSWAs++Ix76qqnYIuQNcRM5E5FRFFxneRrFj5RR/Vqqnf1RBpn3rT7tw6pD1TOiSuulCEBC2x9Yxxsp2BiCOA5Zr1oUm1unegNi1fHL0QaZvrkorPglH7D5HXe9xQfaFqt0VDyAnbmh96ZBc4E4GQHbkTYg+CKNFR6RYRsSxoYMDKsUzUkEahX8QLbd0AuJ3ckaDIx5EK/cdgLijGy2nR6QTVl5k88oYaYrMPY9JoXRFJo5rjdw4bzllOWaKAeiR7YvH+TOjDSKjVZR/1wlqoig6IsVqQtGgnk7ogCIEz2nctvuI7xU7XhlxAbF9wZv/Dcj5ol+cXhcaBEoAiKQ4RcU+QUzbAd2Q0FbjwzHu0xruIW7p7gax7ZOx/sx+RvSjdeEkQDiN2pU2IZKRsqJkOaKohnSDYPKY3SPsG4XXYvpV4F66+5bYkjM6+iCM1vmTBTIqrLEJwW1iIUw1AMA+oXgZM+zLbSt6ElZOEtbsxWbfPOdFgOjRdUT2yCl8njAamtvKOsSzoRXdJYXLinNtO8N9XAiD6AbiJd2y3iMZntti08znogtSWhW48v626if+IAgqyxlINVzSAUUHFPJP0TxmCkO6QwdUuBcEKB1QNDiCbzD2FN/uWQmNYsPUQVcH9dUHWtNZ15cuf2uV+gNb1hXenLh1D16IsicIABBUXzM8gHPJZlawVhgxVJ4QcsZizOx+ke8TvlDRN28NaRWzRidvHZyqT+o6gvWLLoNU1jUPr6hpyJ+xrc5XVXoa1adoCDbcEIxtwKgciJyAK4rtitXsgJIuBuWrR8Of3nFCZD+tiKkjvLmpPm1p1ED4IMJU1gTyZ+6s91WW/AZHLPEOhIZ9xkwwaoBT4ZhB4UiUm5Oa/EA2RYpXFa8NNsS7L+i5ZqBxfVpaYnVUQdpgapsAc9tXVXYJIF6hQbjq9iJdcRCPmAFCh3oPetztUoROGGzrIEnG6VcGGWLi8+FDdCtao RWTztTeyZ/9wx2fv7xMaG7kBECMFd1xGbqIhxX8EIlDGxFExydML1w26ilDZGcFVu/e/t3Xc+fOvt6JE+ykVox/7DW37/631P5hl3uk4wMlzI2W/A/2mL5qf4VQ3PFwxit0lyHi3Ypwo6O9hircaCOCJCNxI7J0MVQr2bgqd+HOfft++rsTCHzkiBaMAMYtjNsYTTZQO5iwQSji0tWal+pb4g/N39eadLW2QTridasiAeI9cIQghmoiTooYmamLlBtHdy7/bNHBM2eKbj4AgiIJ0YzRiMHrajEI3WC7E1EQFoJfgolr1m18Y1T25G9WFAQTSmuDMlLxBtzQAaGbom+cKiHiyg/uXbls4ZHic+dY4dDFEUYAB4KiCVGDwfjdsB3h+XZLOI44EAm4Y1+M1PdmzRkxPWd13hdHgt6yOlMkoi84S/VLUMXLgPBc+fngquVLjv1Z3A6CAM5g/jnu2E7U2wDXbAhG7B4IEoUDws8sJF4kY/SzYXpPmjJt2Jwla+etPx70XqkLiv5Jmng1SxMJ5XtDIZzoOI3sNDP7gRAUTAg6QDfqHuSEY0skQJJwsxSM3jZUAmCe+XDp2nlfnTC9w9I10af6wP5Vyz49evH8WcbEqTpFcybimr1AADYyIdjUBOFgvHj+npnKgQjXERaBriBAgvHy2YNgibt+PDzlL++otzPrC/esWLqg4OzZ31lVinaqTnEUTfEOABvbOUYwgnYK4MCE40joPRwgvCEEQZLGjHlz4EeLl4zPW5Sz/8SJY5xtKCpUNAWHgjgOPZLwUDfCdaTjvbjvAHmxTSiu+T50ZiEHxKn2fV9u97vxw45FwpEHARGKUzMXpy/uO+M8TOSjnO8pkEd5dkSviYFEtJwRuFnMkQgUMaK3iDkS0XJG4GaPjSP/Al31T1GL6r+HAAAAAElFTkSuQmCC",
yOffset:-12,xOffset:2,textStyle:{fontSize:15,fill:"#ffffff"},textOffset:{x:0,y:-15}});this.labelStyle=new a.style.Text({styleName:"defaultMMLabelStyle",fill:"#000000",fontStyle:a.style.Text.FONTSTYLE_ITALIC,fontSize:12,sticky:!1})},addMapMarker:function(b){a.isNull(b)||(a.isNull(b.renderingStyle)&&(b.renderingStyle=this.markerStyle.clone()),a.notNull(b.label)&&a.isNull(b.labelStyle)&&(b.labelStyle=this.labelStyle),a.notNull(b.markerTextStyle)&&(b.renderingStyle.textStyle=b.markerTextStyle),this.addFeature(b))},
removeMapMarker:function(a){this.removeFeature(a)},addMapMarkers:function(b){if(!a.isNull(b))for(var c=0;c<b.length;c++)this.addMapMarker(b[c])}});a.layer.BuiltinExternalTileLayer=a.layer.TileLayer.extend({initialize:function Z(b,c,sa){Z.base.call(this,b);this.layerType=a.LayerTypes.EXTERNAL;b=a.layer.BuiltinExternalTileLayer;c&&b.tileLayerConfigs&&b.tileLayerConfigs[c]&&(this.tileLayerConfig=b.tileLayerConfigs[c]);sa&&(this.customParameters=sa)},init:function(a){},pan:function(a,b){},setCenterAndZoomlevel:function(){var b=
a.event,c=new b.MapEvent(b.LayerEvent.FINISH_LOAD,this);c.mapContext=this.parentMap.getMapContext();this.fire(b.LayerEvent.FINISH_LOAD,c);this.setMapCenterAndZoomlevel()},setMapCenterAndZoomlevel:function(){},setMapType:function(a){},resize:function(){},setVisibleImpl:function(){if(this.container){var b=a.$(this.container);b.css("visibility",this.visible?"visible":"hidden");b.css("display",this.visible?"":"none")}this.visible&&this.parentMap.displayed&&this.init(this.container)},checkVisible:function(){if(!this.isVisible())return!1;
if(this.parentMap){var a=this.parentMap.getMapZoomLevel();if(a>=this.tileLayerConfig.zoomLevels.length||a<this.minVisibleLevel||a>this.maxVisibleLevel)return!1}return!0},setContainer:function(){var b=a.$("\x3cdiv id \x3d'tilelayer_"+this.name+"'\x3e\x3c/div\x3e");b.css({position:"absolute",left:"0px","z-index":this.getZIndex()-1,top:"0px",width:"100%",height:"100%",overflow:"hidden"});this.parentMap.$tileLayersDiv.append(b);var c=a.$("\x3cdiv id \x3d'transparent_tilelayer_"+this.name+"'\x3e\x3c/div\x3e");
c.css({position:"absolute",left:"0px","z-index":this.getZIndex(),top:"0px",width:"100%",height:"100%",background:"white",opacity:"0",overflow:"hidden"});b.append(c);this.container=b[0]},getLayerConfig:function(){var b=new a.event.LayerEvent(a.event.LayerEvent.FINISH_GOT_CONFIG,this);b.config=this.getEnabledConfig(this.tileLayerConfig);this.parentMap&&(b.mapContext=this.parentMap.getMapContext());var ba=this,Y=function(){ba.fire(a.event.LayerEvent.FINISH_GOT_CONFIG,b);var c=a.event,wa=new c.MapEvent(c.LayerEvent.FINISH_LOAD,
ba);wa.mapContext=ba.parentMap.getMapContext();ba.fire(c.LayerEvent.FINISH_LOAD,wa)};if(a.isNull(ba.isBaiduMap)||!1===ba.isBaiduMap)Y();else var sa=1,la=c.setInterval(function(){a.notNull(ba.bdutil)?(a.notNull(ba.parentMap)&&(ba.parentMap.bdutil=ba.bdutil),Y(),clearInterval(la),a.util.Logger.finest("waited "+sa+" cycles")):(a.util.Logger.finest("waiting for baidu to load converter functions."),sa+=1,60<sa&&(clearInterval(la),a.utul.Logger.warning("","OM.layer.BuiltinExternalTileLayer.getLayerConfig",
"Failed to get Baidu Map transform utilities")))},1E3)},destroy:function(){this.mapTypeControl&&this.mapTypeControl.destroy();this.container&&a.$(this.container).empty().remove()},refresh:function ba(b,c){a.isNull(c)&&(c=!0);ba.base.call(this,b,c);this.reloadNumber=Math.round(1E10*Math.random());this.parentMap&&this.map&&this.setCenterAndZoomlevel();if(c){var la=new a.event.LayerEvent(a.event.LayerEvent.AFTER_REFRESH,this);this.parentMap&&(la.mapContext=this.parentMap.getMapContext());this.fire(a.event.LayerEvent.AFTER_REFRESH,
la)}},exportToSVG:function(a,b,c){var la=0,oa=0;this.maxWidth&&b>this.maxWidth?(la=(b-this.maxWidth)/2,b=this.maxWidth):this.minWidth&&b<this.minWidth&&(la=(this.minWidth-b)/2,b=this.minWidth);this.maxHeight&&c>this.maxHeight?(oa=(c-this.maxHeight)/2,c=this.maxHeight):this.minHeight&&c<this.minHeight&&(oa=(this.minHeight-c)/2,c=this.minHeight);var wa=this;wa.loadImg=0;var ma=this.getStaticMapURL(b,c),fa=this.parentMap.graphics;wa.loadImg++;fa.drawImage({x:la,y:oa},{src:ma,width:b,height:c},{group:a}).handleEvent=
function(a){this.resourceUpdate(a);wa.loadImg--};return a},drawTilesImages:function(a,b){var c=0,la=0;this.maxWidth&&a>this.maxWidth?(c=(a-this.maxWidth)/2,a=this.maxWidth):this.minWidth&&a<this.minWidth&&(c=(this.minWidth-a)/2,a=this.minWidth);this.maxHeight&&b>this.maxHeight?(la=(b-this.maxHeight)/2,b=this.maxHeight):this.minHeight&&b<this.minHeight&&(la=(this.minHeight-b)/2,b=this.minHeight);var oa=this;oa.loadImg=0;var wa=this.getStaticMapURL(a,b);oa.loadingImg=!0;var ma=new Image;ma.onload=function(){oa.loadingImg=
!1;oa.canvas.getContext("2d").drawImage(ma,c,la)};ma.onerror=function(){oa.loadingImg=!1;oa.canvas=null};ma.src=wa},clone:function(b){var c={};a.$.extend(c,this);c.name=b?b:c.name+"_clone";c.deleteAllListeners();c.map=null;return c}});a.layer.BuiltinExternalTileLayer.register=function(b,c){var sa=a.layer.BuiltinExternalTileLayer;"undefined"===typeof sa.tileLayerConfigs&&(sa.tileLayerConfigs=[]);sa.tileLayerConfigs[b]=c};a.layer.BingTileLayer=a.layer.BuiltinExternalTileLayer.extend({initialize:function Y(b,
la){Y.base.call(this,b);this.key=la&&la.key?la.key:"your_bing_api_key";this.libURL=null;this.over=2<arguments.length?arguments[2]:!1;var oa=a.layer.BingTileLayer;this.over||"undefined"===typeof Microsoft||c.OM_finishLoadBingJsV7();this.over||oa.LOADEDJS||oa.LOADING||(oa.LOADING=!0,la&&la.libURL?(this.libURL=la.libURL,a.$.getScript(this.libURL+"\x26onscriptload\x3dOM_finishLoadBingJsV7")):a.$.getScript(a.gv.secureHttp()+"//ecn.dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v\x3d7.0\x26onscriptload\x3dOM_finishLoadBingJsV7"));
this.mapType=la&&la.mapType?la.mapType:oa.TYPE_ROAD;this.mapTypeList=la&&la.mapTypeList?la.mapTypeList:null;a.isNull(this.mapTypeList)&&(this.mapTypeList=la&&la.map_type_values?la.map_type_values:null);this.tileLayerConfig=a.layer.TileLayerConfig.CONFIG_GOOGLE;this.mapTypeVisible=la&&a.notNull(la.mapTypeVisible)?la.mapTypeVisible:!0;this.maxWidth=900;this.maxHeight=834;this.minHeight=this.minWidth=80},init:function(){if(this.container){var b=this,c,la=function(wa){if(b.parentMap){var ma=b.parentMap.getMapContext(),
fa=function(w){w=a.notNull(w)?new Microsoft.Maps.Location(w.getY(),w.getX()):new Microsoft.Maps.Location(ma.getCenterPoint().getY(),ma.getCenterPoint().getX());b.checkMapType();try{if(b.map=new Microsoft.Maps.Map(wa,{credentials:b.key,center:w,mapTypeId:a.layer.BingTileLayer.TYPES[b.mapType],zoom:b.getRealZoomLevel(ma.getZoomLevel())+1,animate:!1,labelOverlay:Microsoft.Maps.LabelOverlay.hidden,showDashboard:!1,showCopyright:!1,showScalebar:!1,disableKeyboardInput:!0}),b.mapTypeList&&!b.over){var fa=
[];"string"===typeof b.mapTypeList?fa=b.mapTypeList.split(";"):Array.isArray(b.mapTypeList)&&(fa=b.mapTypeList);w={road:null,satellite:null,mercator:null};for(var J=0;J<fa.length;J++)if("OM.layer.BingTileLayer.TYPE_ROAD"===fa[J]||fa[J]===a.layer.BingTileLayer.TYPE_ROAD)w.road=a.layer.BingTileLayer.TYPE_ROAD;else if("OM.layer.BingTileLayer.TYPE_AERIAL"===fa[J]||fa[J]===a.layer.BingTileLayer.TYPE_AERIAL)w.satellite=a.layer.BingTileLayer.TYPE_AERIAL;var fa=null,L;for(L in w)w[L]===b.mapType&&(fa=L);
b.mapTypeControl=new a.control.MapTypeControl(b.parentMap,b,{enableTypes:w,type:fa});b.mapTypeControl.infoDecoration&&b.mapTypeControl.infoDecoration.setVisible(b.mapTypeVisible)}}catch(K){}c.update(.85);Microsoft.Maps.Events.addHandler(b.map,"viewchangeend",function(){var L=a.event,w=new L.MapEvent(L.LayerEvent.FINISH_LOAD,b);w.mapContext=ma;setTimeout(function(){null!==c&&(c.complete(),c=null)},1E3);b.fire(L.LayerEvent.FINISH_LOAD,w)})};ma.getCenterPoint().transform(8307,function(a){c.update(.5);
fa(a)})}else c.abort(),c=null},oa=function(){a.isNull(c)&&(c=b.startNewTask());a.layer.BingTileLayer.LOADEDJS?(c.update(.25),la(b.container)):setTimeout(oa,500)};oa()}},pan:function(a,b,c){c.callback&&c.callback();this.map&&(c=this.map.getOptions(),c.center=this.map.getCenter(),c.animate=!1,c.centerOffset=new Microsoft.Maps.Point(a,b),this.map.setView(c))},setCenterAndZoomlevel:function(){var b=this.startNewTask();if(this.map){var c=this.parentMap.getMapContext(),la=this.getRealZoomLevel(c.getZoomLevel()),
oa=this,wa=function(c){var fa=oa.map.getOptions();fa.zoom=la+1;fa.center=new Microsoft.Maps.Location(c.getY(),c.getX());oa.map.setView(fa);setTimeout(function(){a.notNull(b)&&(b.complete(),b=null)},1E3)};b.update(.25);c.getCenterPoint().transform(8307,function(a){b.update(.5);wa(a)})}},setMapType:function(b){this.mapType=b;b=null;this.map&&(this.checkMapType(),b=a.layer.BingTileLayer.TYPES[this.mapType],this.map.setMapType(b),this.cloneLayer&&this.cloneLayer.setMapType(this.mapType))},resize:function(){if(this.map){var a=
this.parentMap.getMapContext();this.map.setOptions({height:a.getDeviceWidth(),width:a.getDeviceHeight()})}},getMapType:function(){return this.mapType},checkMapType:function(){a.layer.BingTileLayer.TYPES[this.mapType]||(this.mapType=a.layer.BingTileLayer.TYPE_ROAD)},getStaticMapURL:function(b,c){var la="http://dev.virtualearth.net/REST/V1/Imagery/Map/",oa=this.map.getCenter(),oa=oa.latitude+","+oa.longitude,wa;wa=a.layer.BingTileLayer;switch(this.mapType){case wa.TYPE_AERIAL:wa="Aerial";break;case wa.TYPE_MERCATOR:wa=
"AerialWithLabels";break;default:wa="Road"}var ma=this.map.getZoom();return la=la+wa+"/"+oa+"/"+ma+"?"+("mapSize\x3d"+b+","+c)+"\x26"+("key\x3d"+this.key)},clone:function(b){b||(b=this.name+"_clone");return this.cloneLayer=new a.layer.BingTileLayer(b,{key:this.key,libURL:this.libURL,mapType:this.mapType},!0)}});a.layer.BingTileLayer.TYPE_ROAD="road";a.layer.BingTileLayer.TYPE_AERIAL="aerial";a.layer.BingTileLayer.TYPE_AUTO="auto";a.layer.BingTileLayer.TYPE_MERCATOR="mercator";a.layer.BingTileLayer.TYPES=
[];a.layer.BingTileLayer.LOADEDJS=!1;a.layer.BingTileLayer.LOADING=!1;c.OM_finishLoadBingJsV7=c.OM_finishLoadBingJsV7||function(){a.layer.BingTileLayer.LOADEDJS=!0;a.layer.BingTileLayer.TYPES[a.layer.BingTileLayer.TYPE_ROAD]=Microsoft.Maps.MapTypeId.road;a.layer.BingTileLayer.TYPES[a.layer.BingTileLayer.TYPE_AERIAL]=Microsoft.Maps.MapTypeId.aerial;a.layer.BingTileLayer.TYPES[a.layer.BingTileLayer.TYPE_AUTO]=Microsoft.Maps.MapTypeId.auto;a.layer.BingTileLayer.TYPES[a.layer.BingTileLayer.TYPE_MERCATOR]=
Microsoft.Maps.MapTypeId.mercator};a.layer.ElocationTileLayer=a.layer.TileLayer.extend({initialize:function sa(b){sa.base.call(this,b,{dataSource:"ELOCATION_MERCATOR",tileLayer:"world_map",tileServerURL:a.gv.secureHttp()+"//elocation.oracle.com/mapviewer/mcserver",tileLayerConfig:a.layer.TileLayerConfig.CONFIG_ELOCATION})},getStaticMapURL:function(b,c){var oa="http://elocation.oracle.com/mapviewer/omserver?",wa='width\x3d"'+b+'" height\x3d"'+c+'" antialiase\x3d"false" datasource\x3d"ELOCATION_MERCATOR" basemap\x3d"world_map" format\x3d"PNG_STREAM"\x3e',
ma=new a.geometry.Point(this.parentMap.getMapWindowBoundingBox().getMinX(),this.parentMap.getMapWindowBoundingBox().getMinY(),3857),fa=new a.geometry.Point(this.parentMap.getMapWindowBoundingBox().getMaxX(),this.parentMap.getMapWindowBoundingBox().getMaxY(),3857),ma='\x3cbox srsName\x3d"EPSG:3857"\x3e\x3ccoordinates\x3e'+ma.getX()+","+ma.getY()+","+fa.getX()+","+fa.getY()+"\x3c/coordinates\x3e\x3c/box\x3e\x3c/map_request\x3e";return oa+'xml_request\x3d\x3c?xml version\x3d"1.0" standalone\x3d"yes"?\x3e\x3cmap_request '+
wa+ma}});a.layer.HereTileLayer=a.layer.BuiltinExternalTileLayer.extend({initialize:function la(b,c){la.base.call(this,b);var ma=a.layer.HereTileLayer;this.over=2<arguments.length?arguments[2]:!1;c&&c.libURL?(this.libURL=c.libURL,-1===this.libURL.indexOf("/",this.libURL.length-1)&&(this.libURL+="/")):this.libURL="http://js.api.here.com/v3/3.0/";var fa=this;this.over||"undefined"!==typeof H||ma.LOADING?ma.LOADING||(ma.LOADED=!0,a.util.Logger.finest("","OM.layer.HereTileLayer.initialize","HERE API already loaded.")):
(a.util.Logger.finest("","OM.layer.HereTileLayer.initialize","Loading HERE API ..."),a.layer.HereTileLayer.LOADING=!0,a.$.getScript(fa.libURL+"mapsjs-core.js",function(){a.$.when(a.$.getScript(fa.libURL+"mapsjs-service.js"),a.$.getScript(fa.libURL+"mapsjs-mapevents.js"),a.$.Deferred(function(b){a.$(b.resolve)})).done(function(){ma.LOADING=!1;ma.LOADED=!0;a.util.Logger.finest("","OM.layer.HereTileLayer.initialize","HERE API just loaded.")})}));this.appCode=c&&c.appCode?c.appCode:null;this.appID=c&&
c.appID?c.appID:null;!this.appID&&c&&c.appId&&(this.appID=c.appId);!this.appID&&c&&c.appid&&(this.appID=c.appid);!this.appID&&c&&c.app_id&&(this.appID=c.app_id);this.useHTTPS=c&&c.useHTTPS?c.useHTTPS:!1;this.useCIT=c&&c.useCIT?c.useCIT:!1;this.mapType=c&&c.mapType?c.mapType:a.layer.HereTileLayer.TYPE_NORMAL_MAP;this.mapTypeList=c&&c.mapTypeList?c.mapTypeList:null;a.isNull(this.mapTypeList)&&(this.mapTypeList=c&&c.map_type_values?c.map_type_values:null);this.mapTypeVisible=c&&a.notNull(c.mapTypeVisible)?
c.mapTypeVisible:!0;this.tileLayerConfig=a.layer.TileLayerConfig.CONFIG_GOOGLE;this.maxHeight=this.maxWidth=2048},init:function(){var b=null,oa=this,wa=this.startNewTask(),ma=function(){if(oa.parentMap){wa.update(.25);var c=oa.parentMap.getMapContext(),fa=c.getCenterPoint(),ma=function(L){var K=fa.getX(),ma=fa.getY();L&&(K=L.getX(),ma=L.getY());b=oa.getRealZoomLevel(c.getZoomLevel())+1;oa.checkMapType();if(!oa.map){try{oa.platform=new H.service.Platform({app_id:oa.appID,app_code:oa.appCode,useHTTPS:oa.useHTTPS,
useCIT:oa.useCIT})}catch(m){a.util.Logger.warning("MAPVIEWER_9077","OM.layer.HereTileLayer.showHereMap",m.message);return}a.util.Logger.finest("","OM.layer.HereTileLayer.showHereMap","H.service.Platform instance created.");try{oa.mapLayers=oa.platform.createDefaultLayers(),oa.map=new H.Map(oa.container,oa.mapLayers.normal.map,{zoom:b,center:{lng:K,lat:ma}}),oa.setBaseLayer(oa.map,oa.mapLayers,oa.mapType)}catch(p){a.util.Logger.warning("MAPVIEWER_9078","OM.layer.HereTileLayer.showHereMap",p.message);
return}a.util.Logger.finest("","OM.layer.HereTileLayer.showHereMap","H.Map instance created.");try{oa.events=new H.mapevents.MapEvents(oa.map),oa.behavior=new H.mapevents.Behavior(oa.events)}catch(E){a.util.Logger.warning("MAPVIEWER_9079","OM.layer.HereTileLayer.showHereMap",E.message);return}a.util.Logger.finest("","OM.layer.HereTileLayer.showHereMap","H.mapevents.MapEvents and H.mapevents.Behavior instances created.");oa.parentMap.addListener(a.event.MapEvent.MAP_RESIZED,function(){oa.map.getViewPort().resize()});
if(oa.mapTypeList&&!oa.over){K=[];"string"===typeof oa.mapTypeList?K=oa.mapTypeList.split(";"):Array.isArray(oa.mapTypeList)&&(K=oa.mapTypeList);L={road:null,satellite:null,terrain:null};for(ma=0;ma<K.length;ma++)if("OM.layer.HereTileLayer.TYPE_NORMAL_MAP"===K[ma]||K[ma]===a.layer.HereTileLayer.TYPE_NORMAL_MAP)L.road="road";else if("OM.layer.HereTileLayer.TYPE_SATELLITE_MAP"===K[ma]||K[ma]===a.layer.HereTileLayer.TYPE_SATELLITE_MAP)L.satellite="satellite";else if("OM.layer.HereTileLayer.TYPE_TERRAIN_MAP"===
K[ma]||K[ma]===a.layer.HereTileLayer.TYPE_TERRAIN_MAP)L.terrain="terrain";K=null;a.layer.HereTileLayer.TYPE_NORMAL_MAP===oa.mapType?K="road":a.layer.HereTileLayer.TYPE_SATELLITE_MAP===oa.mapType?K="satellite":a.layer.HereTileLayer.TYPE_TERRAIN_MAP===oa.mapType&&(K="terrain");oa.mapTypeControl=new a.control.MapTypeControl(oa.parentMap,oa,{enableTypes:L,type:K});oa.mapTypeControl.infoDecoration&&oa.mapTypeControl.infoDecoration.setVisible(oa.mapTypeVisible)}L=a.event;setTimeout(function(){a.notNull(wa)&&
(wa.complete(),wa=null)},1E3);K=new L.MapEvent(L.LayerEvent.FINISH_LOAD,oa);K.mapContext=oa.parentMap.getMapContext();oa.fire(L.LayerEvent.FINISH_LOAD,K)}};fa.transform(8307,function(a){wa.update(.5);ma(a)})}else a.util.Logger.finest("","OM.layer.HereTileLayer.init_Here","A HereTileLayer instance already created.")},fa=c.setInterval(function(){!a.layer.HereTileLayer.LOADING&&a.layer.HereTileLayer.LOADED&&(ma(),clearInterval(fa))},500)},setCenterAndZoomlevel:function(){var b=this.parentMap.getMapContext(),
c=this.getRealZoomLevel(b.getZoomLevel()),wa=this,ma=this.startNewTask();ma.update(.3);var fa=function(b){if(wa.map){wa.map.setCenter({lng:b.getX(),lat:b.getY()});wa.map.setZoom(c+1);setTimeout(function(){a.notNull(ma)&&(ma.complete(),ma=null)},1E3);b=a.event;var fa=new b.MapEvent(b.LayerEvent.FINISH_LOAD,wa);fa.mapContext=wa.parentMap.getMapContext();wa.fire(b.LayerEvent.FINISH_LOAD,fa)}};b.getCenterPoint().transform(8307,function(a){ma.update(.5);fa(a)})},setMapType:function(a){"road"===a?a="NORMAL_MAP":
"satellite"===a?a="SATELLITE_MAP":"terrain"===a&&(a="TERRAIN_MAP");this.mapType=a;this.map&&(this.checkMapType(),this.setBaseLayer(this.map,this.mapLayers,this.mapType),this.cloneLayer&&this.cloneLayer.setMapType(this.mapType))},getMapType:function(){return this.mapType},checkMapType:function(){var b=a.layer.HereTileLayer;a.isNull(b.TYPES[this.mapType])&&(this.mapType=b.TYPE_NORMAL_MAP)},clone:function(b){b||(b=this.name+"_clone");return this.cloneLayer=new a.layer.HereTileLayer(b,{libURL:this.libURL,
mapType:this.mapType,key:this.appCode,appID:this.appID},!0)},getStaticMapURL:function(b,c){var wa="http://image.maps.api.here.com/mia/1.6/mapview",ma=this.map.getCenter(),ma=ma.lat+","+ma.lng,fa="\x26t\x3d0",w=a.layer.HereTileLayer;this.mapType==w.TYPE_TERRAIN_MAP?fa="\x26t\x3d2":this.mapType==w.TYPE_SATELLITE_MAP&&(fa="\x26t\x3d1");w=this.map.getZoom();return wa=wa+"?app_id\x3d"+this.appID+"\x26app_code\x3d"+this.appCode+"\x26c\x3d"+ma+"\x26z\x3d"+w+fa+("\x26w\x3d"+b+"\x26h\x3d"+c)+"\x26nodot "},
setBaseLayer:function(b,c,wa){a.isNull(b)||a.isNull(c)?a.util.Logger.warning("MAPVIEWER_9074","OM.layer.HereTileLayer.setBaseLayer"):(a.isNull(wa)&&(wa="NORMAL_MAP"),"NORMAL_MAP"===wa.toUpperCase()?b.setBaseLayer(c.normal.map):"SATELLITE_MAP"===wa.toUpperCase()?b.setBaseLayer(c.satellite.map):"TERRAIN_MAP"===wa.toUpperCase()?b.setBaseLayer(c.terrain.map):"NORMAL_TRAFFIC"===wa.toUpperCase()?b.setBaseLayer(c.normal.traffic):"SATELLITE_TRAFFIC"===wa.toUpperCase()?b.setBaseLayer(c.satellite.traffic):
"TERRAIN_TRAFFIC"===wa.toUpperCase()?b.setBaseLayer(c.terrain.traffic):"NORMAL_PANORAMA"===wa.toUpperCase()?b.setBaseLayer(c.normal.panorama):"SATELLITE_PANORAMA"===wa.toUpperCase()?b.setBaseLayer(c.satellite.panorama):"TERRAIN_PANORAMA"===wa.toUpperCase()?b.setBaseLayer(c.terrain.panorama):"NORMAL_TRANSIT"===wa.toUpperCase()?b.setBaseLayer(c.normal.transit):"NORMAL_XBASE"===wa.toUpperCase()?b.setBaseLayer(c.normal.xbase):"SATELLITE_XBASE"===wa.toUpperCase()?b.setBaseLayer(c.satellite.xbase):"TERRAIN_XBASE"===
wa.toUpperCase()?b.setBaseLayer(c.terrain.xbase):"NORMAL_BASE"===wa.toUpperCase()?b.setBaseLayer(c.normal.base):"SATELLITE_BASE"===wa.toUpperCase()?b.setBaseLayer(c.satellite.base):"TERRAIN_BASE"===wa.toUpperCase()?b.setBaseLayer(c.terrain.base):"NORMAL_LABELS"===wa.toUpperCase()?b.setBaseLayer(c.normal.labels):"SATELLITE_LABELS"===wa.toUpperCase()?b.setBaseLayer(c.satellite.labels):"TERRAIN_LABELS"===wa.toUpperCase()?b.setBaseLayer(c.terrain.labels):b.setBaseLayer(c.normal.map))},pan:function(b,
c,wa){wa.callback&&wa.callback();var ma=this;this.parentMap.getMapContext().getCenterPoint().transform(8307,function(b){if(ma.map){ma.map.setCenter({lng:b.getX(),lat:b.getY()});b=a.event;var c=new b.MapEvent(b.LayerEvent.FINISH_LOAD,ma);c.mapContext=ma.parentMap.getMapContext();ma.fire(b.LayerEvent.FINISH_LOAD,c)}})}});a.layer.HereTileLayer.TYPE_NORMAL_MAP="NORMAL_MAP";a.layer.HereTileLayer.TYPE_SATELLITE_MAP="SATELLITE_MAP";a.layer.HereTileLayer.TYPE_TERRAIN_MAP="TERRAIN_MAP";a.layer.HereTileLayer.TYPE_NORMAL_TRAFFIC=
"NORMAL_TRAFFIC";a.layer.HereTileLayer.TYPE_SATELLITE_TRAFFIC="SATELLITE_TRAFFIC";a.layer.HereTileLayer.TYPE_TERRAIN_TRAFFIC="TERRAIN_TRAFFIC";a.layer.HereTileLayer.TYPE_NORMAL_PANORAMA="NORMAL_PANORAMA";a.layer.HereTileLayer.TYPE_SATELLITE_PANORAMA="SATELLITE_PANORAMA";a.layer.HereTileLayer.TYPE_TERRAIN_PANORAMA="TERRAIN_PANORAMA";a.layer.HereTileLayer.TYPE_NORMAL_TRANSIT="NORMAL_TRANSIT";a.layer.HereTileLayer.TYPE_NORMAL_XBASE="NORMAL_XBASE";a.layer.HereTileLayer.TYPE_SATELLITE_XBASE="SATELLITE_XBASE";
a.layer.HereTileLayer.TYPE_TERRAIN_XBASE="TERRAIN_XBASE";a.layer.HereTileLayer.TYPE_NORMAL_BASE="NORMAL_BASE";a.layer.HereTileLayer.TYPE_SATELLITE_BASE="SATELLITE_BASE";a.layer.HereTileLayer.TYPE_TERRAIN_BASE="TERRAIN_BASE";a.layer.HereTileLayer.TYPE_NORMAL_LABELS="NORMAL_LABELS";a.layer.HereTileLayer.TYPE_SATELLITE_LABELS="SATELLITE_LABELS";a.layer.HereTileLayer.TYPE_TERRAIN_LABELS="TERRAIN_LABELS";a.layer.HereTileLayer.LOADING=!1;a.layer.HereTileLayer.LOADED=!1;a.layer.HereTileLayer.TYPES=[];a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_NORMAL_MAP]=
"NORMAL_MAP";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_TERRAIN_MAP]="TERRAIN_MAP";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_SATELLITE_MAP]="SATELLITE_MAP";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_NORMAL_TRAFFIC]="NORMAL_TRAFFIC";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_TERRAIN_TRAFFIC]="TERRAIN_TRAFFIC";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_SATELLITE_TRAFFIC]="SATELLITE_TRAFFIC";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_NORMAL_PANORAMA]=
"NORMAL_PANORAMA";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_TERRAIN_PANORAMA]="TERRAIN_PANORAMA";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_SATELLITE_PANORAMA]="SATELLITE_PANORAMA";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_NORMAL_TRANSIT]="NORMAL_TRANSIT";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_NORMAL_XBASE]="NORMAL_XBASE";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_TERRAIN_XBASE]="TERRAIN_XBASE";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_SATELLITE_XBASE]=
"SATELLITE_XBASE";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_NORMAL_BASE]="NORMAL_BASE";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_TERRAIN_BASE]="TERRAIN_BASE";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_SATELLITE_BASE]="SATELLITE_BASE";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_NORMAL_LABELS]="NORMAL_LABELS";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_TERRAIN_LABELS]="TERRAIN_LABELS";a.layer.HereTileLayer.TYPES[a.layer.HereTileLayer.TYPE_SATELLITE_LABELS]=
"SATELLITE_LABELS";a.layer.BaiduTileLayer=a.layer.BuiltinExternalTileLayer.extend({initialize:function oa(b,ma){oa.base.call(this,b);this.isBaiduMap=!0;var fa=a.layer.BaiduTileLayer;ma&&(ma.libURL?(this.libURL=ma.libURL,-1!==this.libURL.indexOf("/",this.libURL.length-1)&&(this.libURL=this.libURL.substring(0,this.libURL.length-1))):this.libURL=a.gv.secureHttp()+"//api.map.baidu.com/api",this.v=ma.version||"2.0",a.isNull(ma.APIKey)?(a.util.Logger.warning("","OM.layer.BaiduTileLayer.initialize","Application is required for Baidu Application"),
this.ak="Baidu application key is required!"):this.ak=ma.APIKey,a.notNull(ma.enableBD09Encoding)&&!0===ma.enableBD09Encoding?this.enableBD09Encoding=!0:this.enableBD09Encoding=!1);var w=this;fa.LOADING?fa.LOADING||(fa.LOADED=!0,a.util.Logger.finest("","OM.layer.BaiduTileLayer.initialize","Baidu API already loaded.")):(c.setBaiduMapUtil=function(){"undefined"!==typeof BMap&&(fa.LOADING=!1,fa.LOADED=!0,a.util.Logger.finest("","OM.layer.BaiduTileLayer.initialize","Baidu API just loaded, now setting bdutil."),
w.bdutil={ak:w.ak,WGS84ToBD09:new BMap.Convertor,project:new BMap.MercatorProjection,enableBD09Encoding:w.enableBD09Encoding,BD09_APIURL:a.gv.secureHttp()+"//api.map.baidu.com/geoconv/v1/"})},a.$(document).ready(function(){var b=w.libURL+"?v\x3d"+w.v+"\x26ak\x3d"+w.ak+"\x26callback\x3dsetBaiduMapUtil";if(a.isNull(c.BMap)){var fa=document.createElement("script");fa.type="text/javascript";fa.src=b;document.body.appendChild(fa)}else w.bdutil={ak:w.ak,WGS84ToBD09:new BMap.Convertor,project:new BMap.MercatorProjection,
enableBD09Encoding:w.enableBD09Encoding,BD09_APIURL:a.gv.secureHttp()+"//api.map.baidu.com/geoconv/v1/"},a.util.Logger.finest("","OM.layer.BaiduTileLayer.initialize","Baidu API loaded already, only to set bdutil")}));this.tileLayerConfig=a.layer.TileLayerConfig.CONFIG_BAIDU;this.maxHeight=this.maxWidth=2048},init:function(){var b=null,wa=null,ma=this,fa=this.container,w=this.startNewTask(),z=function(){if(ma.parentMap){w.update(.25);var c=ma.parentMap.getMapContext(),K=c.getCenterPoint(),z=function(m){var p=
K.getX(),E=K.getY();m&&(p=m.getX(),E=m.getY());m=ma.bdutil.project.pointToLngLat(new BMap.Pixel(p,E));wa=new BMap.Point(m.lng,m.lat);b=c.getZoomLevel();b=ma.getRealZoomLevel(b);b=a.util.BaiduUtil.getValidZoomLevel(b);wa=new BMap.Point(m.lng,m.lat);try{ma.map=new BMap.Map(fa),ma.map.centerAndZoom(wa,b)}catch(z){a.util.Logger.warning("","OM.layer.BaiduTileLayer.showBaiduMap",z.message);return}a.util.Logger.finest("","OM.layer.BaiduTileLayer.showBaiduMap");m=a.event;setTimeout(function(){a.notNull(w)&&
(w.complete(),w=null)},1E3);p=new m.MapEvent(m.LayerEvent.FINISH_LOAD,ma);p.mapContext=ma.parentMap.getMapContext();ma.fire(m.LayerEvent.FINISH_LOAD,p)};K.transform(a.util.BaiduUtil.SRID,function(a){w.update(.5);z(a)})}else a.util.Logger.finest("","OM.layer.BaiduTileLayer.init_Baidu","A BaiduTileLayer instance already created.")},J=c.setInterval(function(){!a.layer.BaiduTileLayer.LOADING&&a.layer.BaiduTileLayer.LOADED&&(z(),clearInterval(J))},500)},setCenterAndZoomlevel:function(){var b=this.parentMap.getMapContext(),
c=this.getRealZoomLevel(b.getZoomLevel()),ma=this,fa=this.startNewTask();fa.update(.3);var w=function(b){if(ma.map){b=new BMap.Pixel(b.getX(),b.getY());b=ma.bdutil.project.pointToLngLat(b);ma.map.setCenter(new BMap.Point(b.lng,b.lat));ma.map.setZoom(c);setTimeout(function(){a.notNull(fa)&&(fa.complete(),fa=null)},1E3);b=a.event;var L=new b.MapEvent(b.LayerEvent.FINISH_LOAD,ma);L.mapContext=ma.parentMap.getMapContext();ma.fire(b.LayerEvent.FINISH_LOAD,L)}};b.getCenterPoint().transform(a.util.BaiduUtil.SRID,
function(a){fa.update(.5);w(a)});b=a.event;setTimeout(function(){a.notNull(fa)&&(fa.complete(),fa=null)},1E3);var z=new b.MapEvent(b.LayerEvent.FINISH_LOAD,ma);z.mapContext=ma.parentMap.getMapContext();ma.fire(b.LayerEvent.FINISH_LOAD,z)},pan:function(b,c,ma){ma.callback&&ma.callback();b=this.parentMap.getMapContext();if(!a.isNull(this.map)){var fa=this;b.getCenterPoint().transform(a.util.BaiduUtil.SRID,function(b){b=new BMap.Pixel(b.getX(),b.getY());b=fa.bdutil.project.pointToLngLat(b);fa.map.setCenter(new BMap.Point(b.lng,
b.lat));b=a.event;var c=new b.MapEvent(b.LayerEvent.FINISH_LOAD,fa);c.mapContext=fa.parentMap.getMapContext();fa.fire(b.LayerEvent.FINISH_LOAD,c)})}}});a.layer.BaiduTileLayer.LOADING=!1;a.layer.BaiduTileLayer.LOADED=!1;a.layer.GoogleTileLayer=a.layer.BuiltinExternalTileLayer.extend({initialize:function wa(b,c){wa.base.call(this,b);this.libURL=null;this.tileSource="google";var w=a.layer.GoogleTileLayer;this.over=2<arguments.length?arguments[2]:!1;this.mapTypeList=c&&c.mapTypeList?c.mapTypeList:null;
a.isNull(this.mapTypeList)&&(this.mapTypeList=c&&c.map_type_values?c.map_type_values:null);this.mapTypeVisible=c&&a.notNull(c.mapTypeVisible)?c.mapTypeVisible:!0;this.tilt=c&&c.tilt?c.tilt:0;c&&c.key&&(this.key=c.key);c&&c.clientID&&(this.clientID=c.clientID);var z="";!this.clientID&&this.key?z+="\x26key\x3d"+this.key:this.clientID&&(z+="\x26client\x3d"+this.clientID);this.over||"undefined"===typeof google?this.over||w.LOADING||(this.libURL=c&&c.libURL?c.libURL+"\x26callback\x3dOM.finishLoadGoogleV3"+
z:a.gv.secureHttp()+"//maps.google.com/maps/api/js?v\x3d3\x26sensor\x3dfalse\x26callback\x3dOM.finishLoadGoogleV3"+z,a.$.getScript(this.libURL),w.LOADING=!0):a.finishLoadGoogleV3();this.tileLayerConfig=a.layer.TileLayerConfig.CONFIG_GOOGLE;this.mapType=c&&c.mapType?c.mapType:a.layer.GoogleTileLayer.TYPE_ROAD;this.maxHeight=this.maxWidth=640},init:function(){var b=this.startNewTask(),ma=null,fa=null,w=this,z=a.layer.GoogleTileLayer,J=this.container,L=function(){if(w.parentMap){b.update(.25);var c=
w.parentMap.getMapContext(),L=c.getCenterPoint(),p=function(p){var K=L.getX(),Q=L.getY();p&&(K=p.getX(),Q=p.getY());null!==K&&null!==Q&&(ma=new google.maps.LatLng(Q,K));p=c.getZoomLevel();null!==p&&(fa=w.getRealZoomLevel(p)+1);w.checkMapType();w.map=new google.maps.Map(J,{zoom:fa,center:ma,mapTypeId:z.TYPES[w.mapType],tilt:w.tilt,navigationControl:!1,panControl:!1,zoomControl:!1,mapTypeControl:!1,streetViewControl:!1,draggable:!1,keyboardShortcuts:!1,fullscreenControl:!1,scrollwheel:!1});if(w.mapTypeList&&
!w.over){K=[];"string"===typeof w.mapTypeList?K=w.mapTypeList.split(";"):Array.isArray(w.mapTypeList)&&(K=w.mapTypeList);p={road:null,satellite:null,shaded:null,hybrid:null};for(Q=0;Q<K.length;Q++)if(K[Q]===a.layer.GoogleTileLayer.TYPE_ROAD||"OM.layer.GoogleTileLayer.TYPE_ROAD"===K[Q])p.road=z.TYPE_ROAD;else if(K[Q]===a.layer.GoogleTileLayer.TYPE_SATELLITE||"OM.layer.GoogleTileLayer.TYPE_SATELLITE"===K[Q])p.satellite=z.TYPE_SATELLITE;else if(K[Q]===a.layer.GoogleTileLayer.TYPE_SHADED||"OM.layer.GoogleTileLayer.TYPE_SHADED"===
K[Q])p.shaded=z.TYPE_SHADED;else if(K[Q]===a.layer.GoogleTileLayer.TYPE_HYBRID||"OM.layer.GoogleTileLayer.TYPE_HYBRID"===K[Q])p.hybrid=z.TYPE_HYBRID;var K=null,v;for(v in p)if(p[v]===w.mapType){K=v;break}a.isNull(K)&&(K=z.TYPE_ROAD);w.mapTypeControl=new a.control.MapTypeControl(w.parentMap,w,{enableTypes:p,type:K});w.mapTypeControl.infoDecoration&&w.mapTypeControl.infoDecoration.setVisible(w.mapTypeVisible)}b.update(.75);w.map.addListener("tilesloaded",function(){var L=a.event,p=new L.MapEvent(L.LayerEvent.FINISH_LOAD,
w);p.mapContext=c;a.notNull(b)&&(b.complete(),b=null);w.fire(L.LayerEvent.FINISH_LOAD,p)})};L.transform(8307,function(a){b.updateTask(.5);p(a)})}else b.abort(),b=null},K=c.setInterval(function(){!z.LOADING&&a.layer.GoogleTileLayer.LOADED&&(clearInterval(K),L())},500)},setCenterAndZoomlevel:function(){if(this.parentMap&&this.map){var b=this.startNewTask(),c=this.parentMap.getMapContext(),fa=this.getRealZoomLevel(c.getZoomLevel()),w=this,z=function(c){w.map.setOptions({zoom:fa+1,center:new google.maps.LatLng(c.getY(),
c.getX())});c=new a.event.MapEvent(a.event.LayerEvent.FINISH_LOAD,w);c.mapContext=w.parentMap.getMapContext();setTimeout(function(){a.notNull(b)&&(b.complete(),b=null)},1E3);w.fire(a.event.LayerEvent.FINISH_LOAD,c)};c.getCenterPoint().transform(8307,function(a){b.update(.5);z(a)})}},setMapType:function(b){this.mapType=b;this.map&&(this.checkMapType(),this.map.setMapTypeId(a.layer.GoogleTileLayer.TYPES[this.mapType]),this.cloneLayer&&this.cloneLayer.setMapType(this.mapType),this.parentMap.setMapZoomLevel(this.map.getZoom()-
1))},resize:function(){this.map&&google.maps.event.trigger(this.map,"resize")},getMapType:function(){return this.mapType},checkMapType:function(){var b=a.layer.GoogleTileLayer;b.TYPES[this.mapType]||(this.mapType=b.TYPE_ROAD)},pan:function(a,b,c){c.callback&&c.callback();if(this.map){var w=this.map;this.parentMap.getMapCenter().transform(8307,function(a){w.panTo(new google.maps.LatLng(a.getY(),a.getX()))})}},clone:function(b){b||(b=this.name+"_clone");return this.cloneLayer=new a.layer.GoogleTileLayer(b,
{libURL:this.libURL,mapType:this.mapType},!0)},getStaticMapURL:function(b,c){var fa="https://maps.googleapis.com/maps/api/staticmap?",w=this.map.getCenter(),w="center\x3d"+w.lat()+","+w.lng(),z="zoom\x3d"+this.map.getZoom(),J="size\x3d"+b+"x"+c,L;switch(this.mapType){case a.layer.GoogleTileLayer.TYPE_SATELLITE:L="satellite";break;case a.layer.GoogleTileLayer.TYPE_HYBRID:L="hybrid";break;case a.layer.GoogleTileLayer.TYPE_SHADED:L="terrain";break;default:L="roadmap"}L="maptype\x3d"+L;var K="";if(a.isNull(this.clientID)&&
this.key)K="\x26key\x3d"+this.key;else if(this.clientID){var K="\x26client\x3d"+this.clientID,A=a.util.MiscUtil.signURL(this.key,"/maps/api/staticmap?"+w+"\x26"+z+"\x26"+J+"\x26"+L+"\x26sensor\x3dfalse"+K);a.notNull(A)&&(K=K+"\x26signature\x3d"+A)}return fa+w+"\x26"+z+"\x26"+J+"\x26"+L+"\x26sensor\x3dfalse"+K}});a.finishLoadGoogleV3=a.finishLoadGoogleV3||function(){var b=a.layer.GoogleTileLayer;a.layer.GoogleTileLayer.LOADED=!0;a.layer.GoogleTileLayer.LOADING=!1;null===b.TYPES&&(b.TYPES=[],b.TYPES[b.TYPE_ROAD]=
google.maps.MapTypeId.ROADMAP,b.TYPES[b.TYPE_SATELLITE]=google.maps.MapTypeId.SATELLITE,b.TYPES[b.TYPE_HYBRID]=google.maps.MapTypeId.HYBRID,b.TYPES[b.TYPE_SHADED]=google.maps.MapTypeId.TERRAIN)};a.layer.GoogleTileLayer.TYPE_ROAD="road";a.layer.GoogleTileLayer.TYPE_SATELLITE="satellite";a.layer.GoogleTileLayer.TYPE_HYBRID="hybrid";a.layer.GoogleTileLayer.TYPE_SHADED="shaded";a.layer.GoogleTileLayer.LOADING=!1;a.layer.GoogleTileLayer.LOADED=!1;a.layer.GoogleTileLayer.TYPES=null;a.layer.Cluster=a.Class.extend({initialize:function(a,
b,c,w){this.clusterX=a;this.clusterY=b;this.numberOfPoints=1;this.featureArray=[c];this.updateFlag=!0;this.mbr=null;this.vectorClusterLayer=w},addFeature:function(a,b,c){this.clusterX=(this.clusterX*this.numberOfPoints+a)/(this.numberOfPoints+1);this.clusterY=(this.clusterY*this.numberOfPoints+b)/(this.numberOfPoints+1);this.numberOfPoints++;this.featureArray.push(c);this.updateFlag=!0;this.mbr=null},addCluster:function(a){this.clusterX=(this.clusterX*this.numberOfPoints+a.clusterX*a.numberOfPoints)/
(this.numberOfPoints+a.numberOfPoints);this.clusterY=(this.clusterY*this.numberOfPoints+a.clusterY*a.numberOfPoints)/(this.numberOfPoints+a.numberOfPoints);this.numberOfPoints+=a.numberOfPoints;this.featureArray=this.featureArray.concat(a.featureArray)},getMBR:function(){if(a.notNull(this.mbr))return this.mbr;for(var b,c,fa=Number.MAX_VALUE,w=-Number.MAX_VALUE,z=Number.MAX_VALUE,J=-Number.MAX_VALUE,L=this.featureArray.length,K=0;K<L;K++)b=this.featureArray[K].getGeometry().getMBR(),a.isNull(c)&&(c=
b.getSRID()),b.getMinX()<fa&&(fa=b.getMinX()),b.getMaxX()>w&&(w=b.getMaxX()),b.getMinY()<z&&(z=b.getMinY()),b.getMaxY()>J&&(J=b.getMaxY());return this.mbr=b=new a.geometry.Rectangle(fa,z,w,J,c)},getMBP:function(){var a=null,b=null,c=[];this.iterateCoordinates(function(w){c.push(w);if(null===a||w.x<a.x)a=w;if(null===b||w.x>b.x)b=w});return[].concat(this.buildConvexHull([a,b],c),this.buildConvexHull([b,a],c))},getDistant:function(a,b){return(b[0].y-b[1].y)*(a.x-b[0].x)+(b[1].x-b[0].x)*(a.y-b[0].y)},
findMostDistantPointFromBaseLine:function(a,b){for(var c=0,w=null,z=[],J=b.length-1;0<=J;J--){var L=b[J],K=this.getDistant(L,a);0<K&&(z.push(L),K>c&&(c=K,w=L))}return{maxPoint:w,newPoints:z}},buildConvexHull:function(a,b){var c=[],w=this.findMostDistantPointFromBaseLine(a,b);return w.maxPoint?(c=c.concat(this.buildConvexHull([a[0],w.maxPoint],w.newPoints)),c=c.concat(this.buildConvexHull([w.maxPoint,a[1]],w.newPoints))):[a[0]]},iterateCoordinates:function(a){for(var b=this.featureArray.length,c=0;c<
b;c++){var w=this.featureArray[c].getGeometry(),z=w.coordinates;"Polygon"===w.type&&(z=z[0]);for(var w=w.dim,J=0;J<z.length;J+=w)a({x:z[J],y:z[J+1]})}},removeFeature:function(a,b,c){for(var w=0;w<this.featureArray.length;w++)if(this.featureArray[w]==c)return 1<this.numberOfPoints&&(this.clusterX=(this.clusterX*this.numberOfPoints-a)/(this.numberOfPoints-1),this.clusterY=(this.clusterY*this.numberOfPoints-b)/(this.numberOfPoints-1)),this.numberOfPoints--,this.featureArray.splice(w,1),this.updateFlag=
!0;return!1},getVectorLayer:function(){if(this.vectorClusterLayer&&this.vectorClusterLayer.vectorLayer)return this.vectorClusterLayer.vectorLayer;a.util.Logger.warning("","OM.layer.Cluster","no vector layer was found for this cluster.");return null},createClusterFeature:function(b,c,fa){c=new a.geometry.Point(this.clusterX,this.clusterY,c);this.clusterFeatureId=b;b=new a.Feature(b,c,{renderingStyle:fa});b.cluster=this;fa=function(a){var b=a.target;a=b.parentLayer;var c=a.parentMap,b=b.cluster.getMBR();
-1===a.clickZoomInLevels?c.zoomToExtent(b):0<a.clickZoomInLevels&&c.setMapCenterAndZoomLevel(b.getCenter(),c.getMapZoomLevel()+a.clickZoomInLevels)};c=this.getVectorLayer();a.notNull(c)&&c.vClusterClickToZoomToMBR&&b.addListener(a.event.MouseEvent.MOUSE_CLICK,fa);this.updateFlag=!1;return b}});a.layer.VectorLayerCluster=a.Class.extend({initialize:function(b,c){this.vectorLayer=b;this.threshold=c&&c.threshold?c.threshold:30;this.clusterStyle=c&&c.clusterStyle?c.clusterStyle:null;this.clusterSelectStyle=
a.notNull(c.clusterSelectStyle)?c.clusterSelectStyle:null;this.clusterHoverStyle=a.notNull(c.clusterHoverStyle)?c.clusterHoverStyle:null;this.minPointCount=c&&c.minPointCount?c.minPointCount:2},initCluster:function(a,b){this.gridSizeInX=this.threshold*a;this.gridSizeInY=this.threshold*b;this.clusters={};var c=this.vectorLayer.parentMap.getMapContext().getUniverse().getMapBounds(),w=this.vectorLayer.visibleBound;this.minX=w?Math.max(w.getMinX(),c.getMinX()):c.getMinX();this.maxX=w?Math.min(w.getMaxX(),
c.getMaxX()):c.getMaxX();this.minY=w?Math.max(w.getMinY(),c.getMinY()):c.getMinY();this.maxY=w?Math.min(w.getMaxY(),c.getMaxY()):c.getMaxY();this.numInX=Math.ceil((this.maxX-this.minX)/this.gridSizeInX);this.numInY=Math.ceil((this.maxY-this.minY)/this.gridSizeInY);this.clusterFeatureArray=[];this.initialized=!0},addFeatureToCluster:function(b){var c=b.getGeometry().getMBR(),fa=(c.getMinX()+c.getMaxX())/2,c=(c.getMinY()+c.getMaxY())/2,w=Math.floor((fa-this.minX)/this.gridSizeInX),z=Math.floor((c-this.minY)/
this.gridSizeInY);this.clusters[w]||(this.clusters[w]={});this.clusters[w][z]?this.clusters[w][z].addFeature(fa,c,b):this.clusters[w][z]=new a.layer.Cluster(fa,c,b,this);return{x:w,y:z}},displayAsCluster:function(b){a.util.Logger.finest(null,"VectorLayerCluster","["+this.vectorLayer.name+"] displayAsCluster called.");var ma=this.vectorLayer.parentMap.getMapContext(),fa=ma.getUniverse(),w=ma.getZoomLevel();if(!(this.vectorLayer.maxClusteringLevel<w)){this.initialized||(w=fa.getZoomLevels()[w],this.initCluster(w.resolution,
w.resolution*w.stretchRatio));1<ma.getWholeMapNum()&&(ma=fa.getMapBounds(),b={x:ma.getMinX(),y:ma.getMinY(),w:ma.getWidth(),h:ma.getHeight()});this.startX=Math.floor((b.x-this.minX)/this.gridSizeInX);this.endX=Math.ceil((b.x+b.w-this.minX)/this.gridSizeInX);this.startY=Math.floor((b.y-this.minY)/this.gridSizeInY);this.endY=Math.ceil((b.y+b.h-this.minY)/this.gridSizeInY);var w=(ma=this.vectorLayer.featureArray)?ma.length:0,z=fa.getSRID(),J=this,L=0;this.totolPointNumber=0;for(var fa=function(a){return function(){a.getGeometry().transform(z,
function(b){a.srid=z;a.geo=b;J.addFeatureToCluster(a);L--})}()},K=0;K<w;K++){var A=ma[K];A.inCluster=!1;"Point"!==A.geo.type&&"Polygon"!==A.geo.type||A.displayed||(this.totolPointNumber++,A.geo.srid!==z?(L++,fa(A)):this.addFeatureToCluster(A))}var m=function(){if(0===L){for(var a=J.mergeAllClusters(b);a;)a=J.mergeAllClusters(b);J.showAllClusters()}else c.setTimeout(m,100)};m()}},showAllClusters:function(){for(var b=this.vectorLayer.parentMap.getMapContext().getUniverse().getSRID(),c=this.startX;c<
this.endX;c++)for(var fa=this.startY;fa<this.endY;fa++)if(a.notNull(this.clusters[c])&&a.notNull(this.clusters[c][fa])&&this.clusters[c][fa].numberOfPoints>=this.minPointCount){var w="-CL"+c+"-"+fa,z=this.getClusterFeatureById(w);z?this.updateMarkerText(z):(z=this.clusters[c][fa].createClusterFeature(w,b,this.clusterStyle),this.displayClusterFeature(z))}},displayClusterFeature:function(b){this.clusterFeatureArray.push(b);b.group=this.vectorLayer.realGroup;b.screenTransformObj=this.vectorLayer.parentMap.getMapContext().getTransform();
b.graphics=this.vectorLayer.parentMap.graphics;b.parentLayer=this.vectorLayer;b.markerText=b.cluster.numberOfPoints;var c=b.renderingStyle;c instanceof a.style.BucketStyle&&(c.generateBuckets([this.minPointCount,this.totolPointNumber],"_NUMBERINCLUSTER",!0),c=c.getRealStyle(b.cluster.numberOfPoints),b.renderingStyle=c);a.isNull(c)?c=b.renderingStyle:b.renderingStyle=c;b.displayFeature([c]);b.shape&&b.shape.applyStyle({tooltip:b.cluster.numberOfPoints+""});for(var c=b.cluster.featureArray.length,fa=
0;fa<c;fa++){var w=b.cluster.featureArray[fa];w.displayed=!0;w.inCluster=!0;w.clusterId=b.id;w.clusterFeature=b}},mergeAllClusters:function(){for(var b=!1,c=this.startX;c<this.endX;c++)for(var fa=this.startY;fa<this.endY;fa++)if(a.notNull(this.clusters[c])&&a.notNull(this.clusters[c][fa])){var w=this.mergeCluster(c,fa);a.notNull(w)&&(b=!0)}return b},mergeCluster:function(b,c){var fa=this.gridSizeInX*this.gridSizeInY,w=fa,z=fa,J=fa,L=fa,K=fa,A=fa,m=fa,p=fa;b+1<this.numInX&&a.notNull(this.clusters[b+
1])&&a.notNull(this.clusters[b+1][c])&&(w=this.getSquareDistance(this.clusters[b][c],this.clusters[b+1][c]));c+1<this.numInY&&a.notNull(this.clusters[b][c+1])&&(z=this.getSquareDistance(this.clusters[b][c],this.clusters[b][c+1]));0<=b-1&&a.notNull(this.clusters[b-1])&&a.notNull(this.clusters[b-1][c])&&(J=this.getSquareDistance(this.clusters[b][c],this.clusters[b-1][c]));0<=c-1&&a.notNull(this.clusters[b][c-1])&&(L=this.getSquareDistance(this.clusters[b][c],this.clusters[b][c-1]));b+1<this.numInX&&
c+1<this.numInY&&a.notNull(this.clusters[b+1])&&a.notNull(this.clusters[b+1][c+1])&&(K=this.getSquareDistance(this.clusters[b][c],this.clusters[b+1][c+1]));0<=b-1&&c+1<this.numInY&&a.notNull(this.clusters[b-1])&&a.notNull(this.clusters[b-1][c+1])&&(A=this.getSquareDistance(this.clusters[b][c],this.clusters[b-1][c+1]));b+1<this.numInX&&0<=c-1&&a.notNull(this.clusters[b+1])&&a.notNull(this.clusters[b+1][c-1])&&(m=this.getSquareDistance(this.clusters[b][c],this.clusters[b+1][c-1]));0<=b-1&&0<=c-1&&a.notNull(this.clusters[b-
1])&&a.notNull(this.clusters[b-1][c-1])&&(p=this.getSquareDistance(this.clusters[b][c],this.clusters[b-1][c-1]));p=Math.min(w,Math.min(z,Math.min(J,Math.min(L,Math.min(K,Math.min(A,Math.min(m,p)))))));if(p<fa){if(w===p)return this.mergeHorizontal(b,c,1),{directionX:1,directionY:0};if(z===p)return this.mergeVertical(b,c,1),{directionX:0,directionY:1};if(J===p)return this.mergeHorizontal(b,c,-1),{directionX:-1,directionY:0};if(L===p)return this.mergeVertical(b,c,-1),{directionX:0,directionY:-1};if(K===
p)return this.mergeDiagonal(b,c,1,1),{directionX:1,directionY:1};if(A===p)return this.mergeDiagonal(b,c,-1,1),{directionX:-1,directionY:1};if(m===p)return this.mergeDiagonal(b,c,1,-1),{directionX:1,directionY:-1};this.mergeDiagonal(b,c,-1,-1);return{directionX:-1,directionY:-1}}},getSquareDistance:function(a,b){return(a.clusterX-b.clusterX)*(a.clusterX-b.clusterX)+(a.clusterY-b.clusterY)*(a.clusterY-b.clusterY)},mergeHorizontal:function(a,b,c){this.clusters[a][b].addCluster(this.clusters[a+1*c][b]);
var w=Math.floor((this.clusters[a][b].clusterX-this.minX)/this.gridSizeInX);w==a?(this.removeAllFeatureInCluster(this.clusters[a+1*c][b]),this.clusters[a+1*c][b]=null):w==a+c&&(this.removeAllFeatureInCluster(this.clusters[a+1*c][b]),this.clusters[a+1*c][b]=this.clusters[a][b],this.removeAllFeatureInCluster(this.clusters[a][b]),this.clusters[a][b]=null)},mergeVertical:function(a,b,c){this.clusters[a][b].addCluster(this.clusters[a][b+1*c]);var w=Math.floor((this.clusters[a][b].clusterY-this.minY)/this.gridSizeInY);
w==b?(this.removeAllFeatureInCluster(this.clusters[a][b+1*c]),this.clusters[a][b+1*c]=null):w==b+c&&(this.removeAllFeatureInCluster(this.clusters[a][b+1*c]),this.clusters[a][b+1*c]=this.clusters[a][b],this.removeAllFeatureInCluster(this.clusters[a][b]),this.clusters[a][b]=null)},mergeDiagonal:function(b,c,fa,w){this.clusters[b][c].addCluster(this.clusters[b+1*fa][c+w]);var z=Math.floor((this.clusters[b][c].clusterX-this.minX)/this.gridSizeInX),J=Math.floor((this.clusters[b][c].clusterY-this.minY)/
this.gridSizeInY);z==b&&J==c?(this.removeAllFeatureInCluster(this.clusters[b+fa][c+w]),this.clusters[b+1*fa][c+1*w]=null):z==b+fa&&J==c+w?(this.removeAllFeatureInCluster(this.clusters[b+fa][c+w]),this.clusters[b+1*fa][c+1*w]=this.clusters[b][c],this.removeAllFeatureInCluster(this.clusters[b][c]),this.clusters[b][c]=null):(a.isNull(this.clusters[z][J])?this.clusters[z][J]=this.clusters[b][c]:this.clusters[z][J].addCluster(this.clusters[b][c]),this.removeAllFeatureInCluster(this.clusters[b][c]),this.clusters[b][c]=
null,this.removeAllFeatureInCluster(this.clusters[b+fa][c+w]),this.clusters[b+fa][c+w]=null)},removeAllFeatureInCluster:function(b){var c=b.clusterFeatureId;if(a.isNull(c))for(c=0;c<b.featureArray.length;c++){var fa=b.featureArray[c];fa.parentLayer&&fa.parentLayer.clearFeature(fa)}else for((c=this.getClusterFeatureById(c))&&c.parentLayer.clearFeature(c),b.clusterFeatureId=null,b=this.clusterFeatureArray?this.clusterFeatureArray.length:0,fa=0;fa<b;fa++)if(this.clusterFeatureArray[fa]==c){this.clusterFeatureArray.splice(fa,
1);break}},redrawCluster:function(b,c,fa){if(!a.isNull(b)){var w=this.vectorLayer.parentMap.getMapContext().getUniverse().getSRID();return b.numberOfPoints>=this.minPointCount?(fa="-CL"+c+"-"+fa,(c=this.getClusterFeatureById(fa))?(b=new a.geometry.Point(b.clusterX,b.clusterY,w),c.setGeometry(b),this.updateMarkerText(c)):(this.removeAllFeatureInCluster(b),c=b.createClusterFeature(fa,w,this.clusterStyle),this.displayClusterFeature(c)),!0):!1}},getClusterFeatureById:function(a){for(var b=0;b<this.clusterFeatureArray.length;b++)if(this.clusterFeatureArray[b].id==
a)return this.clusterFeatureArray[b];return null},clearAllClusterFeatures:function(){for(var a=(this.clusterFeatureArray?this.clusterFeatureArray.length:0)-1;0<a;a--){var b=this.clusterFeatureArray[a];b.group=null;b.screenTransformObj=null;b.graphics=null;b.displayed=!1;b.inCluster=!1;b.parentLayer=null;this.clusterFeatureArray.pop()}this.clusterFeatureArray=null;this.initialized=!1},updateMarkerText:function(a){1<a.shape.childrenCount&&a.shape.lastChild.applyStyle({textValue:a.cluster.numberOfPoints})},
addFeature:function(b){var c=this.addFeatureToCluster(b),fa=this.mergeCluster(c.x,c.y),w=this.clusters[c.x][c.y],z=!1;if(a.isNull(fa))z=this.redrawCluster(w,c.x,c.y);else{var J=c.x+fa.directionX,fa=c.y+fa.directionY;a.notNull(w)?z=this.redrawCluster(w,c.x,c.y):a.notNull(this.clusters[J][fa])&&(z=this.redrawCluster(this.clusters[J][fa],J,fa))}z&&(b.displayed=!0)},addClusterFeatureToLabelGrid:function(){for(var a=this.clusterFeatureArray?this.clusterFeatureArray.length:0,b=0;b<a;b++){var c=this.clusterFeatureArray[b];
if(c.displayed&&c.screenPoints){var w=c.screenPoints.x,z=c.screenPoints.y,J=c.renderingStyle.width,c=c.renderingStyle.height;this.vectorLayer.parentMap.grid.insert([w-J/2,z-c/2,w+J/2,z+c/2])}}},showClusterInWrapAround:function(){for(var a=this.vectorLayer.parentMap.getMapContext().getWholeMapNum(),b=this.clusterFeatureArray?this.clusterFeatureArray.length:0,c=1;c<a;c++)for(var w=0;w<b;w++){var z=this.clusterFeatureArray[w];z.group=this.vectorLayer.featureGroupArr[c];z.displayFeature([z.renderingStyle]);
z.shape&&z.shape.applyStyle({tooltip:z.cluster.numberOfPoints+""})}}});a.layer.EditableFeature=a.Feature.extend({initialize:function ma(b,c,z){a.notNull(c)&&ma.base.call(this,b,c,z);this.edit=!1;this.editable=!0;this.editing=this.modified=this.dragging=!1;this.contextMenu=null;this.refresh_dragging=this.point_dragging=this.dragging_flag=!1;this.mbrMinX=this.mbrMaxX=null;this.init();this.pointToSnap=null;var J=this;this.setParentThat=function(a){J=a};this.endEditing=function(b){if(!b||!b.evt||!b.evt.relatedTarget&&
!J.dragging){var c;b&&b.target&&(c=b.target.parentFeature);!c&&b&&b.focusFeature&&(c=b.focusFeature.parentFeature);!c&&b&&(c=b.focusFeature);c||(c=J);c.parentLayer.parentMap.deleteListener(a.event.MapEvent.I_MAP_CENTER_ZOOM,this.calDistance,this);c.editable=!1;c.editing=!1;b=c.geo;"Point"===b.type||"MultiPoint"===b.type?(c.deleteEditingProperties(),c.setRenderingStyle(c.normalStyle)):"OrientedPoint"===b.type?(c.deleteEditingProperties(),c.displayFeature([c.renderingStyle])):("Polygon"!==b.type&&"LineString"!==
b.type&&"MultiPolygon"!==b.type&&"MultiLineString"!==b.type||c.deleteEditingProperties(),c.parentLayer.parentMap.wraparound&&c.parentLayer.parentMap.getLayerByName("ii_oracle_maps_internal_editing").refresh())}};this.shapePointMoving=function(b){a.notNull(a.gv.allowFeaturePointsInteraction)&&!1===a.gv.allowFeaturePointsInteraction||(J.dragging=!0,J.point_dragging=!0,J.featurePointMoving(b,!0))};this.possiblePointMoving=function(b){a.notNull(a.gv.allowFeaturePointsInteraction)&&!1===a.gv.allowFeaturePointsInteraction||
(J.dragging=!0,J.point_dragging=!0,J.featurePointMoving(b,!1))};this.resizePointMoving=function(b){a.notNull(a.gv.allowFeaturePointsInteraction)&&!1===a.gv.allowFeaturePointsInteraction||this.parentFeature.addResizeHandles(b)};this.showContextMenu=function(b){if(!a.notNull(a.gv.allowFeaturePointsInteraction)||!1!==a.gv.allowFeaturePointsInteraction){if(a.notNull(this.parentFeature)){if(!1===this.parentFeature.parentLayer.isEditingMenuContextEnabled())return}else if(!1===this.parentLayer.isEditingMenuContextEnabled())return;
var c=b.target.parentLayer.parentMap,w=b.evt.clientX,m=b.evt.clientY,p=b.target,fa=new a.layer.Menu(c,{left:w,top:m});fa.menu.setPosition(w,m);var z=function(){if(p&&(J.deleteShapePoint(p),p.parentFeature)){var b=new a.event.LayerEvent(a.event.LayerEvent.FEATURE_EDITED,p.parentFeature);p.parentFeature.fire(a.event.LayerEvent.FEATURE_EDITED,b);p.parentFeature.addResizeHandles.apply(p.parentFeature)}};b=function(){if(p){var b=fa.location.left,c=fa.location.top,L=p.parentLayer.parentMap.getScreenPointLocation(b,
c),c=p.parentLayer.parentMap.getScreenPointLocation(b-5,c-5),b=L.coordinates[0]-c.coordinates[0],c=c.coordinates[1]-L.coordinates[1],b=Math.sqrt(b*b+c*c),b=a.util.GeomUtil.findGeometryElement(p.getGeometry(),L.coordinates[0],L.coordinates[1],b);-1!==b&&(L=p.getGeometry().clone(!0),L=a.util.GeomUtil.removeGeometryElement(L,b),a.notNull(L)&&(a.notNull(p.parentLayer.changeManager)&&(b=p.parentLayer.changeManager.updateFeature(p.id,p,L,a.edit.EditChangeEvent.SPATIAL_UPDATE),a.notNull(b)&&p.parentLayer.getUndoManager().addEdit({feature:p,
changeManager:p.parentLayer.changeManager,editChangeEvent:b,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"remove feature element"},undo:function(){this.changeManager.undo(this.editChangeEvent);this.feature.fire(a.event.LayerEvent.FEATURE_EDITED);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()},redo:function(){this.changeManager.redo(this.editChangeEvent);this.feature.fire(a.event.LayerEvent.FEATURE_EDITED);
this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()}})),p.setGeometry(L),p.fire(a.event.LayerEvent.FEATURE_EDITED),p.deleteEditingProperties(),p.addEditProperties(!0)))}};w=function(){if(p){var b=p.parentLayer;if(!a.isNull(b)){var L=fa.location.left,w=fa.location.top,m=p.parentLayer.parentMap.getScreenPointLocation(L,w),w=p.parentLayer.parentMap.getScreenPointLocation(L-5,w-5),L=m.coordinates[0]-w.coordinates[0],w=w.coordinates[1]-m.coordinates[1],L=Math.sqrt(L*
L+w*w),m=a.util.GeomUtil.findGeometryElement(p.getGeometry(),m.coordinates[0],m.coordinates[1],L);if(-1===m)a.util.Logger.alert("MAPVIEWER_9061","OM.EditableFeature.showContextMenu","");else{var z=p.getGeometry().clone(!0),z=a.util.GeomUtil.removeGeometryElement(z,m);if(a.isNull(z))a.util.Logger.alert("MAPVIEWER_9062","OM.EditableFeature.showContextMenu","");else{var A=a.util.GeomUtil.cloneGeometryElement(p.getGeometry(),m);if(a.isNull(A))a.util.Logger.alert("MAPVIEWER_9063","OM.EditableFeature.showContextMenu",
"");else{var m="\x3ctr\x3e\x3ctd\x3e\x3ctable\x3e",S=[],L=[],ma=a.layer.VectorLayer,w=""+Math.floor(1E3*Math.random()+1);if(b.type===ma.TYPE_PREDEFINED||b.type===ma.TYPE_JDBC)if(a.notNull(b.keyColumn))S.push(b.keyColumn);else return;else S.push("ID");if(a.notNull(b.notNullAttributes))for(var J=0;J<b.notNullAttributes.length;J++)b.notNullAttributes[J]!==b.keyColumn&&S.push(b.notNullAttributes[J].toUpperCase());for(J=0;J<S.length;J++){var Sa=document.getElementById("_wb_attr"+J+c.instanceId);a.notNull(Sa)&&
(Sa.outerHTML="");0!==J?L.push(""):L.push(w);m+="\x3ctr\x3e\x3ctd\x3e"+S[J]+" : \x3c/td\x3e\x3ctd\x3e\x3cinput type\x3d'text' style\x3d'width:340px'  id\x3d'_wb_attr"+J+c.instanceId+"' value\x3d"+L[J]+"\x3e\x3c/td\x3e\x3c/tr\x3e"}m+="\x3c/table\x3e\x3c/td\x3e\x3c/tr\x3e";c.$featdialog=a.$('\x3cdiv id\x3d"_wb_dialog'+c.mapInstanceId+'" title\x3d"'+a.gv.getLabel("MAPVIEWER_WB_PROPERTIES")+'" style\x3d"overflow:visible"\x3e\x3ctable width\x3d100% cellSpacing\x3d0 borderSpacing\x3d0 style\x3d\'font-size:13px\'\x3e'+
m+"\x3c/table\x3e\x3c/div\x3e");c.$featdialog.dialog({position:{of:c.$oracleMapDiv,at:"center"},resizable:!1,width:a.browser.touchSupported||a.gv.isWin8Touch?450:510,height:a.browser.touchSupported||a.gv.isWin8Touch?300:360,buttons:[{closeOnEscape:!0,text:a.gv.getLabel("MAPVIEWER_WB_OK"),click:function(){for(var L=0;L<S.length;L++){var w=document.getElementById("_wb_attr"+L+c.instanceId).value;if(a.isNull(w)||0===w.length){alert(a.gv.getLabel("MAPVIEWER_9060")+" ["+S[L]+"]");return}var m=b.getAttributeType(S[L]);
if(a.notNull(m)&&"string"!==m&&!0===isNaN(w)){alert(a.gv.getLabel("MAPVIEWER_9059")+" ["+S[L]+"]");return}}var w=document.getElementById("_wb_attr0"+c.instanceId).value,L={},m=!1,v=p.getAttributes(),fa=null,E=null,J=null;if(b.type===ma.TYPE_PREDEFINED||b.type===ma.TYPE_JDBC)for(fa in v){E=fa.toUpperCase();J=p.getAttributeValue(E);for(m=0;m<S.length;m++)if(S[m]===E){J=document.getElementById("_wb_attr"+m+c.instanceId).value;break}L[E]=J;m=!0}else for(fa in v)E=fa.toUpperCase(),L[E]=p.getAttributeValue(E),
m=!0;w=new a.Feature(w,A);m&&(w.attributes=L);a.notNull(p.parentLayer.changeManager)?(L=a.edit.EditChangeEvent,p.parentLayer.getUndoManager().startChangeBlock("detach feature element"),L=p.parentLayer.changeManager.updateFeature(p.id,p,z,L.SPATIAL_UPDATE),a.notNull(L)&&p.parentLayer.getUndoManager().addEdit({feature:p,changeManager:p.parentLayer.changeManager,editChangeEvent:L,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"update feature element"},
undo:function(){this.changeManager.undo(this.editChangeEvent);this.feature.fire(a.event.LayerEvent.FEATURE_EDITED);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()},redo:function(){this.changeManager.redo(this.editChangeEvent);this.feature.fire(a.event.LayerEvent.FEATURE_EDITED);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()}}),L=p.parentLayer.changeManager.addFeature(w.id,w),a.notNull(L)&&p.parentLayer.getUndoManager().addEdit({changeManager:p.parentLayer.changeManager,
editChangeEvent:L,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"feature added"},undo:function(){this.changeManager.undo(this.editChangeEvent)},redo:function(){this.changeManager.redo(this.editChangeEvent)}}),p.parentLayer.getUndoManager().endChangeBlock("detach feature element")):p.parentLayer.addFeature(w);p.setGeometry(z);p.fire(a.event.LayerEvent.FEATURE_EDITED);p.deleteEditingProperties();p.addEditProperties(!0);a.$(this).dialog("close")}},{text:a.gv.getLabel("MAPVIEWER_WB_CANCEL"),
click:function(){a.$(this).dialog("close")}}],close:function(a,b){}})}}}}}};m=function(){if(J.editable&&p){var b="\x3ctr\x3e\x3ctd\x3e\x3ctable\x3e",L,w,m,z,A,S=[],ma=[];m=-1;if(p.parentFeature)if(L=p.parentFeature.getGeometry(),w=L.getDimension(),"OrientedPoint"===L.type)for(var Aa=0;Aa<w;Aa++)S.push(L.getDimensionValue(Aa)),ma.push(L.getOrientationValue(Aa));else{Aa=p.id.indexOf("shapePoints");Aa=p.id.substring(Aa+11).split("_");m=parseInt(Aa[0]);z=parseInt(Aa[1]);A=parseInt(Aa[2]);Aa=[];"MultiPolygon"===
L.type?Aa=L.getOrdinates():"MultiLineString"===L.type?Aa=[L.getOrdinates()]:"Polygon"===L.type?Aa=[L.getOrdinates()]:"LineString"===L.type&&(Aa=[[L.getOrdinates()]]);for(var Sa=0;Sa<w;Sa++)S.push(Aa[m][z][A*w+Sa])}else if(L=p.getGeometry(),w=L.getDimension(),"Point"===L.type)for(Aa=0;Aa<w;Aa++)S.push(L.getDimensionValue(Aa));else{var Sa=fa.location.left,xb=fa.location.top,Aa=p.parentLayer.parentMap.getScreenPointLocation(Sa,xb),xb=p.parentLayer.parentMap.getScreenPointLocation(Sa-5,xb-5),Sa=Aa.coordinates[0]-
xb.coordinates[0],xb=xb.coordinates[1]-Aa.coordinates[1],Sa=Math.sqrt(Sa*Sa+xb*xb);m=a.util.GeomUtil.findGeometryElement(L,Aa.coordinates[0],Aa.coordinates[1],Sa);if(-1!==m&&"MultiPoint"===L.type)for(Aa=0;Aa<w;Aa++)S.push(L.getOrdinates()[m][Aa])}for(Aa=0;Aa<w;Aa++)Sa=document.getElementById("_wb_dim"+Aa+c.instanceId),a.notNull(Sa)&&(Sa.outerHTML=""),b+="\x3ctr\x3e\x3ctd\x3e"+a.gv.getLabel("MAPVIEWER_WB_DIMENSION")+" "+Aa+"\x3c/td\x3e\x3ctd\x3e\x3cinput type\x3d'text' style\x3d'width:340px'  id\x3d'_wb_dim"+
Aa+c.instanceId+"' value\x3d"+S[Aa]+"\x3e\x3c/td\x3e\x3c/tr\x3e";if(0<ma.length)for(Aa=0;Aa<w;Aa++)Sa=document.getElementById("_wb_orient"+Aa+c.instanceId),a.notNull(Sa)&&(Sa.outerHTML=""),b+="\x3ctr\x3e\x3ctd\x3e"+a.gv.getLabel("MAPVIEWER_WB_ORIENTATION")+" "+Aa+"\x3c/td\x3e\x3ctd\x3e\x3cinput type\x3d'text' style\x3d'width:340px'  id\x3d'_wb_orient"+Aa+c.instanceId+"' value\x3d"+ma[Aa]+"\x3e\x3c/td\x3e\x3c/tr\x3e";b+="\x3c/table\x3e\x3c/td\x3e\x3c/tr\x3e";c.$pointdialog=a.$('\x3cdiv id\x3d"_wb_dialog'+
c.mapInstanceId+'" title\x3d"'+a.gv.getLabel("MAPVIEWER_WB_GEOM_PROPERTIES")+'" style\x3d"overflow:visible"\x3e\x3ctable width\x3d100% cellSpacing\x3d0 borderSpacing\x3d0 style\x3d\'font-size:13px\'\x3e'+b+"\x3c/table\x3e\x3c/div\x3e");c.$pointdialog.dialog({position:{of:c.$oracleMapDiv,at:"center"},resizable:!1,width:a.browser.touchSupported||a.gv.isWin8Touch?450:510,height:a.browser.touchSupported||a.gv.isWin8Touch?300:360,buttons:[{closeOnEscape:!0,text:a.gv.getLabel("MAPVIEWER_WB_UPDATE"),click:function(){for(var b=
a.util.ValidationUtil.isNumber,fa=0;fa<S.length;fa++)if(!b(document.getElementById("_wb_dim"+fa+c.instanceId).value)){alert(a.gv.getLabel("MAPVIEWER_9059")+" ["+a.gv.getLabel("MAPVIEWER_WB_DIMENSION")+":"+fa+"]");return}for(fa=0;fa<ma.length;fa++)if(!b(document.getElementById("_wb_orient"+fa+c.instanceId).value)){alert(a.gv.getLabel("MAPVIEWER_9059")+" ["+a.gv.getLabel("MAPVIEWER_WB_ORIENTATION")+":"+fa+"]");return}var E=fa=b=null,Q=null;if(p.parentFeature)if(fa=p.parentFeature,L=p.parentFeature.getGeometry(),
b=L.clone(!0),w=L.getDimension(),"OrientedPoint"===L.type){for(E=0;E<w;E++)b.setDimensionValue(E,parseFloat(document.getElementById("_wb_dim"+E+c.instanceId).value)),b.setOrientationValue(E,parseFloat(document.getElementById("_wb_orient"+E+c.instanceId).value));E=fa.screenPoints;Q={x:E.x,y:E.y,angle:E.angle};E.angle=-Math.atan2(b.getOrientationValue(1),b.getOrientationValue(0))}else for(var J=b.getOrdinates(),lb=0;lb<w;lb++)"MultiPolygon"===L.type?J[m][z][A*w+lb]=parseFloat(document.getElementById("_wb_dim"+
lb+c.instanceId).value):"MultiLineString"===L.type?J[z][A*w+lb]=parseFloat(document.getElementById("_wb_dim"+lb+c.instanceId).value):"Polygon"===L.type?J[z][A*w+lb]=parseFloat(document.getElementById("_wb_dim"+lb+c.instanceId).value):"LineString"===L.type&&(J[A*w+lb]=parseFloat(document.getElementById("_wb_dim"+lb+c.instanceId).value));else if(fa=p,L=p.getGeometry(),b=L.clone(!0),w=L.getDimension(),"Point"===L.type)for(J=0;J<w;J++)b.setDimensionValue(J,parseFloat(document.getElementById("_wb_dim"+
J+c.instanceId).value));else if(-1!==m&&"MultiPoint"===L.type)for(J=b.getOrdinates(),lb=0;lb<w;lb++)J[m][lb]=parseFloat(document.getElementById("_wb_dim"+lb+c.instanceId).value);a.notNull(b)&&(a.notNull(fa.parentLayer.changeManager)&&(J=fa.parentLayer.changeManager.updateFeature(fa.id,fa,b,a.edit.EditChangeEvent.SPATIAL_UPDATE),a.notNull(J)&&fa.parentLayer.getUndoManager().addEdit({feature:fa,changeManager:fa.parentLayer.changeManager,editChangeEvent:J,screenPointsOld:Q,screenPointNew:E,canUndo:function(){return!0},
canRedo:function(){return!0},getPresentationName:function(){return"point orientation change"},undo:function(){this.changeManager.undo(this.editChangeEvent);"OrientedPoint"===this.feature.geo.type&&(this.feature.screenPoints=this.screenPointsOld);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()},redo:function(){this.changeManager.redo(this.editChangeEvent);"OrientedPoint"===this.feature.geo.type&&(this.feature.screenPoints=this.screenPointsNew);this.feature.deleteEditingProperties();
this.feature.selected&&this.feature.addEditProperties()}})),fa.setGeometry(b),"OrientedPoint"===fa.geo.type&&(fa.screenPoints=E),fa.deleteEditingProperties(),fa.addEditProperties());a.$(this).dialog("close")}},{text:a.gv.getLabel("MAPVIEWER_WB_CANCEL"),click:function(){a.$(this).dialog("close")}}],close:function(a,b){}})}};if(a.notNull(p.parentFeature))"OrientedPoint"!==p.parentFeature.geo.type&&fa.addMenuItem(a.gv.getLabel("MAPVIEWER_WB_DELETE"),z),fa.addMenuItem(a.gv.getLabel("MAPVIEWER_WB_PROPERTIES"),
m);else{z=p.geo.type;if("MultiPolygon"===z||"MultiLineString"===z||"MultiPoint"===z||"MultiOrientedPoint"===z||"GeometryCollection"===z)fa.addMenuItem(a.gv.getLabel("MAPVIEWER_WB_DELETE_ELEMENT"),b),fa.addMenuItem(a.gv.getLabel("MAPVIEWER_WB_UNGROUP_ELEMENT"),w);("Point"===z||"OrientedPoint"===z||"MultiPoint"===z||"MultiOrientedPoint"===z)&&this.editable&&fa.addMenuItem(a.gv.getLabel("MAPVIEWER_WB_PROPERTIES"),m)}fa.show=!0;this.parentFeature&&(this.parentFeature.contextMenu=fa)}};this.registerUpdate=
function(b,c,w,m){a.isNull(b)||a.isNull(c)||a.isNull(w)||(c===w?w.parentLayer.getUndoManager().addEdit({feature:w,changeManager:w.parentLayer.changeManager,editChangeEvent:b,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return m},undo:function(){this.changeManager.undo(this.editChangeEvent);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()},redo:function(){this.changeManager.redo(this.editChangeEvent);this.feature.deleteEditingProperties();
this.feature.selected&&this.feature.addEditProperties()}}):w.parentLayer.getUndoManager().addEdit({feature:c,changeManager:w.parentLayer.changeManager,editChangeEvent:b,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return m},undo:function(){this.changeManager.undo(this.editChangeEvent)},redo:function(){this.changeManager.redo(this.editChangeEvent)}}))}},init:function(){this.relatedFeature=[]},startDrag:function(b,c){var w=this;if(!a.gv.featureDragDisabled(w)&&
!w.dragging){var z=w.parentLayer.parentMap.$oracleMapDiv.offset();w.startX=b.clientX+z.left;w.startY=b.clientY+z.top;w.lastX=b.clientX+z.left;w.lastY=b.clientY+z.top;w.parentLayer.parentMap.enableMapAction.drag?w.parentLayer.parentMap.enableMapDrag(!1):w.lockedParMap=!0;this.dragging=!0;if(a.notNull(w.parentFeature)&&c){z=w.parentFeature;z.relatedFeature=[];var J=z.featureEditingProperties;w.orientation?(z=z.featureEditingProperties.shapePoints[0][0][0],w.centerX=z.screenPoints.x,w.centerY=z.screenPoints.y,
w.posX=this.screenPoints.x,w.posY=this.screenPoints.y,w.endDragOrietation=function(){var b=w.parentLayer;b.parentMap.enableMapDrag(!0);var c=w.screenPoints.x-w.centerX,fa=w.centerY-w.screenPoints.y;w.startX=null;w.startY=null;w.posX=null;w.posY=null;var m,p,z=w.parentFeature;if(z.tool)m=z.tool.currentPoint,p=new a.geometry.Point(m.getX(),m.getY(),m.srid,c,fa),z.tool.currentPoint=p;else{m=z.geo;p=new a.geometry.Point(m.getX(),m.getY(),m.srid,c,fa);if(2<m.dim)for(var S=2;S<m.dim;S++){var Q=m.getOrientationValue(S),
v=m.getDimensionValue(S);p.addDimension(v,Q)}m=z.screenPoints;S={x:m.x,y:m.y,angle:m.angle};m.angle=-Math.atan2(fa,c);a.notNull(z.parentLayer.changeManager)&&(c=z.parentLayer.changeManager.updateFeature(z.id,z,p,a.edit.EditChangeEvent.SPATIAL_UPDATE),a.notNull(c)&&z.parentLayer.getUndoManager().addEdit({feature:z,changeManager:z.parentLayer.changeManager,editChangeEvent:c,screenPointsOld:S,screenPointNew:m,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"point orientation change"},
undo:function(){this.changeManager.undo(this.editChangeEvent);this.feature.screenPoints=this.screenPointsOld;var a=new J(J.FEATURE_MOVED,this.feature);this.feature.fire(J.FEATURE_MOVED,a);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()},redo:function(){this.changeManager.redo(this.editChangeEvent);this.feature.screenPoints=this.screenPointNew;var a=new J(J.FEATURE_MOVED,this.feature);this.feature.fire(J.FEATURE_MOVED,a);this.feature.deleteEditingProperties();
this.feature.selected&&this.feature.addEditProperties()}}));z.setGeometry(p);z.screenPoints=m}w.dragging=!1;b.labelsVisible()&&b.parentMap.refreshVectorLayerLabels();var J=a.event.LayerEvent,b=new J(J.FEATURE_MOVED,w);w.fire(b)}):w.pos?(J.shapePoints[0][0][1].setVisible(!1),J.shapePoints[0][0][2].setVisible(!1)):this.calRelatedFeature(J,w)}}},calRelatedFeature:function(a,b){this.point_dragging=!0;var c=b.parentFeature;b.relatedFeature=[];var z,J,L,K,A,m,p;z=0;for(L=a.shapePoints.length;z<L;z++)for(J=
0,K=a.shapePoints[z].length;J<K;J++)for(A=a.shapePoints[z][J].length;A--;)if(m=a.shapePoints[z][J],p=a.possiblePoints[z][J],m[A]===b&&("Polygon"===c.geo.type||"LineString"===c.geo.type||"MultiPolygon"===c.geo.type||"MultiLineString"===c.geo.type)){if(0!==A)b.relatedFeature.push(p[A-1]),b.relatedFeature.push(m[A-1]);else if("Polygon"===c.geo.type||"MultiPolygon"===c.geo.type)b.relatedFeature.push(p[m.length-1]),b.relatedFeature.push(m[p.length-1]);b.relatedFeature.push(p[A]);if(A===m.length-1&&("Polygon"===
c.geo.type||"MultiPolygon"===c.geo.type))A=-1;else if(A===m.length-1)return;b.relatedFeature.push(m[A+1]);return}z=0;for(L=a.possiblePoints.length;z<L;z++)for(J=0,K=a.possiblePoints[z].length;J<K;J++)for(A=a.possiblePoints[z][J].length;A--;)if(m=a.shapePoints[z][J],p=a.possiblePoints[z][J],p[A]==b&&("Polygon"==c.geo.type||"LineString"==c.geo.type||"MultiPolygon"===c.geo.type||"MultiLineString"===c.geo.type)){b.relatedFeature.push(A);b.relatedFeature.push(m[A]);A==m.length-1&&(A=-1);b.relatedFeature.push(m[A+
1]);b.relatedFeature.push(J);b.relatedFeature.push(z);return}},featureDragging:function(b){this._activeIndex=this.parentLayer.parentMap.getCursorLocation().wraparoundMapIndex;this.dragging_flag||(this.dragging_flag=this._activeIndex,a.isNull(this.dragging_flag)&&(this.dragging_flag=!1));var c;if(this.parentLayer&&!a.gv.featureDragDisabled(this)){var w=this.parentLayer.parentMap.getMapContext();c=w.getUniverse().getZoomLevels()[w.getZoomLevel()];var w=a.event.LayerEvent,z=b.pageX-this.lastX,J=b.pageY-
this.lastY,L=z*c.resolution;if(!this.mbrMaxX||!this.mbrMinX){var K=new a.geometry.Point(this.geo.getMBR().getMaxX(),this.geo.getMBR().getMaxY(),this.geo.srid),A=new a.geometry.Point(this.geo.getMBR().getMinX(),this.geo.getMBR().getMinY(),this.geo.srid),K=this.parentLayer.parentMap.getACL(K,this.dragging_flag),A=this.parentLayer.parentMap.getACL(A,this.dragging_flag);this.mbrMaxX=K.getX();this.mbrMinX=A.getX()}this.mbrMaxX+=L;this.mbrMinX+=L;if(this.parentLayer.parentMap.wraparound&&!this.point_dragging&&
(this.mbrMaxX>=this.parentLayer.parentMap.mapBBox[this.dragging_flag].maxX||this.mbrMinX<=this.parentLayer.parentMap.mapBBox[this.dragging_flag].minX)||this.parentLayer.parentMap.wraparound&&!(this.mbrMaxX<=this.parentLayer.parentMap.mapBBox[this.dragging_flag].maxX&&this.mbrMinX>=this.parentLayer.parentMap.mapBBox[this.dragging_flag].minX))this.lastX=b.pageX,this.lastY=b.pageY;else{this.mouseLocX=b.pageX;this.mouseLocY=b.pageY;this.moving=!0;if(this.orientation){this.posX+=z;this.posY+=J;L=Math.atan2(this.centerY-
this.posY,this.posX-this.centerX);A=this.parentFeature;K=A.geo;A.tool&&(K=A.tool.currentPoint);var m=K.getOrientationPoint(a.layer.EditableFeature.MARKER_SIZE+20,c,L);this.setGeometry(m);m=K.getOrientationPoint(a.layer.EditableFeature.MARKER_SIZE/2,c,L);c=K.getOrientationPoint(a.layer.EditableFeature.MARKER_SIZE/2+20,c,L);c=new a.geometry.LineString([m.getX(),m.getY(),c.getX(),c.getY()],m.srid);A.featureEditingProperties.shapePoints[0][0][2].setGeometry(c);c=new a.event.LayerEvent(a.event.LayerEvent.FEATURE_ORIENTATION_CHANGING,
this.parentLayer);c.angle=L;A.fire(w.FEATURE_ORIENTATION_CHANGING,c)}else if(this.shapeGroup)for(L=this.shapeGroup.length,c=0;c<L;c++)this.shapeGroup[c].translate(z,J);else if(this.scale&&("Point"===this.geo.type||"OrientedPoint"===this.geo.type))z/=this.scale,J/=this.scale,this.shape.translate(z,J);else if(a.notNull(this.shape))if(this.parentLayer.parentMap.wraparound&&!this.point_dragging)for(c=0;c<this.parentLayer.featureGroupArr.length;c++)this.parentLayer.featureGroupArr[c].translate(z,J);else{if(this.dragging_flag!==
this._activeIndex&&this.parentLayer.parentMap.wraparound)return;this.shape.translate(z,J)}this.lastX=b.pageX;this.lastY=b.pageY;this.labelShape&&!this.ghostShape&&this.labelShape.translate(z,J);z=new w(w.FEATURE_MOVING,this);z.orgEvt=b;this.fire(w.FEATURE_MOVING,z);a.notNull(this.parentFeature)&&this.parentFeature.fire(w.FEATURE_MOVING,z);!this.refresh_dragging&&this.parentLayer.parentMap.wraparound&&this.parentLayer.parentMap.getLayerByName("ii_oracle_maps_internal_editing").refresh()}}},endDrag:function(){this.mbrMinX=
this.mbrMaxX=null;var b=this.parentLayer;if(!a.isNull(b)&&!a.gv.featureDragDisabled(this)){this.dragging=!1;b.parentMap.enableMapAction.drag||(this.lockedParMap?b.parentMap.enableMapDrag(!1):b.parentMap.enableMapDrag(!0));var c,w;if(this.moving){this.moving=!1;var z=this.startX-this.mouseLocX,J=this.startY-this.mouseLocY;(z||J)&&this.deleteEditingProperties();var L=b.parentMap.getMapContext(),L=L.getUniverse().getZoomLevels()[L.getZoomLevel()];w=this.getGeometry().clone(!0);this.point_dragging&&this.dragging_flag!==
this._activeIndex&&this.parentLayer.parentMap.wraparound?(a.util.Logger.warning(0,"Point is out of bounding",""),this.point_dragging=!1):this.move(z,J,L);this.startY=this.startX=null;var K=this.getGeometry().clone(!0),A=this.editing;c=this;if(a.notNull(this.parentFeature)&&"OrientedPoint"===this.parentFeature.geo.type){A=this.parentFeature.editing;b=this.parentFeature.parentLayer;c=this.parentFeature;w=this.parentFeature.getGeometry().clone(!0);var m=K.getX(),p=K.getY(),K=this.parentFeature.getGeometry().clone(!0);
K.setPoint(m,p)}A&&a.notNull(b.changeManager)&&(c.geo=w,w=b.changeManager.updateFeature(c.id,c,K,a.edit.EditChangeEvent.SPATIAL_UPDATE),a.notNull(w)&&b.getUndoManager().addEdit({feature:c,changeManager:b.changeManager,editChangeEvent:w,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"feature move"},undo:function(){this.changeManager.undo(this.editChangeEvent);var a=new E(E.FEATURE_MOVED,this.feature);this.feature.fire(E.FEATURE_MOVED,a);this.feature.deleteEditingProperties();
this.feature.selected&&this.feature.addEditProperties()},redo:function(){this.changeManager.redo(this.editChangeEvent);var a=new E(E.FEATURE_MOVED,this.feature);this.feature.fire(E.FEATURE_MOVED,a);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()}}));b.labelsVisible()&&b.parentMap.refreshVectorLayerLabels();var E=a.event.LayerEvent;this.pos&&(c=this.parentFeature,w=c.featureEditingProperties,w.shapePoints[0][0][1].move(z,J,L),w.shapePoints[0][0][1].shape.translate(-z,
-J),w.shapePoints[0][0][2].move(z,J,L),w.shapePoints[0][0][2].shape.translate(-z,-J),w.shapePoints[0][0][1].setVisible(!0),w.shapePoints[0][0][2].setVisible(!0),w=this.geo.getX(),K=this.geo.getY(),c.tool?c.tool.currentPoint.setPoint(w,K):(L=c.geo,L.setPoint(w,K),w={x:this.screenPoints.x,y:this.screenPoints.y,angle:c.screenPoints.angle},c.setGeometry(L),c.screenPoints=w));L=new E(E.FEATURE_MOVED,this);this.fire(E.FEATURE_MOVED,L);a.notNull(this.parentFeature)&&this.parentFeature.fire(E.FEATURE_MOVED,
L);this.addEditProperties(!0);b.parentMap.wraparound&&(this.refresh_dragging=!1,b.parentMap.getLayerByName("ii_oracle_maps_internal_editing").refresh(),b.parentMap.getLayerByName("ii_oracle_maps_internal_others").refresh());return z&&J}this.pos&&(c=this.parentFeature,w=c.featureEditingProperties,w.shapePoints[1].setVisible(!0),w.shapePoints[2].setVisible(!0))}},addEditProperties:function(){if(!a.notNull(this.parentFeature)){var b=this.getGeometry();if("Polygon"===b.type||"LineString"===b.type||"MultiPolygon"===
b.type||"Point"===b.type||"OrientedPoint"===b.type||"MultiLineString"===b.type||"MultiPoint"===b.type){var c=b.getDimension();"MultiPolygon"!==b.type&&"MultiLineString"!==b.type&&"MultiPoint"!==b.type&&"OrientedMultiPoint"!==b.type&&"GeometryCollection"!==b.type&&"Point"!==b.type&&"OrientedPoint"!==b.type||this.addListener(a.event.MouseEvent.MOUSE_RIGHT_CLICK,this.showContextMenu);var w=a.layer.EditableFeature,z=this.parentLayer.parentMap.getMapContext().getUniverse(),J=this.parentLayer.parentMap.getDefaultFeatureLayer(),
L={shapePoints:[],possiblePoints:[]};this.featureEditingProperties=L;if("OrientedPoint"==b.type){L.shapePoints[0]=[];L.shapePoints[0][0]=[];var K=new a.geometry.Point(b.getX(),b.getY(),b.srid),z=new a.layer.EditableFeature(this.id+"pos",K,{renderingStyle:w.pointStyle});z.addListener(a.event.MouseEvent.MOUSE_RIGHT_CLICK,z.showContextMenu);z.parentFeature=this;z.pos=!0;J.addFeature(z);L.shapePoints[0][0].push(z);K=this.parentLayer.parentMap.getMapContext();z=K.getUniverse();z=z.getZoomLevels()[K.getZoomLevel()];
K=b.getOrientationPoint(a.layer.EditableFeature.MARKER_SIZE+20,z);K=new a.layer.EditableFeature(this.id+"orien",K,{renderingStyle:w.ORIENTATION_POINT_STYLE});K.parentFeature=this;K.orientation=!0;J.addFeature(K);L.shapePoints[0][0].push(K);K=b.getOrientationPoint(a.layer.EditableFeature.MARKER_SIZE/2,z);z=b.getOrientationPoint(a.layer.EditableFeature.MARKER_SIZE/2+20,z);z=new a.geometry.LineString([K.getX(),K.getY(),z.getX(),z.getY()],K.srid);z=new a.Feature(this.id+"orienline",z,{renderingStyle:w.ORIENTATION_LINE_STYLE});
z.parentFeature=this;J.addFeature(z);L.shapePoints[0][0].push(z)}z=[];if("MultiPolygon"===b.type)z=b.getOrdinates();else if("MultiLineString"===b.type)z=[b.getOrdinates()];else if("Polygon"===b.type)z=[b.getOrdinates()];else if("LineString"===b.type)z=[[b.getOrdinates()]];else return;for(var K=0,A=z.length;K<A;K++){var m=z[K];m[0]instanceof Array||(m=[m[0]]);L.shapePoints[K]=[];L.possiblePoints[K]=[];for(var p=0;p<m.length;p++){L.shapePoints[K][p]=[];L.possiblePoints[K][p]=[];for(var E=null,S=null,
Q=m[p],v,ha=0;ha<Q.length/c;ha++){var pa=Q[ha*c],ra=Q[ha*c+1];if("LineString"===b.type||"MultiLineString"===b.type||ha!==Q.length/c-1)v=new a.layer.EditableFeature(this.id+"shapePoints"+K+"_"+p+"_"+ha,new a.geometry.Point(pa,ra,b.srid),{renderingStyle:w.pointStyle}),v.parentFeature=this,v.ringIds=[K,p,ha],v.addListener(a.event.LayerEvent.FEATURE_MOVING,v.shapePointMoving),v.addListener(a.event.MouseEvent.MOUSE_RIGHT_CLICK,v.showContextMenu),v.addListener(a.event.LayerEvent.FEATURE_MOVED,v.shapePointMoved),
L.shapePoints[K][p].push(v),J.addFeature(v);a.notNull(E)&&a.notNull(S)&&(v=new a.layer.EditableFeature(this.id+"possiblePoints"+K+"_"+p+"_"+(ha-1),new a.geometry.Point(E+(pa-E)/2,S+(ra-S)/2,b.srid),{renderingStyle:w.possibleStyle}),v.parentFeature=this,v.ringIds=[K,p,ha],v.addListener(a.event.LayerEvent.FEATURE_MOVING,v.possiblePointMoving),v.addListener(a.event.LayerEvent.FEATURE_MOVED,v.possiblePointMoved),L.possiblePoints[K][p].push(v),J.addFeature(v));E=pa;S=ra}}}this.addResizeHandles();this.calDistance()}}},
addResizeHandles:function(b){if(!a.notNull(a.gv.showManipulator)||!1!==a.gv.showManipulator){var c=this.getGeometry(),w=c.getType();if("Polygon"===w||"MultiPolygon"===w||"LineString"===w||"MultiLineString"===w){var w=this.parentLayer.parentMap.getDefaultFeatureLayer(),z=w.parentMap.getMapContext(),J=z.getUniverse().getZoomLevels()[z.getZoomLevel()],L=new a.style.Color({stroke:"#FF0080",strokeThickness:2,strokeOpacity:.5}),z=this.featureEditingProperties,K=c.getMBR(),A=K.coordinates[0],m=K.coordinates[1],
p=K.coordinates[2],E=K.coordinates[3],S;if(!z.resizePoints)z.resizePoints=[];else if(b){S=b.target;var K=new this.graphics.oui.geom.Matrix,Q=-(S.startX-S.mouseLocX)*J.resolution,v=(S.startY-S.mouseLocY)*J.resolution*J.stretchRatio,ha=S.getGeometry().coordinates,pa=S.anchor,Q=ha[0]+Q,v=ha[1]+v;if(S===z.rotateHandle)if(this.parentLayer.parentMap.wraparound)a.util.Logger.warning("MAPVIEWER_9010","OM.EditableFeature.startEditing","Not support rotation for wraparound");else{if(p=Math.atan2(v-pa.y,Q-pa.x),
K.translate(pa.x,pa.y),K.rotate(p),K.translate(-pa.x,-pa.y),z.resizeMBR&&z.resizeMBR.setVisible(!1),z.resizePoints)for(m=0;m<z.resizePoints.length;m++)(E=z.resizePoints[m])&&E.setVisible(!1)}else p=(Q-pa.x)/(p-A)*S.correction.x,m=(v-pa.y)/(E-m)*S.correction.y,S.id===this.id+"resizePointsN"||S.id===this.id+"resizePointsS"?p=b.orgEvt.shiftKey?m:1:S.id===this.id+"resizePointsW"||S.id===this.id+"resizePointsE"?m=b.orgEvt.shiftKey?p:1:b.orgEvt.shiftKey&&(m=p=Math.max(p,m)),K.translate(pa.x,pa.y),K.scale(p,
m),K.translate(-pa.x,-pa.y);p=a.util.GeomUtil.getTransformedGeometry(c,K);z.transitFeature?z.transitFeature.setGeometry(p):(m=new a.style.Line({stroke:"#8684F3",strokeThickness:3,strokeOpacity:.5}),m=new a.layer.EditableFeature(this.id+"transitFeature",p,{renderingStyle:m}),m.parentFeature=this,z.transitFeature=m,w.addFeature(m));b=p.getMBR();A=b.coordinates[0];m=b.coordinates[1];p=b.coordinates[2];E=b.coordinates[3]}b=A+(p-A)/2;for(var K=m+(E-m)/2,pa="NW N NE E SE S SW W".split(" "),A=[A,b,p,p,p,
b,A,A],v=[E,E,E,K,m,m,m,K],ha=[-1,1,1,1,1,1,-1,-1],Q=[1,1,1,1,-1,-1,-1,1],ra=[],m=0;m<A.length;m++){ra.push(A[m]);ra.push(v[m]);var E=z.resizePoints[m],Ca=new a.geometry.Point(A[m],v[m],c.srid);E?E!==S&&E.setGeometry(Ca):(E=new a.layer.EditableFeature(this.id+"resizePoints"+pa[m],Ca,{renderingStyle:a.layer.EditableFeature.resizeHandleStyle}),E.parentFeature=this,E.correction={x:ha[m],y:Q[m]},E.addListener(a.event.LayerEvent.FEATURE_MOVING,E.resizePointMoving),E.addListener(a.event.LayerEvent.FEATURE_MOVED,
E.resizePointMoved),z.resizePoints.push(E),w.addFeature(E),E.anchor=4>m?{x:A[m+4],y:v[m+4]}:{x:A[m-4],y:v[m-4]})}ra.push(A[0]);ra.push(v[0]);m=new a.geometry.LineString(ra,c.srid);if(z.resizeMBR)z.resizeMBR.setGeometry(m);else{var L=new a.Feature(this.id+"resizePointsMBR",m,{renderingStyle:L}),va=this.id+"resizePointsMBR";L.parentFeature=this;z.resizeMBR=L;L.addListener(a.event.MouseEvent.MOUSE_DOWN,function(a){a.target.id===va&&(a.target.sendBackward(),a.evt.stopPropagation())});w.addFeature(L)}c=
new a.geometry.Point(p+20*J.resolution,K,c.srid);z.rotateHandle?z.rotateHandle!==S&&z.rotateHandle.setGeometry(c):(S=new a.layer.EditableFeature(this.id+"rotateHandle",c,{renderingStyle:a.layer.EditableFeature.rotateHandleStyle}),S.parentFeature=this,S.anchor={x:b,y:K},S.addListener(a.event.LayerEvent.FEATURE_MOVING,S.resizePointMoving),S.addListener(a.event.LayerEvent.FEATURE_MOVED,S.resizePointMoved),z.rotateHandle=S,w.addFeature(S))}}},calDistance:function(){for(var b=this.getGeometry(),c=null,
c="Polygon"===b.type||"MultiLineString"===b.type?[b.coordinates]:"Polygon"===b.type?b.coordinates:[[b.coordinates]],w=b.getDimension(),z=this.featureEditingProperties,J=0,L=c.length;J<L;J++)for(var K=0,A=c[J].length;K<A;K++){var m=c[J][K].length/w;"Polygon"!==b.type&&"MultiPolygon"!==b.type||m--;for(var p=0;p<m;p++){var E=p+1;if(E===m&&("Polygon"===b.type||"MultiPolygon"===b.type))E=0;else if(E===m)break;var S=z.shapePoints[J][K][p].geo.getX(),Q=z.shapePoints[J][K][p].geo.getY(),v=z.shapePoints[J][K][E].geo.getX(),
E=z.shapePoints[J][K][E].geo.getY(),ha=this.parentLayer.parentMap.getMapContext(),ha=ha.getUniverse().getZoomLevels()[ha.getZoomLevel()],S=Math.pow(Math.pow((S-v)/ha.resolution,2)+Math.pow((Q-E)/ha.resolution*ha.stretchRatio,2),.5);z.possiblePoints[J][K][p].setVisible(S>=a.layer.EditableFeature.NEAREST_DISTANCE)}}},startEditing:function(){if(!this.dragging&&!a.notNull(this.parentFeature)){var b=this.geo;if(!(b instanceof a.geometry.Circle||b instanceof a.geometry.Rectangle)){var c=a.layer.EditableFeature;
this.editing=!0;"Point"!==b.type&&"MultiPoint"!==b.type||!a.isNull(this.parentFeature)?"OrientedPoint"===b.type&&a.isNull(this.parentFeature)?(this.tool&&(this.tool.currentPoint=this.geo.clone(),b=this.tool,b.textFeature&&b.textFeature!==this&&b.textFeature.parentLayer.deselectFeature(b.textFeature),a.tool.WhiteBoardTool.showDialog(this.parentLayer.parentMap,this.tool,this)),this.remove(),this.displayed=!1,this.deleteEditingProperties(),this.addEditProperties(!0)):"Polygon"===b.type||"LineString"===
b.type||"MultiPolygon"===b.type||"MultiLineString"===b.type?(this.deleteEditingProperties(),this.addEditProperties(!0),this.parentLayer.parentMap.on(a.event.MapEvent.I_MAP_CENTER_ZOOM,this.calDistance,this)):a.util.Logger.alert("MAPVIEWER_9010","OM.EditableFeature.startEditing",""):(this.normalStyle=this.renderingStyle,this instanceof a.TextFeature?a.notNull(this.editRenderingStyle)?this.setRenderingStyle(this.editRenderingStyle):this.setRenderingStyle(c.textStyle):this.setRenderingStyle(c.pointStyle),
this.deleteEditingProperties(),this.addEditProperties(!0))}}},startDragging:function(){if(!this.dragging&&!a.notNull(this.parentFeature)){var b=this.geo;b instanceof a.geometry.Circle||b instanceof a.geometry.Rectangle||(this.editing=!0,"Point"!==b.type&&"MultiPoint"!==b.type||!a.isNull(this.parentFeature)?"OrientedPoint"===b.type&&a.isNull(this.parentFeature)?(this.tool&&(this.tool.currentPoint=this.geo.clone(),b=this.tool,b.textFeature&&b.textFeature!==this&&b.textFeature.parentLayer.deselectFeature(b.textFeature),
a.tool.WhiteBoardTool.showDialog(this.parentLayer.parentMap,this.tool,this)),this.remove(),this.displayed=!1,this.deleteEditingProperties(),this.addEditProperties(!0)):a.util.Logger.alert("to be filed",a.EditableFeature.start):(this.normalStyle=this.renderingStyle,this.deleteEditingProperties(),this.addEditProperties(!0)))}},deleteEditingProperties:function(){a.isNull(this.parentFeature)&&this.deleteListener(a.event.MouseEvent.MOUSE_RIGHT_CLICK,this.showContextMenu);var c=this.featureEditingProperties,
fa=this.parentLayer.parentMap.getDefaultFeatureLayer();if(!a.isNull(c)){var w,z,J,L,K,A;w=0;for(L=c.shapePoints.length;w<L;w++)for(K=c.shapePoints[w].length,z=0;z<K;z++)for(A=c.shapePoints[w][z].length,J=0;J<A;J++)fa.removeFeature(c.shapePoints[w][z][J]);c.shapePoints=[];w=0;for(L=c.possiblePoints.length;w<L;w++)for(K=c.possiblePoints[w].length,z=0;z<K;z++)for(A=c.possiblePoints[w][z].length,J=0;J<A;J++)fa.removeFeature(c.possiblePoints[w][z][J]);c.possiblePoints=[];if(c.resizePoints){w=c.resizePoints.length;
for(z=0;z<w;z++)fa.removeFeature(c.resizePoints[z]);c.resizePoints=[]}c.resizeMBR&&(fa.removeFeature(c.resizeMBR),c.resizeMBR=b);c.transitFeature&&(fa.removeFeature(c.transitFeature),c.transitFeature=b);c.rotateHandle&&(fa.removeFeature(c.rotateHandle),c.rotateHandle=b);fa&&fa.group&&a.$("#"+fa.group._id).unbind();this.featureEditingProperties=null;this.contextMenu&&!0===this.contextMenu.show&&this.contextMenu.removeRightClickMenu()}},focusProperties:function(b){var c=this.featureEditingProperties;
if(a.isNull(c)&&(a.notNull(this.parentFeature)&&(c=this.parentFeature.featureEditingProperties),a.isNull(c)))return;var w=0,z,J,L,K;if(this.isEditProperties(b,c)){w=c.resizePoints.length;for(b=0;b<w;b++)c.resizePoints[b].bringToTop();c.resizeMBR&&c.resizeMBR.bringToTop()}else{w=c.shapePoints.length;for(z=0;z<w;z++)for(J=c.shapePoints[z].length,b=0;b<J;b++)for(L=c.shapePoints[z][b].length,K=0;K<L;K++)c.shapePoints[z][b][K].bringToTop();w=c.possiblePoints.length;for(z=0;z<w;z++)for(J=c.shapePoints[z].length,
b=0;b<J;b++)for(L=c.possiblePoints[z][b].length,K=0;K<L;K++)c.possiblePoints[z][b][K].bringToTop()}},isEditProperties:function(b,c){var w=b.id;if(a.isNull(c))return!1;if(c.resizePoints)for(var z=c.resizePoints.length,J=0;J<z;J++)if(c.resizePoints[J].id===w)return!0;return c.resizeMBR&&c.resizeMBR.id===w?!0:!1},shapePointMoved:function(b){a.notNull(a.gv.allowFeaturePointsInteraction)&&!1===a.gv.allowFeaturePointsInteraction||(this.point_dragging=this.dragging=!1,this.parentFeature.featurePointMoved(b,
!0),b=new a.event.LayerEvent(a.event.LayerEvent.FEATURE_EDITED,this.parentFeature),this.parentFeature.fire(a.event.LayerEvent.FEATURE_EDITED,b))},possiblePointMoved:function(b){a.notNull(a.gv.allowFeaturePointsInteraction)&&!1===a.gv.allowFeaturePointsInteraction||(this.point_dragging=this.dragging=!1,this.parentFeature.featurePointMoved(b,!1),b=new a.event.LayerEvent(a.event.LayerEvent.FEATURE_EDITED,this.parentFeature),this.parentFeature.fire(a.event.LayerEvent.FEATURE_EDITED,b))},resizePointMoved:function(){this.mbrMinX=
this.mbrMaxX=null;if(!a.notNull(a.gv.allowFeaturePointsInteraction)||!1!==a.gv.allowFeaturePointsInteraction){var b=this.parentFeature,c=b.featureEditingProperties.transitFeature,w=c.getGeometry().clone();a.notNull(b.parentLayer.changeManager)&&(w=b.parentLayer.changeManager.updateFeature(b.id,b,w,a.edit.EditChangeEvent.SPATIAL_UPDATE),a.notNull(w)&&b.parentLayer.getUndoManager().addEdit({feature:b,changeManager:b.parentLayer.changeManager,editChangeEvent:w,canUndo:function(){return!0},canRedo:function(){return!0},
getPresentationName:function(){return"feature transform"},undo:function(){this.changeManager.undo(this.editChangeEvent);this.feature.fire(a.event.LayerEvent.FEATURE_EDITED);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()},redo:function(){this.changeManager.redo(this.editChangeEvent);this.feature.fire(a.event.LayerEvent.FEATURE_EDITED);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()}}));b.setGeometry(c.getGeometry());
b.fire(a.event.LayerEvent.FEATURE_EDITED);b.deleteEditingProperties();b.addEditProperties(!0)}},digHole:function(){console.info("hole")},deleteShapePoint:function(b){if(!a.notNull(a.gv.allowFeaturePointsInteraction)||!1!==a.gv.allowFeaturePointsInteraction){var c=b.parentFeature,w=c.geo.dim,z=c.featureEditingProperties,J=b.parentLayer.parentMap.getDefaultFeatureLayer(),L=null,K=null,A=null,m=null,p=-1,E=0,S=0;b.ringIds&&2<b.ringIds.length&&(S=b.ringIds[0],E=b.ringIds[1]);var Q=z.shapePoints[S][E],
v=z.possiblePoints[S][E],ha;if("Polygon"===c.geo.type||"LineString"===c.geo.type||"MultiPolygon"===c.geo.type||"MultiLineString"===c.geo.type){p=Q.length;if(2>=p){a.util.Logger.alert("MAPVIEWER_9011","OM.EditableFeature.deleteShapePoint","");return}if(("Polygon"===c.geo.type||"MultiPolygon"===c.geo.type)&&3>=p){a.util.Logger.alert("MAPVIEWER_9012","OM.EditableFeature.deleteShapePoint","");return}for(;p--;)if(Q[p]===b){if(0!==p&&p!==Q.length-1)L=v[p-1],A=Q[p-1],K=v[p],m=Q[p+1],ha=A.geo.getX()+(m.geo.getX()-
A.geo.getX())/2,A=A.geo.getY()+(m.geo.getY()-A.geo.getY())/2,K.setGeometry(new a.geometry.Point(ha,A,b.geo.srid));else if("Polygon"===c.geo.type||"MultiPolygon"===c.geo.type)0===p?(L=v[v.length-1],A=Q[Q.length-1],K=v[p],m=Q[p+1]):p===Q.length-1&&(L=v[p-1],A=Q[p-1],K=v[p],m=Q[0]),ha=A.geo.getX()+(m.geo.getX()-A.geo.getX())/2,A=A.geo.getY()+(m.geo.getY()-A.geo.getY())/2,K.setGeometry(new a.geometry.Point(ha,A,b.geo.srid));else if("LineString"===c.geo.type||"MultiLineString"===c.geo.type)0===p?(K=v[p],
J.removeFeature(K),v.splice(p,1)):p===Q.length-1&&(L=v[p-1]);break}}for(K=0;K<Q.length;K++)if(Q[K]===b){Q.splice(K,1);J.removeFeature(b);break}if(L)for(K=0;K<v.length;K++)if(v[K]===L){v.splice(K,1);J.removeFeature(L);break}L=c.geo.getOrdinates();Q=[];for(J=0;J<z.shapePoints.length;J++)for(Q[J]=[],K=0;K<z.shapePoints[J].length;K++){Q[J][K]=[];for(ha=0;ha<z.shapePoints[J][K].length;ha++)if(z.shapePoints[J][K][ha].id=c.id+"shapePoints"+J+"_"+K+"_"+ha,Q[J][K].push(z.shapePoints[J][K][ha].geo.getX()),
Q[J][K].push(z.shapePoints[J][K][ha].geo.getY()),2<w)for(A=0,ha>=p&&J===S&&K===E&&A++,m=2;m<w;m++){var pa=0;"MultiPolygon"===c.geo.type&&(pa=L[J][K][(ha+A)*w+m]);"Polygon"===c.geo.type?pa=L[K][(ha+A)*w+m]:"LineString"===c.geo.type?pa=L[(ha+A)*w+m]:"MultiLineString"===c.geo.type&&(pa=L[K][(ha+A)*w+m]);Q[J][K].push(pa)}if("Polygon"===c.geo.type||"MultiPolygon"===c.geo.type)if(Q[J][K].push(z.shapePoints[J][K][0].geo.getX()),Q[J][K].push(z.shapePoints[J][K][0].geo.getY()),2<w)for(ha=2;ha<w;ha++)A=0,A=
"MultiPolygon"===c.geo.type?L[J][K][L[J][K].length-w+ha]:L[K][L[K].length-w+ha],Q[J][K].push(A)}var ra;"Polygon"===c.geo.type?ra=new a.geometry.Polygon(Q[0],c.geo.srid,w):"MultiPolygon"===c.geo.type?ra=new a.geometry.MultiPolygon(Q,c.geo.srid,w):"MultiLineString"===c.geo.type?ra=new a.geometry.MultiLineString(Q[0],c.geo.srid,w):"LineString"===c.geo.type&&(ra=new a.geometry.LineString(Q[0][0],c.geo.srid,w));p=ra.clone();w=[];w.push(c);z={};z[c.id]=p;if(c.parentLayer.hasSharedBoundary()&&(p=c.parentLayer.parentMap.getScreenLocation(b.geo),
E=c.parentLayer.parentMap.getScreenPointLocation(p.x-3,p.y-3),p=b.geo.getX()-E.coordinates[0],E=E.coordinates[1]-b.geo.getY(),p=Math.sqrt(p*p+E*E),b=[b.geo.getX(),b.geo.getY()],b=a.edit.GeometrySegmentUtil.getLayerSegmentPoints(c.parentLayer,b,p,!1,!1,!1,!1),a.notNull(b)))for(p=0;p<b.length;p++)E=b[p].getFeature().id,E!==c.id&&(S=b[p].getFeature().getGeometry().clone(!0),a.edit.GeometrySegmentUtil.removeVertexFromGeometry(S,b[p])&&(w.push(b[p].getFeature()),z[E]=S));if(a.notNull(c.parentLayer.changeManager)){b=
a.edit.EditChangeEvent;1<w.length&&c.parentLayer.getUndoManager().startChangeBlock("feature point move");for(p=0;p<w.length;p++)E=w[p],a.isNull(z[E.id])||(S=c.parentLayer.changeManager.updateFeature(E.id,E,z[E.id],b.SPATIAL_UPDATE),a.notNull(S)&&c.registerUpdate(S,E,c,"feature point delete"));1<w.length&&c.parentLayer.getUndoManager().endChangeBlock("feature point move")}for(b=0;b<w.length;b++)p=w[b],p.setGeometry(z[p.id]);for(K=0;K<v.length;K++)v[K].id=c.id+"possiblePoints"+K}},featurePointMoving:function(b,
c){this.refresh_dragging=!0;this.activeIndex=this.parentLayer.parentMap.getCursorLocation().wraparoundMapIndex;a.isNull(this.activeIndex)&&(this.activeIndex=0);if(!a.notNull(a.gv.allowFeaturePointsInteraction)||!1!==a.gv.allowFeaturePointsInteraction){var w=b.target.parentFeature,z=w.parentLayer.parentMap,J=new a.style.Line({stroke:"#8684F3",strokeThickness:5,strokeOpacity:.5}),L=b.target.graphics,K=null,A=null;if(w&&("Polygon"===w.geo.type||"LineString"===w.geo.type||"MultiPolygon"===w.geo.type||
"MultiLineString"===w.geo.type)){c?(1>b.target.relatedFeature.length&&w.calRelatedFeature(w.featureEditingProperties,b.target),K=b.target.relatedFeature[1],A=b.target.relatedFeature[3]):(1>b.target.relatedFeature.length&&w.calRelatedFeature(w.featureEditingProperties,b.target),K=b.target.relatedFeature[1],A=b.target.relatedFeature[2]);var m=L.getLeftTop(K.parentLayer.group),p=L.getLeftTop(z.draggableGroup),E=b.orgEvt.pageX-z.$oracleMapDiv.offset().left-m.x-p.x,m=b.orgEvt.pageY-z.$oracleMapDiv.offset().top-
m.y-p.y,p=K.parentLayer.group,S;w.editingLineBefore||w.editingLineAfter?(K&&(S=a.util.GeomUtil.screenPointsXOffset(K.screenPoints.x,this.activeIndex,z.getMapContext()),L.setPath(w.editingLineBefore,[[S,K.screenPoints.y,E,m]])),A&&(S=a.util.GeomUtil.screenPointsXOffset(A.screenPoints.x,this.activeIndex,z.getMapContext()),L.setPath(w.editingLineAfter,[[S,A.screenPoints.y,E,m]]))):(K&&(S=a.util.GeomUtil.screenPointsXOffset(K.screenPoints.x,this.activeIndex,z.getMapContext()),w.editingLineBefore=L.drawPath([[S,
K.screenPoints.y,E,m]],J,{group:p}),w.editingLineBefore.setStrokeDashArray([10]),K.bringToTop()),A&&(S=a.util.GeomUtil.screenPointsXOffset(A.screenPoints.x,this.activeIndex,z.getMapContext()),w.editingLineAfter=L.drawPath([[S,A.screenPoints.y,E,m]],J,{group:p}),w.editingLineAfter.setStrokeDashArray([10]),A.bringToTop()),b.target.bringToTop())}}},featurePointMoved:function(b,c){if((!a.notNull(a.gv.allowFeaturePointsInteraction)||!1!==a.gv.allowFeaturePointsInteraction)&&0!==b.target.relatedFeature.length){b.target.graphics.remove(this.editingLineBefore);
this.editingLineBefore=null;b.target.graphics.remove(this.editingLineAfter);this.editingLineAfter=null;var w=b.target,z=w.parentFeature,J=!1;if(a.notNull(z)){var L=z.pointToSnap;a.notNull(L)&&(w.geo.setPoint(L[0],L[1]),z.pointToSnap=null,J=!0)}var K=z.geo.dim,A=z.featureEditingProperties,L=z.parentLayer.parentMap.getDefaultFeatureLayer(),m=a.layer.EditableFeature;z.parentLayer.removeFromRtree(w);z.parentLayer.addToRtree(w);var p=L.parentMap.getMapContext(),E=p.getUniverse().getZoomLevels()[p.getZoomLevel()],
S,Q,v,ha,pa,ra,Ca,va,p=null,Da,Aa,Sa;if(c){if("Polygon"===z.geo.type||"LineString"===z.geo.type||"MultiPolygon"===z.geo.type||"MultiLineString"===z.geo.type)p=[],"MultiPolygon"===z.geo.type?p=z.geo.getOrdinates():"MultiLineString"===z.geo.type?p=[z.geo.getOrdinates()]:"Polygon"===z.geo.type?p=[z.geo.getOrdinates()]:"LineString"===z.geo.type&&(p=[[z.geo.getOrdinates()]]),m=z.geo.getDimension(),Da=b.target.ringIds[0],Aa=b.target.ringIds[1],Sa=b.target.ringIds[2],p=[p[Da][Aa][Sa*m],p[Da][Aa][Sa*m+1]],
S=w.geo.getX()+(b.target.relatedFeature[1].geo.getX()-w.geo.getX())/2,Q=w.geo.getY()+(b.target.relatedFeature[1].geo.getY()-w.geo.getY())/2,b.target.relatedFeature[0].setGeometry(new a.geometry.Point(S,Q,w.geo.srid)),v=w.geo.getX(),ha=w.geo.getY(),Q=b.target.relatedFeature[1].geo.getX(),pa=b.target.relatedFeature[1].geo.getY(),Q=Math.pow(Math.pow((v-Q)/E.resolution,2)+Math.pow((ha-pa)/E.resolution*E.stretchRatio,2),.5),Q<a.layer.EditableFeature.NEAREST_DISTANCE?b.target.relatedFeature[0].setVisible(!1):
b.target.relatedFeature[0].setVisible(!0),b.target.relatedFeature[3]&&(S=w.geo.getX()+(b.target.relatedFeature[3].geo.getX()-w.geo.getX())/2,Q=w.geo.getY()+(b.target.relatedFeature[3].geo.getY()-w.geo.getY())/2,b.target.relatedFeature[2].setGeometry(new a.geometry.Point(S,Q,w.geo.srid)),Q=b.target.relatedFeature[3].geo.getX(),pa=b.target.relatedFeature[3].geo.getY(),Q=Math.pow(Math.pow((v-Q)/E.resolution,2)+Math.pow((ha-pa)/E.resolution*E.stretchRatio,2),.5),Q<a.layer.EditableFeature.NEAREST_DISTANCE?
b.target.relatedFeature[2].setVisible(!1):b.target.relatedFeature[2].setVisible(!0))}else if("Polygon"===z.geo.type||"LineString"===z.geo.type||"MultiPolygon"===z.geo.type||"MultiLineString"===z.geo.type){ra=b.target.relatedFeature[0];Ca=b.target.relatedFeature[3];Da=va=b.target.relatedFeature[4];Aa=Ca;Sa=ra;ha=a.event.LayerEvent;A.shapePoints[va][Ca].splice(ra+1,0,w);w.setRenderingStyle(m.pointStyle);w.addListener(ha.FEATURE_MOVING,w.possiblePointMoving);w.addListener(ha.FEATURE_MOVING,w.shapePointMoving);
w.deleteListener(ha.FEATURE_MOVED,w.possiblePointMoved);w.addListener(ha.FEATURE_MOVED,w.shapePointMoved);w.addListener(a.event.MouseEvent.MOUSE_RIGHT_CLICK,w.showContextMenu);for(v=0;v<A.shapePoints[va][Ca].length;v++)A.shapePoints[va][Ca][v].id=z.id+"shapePoints"+va+"_"+Ca+"_"+v;p=b.target.relatedFeature[1].geo.getX();v=b.target.relatedFeature[1].geo.getY();S=b.target.relatedFeature[2].geo.getX();Q=b.target.relatedFeature[2].geo.getY();p=[p+(S-p)/2,v+(Q-v)/2];v=b.target.relatedFeature[1].geo;Q=
w.geo;S=v.getX()+(Q.getX()-v.getX())/2;Q=v.getY()+(Q.getY()-v.getY())/2;S=new a.layer.EditableFeature(z.id+"possiblePoints"+va+"_"+Ca+"_"+ra,new a.geometry.Point(S,Q,w.geo.srid),{renderingStyle:m.pointStyle});S.parentFeature=z;S.addListener(ha.FEATURE_MOVING,S.possiblePointMoving);S.addListener(ha.FEATURE_MOVED,S.possiblePointMoved);L.addFeature(S);A.possiblePoints[va][Ca].splice(ra,1,S);v=w.geo.getX();ha=w.geo.getY();Q=b.target.relatedFeature[1].geo.getX();pa=b.target.relatedFeature[1].geo.getY();
Q=Math.pow(Math.pow((v-Q)/E.resolution,2)+Math.pow((ha-pa)/E.resolution*E.stretchRatio,2),.5);Q<a.layer.EditableFeature.NEAREST_DISTANCE?S.setVisible(!1):S.setVisible(!0);S=w.geo.getX()+(b.target.relatedFeature[2].geo.getX()-w.geo.getX())/2;Q=w.geo.getY()+(b.target.relatedFeature[2].geo.getY()-w.geo.getY())/2;S=new a.layer.EditableFeature(z.id+"possiblePoints"+va+"_"+Ca+"_"+A.possiblePoints[va][Ca].length,new a.geometry.Point(S,Q,w.geo.srid),{renderingStyle:m.pointStyle});S.parentFeature=z;S.addListener(a.event.LayerEvent.FEATURE_MOVING,
S.possiblePointMoving);S.addListener(a.event.LayerEvent.FEATURE_MOVED,S.possiblePointMoved);L.addFeature(S);A.possiblePoints[va][Ca].splice(ra+1,0,S);Q=b.target.relatedFeature[2].geo.getX();pa=b.target.relatedFeature[2].geo.getY();Q=Math.pow(Math.pow((v-Q)/E.resolution,2)+Math.pow((ha-pa)/E.resolution*E.stretchRatio,2),.5);Q<a.layer.EditableFeature.NEAREST_DISTANCE?S.setVisible(!1):S.setVisible(!0);E=0;for(ra=A.possiblePoints.length;E<ra;E++)for(v=0,Ca=A.possiblePoints[E].length;v<Ca;v++)for(ha=0,
va=A.possiblePoints[E][v].length;ha<va;ha++)A.possiblePoints[E][v][ha].id=z.id+"possiblePoints"+E+"_"+v+"_"+ha,A.possiblePoints[E][v][ha].setRenderingStyle(m.possibleStyle)}m=z.geo.getOrdinates();va=[];E=0;for(ra=A.shapePoints.length;E<ra;E++)for(va[E]=[],v=0,Ca=A.shapePoints[E].length;v<Ca;v++){va[E][v]=[];ha=0;for(S=A.shapePoints[E][v].length;ha<S;ha++)if(Q=A.shapePoints[E][v][ha].geo,va[E][v].push(Q.getX()),va[E][v].push(Q.getY()),2<K)for(Q=0,!c&&ha>Sa+1&&E===Da&&v===Aa&&Q--,pa=2;pa<K;pa++){var xb=
0;c||ha!==Sa+1||E!==Da||v!==Aa?("MultiPolygon"===z.geo.type&&(xb=m[E][v][(ha+Q)*K+pa]),"Polygon"===z.geo.type?xb=m[v][(ha+Q)*K+pa]:"LineString"===z.geo.type?xb=m[(ha+Q)*K+pa]:"MultiLineString"===z.geo.type&&(xb=m[v][(ha+Q)*K+pa]),va[E][v].push(xb)):va[E][v].push(0)}if(("Polygon"===z.geo.type||"MultiPolygon"===z.geo.type)&&A.shapePoints[E][v]instanceof Array&&(ha=A.shapePoints[E][v][0].geo,va[E][v].push(ha.getX()),va[E][v].push(ha.getY()),2<K))for(ha=2;ha<K;ha++)S=0,S="MultiPolygon"===z.geo.type?m[E][v][m[E][v].length-
K+ha]:m[v][m[v].length-K+ha],va[E][v].push(S)}var yb;"MultiPolygon"===z.geo.type&&(yb=new a.geometry.MultiPolygon(va,z.geo.srid,K));"Polygon"===z.geo.type?yb=new a.geometry.Polygon(va[0],z.geo.srid,K):"LineString"===z.geo.type?yb=new a.geometry.LineString(va[0][0],z.geo.srid,K):"MultiLineString"===z.geo.type&&(yb=new a.geometry.MultiLineString(va[0],z.geo.srid,K));A=yb.clone();yb=[];yb.push(z);K={};K[z.id]=A;if(z.parentLayer.hasSharedBoundary()&&(A=z.parentLayer.parentMap.getScreenLocation(w.geo),
Da=z.parentLayer.parentMap.getScreenPointLocation(A.x-3,A.y-3),A=w.geo.getX()-Da.coordinates[0],Da=Da.coordinates[1]-w.geo.getY(),A=Math.sqrt(A*A+Da*Da),p=a.edit.GeometrySegmentUtil.getLayerSegmentPoints(z.parentLayer,[p[0],p[1]],A,!1,!1,!1,!1),a.notNull(p)))for(A=0;A<p.length;A++)Da=p[A].getFeature().id,Da!==z.id&&(Aa=p[A].getPointLocation(),Sa=p[A].getFeature().getGeometry().clone(!0),2===Aa?(p[A].setPoint([w.geo.getX(),w.geo.getY()]),a.edit.GeometrySegmentUtil.addVertexToGeometry(Sa,p[A])&&(yb.push(p[A].getFeature()),
K[Da]=Sa)):a.edit.GeometrySegmentUtil.moveGeometryVertex(Sa,p[A],[w.geo.getX(),w.geo.getY()])&&(yb.push(p[A].getFeature()),K[Da]=Sa));if(a.notNull(z.parentLayer.changeManager)){w=a.edit.EditChangeEvent;1<yb.length&&z.parentLayer.getUndoManager().startChangeBlock("feature point move");for(p=0;p<yb.length;p++)A=yb[p],a.isNull(K[A.id])||(Da=z.parentLayer.changeManager.updateFeature(A.id,A,K[A.id],w.SPATIAL_UPDATE),a.notNull(Da)&&z.registerUpdate(Da,A,z,"feature point move"));1<yb.length&&z.parentLayer.getUndoManager().endChangeBlock("feature point move")}z.activeIdx=
null;for(w=0;w<yb.length;w++)p=yb[w],p.setGeometry(K[p.id]),z.parentLayer.parentMap.wraparound&&(p.parentLayer.refresh(),z.parentLayer.parentMap.getLayerByName("ii_oracle_maps_internal_editing").refresh());a.notNull(L)&&J&&L.refresh();this.addResizeHandles()}}});a.layer.EditableFeature.MARKER_SIZE=10;a.layer.EditableFeature.NEAREST_DISTANCE=35;if(a.browser.touchSupported||a.gv.isWin8Touch)a.layer.EditableFeature.MARKER_SIZE=20,a.layer.EditableFeature.NEAREST_DISTANCE=50;a.layer.EditableFeature.POINT_BACKGROUND=
new a.style.Marker({width:30,height:30,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:30,height:30},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1,fillOpacity:0,strokeOpacity:0}}]});a.layer.EditableFeature.ORIENTEDPOINT_BACKGROUND=new a.style.Marker({width:70,height:70,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:70,height:70},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1,fillOpacity:0,strokeOpacity:0}}]});a.layer.EditableFeature.ORIENTATION_POINT_STYLE=new a.style.Marker({styleName:"_orientationPointStyle",
width:a.layer.EditableFeature.MARKER_SIZE,height:a.layer.EditableFeature.MARKER_SIZE,vectorDef:[{shape:{type:"circle",cx:a.layer.EditableFeature.MARKER_SIZE/2,cy:a.layer.EditableFeature.MARKER_SIZE/2},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1}}]});a.layer.EditableFeature.ORIENTATION_LINE_STYLE=new a.style.Line({styleName:"_orientationLinetyle",stroke:"#0000ff",strokeThickness:1});a.layer.EditableFeature.pointStyle=new a.style.Marker({width:a.layer.EditableFeature.MARKER_SIZE,height:a.layer.EditableFeature.MARKER_SIZE,
vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:a.layer.EditableFeature.MARKER_SIZE,height:a.layer.EditableFeature.MARKER_SIZE},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1}}]});a.layer.EditableFeature.possibleStyle=new a.style.Marker({width:a.layer.EditableFeature.MARKER_SIZE,height:a.layer.EditableFeature.MARKER_SIZE,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:a.layer.EditableFeature.MARKER_SIZE,height:a.layer.EditableFeature.MARKER_SIZE},style:{fill:"#ffffff",stroke:"#0000ff",
strokeThickness:1,fillOpacity:.4,strokeOpacity:.4}}]});a.layer.EditableFeature.resizeHandleStyle=new a.style.Marker({width:a.layer.EditableFeature.MARKER_SIZE,height:a.layer.EditableFeature.MARKER_SIZE,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:a.layer.EditableFeature.MARKER_SIZE,height:a.layer.EditableFeature.MARKER_SIZE},style:{fill:"#ffffff",stroke:"#ff00ff",strokeThickness:1,fillOpacity:.4,strokeOpacity:.4}}]});a.layer.EditableFeature.rotateHandleStyle=new a.style.Marker({width:a.layer.EditableFeature.MARKER_SIZE,
height:a.layer.EditableFeature.MARKER_SIZE,vectorDef:[{shape:{type:"circle",cx:0,cy:0,width:a.layer.EditableFeature.MARKER_SIZE,height:a.layer.EditableFeature.MARKER_SIZE},style:{fill:"#ffffff",stroke:"#ff00ff",strokeThickness:1,fillOpacity:.4,strokeOpacity:.4}}]});a.layer.EditableFeature.bgPolyStyle=new a.style.Color({styleName:"polygonToolStyle",fillOpacity:0,fill:"#8D8DFF",stroke:"#C0C0C0",strokeThickness:15,strokeOpacity:0});a.layer.EditableFeature.bgLineStyle=new a.style.Line({styleName:"polygonToolStyle",
fillOpacity:0,fill:"#8D8DFF",stroke:"#C0C0C0",strokeThickness:15,strokeOpacity:0});a.layer.EditableFeature.textStyle=new a.style.Text({styleName:"editableTextStyle",fill:"#000000",stroke:"#C0C0C0",fontFamily:"Arial",fontStyle:a.Text.FONTSTYLE_ITALIC});a.layer.XMLMapLayer=a.layer.Layer.extend({setXMLRequest:function(a){this.xmlRequest=a}});a.layer.OSMTileLayer=a.layer.TileLayer.extend({initialize:function fa(b,c,J,L){fa.base.call(this,b,{tileLayerConfig:a.layer.TileLayerConfig.CONFIG_OSM,getTileURL:function(b,
w,m,p){m=this.tileLayerConfig.tileImageHeight;var E=this.tileLayerConfig.zoomLevels[b];p=(this.tileLayerConfig.bounds.getMaxY()-p.getMaxY())/E.resolution/m;m=null;if(a.isNull(c)){m="a";switch((w+p)%3){case 1:m="b";break;case 2:m="c"}m="http://"+m+".tile.openstreetmap.org/"+b+"/"+w+"/"+p+".png"}else m=(w+p)%c.length,m=c[m],m=!0===this.isInZYXOrder?m+"/"+b+"/"+p+"/"+w:m+"/"+b+"/"+w+"/"+p,m=a.isNull(J)?m+".png":"."===J[0]?m+J:m+("."+J);if(a.notNull(L)){b="?";for(var S in L)L.hasOwnProperty(S)&&(m=m+
b+S+"\x3d"+L[S],b="\x26")}return m}})},setInZYXOrder:function(a){if(!0===a||"true"===a.toLowerCase)this.isInZYXOrder=!0}});a.layer.Menu=a.Class.extend({initialize:function(b,c){var z=this;this.map=b;this.menuId="menu_0";this.menuTableId="mvmenu_table_0";this.menuTableBodyId="mvmenu_table_body_0";this.show=!1;this.location=c;for(var J=0;J<this.map.decorationArray.length;J++)this.map.decorationArray[J]&&"menu_0"==this.map.decorationArray[J].sblx&&this.map.removeMapDecoration(this.map.decorationArray[J]);
this.menu=new a.control.MapDecoration("\x3ctable id\x3d'"+this.menuTableId+"' cellpadding\x3d0 cellspacing\x3d0 style\x3d'width:0px'\x3e\x3ctr\x3e\x3ctd style\x3d'border-width:0px;border-style:solid;border-color:black;background-color:white'\x3e\x3ctable width\x3d100%\x3e\x3ctbody id\x3d'"+this.menuTableBodyId+"'\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",{offsetX:c.left,offsetY:c.top},{draggable:!0,panelOptions:{style:{"border-style":"solid","border-color":"#0000ff","border-width":"1px",
backgroundColor:"#FDFDFD",filter:"alpha(Opacity\x3d80)","-moz-opacity":"0.8",opacity:"0.8"}}});this.menu.sblx="menu_0";this.map.addMapDecoration(this.menu);a.layer.Menu.count+=1;this.removeRightClickMenu=function(){z.menu&&z.show&&(z.map.removeMapDecoration(z.menu),z.map.deleteListener(a.event.MouseEvent.MOUSE_CLICK,z.removeRightClickMenu),z.menu=null,z.show=!1)};this.map.on(a.event.MouseEvent.MOUSE_CLICK,z.removeRightClickMenu)},addMenuItem:function(b,c){var z=document.getElementById(this.menuTableBodyId);
document.getElementById(this.menuTableId).style.width=12*b.length+"px";var J=document.createElement("tr");z.appendChild(J);J.style.fontFamily="Arial, Helvetica, Geneva, sans-serif";J.style.fontSize="12px";J.style.cursor="pointer";J.align="center";z=document.createElement("td");z.innerHTML=b;J.appendChild(z);J.onmouseover=function(){this.style.backgroundColor="#336699";this.style.color="#ffffff"};J.onmouseout=function(){this.style.backgroundColor="transparent";this.style.color="#000000"};if(c){var z=
function(a){a.stopPropagation();a.preventDefault();L.removeRightClickMenu();c()},L=this;a.browser.touchSupported?a.$(J).bind("touchstart",z):a.$(J).mousedown(z)}}});a.layer.Menu.count=0;a.layer.VectorLayerHeatMap=a.Class.extend({initialize:function(b,c){this.opacity=b&&0<b.opacity&&1>b.opacity?b.opacity:1;a.browser.android&&4>=a.browser.androidVersion&&(this.opacity=1);this.initColor(b.colorStops);this.vectorLayer=c;this.maxValue=b.maxValue;this.minValue=b.minValue;this.loadingBoundaray=!1;this.scale=
b.sampleFactor;this.bigCanvas=this.smallCanvas=null;var z=this;(this.containerVectorLayer=b.containerVectorLayer)&&a.isNull(this.containerVectorLayer.serverURL)&&(this.containerVectorLayer.serverURL=c.parentMap.mapviewerURL);if(this.containerVectorLayer&&!this.containerVectorLayer.dataLoaded&&!this.containerVectorLayer.loading&&!this.containerVectorLayer.usedInOverview)z.containerVectorLayer.parentMap=z.vectorLayer.parentMap,z.loadingBoundaray=!0,z.containerVectorLayer.dataBufferWindow=z.vectorLayer.dataBufferWindow,
z.containerVectorLayer.getThemeData(null,function(){z.containerVectorLayer.loading=!1;z.loadingBoundaray=!1},function(){z.containerVectorLayer.loading=!1;z.loadingBoundaray=!1});else if(this.containerVectorLayer){z.loadingBoundaray=!0;var J=function(){z.containerVectorLayer.dataLoaded?z.loadingBoundaray=!1:setTimeout(J,100)};J()}},init:function(a,b,c,J,L){this.realWidth=a;this.realHeight=b;this.width=a;this.height=b;1<this.scale&&(this.width=a/this.scale,this.height=b/this.scale);this.width|=0;this.height|=
0;this.minX=c;this.minY=J;this.data=[];this.realMaxValue=Number.NEGATIVE_INFINITY;this.realMinValue=Number.POSITIVE_INFINITY;a=L/this.scale;this.radius=1<a?Math.floor(a):1;50<this.radius&&(this.radius=50);this.smallCanvas&&(a=this.smallCanvas,a.width!==this.width||a.height!==this.height)&&(this.smallCanvas=null);this.sX=parseInt(c/this.scale);this.sY=parseInt(J/this.scale)},addData:function(a,b,c){this.data[a]||(this.data[a]=[]);this.data[a][b]||(this.data[a][b]={num:0,value:0});var J=this.data[a][b].num;
c=this.isValued?(this.data[a][b].value*J+c)/(J+1):this.data[a][b].value+c;this.data[a][b]={num:J+1,value:c};c>this.realMaxValue&&(this.realMaxValue=c);c<this.realMinValue&&(this.realMinValue=c)},drawHeatMap:function(b){this.numClass=this.origNum;this.max=this.realMaxValue;this.min=this.realMinValue;a.notNull(this.maxValue)&&(this.max=this.maxValue,this.maxValue<this.realMaxValue&&this.numClass--);a.notNull(this.minValue)&&(this.min=this.minValue,this.minValue>this.realMinValue&&this.numClass--);0>=
this.numClass&&(this.numClass=1);this.step=(this.max-this.min)/this.numClass;var c=this.drawShrunkenMap(),z=document.createElement("canvas");z.width=this.realWidth;z.height=this.realHeight;var J=z.getContext("2d");(!a.browser.android||4<a.browser.androidVersion)&&this.clip(J);1<this.scale?(J=Math.round(this.scale/2),b(z,c,0,0,this.width,this.height,0-J,0-J,this.realWidth-this.scale/2,this.realHeight-this.scale/2)):b(z,c,0,0,this.width,this.height,0,0,this.realWidth,this.realHeight)},initColor:function(a){var b=
document.createElement("canvas");b.width="1";b.height="256";for(var b=b.getContext("2d"),c=b.createLinearGradient(0,0,1,256),J=a.length,L=0;L<J;L++)c.addColorStop(L/J,a[L]);b.fillStyle=c;b.fillRect(0,0,1,256);this.colorData=b.getImageData(0,0,1,256).data;this.origNum=J},drawShrunkenMap:function(){var b=this.smallCanvas;b||(b=document.createElement("canvas"),b.width=this.width,b.height=this.height,this.smallCanvas=b);var c=b.getContext("2d");c.clearRect(0,0,b.width,b.height);console&&console.time&&
a.util.Logger.finest("","OM.VectorLayerHeatMap.drawShrunkenMap",console.time("computingHeatMap"));return b=this.calculateHeatMap(b,c)},calculateHeatMap:function(b,c){this.isValued?this.metricHeatMap3(b,c):this.classicalHeatMap(c);for(var z=c.getImageData(0,0,this.width,this.height),J=z.data,L=J.length,K=3;K<L;K+=4){var A=J[K];0!==A&&(A*=4,J[K-3]=this.colorData[A],J[K-2]=this.colorData[A+1],J[K-1]=this.colorData[A+2],J[K]=255)}console&&console.timeEnd&&a.util.Logger.finest("","OM.VectorLayerHeatMap.drawShrunkenMap",
console.timeEnd("computingHeatMap"));z.data=J;c.putImageData(z,0,0);return b},classicalHeatMap:function(a){for(var b=0;b<this.width;b++)for(var c=0;c<this.height;c++){var J=b+this.sX,L=c+this.sY;this.data[J]&&this.data[J][L]&&(J=this.data[J][L].value/this.max,L=a.createRadialGradient(b,c,0,b,c,this.radius),L.addColorStop(0,"rgba(0,0,0,"+J+")"),L.addColorStop(1,"rgba(0,0,0,0)"),a.fillStyle=L,a.beginPath(),a.arc(b,c,this.radius,0,2*Math.PI,!0),a.closePath(),a.fill())}},metricHeatMap:function(a){var b=
this.radius;3>b&&(b=3);var c=document.createElement("canvas");c.width=2*b;c.height=2*b;for(var J=c.getContext("2d"),L=0;L<this.width;L++)for(var K=0;K<this.height;K++){var A=L+this.sX,m=K+this.sY;if(this.data[A]&&this.data[A][m]){A=this.data[A][m].value/this.max;m=J.createRadialGradient(b,b,0,b,b,b);m.addColorStop(0,"rgba(0,0,0,"+A+")");m.addColorStop(1,"rgba(0,0,0,0)");J.fillStyle=m;J.beginPath();J.arc(b,b,b,0,2*Math.PI,!0);J.closePath();J.fill();for(var A=J.getImageData(0,0,2*b,2*b).data,m=a.getImageData(L-
b,K-b,2*b,2*b),p=m.data,E=3,S=A.length;E<S;E+=4)p[E]=Math.max(A[E],p[E]);m.data=p;a.putImageData(m,L-b,K-b);J.clearRect(0,0,c.width,c.height)}}},metricHeatMap2:function(a,b){var c=this.radius;3>c&&(c=3);var J=document.createElement("canvas"),L=2*c;J.width=L;J.height=L;for(var J=J.getContext("2d"),K=b.getImageData(0,0,a.width,a.height),A=K.data,m=a.width,p=0;p<this.width;p++)for(var E=0;E<this.height;E++){var S=p+this.sX,Q=E+this.sY;if(this.data[S]&&this.data[S][Q]){S=this.data[S][Q].value/this.max;
Q=J.createRadialGradient(c,c,0,c,c,c);Q.addColorStop(0,"rgba(0,0,0,"+S+")");Q.addColorStop(1,"rgba(0,0,0,0)");J.fillStyle=Q;J.beginPath();J.arc(c,c,c,0,2*Math.PI,!0);J.closePath();J.fill();for(var v=J.getImageData(0,0,2*c,2*c).data,Q=0;Q<L;Q++)for(S=0;S<L;S++){var ha=4*((E-c+Q)*m+(p-c+S));0>ha||(A[ha+3]=Math.max(v[4*(Q*L+S)+3],A[ha+3]))}J.clearRect(0,0,L,L)}}K.data=A;b.putImageData(K,0,0)},metricHeatMap3:function(a,b){var c=this.radius;3>c&&(c=3);var J=document.createElement("canvas"),L=2*c;J.width=
L;J.height=L;var K=J.getContext("2d"),J=b.getImageData(0,0,a.width,a.height),A=J.data,m=a.width,p=K.createRadialGradient(c,c,0,c,c,c);p.addColorStop(0,"rgba(0,0,0,1)");p.addColorStop(1,"rgba(0,0,0,0)");K.fillStyle=p;K.beginPath();K.arc(c,c,c,0,2*Math.PI,!0);K.closePath();K.fill();K=K.getImageData(0,0,2*c,2*c).data;for(p=0;p<this.width;p++)for(var E=0;E<this.height;E++){var S=p+this.sX,Q=E+this.sY;if(this.data[S]&&this.data[S][Q]){var v=this.data[S][Q].value/this.max;1<v&&(v=1);for(Q=0;Q<L;Q++)for(S=
0;S<L;S++){var ha=4*((E-c+Q)*m+(p-c+S));0>ha||(A[ha+3]=Math.max(parseInt(K[4*(Q*L+S)+3]*v),A[ha+3]))}}}J.data=A;b.putImageData(J,0,0)},clip:function(b){if(this.containerVectorLayer){var c=this.vectorLayer.parentMap.getMapContext().getTransform(),z=this.containerVectorLayer.size();if(0===z)this.clipByBounds(b);else{b.beginPath();for(var J=0;J<z;J++){var L=this.containerVectorLayer.featureArray[J].getGeometry(),K=L.getMBR(),A=this.vectorLayer.dataBufferWindow;if(!a.notNull(K)||!(K.maxX<A.x||K.maxY<
A.y||K.minX>A.x+A.w||K.minY>A.y+A.h)){var m,p,E;if("Polygon"===L.type)for(K=L.coordinates.slice(0),m=0;1>m;m++){if(A=K[m].slice(0),A=c.transformHeatMapSegment(A,1,L.dim,this.minX,this.minY,1))if(p=A.length,!(6>p))for(b.moveTo(A[0],A[1]),E=2;E<p;E+=2)b.lineTo(A[E],A[E+1])}else if("MultiPolygon"===L.type){var K=L.coordinates.slice(0),S=K.length;for(m=0;m<S;m++)if(A=K[m][0].slice(0),A=c.transformHeatMapSegment(A,1,L.dim,this.minX,this.minY,1))if(p=A.length,!(6>p))for(b.moveTo(A[0],A[1]),E=2;E<p;E+=2)b.lineTo(A[E],
A[E+1])}}}b.closePath();b.clip()}}else this.clipByBounds(b)},clipByBounds:function(a){var b=this.vectorLayer.parentMap.getMapContext(),c=b.getTransform(),b=b.getUniverse().getMapBounds().coordinates.slice(0),b=c.transformHeatMapSegment(b,1,2,this.minX,this.minY,1);4>b.length||(a.beginPath(),a.moveTo(b[0],b[1]),a.lineTo(b[0],b[3]),a.lineTo(b[2],b[3]),a.lineTo(b[2],b[1]),a.closePath(),a.clip())},getPixelValue:function(b){b>this.max&&a.notNull(this.maxValue)&&(b=this.max);b<this.min&&a.notNull(this.minValue)&&
(b=this.min);b=parseInt((b-this.min)/this.step);b=4*parseInt(255*b/this.numClass);return{r:this.colorData[b],g:this.colorData[b+1],b:this.colorData[b+2]}},getRadius:function(a,b){return a+parseInt((b-this.min)/((this.max-this.min)/3))},calculate:function(a,b,c,J){3>J&&(J=3);J=this.getRadius(J,a[b][c].value);for(var L=-J;L<=J;L++){var K=c+L;if(!(0>K))for(var A=Math.sqrt(J*J-L*L),m=Math.floor(b-A),A=Math.ceil(b+A),m=0>m?0:m;m<=A;m++)if(a[m]||(a[m]=[]),b!=m||c!=K){var p=Math.sqrt((m-b)*(m-b)+L*L);if(!(p>
J)){var E=a[b][c].num*Math.sqrt((J-p)/J),p=a[b][c].value*Math.sqrt((J-p)/J);a[m][K]?(E=a[m][K].num+E,p>a[m][K].value&&(a[m][K]={num:E,value:p})):a[m][K]={num:E,value:p}}}}}});a.layer.MultiFeature=a.Class.extend({initialize:function(a){this.fList=a},add:function(a){this.fList?this.fList.push(a):this.fList=[a]},createFeature:function(b,c){var z=this.fList.length,J=new a.Feature(b,this.fList[0].geo,{renderingStyle:c});J.setMarkerText(z+"");return J}});a.layer.VectorLayerMultiFeature=a.Class.extend({initialize:function(b){this.vectorLayer=
b;this.mfList=[];this.group=b.parentMap.graphics.createGroup();b.group.appendChild(this.group);var c=this;b.parentMap.graphics.attachEventListener(a.event.MouseEvent.MOUSE_LEAVE,function(){c.clear()},this.group)},checkLocation:function(){for(var b=this.vectorLayer.featureArray,c=0,z=b.length;c<z-1;c++)if((!this.vectorLayer.mapping||b[c].mapping||this.vectorLayer.nsdp.fullDisplay)&&!b[c].multi&&b[c].geo&&b[c].geo.type===a.GeomTypes.POINT){for(var J=b[c].geo.coordinates[0],L=b[c].geo.coordinates[1],
K=null,A=c+1;A<z;A++)if((!this.vectorLayer.mapping||b[A].mapping||this.vectorLayer.nsdp.fullDisplay)&&!b[A].multi&&b[A].geo&&b[A].geo.type===a.GeomTypes.POINT){var m=b[A].geo.coordinates[1];J===b[A].geo.coordinates[0]&&L===m&&(K?K.add(b[A]):K=new a.layer.MultiFeature([b[c],b[A]]),b[c].multi=b[A].multi=!0)}K&&this.mfList.push(K)}},display:function(){for(var b=this,c=function(c,L){return function(){L.graphics.attachEventListener(a.event.MouseEvent.MOUSE_ENTER,function(){b.showFeatures(c.fList,L.screenPoints)},
L.shape)}()},z=function(a){a=a.target;var c=a.mf;c.open?b.clear():(b.showFeatures(c.fList,a.screenPoints),c.open=!0)},J=0,L=this.mfList.length;J<L;J++){var K=this.mfList[J];K.open=!1;var A=K.createFeature("_mul"+J,this.vectorLayer.mfMarker);A.mf=K;A.group=this.vectorLayer.realGroup;A.screenTransformObj=this.vectorLayer.parentMap.getMapContext().getTransform();A.graphics=this.vectorLayer.parentMap.graphics;A.parentLayer=this.vectorLayer;A.displayFeature([this.vectorLayer.mfMarker]);a.browser.touchSupported?
A.addListener(a.event.MouseEvent.MOUSE_CLICK,z,A.shape):c(K,A)}},showFeatures:function(b,c){var z=b.length;if(!(2>z)){var J=this.vectorLayer.parentMap.graphics;this.clear();var L=2*Math.PI/z,K=this.algorith1;L<Math.PI/5&&(K=this.algorith2,L=Math.PI/5);this.group.applyStyle({opacity:1});this.lineGroup=J.createGroup();this.markerGroup=J.createGroup();this.markerGroup.applyStyle({cursor:this.vectorLayer.mouseCursor});this.group.appendChild(this.lineGroup);this.group.appendChild(this.markerGroup);this.group.parentNode||
(this.vectorLayer.group.appendChild(this.group),J.sendToBottom(this.group));for(var A=function(a,b){return function(){b.vectorLayer.showInfoWindow(a,a.getGeometry());b.clear();J.clearToolTips()}},m=0;m<z;m++){var p=L*m+Math.PI/2,E=K(m),S=Math.cos(p)*E.r1+c.x,Q=-Math.sin(p)*E.r1+c.y,v=Math.cos(p)*E.r2+c.x,p=-Math.sin(p)*E.r2+c.y,E=b[m];J.drawPath([[S,Q,v,p]],{stroke:"#003286",strokeThickness:1},{group:this.lineGroup});E.screenPoints={x:v,y:p};E.parentLayer=this.vectorLayer;this.vectorLayer.getFeatureStyles(E).draw(E,
this.vectorLayer.parentMap.getMapContext(),{group:this.markerGroup,type:E.geo.type,screenPoints:{x:v,y:p}});E.displayed=!0;E.applyToolTip();a.browser.touchSupported?J.attachEventListener(a.event.MouseEvent.TOUCH_TAP,A(E,this),E.shape):J.attachEventListener(a.event.MouseEvent.MOUSE_CLICK,A(E,this),E.shape)}z=2*K(m).r2;z=J.drawEllipse({cx:c.x,cy:c.y,width:z,height:z},{fill:"#ffffff",fillOpacity:0},{group:this.group});J.sendToBottom(z)}},algorith1:function(){return{r1:15,r2:30}},algorith2:function(a){return{r1:15,
r2:30+3*a}},clear:function(){for(var a=0,b=this.mfList.length;a<b;a++)this.mfList[a].open=!1;this.vectorLayer.parentMap.graphics.clearGroup(this.group)},destroy:function(){for(var a=this.mfList.length-1;0<=a;a--){var b=this.mfList[a];b.shape=null;b.screenPoints=null;b.parentLayer=null;b.graphics=null;this.mfList.pop()}this.vectorLayer.parentMap.graphics.clearGroup(this.group)}});a.layer.KMLParser=a.Class.extend({initialize:function(a){this.vLayer=a;this.minY=this.minX=Number.POSITIVE_INFINITY;this.maxY=
this.maxX=Number.NEGATIVE_INFINITY},parse:function(b,c){var z=0,J=this.vLayer;J.featureArray=[];var L=this;b.find("Placemark").each(function(){var b=a.$(this),c="KML"+z,m=L.parseExtendedData(b),K=b.find("name").text(),w=b.find("addresss").text(),A=b.find("phoneNumber").text();a.notNull(K)&&""!==K&&(m.name=K);a.notNull(w)&&""!==w&&(m.address=w);a.notNull(A)&&""!==A&&(m.phone=A);K=b.find("gx\\:Track, Track");w=0;for(A=K.length;w<A;w++){var fa=L.parseTrack(a.$(K[w]),c,m);0<fa.length&&(J.addFeatures(fa),
z++)}var K=b.find("MultiGeometry"),ra;if(0<K.length){var Ca=[],va,Da=[];K.children().each(function(){var b=L.parseSimpleGeometry(a.$(this));b&&(Ca.push(b),Da.push(b.getOrdinates()),va?va!==b.getType()&&(va="GeometryCollection"):va=b.getType())});1<Ca.length&&("GeometryCollection"==va?ra=new a.geometry.GeometryCollection(Ca,8307):"Point"==va?ra=new a.geometry.MultiPoint(Da,8307):"LineString"==va?ra=new a.geometry.MultiLineString(Da,8307):"Polygon"==va&&(ra=new a.geometry.MultiPolygon(Da,8307)),ra.dimension=
Ca[0].dimension)}else ra=L.parseSimpleGeometry(b);ra&&(b=new a.Feature(c,ra,{attributes:m}),J.featureArray.push(b),z++)});J.dataLoaded=!0;if(!J.featureArray||0===J.featureArray.length)return!1;var K=a.event,A=function(a){var b=new K.LayerEvent(K.LayerEvent.FEATURES_LOADED,J);b.mapContext=J.parentMap.getMapContext();J.fire(K.LayerEvent.FEATURES_LOADED,b);c(a)},m=J.parentMap.getMapContext().getUniverse().getSRID();8307!==m?(new a.geometry.Rectangle(this.minX,this.minY,this.maxX,this.maxY,8307)).transform(m,
function(a){a=[a.getMinX(),a.getMinY(),a.getMaxX(),a.getMaxY()];A(a)}):A([this.minX,this.minY,this.maxX,this.maxY]);return!0},parseSimpleGeometry:function(b){var c=b.find("coordinates"),z;if(0<c.length)if(z=c.parent()[0].nodeName,"LinearRing"==z){if(c=b.find("outerBoundaryIs").find("coordinates").text(),a.notNull(c)&&""!==c)return z=this.parseCoordinates(c),c=b.find("innerBoundaryIs").find("coordinates").text(),b=[z.coords],a.notNull(c)&&""!==c&&(c=this.parseCoordinates(c),b.push(c.coords)),b=new a.geometry.Polygon(b,
8307),b.dimension=z.dimension,b}else{c=c.text();if("Point"==z)return b=c.split(","),z=Number(b[0]),b=Number(b[1]),c=new a.geometry.Point(z,b,8307),z<this.minX&&(this.minX=z),z>this.maxX&&(this.maxX=z),b<this.minY&&(this.minY=b),b>this.maxY&&(this.maxY=b),c;if("LineString"==z)return z=this.parseCoordinates(c),b=new a.geometry.LineString(z.coords,8307),b.dimension=z.dimension,b}return null},parseCoordinates:function(a){var b=a.trim().split(/\s+/g)[0].split(",").length;a=a.trim().split(/\s+|,/g);for(var c=
0,J=a.length;c<J;c++)a[c]=Number(a[c]),0===c%b?(a[c]<this.minX&&(this.minX=a[c]),a[c]>this.maxX&&(this.maxX=a[c])):1===c%b&&(a[c]<this.minY&&(this.minY=a[c]),a[c]>this.maxY&&(this.maxY=a[c]));return{coords:a,dimension:b}},parseTrack:function(b,c,z){var J=b.find("when"),L=b.find("gx\\:coord, coord"),K,A,m;if(0<J.length&&0<L.length&&J.length==L.length){var p=[];b=[];for(var E=0,S=J.length;E<S;E++){var Q=a.$(L[E]).text().trim().split(" ");K=Q.length;A=Number(Q[0]);var v=Number(Q[1]),ha=new a.geometry.Point(A,
v,8307);A<this.minX&&(this.minX=A);A>this.maxX&&(this.maxX=A);v<this.minY&&(this.minY=v);v>this.maxY&&(this.maxY=v);A={when:a.$(J[E]).text()};for(m in z)z[m]instanceof Array&&z[m].length>E&&(A[m]=z[m][E]);b.push(new a.Feature(c+"_"+E,ha,{attributes:A}));Array.prototype.push.apply(p,Q)}if(1<S){J=new a.geometry.LineString(p,8307);J.dimension=K;K={};for(m in z)!z[m]instanceof Array&&(A[K]=z[K]);b.splice(0,0,new a.Feature(c+"_"+E,J,{}))}return b}},parseExtendedData:function(b){var c={},z=b.find("ExtendedData").find("Data"),
J,L,K,A,m;J=0;for(L=z.length;J<L;J++){K=a.$(z[J]);A=K.attr("name");var p=K.find("displayName").text();m=K.find("value").text();a.notNull(p)&&""!==p?c[p]=m:c[A]=m}z=b.find("ExtendedData").find("SimpleData");J=0;for(L=z.length;J<L;J++)K=a.$(z[J]),A=K.attr("name"),m=K.find("value").text(),c[A]=m;z=b.find("ExtendedData").find("gx\\:SimpleArrayData, SimpleArrayData");b=function(){m.push(a.$(this).text())};J=0;for(L=z.length;J<L;J++)K=a.$(z[J]),A=K.attr("name"),m=[],K.children().each(b),c[A]=m;return c}});
a.layer.GeoJSONParser=a.Class.extend({initialize:function(a){this.layer=a;this.count=0},parse:function(b,c,z){var J=!b||b.mds_error||b.error;if(J){var L=J.message;(J=J.details)&&(L+=" [details]:"+J);this.layer.dataLoaded=!1;a.util.Logger.severe("MAPVIEWER_9007","OM.layer.VectorLayer.getThemeData",L);z()}else{this.layer.getDataRequest=null;this.parseSRID(b);this.parselayerLevelStyle(b);this.parseEditParameters(b);this.parseFeatures(b);var K=this,A=function(){if(0===K.count){if(!K.layer.dataLoaded){K.layer.dataLoaded=
!0;var L=a.event,p=new L.LayerEvent(L.LayerEvent.FEATURES_LOADED,K.layer);p.mapContext=K.layer.parentMap.getMapContext();K.layer.fire(L.LayerEvent.FEATURES_LOADED,p)}c(K.bbox);b=null}else setTimeout(A,100)};A()}},parseSRID:function(b){this.srid=b.srs;!this.srid&&b.crs&&"name"===b.crs.type&&b.crs.properties&&b.crs.properties.name&&(this.srid=a.util.GeomUtil.parseCRSName(b.crs.properties.name));a.isNull(this.srid)&&(this.srid=8307)},parseBBox:function(b){if(this.bbox=b.bbox){b=new a.geometry.Rectangle(this.bbox[0],
this.bbox[1],this.bbox[2],this.bbox[3],this.srid);4<this.bbox.length&&(b=parseInt(this.bbox.length/2),b=new a.geometry.Rectangle(this.bbox[0],this.bbox[1],this.bbox[b],this.bbox[b+1],this.srid));var c=this.layer.parentMap.getMapContext().getUniverse().getSRID();if(this.srid!==c){var z=this;(new a.geometry.LineString([b.getMinX(),b.getMinY(),b.getMaxX(),b.getMaxY()],this.srid)).transform(c,function(b){b=b.coordinates;z.layer.mbr=new a.geometry.Rectangle(b[0],b[1],b[2],b[3],z.srid);z.bbox=[b[0],b[1],
b[2],b[3]];505050===c&&(z.layer.mbr=null,z.bbox=null)})}else this.layer.mbr=b}},parselayerLevelStyle:function(a){!this.layer.renderingStyle&&a.renderStyle&&this.layer.setRenderingStyle({dataSource:this.layer.dataSource,name:a.renderStyle,url:this.layer.serverURL});!this.layer.hoverStyle&&a.hoverStyle&&this.layer.setHoverStyle({dataSource:this.layer.dataSource,name:a.hoverStyle,url:this.layer.serverURL});!this.layer.selectionStyle&&a.selectStyle&&this.layer.setSelectStyle({dataSource:this.layer.dataSource,
name:a.selectStyle,url:this.layer.serverURL});!this.layer.labelingStyle&&a.labelStyle&&this.layer.setLabelingStyle({dataSource:this.layer.dataSource,name:a.labelStyle,url:this.layer.serverURL})},parseEditParameters:function(b){a.notNull(b.not_null_attr_names)?this.layer.notNullAttributes=b.not_null_attr_names:this.layer.notNullAttributes=[];if(!a.isNull(b.edit_properties)){a.isNull(this.layer.keyColumn)&&(this.keyColumn=b.edit_properties.id_attr,a.notNull(this.keyColumn)&&(this.layer.keyColumn=this.keyColumn.toUpperCase()));
this.baseTable=b.edit_properties.base_table;a.notNull(this.baseTable)?this.layer.baseTable=this.baseTable.toUpperCase():this.layer.baseTable=null;a.isNull(this.layer.geometryColumn)&&(this.spatialAttr=b.edit_properties.spatial_attr,a.notNull(this.spatialAttr)&&(this.layer.geometryColumn=this.spatialAttr.toUpperCase()));this.spatialType=b.edit_properties.spatial_type;a.notNull(this.spatialType)?this.layer.spatialType=this.spatialType:this.layer.spatialType="geometry";this.workspace=b.edit_properties.workspace;
a.notNull(this.workspace)&&"LIVE"!==this.workspace.toUpperCase()&&(this.layer.workspace=this.workspace.toUpperCase());var c=b.attr_names;b=b.attr_types;this.layer.attributeTypes={};if(a.notNull(c)&&a.notNull(b)&&c.length===b.length)for(var z=0;z<c.length;z++){var J=c[z].toUpperCase();this.layer.attributeTypes[J]=b[z]}}},parseFeatures:function(b){var c=this.layer.getSelectedFeatures(),z=b.features,J=z.length,L={};this.layer.featureArray=[];this.layer.mapping=!1;this.layer.attrNames=b.attr_names;this.layer.columnMap=
b.columnMap;var K=this;b=function(b){L[b]||(L[b]=b,K.count++,a.style.StyleStore.getServerSideStyle(K.layer.dataSource,b,{url:K.layer.serverURL,callback:function(b){"undefined"!==typeof a.style.HeatMap&&b instanceof a.style.HeatMap&&!K.layer.renderingStyle&&(K.layer.renderingStyle=b);K.count--}}))};for(var A=0;A<J;A++)try{var m=z[A],p=m.geometry;if(!a.isNull(p)&&!a.$.isEmptyObject(p)){this.layer.type===a.layer.VectorLayer.TYPE_DATAPACK&&(p=a.util.GeomUtil.parseGeoJson(p));var E="undefined"!==typeof m._id?
m._id:A;if(this.layer.loadOnDemand){if(this.layer.featureEditable&&a.notNull(this.layer.changeManager)&&this.layer.changeManager.hasChanges())if(this.layer.changeManager.isModifiedFeature(E)){this.layer.featureArray.push(this.layer.changeManager.modifiedFeatures[E]);this.layer.changeManager.modifiedFeatures[E].rtreeKeys=[];continue}else if(this.layer.changeManager.isRemovedFeature(E))continue;if(a.notNull(c)&&0<c.length){for(var S=-1,Q=0;Q<c.length;Q++)if(c[Q].id===E){S=Q;break}if(-1<S){this.layer.featureArray.push(c[S]);
c[S].rtreeKeys=[];continue}}}p.srid=this.srid;var v=new a.Feature(E,p,{attributes:m.properties});a.notNull(this.layer.columnMap)&&(v.columnMap=this.layer.columnMap);v.srid=this.srid;if(!this.layer.doFilter(v)){v.labelBox=m.label_box;if(this.layer.type!==a.layer.VectorLayer.TYPE_DATAPACK){if(m.styles&&m.styles.rendering&&m.styles.rendering.style){m.styles&&m.styles.rendering&&m.styles.rendering.columns&&(v.columns=m.styles.rendering.columns);var ha=m.styles.rendering.style;v.styleName=ha;b(ha)}m.styles&&
m.styles.labeling&&m.styles.labeling.style&&(m.styles&&m.styles.labeling&&m.styles.labeling.columns&&(v.labelColumn=m.styles.labeling.columns[0]),v.labelStyleName=m.styles.labeling.style,b(v.labelStyleName))}this.layer.featureArray.push(v)}}}catch(pa){a.util.Logger.warning("MAPVIEWER_9101","OM.layer.GeoJsonParser.parseFeatures",pa.message+" (Feature id: "+E+")")}if(this.layer.loadOnDemand&&this.layer.featureEditable&&a.notNull(this.layer.changeManager)){c=this.layer.changeManager.getNewFeatures();
for(z=0;z<c.length;z++)this.layer.featureArray.push(c[z]),c[z].rtreeKeys=[];this.layer.rtree=null;this.layer.segmentRtree={}}}});a.layer.GeoRSSParser=a.Class.extend({initialize:function(a){this.vLayer=a},parse:function(b,c){var z=this.vLayer,J=Number.POSITIVE_INFINITY,L=Number.POSITIVE_INFINITY,K=Number.NEGATIVE_INFINITY,A=Number.NEGATIVE_INFINITY;z.featureArray=[];var m=z.parentMap.getMapContext().getUniverse().getSRID();a.$(b).find("entry").each(function(){var b=a.$(this),c=b.find("title").text(),
p=b.find("link").attr("href"),m=b.find("id").text(),E=b.find("updated").text(),w=b.find("content").text(),Ca=b.find("summary").text(),va=b.find("georss\\:point").text();""===va&&(va=b.find("point").text());if(a.notNull(va)&&""!==va){var va=va.split(" "),b=Number(va[1]),va=Number(va[0]),Da=new a.geometry.Point(b,va,8307),Aa={};a.notNull(c)&&(Aa._LABEL_=c);a.notNull(p)&&(Aa.link="\x3ca href\x3d'"+p+"' target\x3d'_blank'\x3elink\x3c/a\x3e");a.notNull(E)&&(Aa.updated=E);a.notNull(w)&&(Aa.content=w);a.notNull(Ca)&&
(Aa.summary=Ca);c=new a.Feature(m,Da,{attributes:Aa});b<J&&(J=b);b>K&&(K=b);va<L&&(L=va);va>A&&(A=va);z.featureArray.push(c)}});z.dataLoaded=!0;if(!z.featureArray||0===z.featureArray.length)return!1;var p=a.event,E=function(a){var b=new p.LayerEvent(p.LayerEvent.FEATURES_LOADED,z);b.mapContext=z.parentMap.getMapContext();z.fire(p.LayerEvent.FEATURES_LOADED,b);c(a)};8307!==m?(new a.geometry.Rectangle(J,L,K,A,8307)).transform(m,function(a){a=[a.getMinX(),a.getMinY(),a.getMaxX(),a.getMaxY()];E(a)}):
E([J,L,K,A]);return!0}});a.layer.DynamicTileLayer=a.layer.TileLayer.extend({initialize:function w(b,c,L){c=a.$.extend(!0,{},c);if(a.notNull(L)&&"[object Object]"===Object.prototype.toString.call(L))try{c.serverMapRequest=L,a.isNull(c.dataSource)&&(a.notNull(L.dataSource)?c.dataSource=L.dataSource:a.notNull(L.datasource)?c.dataSource=L.datasource:a.util.Logger.warning("MAPVIEWER_9099","OM.layer.DynamicTileLayer.initialize")),a.isNull(c.tileServerURL)&&(a.notNull(L.baseURL)?c.tileServerURL=L.baseURL+
"/omserver":a.util.Logger.warning("MAPVIEWER_9100","OM.layer.DynamicTileLayer.initialize"))}catch(K){a.util.Logger.warning("MAPVIEWER_9082","OM.layer.DynamicTileLayer.initialize")}a.isNull(c.isWMSTileLayer)&&(c.isDynamicTileLayer=!0);a.notNull(c.isDynamicTileLayer&&c.tileServerURL)&&(c.tileServerURL=this.fixTileServerUrl(c.tileServerURL));w.base.call(this,b,c);this.initialize_DTL(c);this.bindingParameters=null},fixTileServerUrl:function(b){if(a.notNull(b)&&-1===b.indexOf("/omserver")){a.util.Logger.warning("MAPVIEWER_9075",
"OM.layer.Tilelayer.initialize");var c=b.indexOf("/mcserver");0<c&&(b=b.substring(0,c)+"/omserver",a.util.Logger.warning("MAPVIEWER_9076","OM.layer.Tilelayer.initialize"))}return b},initialize_DTL:function(b){this.layerType=a.LayerTypes.DYNAMIC_TILE;a.isNull(b.isWMSTileLayer)?this.isDynamicTileLayer=!0:this.isWMSTileLayer=!0;var c;if(a.isNull(b))a.util.Logger.warning("MAPVIEWER_9070","OM.layer.TileLayer.initialize_DTL");else{this.yOffset_DynamicTL=this.xOffset_DynamicTL=0;this.tileLayerConfig={};
if(b.tileLayerConfig){this.tileLayerConfig.tileImageHeight=b.tileLayerConfig.tileImageHeight;this.tileLayerConfig.tileImageWidth=b.tileLayerConfig.tileImageWidth;this.tileLayerConfig.tileImageFormat=b.tileLayerConfig.tileImageFormat;if(a.isNull(this.tileLayerConfig.tileImageFormat)||"PNG"===this.tileLayerConfig.tileImageFormat)this.tileLayerConfig.tileImageFormat="image/png";if(a.isNull(this.tileLayerConfig.tileImageHeight)||a.isNull(this.tileLayerConfig.tileImageWidth)||0>=this.tileLayerConfig.tileImageHeight||
0>=this.tileLayerConfig.tileImageWidth)this.tileLayerConfig.tileImageHeight=256,this.tileLayerConfig.tileImageWidth=256}else c=new a.layer.TileLayerConfig,this.tileLayerConfig.tileImageHeight=c.tileImageHeight,this.tileLayerConfig.tileImageWidth=c.tileImageHeight,this.tileLayerConfig.tileImageFormat="image/png";b.universe?(this.tileLayerConfig.bounds=b.universe.bound,this.tileLayerConfig.srid=b.universe.srid,this.tileLayerConfig.zoomLevels=b.universe.zoomLevels):a.isNull(this.parentMap)?(c=new a.universe.ElocationUniverse,
this.tileLayerConfig.bounds=c.bound,this.tileLayerConfig.srid=c.srid,this.tileLayerConfig.zoomLevels=c.zoomLevels,a.util.Logger.warning("MAPVIEWER_9072","OM.layer.TileLayer.initialize_DTL")):(c=this.parentMap.getMapContext(),a.isNull(c)?a.util.Logger.warning("MAPVIEWER_9084","OM.layer.TileLayer.initialize_DTL"):(c=c.getUniverse(),a.isNull(c)&&(c=new a.universe.ElocationUniverse,a.util.Logger.warning("MAPVIEWER_9072","OM.layer.TileLayer.initialize_DTL")),this.tileLayerConfig.bounds=c.bound,this.tileLayerConfig.srid=
c.srid,this.tileLayerConfig.zoomLevels=c.zoomLevels));a.notNull(b.urlBuilder)&&(this.getURLBuilderURL=b.urlBuilder,a.notNull(b.urlBuilderOptions)&&(this.urlBuilderParams=b.urlBuilderOptions));a.notNull(b.tileURLTemplate)&&this.extractCustomTileURL(b.tileURLTemplate);a.notNull(b.hideInOverviewMap)?this.hideInOverviewMap=b.hideInOverviewMap:this.hideInOverviewMap=!0;this.serverMapRequest=b.serverMapRequest}},getDefaultImgURL:function(b,c,J,L,K,A){var m,p=this.parentMap;a.notNull(this.serverMapRequest)&&
(m=this.serverMapRequest.clone(),m.setImageWidth(b),m.setImageHeight(c),m.setBBox(J,L,K,A,this.tileLayerConfig.srid),b=this.serverURL,a.notNull(this.serverArray)&&(b=this.serverArray[this.serverCounter],this.serverCounter+=1,this.serverCounter%=this.serverArray.length),m.setProperties({isclienttilereq:!0,tileServerURL:b,applicationID:a.notNull(p.applicationID)?p.applicationID:null}),this.enableUTFGrid&&(m.setEnableUTFGrid(!0),m.setUTFGridResolution(this.utfgridResolution)),m=m.toXMLString());return m},
getCustomURL:function(b,c,J){var L;if(a.notNull(this.tileURLTemplate)){L=Math.ceil((this.tileLayerConfig.bounds.getMaxY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh)-1;b=a.util.MiscUtil.substituteStr(this.tileURLTemplate,"{x}",""+b);b=a.util.MiscUtil.substituteStr(b,"{y}",""+(L-c));b=a.util.MiscUtil.substituteStr(b,"{z}",""+(J+(a.notNull(this.z_offset)?this.z_offset:0)));if(a.notNull(this.tileCustomURLProps))for(var K in this.tileCustomURLProps)b=a.util.MiscUtil.substituteStr(b,"{"+
K+"}",this.tileCustomURLProps[K]);return b}},getDynamicTL_URL:function(b,c,J){if(this.tileCustomURL)return this.getCustomURL(b,c,J);var L=this.tileLayerConfig.zoomLevels[J];J=this.tileLayerConfig.tileImageWidth;var K=this.tileLayerConfig.tileImageHeight,A=J*L.resolution,L=K*L.resolution*L.stretchRatio;b=this.tileLayerConfig.bounds.getMinX()+b*A;A=b+A;c=this.tileLayerConfig.bounds.getMinY()+c*L;L=c+L;return a.isNull(this.getURLBuilderURL)?this.getDefaultImgURL(J,K,b,c,A,L):this.getURLBuilderURL(J,
K,b,c,A,L,this.urlBuilderParams)},setBindingParameters:function(b){var c=this.serverMapRequest;a.notNull(c)&&c.setBindingParameters(b)},getStaticMapURL:function(b,c){var J=new a.geometry.Point(this.parentMap.getMapWindowBoundingBox().getMinX(),this.parentMap.getMapWindowBoundingBox().getMinY(),this.tileLayerConfig.srid),L=new a.geometry.Point(this.parentMap.getMapWindowBoundingBox().getMaxX(),this.parentMap.getMapWindowBoundingBox().getMaxY(),this.tileLayerConfig.srid);return a.isNull(this.getURLBuilderURL)?
this.getDefaultImgURL(b,c,J.getX(),J.getY(),L.getX(),L.getY()):this.getURLBuilderURL(b,c,J.getX(),J.getY(),L.getX(),L.getY(),this.urlBuilderParams)},extractCustomTileURL:function(b){!0===Array.isArray(b)?(this.checkRequiredPlaceHolders(b[0]),2!==b.length?a.util.Logger.warning("MAPVIEWER_9098","OM.layer.DynamicTileLayer.extractCustomTileURL"):this.tileCustomURLProps=b[1],this.tileURLTemplate=b[0]):(this.checkRequiredPlaceHolders(b),this.tileURLTemplate=b)},checkRequiredPlaceHolders:function(b){var c=
b.toUpperCase().indexOf("{X}"),J=b.toUpperCase().indexOf("{Y}");b=b.toUpperCase().indexOf("{Z}");return 0<c&&0<J&&0<b?!0:(a.util.Logger.warning("MAPVIEWER_9097","OM.layer.DynamicTileLayer.checkRequiredPlaceHolders"),!1)},setZoomLevelOffset:function(a){this.z_offset=a}});a.layer.DynamicTileLayer.combineDTLURLs=function(a){var b=this.combineDTLThemes(a);a=this.combineDTLStyles(a);return b+a};a.layer.DynamicTileLayer.combineDTLThemes=function(b){for(var c="",J=0;J<b.length;J++){var L=b[J],L=decodeURIComponent(L),
K=-1,A=-1,m=-1,p="";a.notNull(L)&&(K=L.indexOf('datasource\x3d"'),0<K&&(A=L.indexOf('"',K),0<A&&(m=L.indexOf(" ",A)),0<K,0<A&&0<m))&&(p=L.substring(A,m));a.isNull(p)&&a.util.Logger.warning("MAPVIEWER_9099","OM.Map.combineDTLThemes","No datasource attribute found in ["+L+"]");m=0;do K=L.indexOf("\x3ctheme ",m),0<K&&(A=L.indexOf("\x3c/theme\x3e",m),0<A&&(c+="\x3ctheme datasource\x3d"+p+" "+L.substring(K+7,A)+"\x3c/theme\x3e",m=A+8));while(0<K)}return a.notNull(c)&&0<c.trim().length?"\x3cthemes\x3e"+
c+"\x3c/themes\x3e":""};a.layer.DynamicTileLayer.combineDTLStyles=function(b){for(var c="",J=0;J<b.length;J++){var L=b[J],L=decodeURIComponent(L),K=-1,A=-1,K=L.indexOf("\x3cstyles\x3e");0<K&&(A=L.indexOf("\x3c/styles\x3e"),0<A&&(c+=L.substring(K+8,A)))}return a.notNull(c)&&0<c.trim().length?"\x3cstyles\x3e"+c+"\x3c/styles\x3e":""};a.layer.WMSTileLayer=a.layer.DynamicTileLayer.extend({initialize:function z(b,c){a.notNull(c)&&(c.isWMSTileLayer=!0);z.base.call(this,b,c);this.initialize_WMSTL(c);this.bindingParameters=
null},initialize_WMSTL:function(b){this.isWMSTileLayer=!0;this.layerType=a.LayerTypes.DYNAMIC_TILE;a.isNull(b)?a.util.Logger.warning("MAPVIEWER_9069","OM.layer.TileLayer.initialize_WMSTL"):(this.serverURL=b.wmsServerURL,a.isNull(this.serverURL)&&a.util.Logger.warning("MAPVIEWER_9066","OM.layer.TileLayer.initialize_WMSTL"),a.isNull(b.urlBuilderOptions)||(this.optParams_WMSTL=b.urlBuilderOptions,a.isNull(this.optParams_WMSTL.layers)&&a.util.Logger.warning("MAPVIEWER_9067","OM.layer.TileLayer.initialize_WMSTL"),
a.isNull(this.optParams_WMSTL.version)&&a.util.Logger.warning("MAPVIEWER_9068","OM.layer.TileLayer.initialize_WMSTL")),a.notNull(b.hideInOverviewMap)?this.hideInOverviewMap=b.hideInOverviewMap:this.hideInOverviewMap=!0)},buildWMSTL_URL:function(b,c,L,K,A,m){var p="";b=this.serverURL+"?request\x3dgetmap\x26bbox\x3d"+L+","+K+","+A+","+m+"\x26width\x3d"+b+"\x26height\x3d"+c;if(!a.isNull(this.optParams_WMSTL))for(var E in this.optParams_WMSTL)p="bgcolor"===E.toLowerCase()?p+"\x26"+E+"\x3d"+encodeURIComponent(this.optParams_WMSTL[E]):
p+"\x26"+E+"\x3d"+this.optParams_WMSTL[E];return b+p},getWMSTL_URL:function(a,b,c){c=this.tileLayerConfig.zoomLevels[c];var K=this.tileLayerConfig.tileImageWidth*c.resolution;c=this.tileLayerConfig.tileImageHeight*c.resolution*c.stretchRatio;a=this.tileLayerConfig.bounds.getMinX()+a*K;K=a+K;b=this.tileLayerConfig.bounds.getMinY()+b*c;return this.buildWMSTL_URL(this.tileLayerConfig.tileImageWidth,this.tileLayerConfig.tileImageHeight,a,b,K,b+c)}});a.layer.WMTSTileLayer=a.layer.TileLayer.extend({initialize:function J(a,
b){var c=b||{};J.base.call(this,a,c);this.initialize_WMTS(c)},initialize_WMTS:function(b){this.layerType=a.LayerTypes.WMTS_TILE;this.getCapabilitiesURL=b.url;this.getTileTemplate=b.getTileTemplate;this.layerID=b.layerID;this.tileMatrixSetID=b.tileMatrixSetID;a.notNull(b.hideInOverviewMap)?this.hideInOverviewMap=b.hideInOverviewMap:this.hideInOverviewMap=!0},buildConfig:function(b){if(null===b)a.util.Logger.warning("","OM.layer.WMTSTileLayer.buildConfig","The WMTS config cannot be null.");else{if(a.notNull(this.getTileTemplate))this.tileURLTemplate=
this.getTileTemplate;else if(b.urls&&0<b.urls.length)this.tileURLTemplate=b.urls[0];else{a.util.Logger.warning("","OM.layer.WMTSTileLayer.buildConfig","The WMTS URL template does not present.");return}this.style=b.style;for(var c=[],K=0,A=b.tileGrid.resolutions.length;K<A;K+=1)c.push(new a.universe.ZoomLevel(b.tileGrid.resolutions[K]));return{srid:b.projection.SRID,bounds:b.projection.bounds,zoomLevels:c,tileImageWidth:b.tileGrid.tileSizes[0],tileImageHeight:b.tileGrid.tileSizes[0]}}},getWMTS_URL:function(b,
c,K){var A;if(a.notNull(this.tileURLTemplate)){A=Math.ceil((this.tileLayerConfig.bounds.getMaxY()-this.tileLayerConfig.bounds.getMinY())/this.centerMesh.mh-1);b=a.util.MiscUtil.substituteStr(this.tileURLTemplate,"{TileCol}",""+b);b=a.util.MiscUtil.substituteStr(b,"{TileRow}",""+(A-c));b=a.util.MiscUtil.substituteStr(b,"{TileMatrix}",""+(K+(a.notNull(this.z_offset)?this.z_offset:0)));b=a.util.MiscUtil.substituteStr(b,"{style}",this.style);b=a.util.MiscUtil.substituteStr(b,"{TileMatrixSet}",""+this.tileMatrixSetID);
if(a.notNull(this.tileCustomURLProps))for(var m in this.tileCustomURLProps)b=a.util.MiscUtil.substituteStr(b,"{"+m+"}",this.tileCustomURLProps[m]);return b}}});a.layer.VectorTileLayer=a.layer.VectorLayer.extend({initialize:function L(b,c){if(a.isNull(c)||a.isNull(c.def))throw Error("Invalid or null VectorTileLayer options found.");var m=this;c.def.type=a.layer.VectorLayer.TYPE_MAPBOX;var p=c.def;this.options=c;L.base.call(this,b,c);this.type=p.type;this.dataSource=p.dataSource||p.datasource;this.themeName=
p.theme;this.keyColumn=p.keyColumn?p.keyColumn.toUpperCase():null;this.serverURL=p.url;a.isNull(this.serverURL)&&(this.serverURL=a.gv._baseURL);this.featuresMap={};this.tileFeatures={};this.loadTileFeaturesTask=null;a.notNull(this.themeName)&&(a.isNull(this.keyColumn)||a.isNull(this.renderingStyle))&&a.util.HttpRequest.send("/mapviewer/omserver",{xml_request:'\x3cnon_map_request\x3e\x3cget_theme_info data_source\x3d"'+m.dataSource+'" theme\x3d"'+m.themeName+'"/\x3e\x3c/non_map_request\x3e'},function(b){if(a.isNull(m.keyColumn)){var c=
a.$(b).find("key_column").text();console.log("Key column: "+c);a.notNull(c)&&(m.keyColumn=c)}a.isNull(m.renderingStyle)&&(b=a.$(b).find("theme_style[label\x3d'false']").attr("name"),console.log("Theme render style: "+b),a.notNull(b)&&(m.renderingStyle={name:b,dataSource:m.dataSource}))},"xml")},enableFeatureEditing:function(a){return!1},getFeatureGeometryType:function(){if(this.featureArray&&0<this.featureArray.length){var b=this.featureArray[0].geo.geometries;if(a.notNull(b)&&0<b.length){b=b[0];
if("Point"===b.type||"OrientedPoint"===b.type||"MultiPoint"===b.type||"OrientedMultiPoint"===b.type)return"POINT";if("LineString"===b.type||"MultiLineString"===b.type)return"LINESTRING";if("Polygon"===b.type||"MultiPolygon"===b.type)return"POLYGON"}}return""},addFeature:function(a){},addFeatures:function(a){},refreshImpl:function(b,c,A){if(!a.isNull(this.group))if(A=b&&b.type===a.event.MapEvent.MAP_BEFORE_REFRESH?b.bigPan:!1,c?(A||(this.loaded=!1),A||(this.dataLoaded=!1)):b&&null!==b.beforeZoomLevel&&
null!==b.afterZoomLevel&&b.beforeZoomLevel!==b.afterZoomLevel&&this.setWindow(),this.clearFeatureShapes(),this.clearAllLabels(),this.checkVisible()){b=this.parentMap.getMapContext();c=b.getUniverse();var m=c.getZoomLevels()[b.getZoomLevel()],p=b.getCenterPoint();A=this.orgWidth*this.xRatio*m.resolution;m=this.orgHeight*this.yRatio*m.resolution*m.stretchRatio;this.dataBufferWindow={x:p.getX()-A/2,y:p.getY()-m/2,w:A,h:m};this.emptyCustomLayer();var p=c.getSRID(),E=null,S=this.visibleBound?Math.max(this.dataBufferWindow.x,
this.visibleBound.getMinX()):this.dataBufferWindow.x,Q=this.visibleBound?Math.max(this.dataBufferWindow.y,this.visibleBound.getMinY()):this.dataBufferWindow.y;A=this.visibleBound?Math.min(this.dataBufferWindow.x+A,this.visibleBound.getMaxX()):this.dataBufferWindow.x+A;m=this.visibleBound?Math.min(this.dataBufferWindow.y+m,this.visibleBound.getMaxY()):this.dataBufferWindow.y+m;c.geodetic&&(-180>S&&(S=-180),-90>Q&&(Q=-90),180<A&&(A=180),90<m&&(m=90));E=new a.geometry.Rectangle(S,Q,A,m,p);E.transform(3857,
function(a){E=a});m=a.util.WorldMercatorUtil.metersToPixels(b.getZoomLevel(),E.getMinX(),E.getMinY());S=a.util.WorldMercatorUtil.metersToPixels(b.getZoomLevel(),E.getMaxX(),E.getMaxY());p=Math.round(m[0]/256);c=Math.round(S[0]/256);A=Math.min(Math.round(m[1]/256),Math.round(S[1]/256));m=Math.max(Math.round(m[1]/256),Math.round(S[1]/256));S=A;A=(1<<b.getZoomLevel())-1-m;m=(1<<b.getZoomLevel())-1-S;0>p&&(p=0);0>A&&(A=0);this.tileFeatures={};this.featuresMap={};this.featureArray=[];this.rtree=this.attrNames=
null;this.numberOfTilesToLoad=(c-p+1)*(m-A+1);if(1>this.numberOfTilesToLoad)a.util.Logger.info(null,"VectorTileLayer","["+this.name+"]  No tiles to load.");else{this.loadedTiles=[];this.loading=!0;this.loaded=!1;a.util.Logger.fine(null,"VectorTileLayer","["+this.name+"]  tile loading started. ["+this.numberOfTilesToLoad+"]");a.util.Logger.finest(null,"VectorTileLayer","["+this.name+"]  tile retrieval and rendering started.");a.util.Logger.finest(null,"VectorTileLayer","["+this.name+"]  number of tiles to process: "+
this.numberOftilesToProcess);for(this.loadTileFeaturesTask=this.startNewTask();p<=c;p++)for(S=A;S<=m;S++)Q=b.getZoomLevel()+"_"+p+"_"+S,a.util.Logger.finest(null,"VectorTileLayer","["+this.name+"] processing tile "+Q+"."),a.notNull(this.tileFeatures[Q])?this.checkVisible()&&this.displayTileFeatures(b.getZoomLevel(),p,S):this.getTileData(b.getZoomLevel(),p,S);a.util.Logger.fine(null,"VectorTileLayer","["+this.name+"]  all tiles processed (but some may be in rendering phase).");a.notNull(this.initTask)&&
(this.initTask.complete(),this.initTask=null)}}else b=a.event,c=new b.MapEvent(b.LayerEvent.FINISH_LOAD,this),c.mapContext=this.parentMap.getMapContext(),this.fire(b.LayerEvent.FINISH_LOAD,c)},getTileData:function(b,c,A){var m=dcodeIO.ProtoBuf,p=m.loadProtoFile(a.gv.getProtoResourcePath()+"vector_tile.proto").build("vector_tile"),E=a.util.WorldMercatorUtil.getTileCoverage(b,c,A),S=m.Util.XHR();S.open("GET",this.serverURL+"/vt/"+this.dataSource+"/"+b+"/"+c+"/"+A+".mvt?t\x3d"+this.themeName,!0);var Q=
this;S.responseType="arraybuffer";S.onload=function(m){m=p.Tile.decode(S.response);m=Q.decodeFeatures(m,E);var ha=b+"_"+c+"_"+A;if(a.isNotNull(m)&&0<m.length){Q.featureArray||(Q.featureArray=[]);var pa=Q.parentMap.getMapContext().getUniverse().getSRID();E.transform(pa,function(a){E=a});for(var ra=0;ra<m.length;ra++)if(a.isNotNull(m[ra].id)){var Ca=Q.featuresMap[m[ra].id],va={},Da=null,Da=Da=Da=null;if(a.isNull(Ca)){var Aa=m[ra].geo;Aa.transform(pa,function(a){Aa=a});Da=[];Da.push(Aa);Da=new a.geometry.GeometryCollection(Da,
pa);Ca=new a.Feature(m[ra].id,Da,{attributes:m[ra].getAttributes()});Ca.tiledFeature=!0;Q.featureArray.push(Ca);va[m[ra].id]=Aa;Ca.tileGeometries[ha]=va;Ca.clipMap[ha]=E;Ca.zoomLevelsGeometries["zoomlevel_"+b]=Da;Da=[];Da.push(E);Ca.zoomLevelsGeomClipArea["zoomlevel_"+b]=Da;Q.featuresMap[m[ra].id]=Ca;if(a.isNull(Q.attrNames)&&a.isNotNull(Ca.getAttributes())){va=Ca.getAttributes();Q.attrNames=[];for(var Sa in va)va.hasOwnProperty(Sa)&&Q.attrNames.push(Sa);Q.nsdpTitleArray&&(Q.attrNames?(Q.nsdpTitleArray[0].toUpperCase()===
Q.nsdpKey&&Q.nsdpTitleArray.shift(),Q.attrNames=Q.attrNames.concat(Q.nsdpTitleArray)):this.nsdpTitleArray[0].toUpperCase()===Q.nsdpKey&&(Q.attrNames=Q.nsdpTitleArray.slice(1)))}}else Aa=m[ra].geo,Aa.transform(pa,function(a){Aa=a}),va=Ca.tileGeometries[ha],a.isNull(va)&&(va={},Ca.tileGeometries[ha]=va),va[m[ra].id]=Aa,Ca.clipMap[ha]=E,Da=Ca.zoomLevelsGeometries["zoomlevel_"+b],a.isNull(Da)?(Da=[],Da.push(Aa),Da=new a.geometry.GeometryCollection(Da,pa),Ca.zoomLevelsGeometries["zoomlevel_"+b]=Da,Da=
[],Da.push(E),Ca.zoomLevelsGeomClipArea["zoomlevel_"+b]=Da):(Da=Da.geometries,Da.push(Aa),Da=Ca.zoomLevelsGeomClipArea["zoomlevel_"+b],Da.push(E));Da=Q.tileFeatures[ha];a.isNull(Da)&&(Da=[],Q.tileFeatures[ha]=Da);Da.push(m[ra].id);Q.mappingFeatureNSDP(Ca)}!Q.checkVisible()||Q.renderingStyle&&("HeatMap"===Q.renderingStyle.styleType||Q.renderingStyle instanceof a.style.BucketStyle&&!Q.renderingStyle.isServerSide&&Q.renderingStyle.buckets&&0<Q.renderingStyle.buckets.length&&!(Q.renderingStyle.buckets[0]instanceof
a.style.CollectionBucket))||Q.displayTileFeatures(b,c,A)}Q.addToTileLoadedList(ha)};S.onerror=function(p){p=b+"_"+c+"_"+A;a.util.Logger.warning(null,"VectorTileLayer","["+Q.name+"]  error while processing tile "+p+".");console.log("["+Q.name+"]  error while processing tile "+p+".");Q.addToTileLoadedList(p)};S.send(null)},addToTileLoadedList:function(b){if(!(a.isNull(b)||1>this.numberOfTilesToLoad)&&(this.loadedTiles.push(b),a.notNull(this.loadTileFeaturesTask)&&this.loadedTiles.length!==this.numberOfTilesToLoad&&
this.loadTileFeaturesTask.update(this.loadedTiles.length/this.numberOfTilesToLoad),this.loadedTiles.length===this.numberOfTilesToLoad)){this.loading=!1;this.loaded=!0;a.util.Logger.fine(null,"VectorTileLayer","Finished loading of "+this.numberOfTilesToLoad+" tiles.");if(this.checkVisible())if(this.renderingStyle&&"HeatMap"===this.renderingStyle.styleType)console.log("Going to display heat map ..."),this.displayHeatMap();else if(this.renderingStyle&&this.renderingStyle instanceof a.style.BucketStyle&&
!this.renderingStyle.isServerSide&&this.renderingStyle.buckets&&0<this.renderingStyle.buckets.length&&!(this.renderingStyle.buckets[0]instanceof a.style.CollectionBucket)&&(this.renderingStyle.generateBuckets(this.featureArray,this.styleAttributes,!0),a.isNotNull(this.featureArray)))for(b=0;b<this.featureArray.length;b++)this.displayFeature(this.featureArray[b]);a.notNull(this.loadTileFeaturesTask)&&(this.loadTileFeaturesTask.complete(),this.loadTileFeaturesTask=null)}},displayEnd:function(a){console.log("Vector tile layer displayEnd called.")},
displayTileFeatures:function(b,c,A){var m=this.startNewTask();b=b+"_"+c+"_"+A;c=this.tileFeatures[b];if(a.isNotNull(c)){A={};for(var p=.3,E=0;E<c.length;E++){var S=E/c.length;a.isNotNull(A[c[E]])||(S>=p&&(m.update(S),p+=.3),A[c[E]]=E,this.displayFeature(this.featuresMap[c[E]],b))}}m.complete()},displayFeature:function(b,c){if(!a.isNull(b)){if(!b.displayed){var A=this.parentMap.getMapContext();A.getWholeMapNum();A.getBaseWholeMapIndex();a.notNull(this.featureGroupArr)&&0<this.featureGroupArr.length&&
(a.notNull(b.activeIdx)?this.realGroup=this.featureGroupArr[b.activeIdx]:this.realGroup=this.featureGroupArr[0]);a.isNull(this.realGroup)&&(this.realGroup=this.parentMap.graphics.createGroup(),this.realGroup.applyStyle({cursor:this.mouseCursor}),this.pointerSensitivity||this.realGroup.applyStyle({pointerSensitivity:!1}),this.group.appendChild(this.realGroup));b.group=this.realGroup;b.screenTransformObj=this.parentMap.getMapContext().getTransform();b.graphics=this.parentMap.graphics;b.parentLayer=
this}A=null;A=a.isNotNull(c)?b.tileGeometries[c][b.id].getMBR():b.geo.getMBR();this.display(b,A,c)}},decodeFeatures:function(b,c){if(a.isNull(b.layers)||0===b.layers.length|a.isNull(c))return null;var A=b.layers[0].extent,m=[];if(a.isNotNull(b.layers[0].keys)&&0<b.layers[0].keys.length)for(var p=0;p<b.layers[0].keys.length;p++)m.push(b.layers[0].keys[p]);var E=[];if(a.isNotNull(b.layers[0].values)&&0<b.layers[0].values.length)for(p=0;p<b.layers[0].values.length;p++){var S=null;a.notNull(b.layers[0].values[p].bool_value)?
S=b.layers[0].values[p].bool_value:a.notNull(b.layers[0].values[p].double_value)?S=b.layers[0].values[p].double_value:a.notNull(b.layers[0].values[p].float_value)?S=b.layers[0].values[p].float_value:a.notNull(b.layers[0].values[p].int_value)?S=b.layers[0].values[p].int_value:a.notNull(b.layers[0].values[p].sint_value)?S=b.layers[0].values[p].sint_value:a.notNull(b.layers[0].values[p].string_value)?S=b.layers[0].values[p].string_value:a.notNull(b.layers[0].values[p].uint_value)&&(S=b.layers[0].values[p].uint_value);
E.push(S)}S=[];if(a.isNotNull(b.layers[0].features)&&0<b.layers[0].features.length)for(p=0;p<b.layers[0].features.length;p++){var Q=this.decodeFeature(b.layers[0].features[p].type,b.layers[0].features[p].geometry,b.layers[0].features[p].tags,m,E,c,A);a.isNotNull(Q)&&S.push(Q)}return S},decodeFeature:function(b,c,A,m,p,E,S){if(a.isNull(c)||a.isNull(E))return null;var Q=null;1===b?Q=this.decodePointGeometry(c,E,S):2===b?Q=this.decodeLineGeometry(c,E,S):3===b&&(Q=this.decodePolygonGeometry(c,E,S));if(a.isNull(Q))return null;
b=this.decodeFeatureAttributes(A,m,p);return a.notNull(b)&&a.notNull(b[this.keyColumn])?new a.Feature(b[this.keyColumn],Q,{attributes:b}):null},decodePointGeometry:function(b,c,A){if(a.isNull(b)||a.isNull(c)||a.isNull(A))return null;var m=b[0]>>3,p=null,p=b[1]>>1^-(b[1]&1),E=b[2]>>1^-(b[2]&1),S=this.getMapPoint(c,A,p,E),Q=p,v=E;if(1===m)p=new a.geometry.Point(S[0],S[1],3857);else{for(var ha=[],pa=0;pa<m;pa++){var ra=[];0===pa?(ra.push(S[0]),ra.push(S[1])):(p=b[1+2*pa]>>1^-(b[1+2*pa]&1),E=b[2*pa+2]>>
1^-(b[2*pa+2]&1),p+=Q,E+=v,S=this.getMapPoint(c,A,p,E),ra.push(S[0]),ra.push(S[1]),Q=p,v=E);ha.push(ra)}p=new a.geometry.MultiPoint(ha,3857,2)}return p},decodeLineGeometry:function(b,c,A){if(a.isNull(b)||a.isNull(c)||a.isNull(A))return null;var m=b.length,p=b[3]>>3,E=null,E=[];if(m===2*p+4){var S=b[1]>>1^-(b[1]&1),Q=b[2]>>1^-(b[2]&1),v=S,ha=Q,pa=this.getMapPoint(c,A,S,Q);E.push(pa[0]);E.push(pa[1]);for(S=0;S<p;S++){var Q=b[4+2*S]>>1^-(b[4+2*S]&1),ra=b[2*S+5]>>1^-(b[2*S+5]&1);if(Q!==v||ra!==ha)Q+=
v,ra+=ha,pa=this.getMapPoint(c,A,Q,ra),E.push(pa[0]),E.push(pa[1]),v=Q,ha=ra}E=new a.geometry.LineString(E,3857,2)}else{for(var ha=v=-1,Ca=0,va=[];Ca<m;){E=[];S=b[Ca+1]>>1^-(b[Ca+1]&1);Q=b[Ca+2]>>1^-(b[Ca+2]&1);0<Ca&&(S+=v,Q+=ha);pa=this.getMapPoint(c,A,S,Q);E.push(pa[0]);E.push(pa[1]);v=S;ha=Q;p=b[Ca+3]>>3;for(S=0;S<p;S++)if(pa=Ca+4,Q=b[pa+2*S]>>1^-(b[pa+2*S]&1),ra=b[pa+2*S+1]>>1^-(b[pa+2*S+1]&1),Q!==v||ra!==ha)Q+=v,ra+=ha,pa=this.getMapPoint(c,A,Q,ra),E.push(pa[0]),E.push(pa[1]),v=Q,ha=ra;va.push(E);
Ca=Ca+4+2*p}E=new a.geometry.MultiLineString(va,3857,2)}return E},decodePolygonGeometry:function(b,c,A){if(a.isNull(b)||a.isNull(c)||a.isNull(A))return null;for(var m=b.length,p=b[3]>>3,E=null,S=[],Q=-1,v=-1,ha=0;ha<m;){var pa=[],ra=b[ha+1]>>1^-(b[ha+1]&1),p=b[ha+2]>>1^-(b[ha+2]&1);0<ha&&(ra+=Q,p+=v);Q=this.getMapPoint(c,A,ra,p);pa.push(Q[0]);pa.push(Q[1]);Q=ra;v=p;p=b[ha+3]>>3;for(ra=0;ra<p;ra++){var Ca=ha+4,va=b[Ca+2*ra]>>1^-(b[Ca+2*ra]&1),Ca=b[Ca+2*ra+1]>>1^-(b[Ca+2*ra+1]&1);if(va!==Q||Ca!==v)va+=
Q,Ca+=v,Q=this.getMapPoint(c,A,va,Ca),pa.push(Q[0]),pa.push(Q[1]),Q=va,v=Ca}ra=pa[1];pa.push(pa[0]);pa.push(ra);S.push(pa);ha=ha+4+2*p+1}if(0<S.length){b=[];for(ra=0;ra<S.length;ra++){c=[];c.push(S[ra]);A=a.util.GeomUtil.isClockwise(S[ra],2);for(m=ra+1;m<S.length;m++)if(a.util.GeomUtil.isClockwise(S[m],2)===A){ra=m-1;break}else c.push(S[m]);b.push(c)}0<b.length&&(E=1===b.length?new a.geometry.Polygon(b[0],3857,2):new a.geometry.MultiPolygon(b,3857,2))}return E},decodeFeatureAttributes:function(b,
c,A){if(a.isNull(c))return null;for(var m={},p=0;p<c.lenght;p++)m[c[p]]="";for(p=0;p<b.length;p+=2)m[c[b[p]]]=A[b[p+1]];return m},getMapPoint:function(b,c,A,m){if(a.isNull(b)||a.isNull(c)||a.isNull(A)||a.isNull(m))return null;A=A*b.getWidth()/c+b.getMinX();b=b.getMaxY()-m*b.getHeight()/c;return[A,b]},mappingFeatureNSDP:function(b){if(!a.isNull(b)&&!b.mapping&&this.nsdpData&&this.nsdpKey){var c=this.getNsdpDataForFeature(b);if(a.notNull(c)){a.$.extend(b.attributes,c);b.columns=[];for(var A in c)b.columns.push(A);
b.mapping=!0}else b.mapping=!1}}});a.visualfilter.VisualFilter=a.Class.extend({initialize:function(){}});a.visualfilter.DropShadow=a.visualfilter.VisualFilter.extend({initialize:function(b){this.type="DROPSHADOW";this.angle=b&&a.notNull(b.angle)?b.angle:45;this.color=b&&a.notNull(b.color)?b.color:null;this.knockout=b&&a.notNull(b.knockout)?b.knockout:null;this.offset=b&&a.notNull(b.offset)?b.offset:2;this.opacity=b&&a.notNull(b.opacity)?b.opacity:.5;this.radius=b&&a.notNull(b.radius)?b.radius:2;this.applyToLayer=
b&&a.notNull(b.applyToLayer)?b.applyToLayer:!0}});a.visualfilter.Glow=a.visualfilter.VisualFilter.extend({initialize:function(b){this.type="GLOW";this.color=b&&a.notNull(b.color)?b.color:null;this.strength=b&&a.notNull(b.strength)?b.strength:3;this.applyToLayer=b&&a.notNull(b.applyToLayer)?b.applyToLayer:!0}});a.infowindow.InfoWindow=a.Class.extend({initialize:function(b,c){this.maxY=this.maxX=this.minY=this.minX=0;var A=b.getMapContext();this.width=A.getDeviceWidth();this.height=A.getDeviceHeight();
this.parentMap=b;this.wininfo=null;this.$div=a.$("\x3cdiv style\x3d'position:absolute;width:0px;height:0px;z-index:3000'\x3e\x3c/div\x3e");this.parentMap.$topLayerDIV.append(this.$div);this.div=this.$div[0];this.infoWindows=[];this.$infoWindow=null;this.mouseOver=this.clrIntervalFlag=this.enablePropagation=!1;this.id=c;this.idPrefix="omv2_ifw_";A=a.event.MapEvent;b.addListener(A.I_MAP_DRAGGING,this.panEventAction);b.addListener(A.MAP_BEFORE_REFRESH,this.refreshEventAction);b.addListener(A.I_MAP_CENTER_ZOOM,
this.zoomEventAction);b.addListener(A.MAP_RESIZED,this.resizeEventAction);b.addListener(A.MAP_DESTROY,this.destroyEventAction);b.addListener(A.MAP_CLEAN,this.refreshEventAction);var m=this;m.infoStopPropagation=function(b){a.event.EventSource.stopEvents[b.type]=!0};m.infoMouseMove=function(a){m.mouseOnInfoWindow=!0;m.div&&(m.div.style.zIndex=3002);m.infoStopPropagation(a)};m.infoMouseOver=function(a){m.mouseOnInfoWindow=!0;m.div&&(m.div.style.zIndex=3001);m.infoStopPropagation(a)};m.infoMouseOut=
function(a){m.mouseOnInfoWindow=!1;m.div&&(m.div.style.zIndex=3E3);m.infoStopPropagation(a)};this.$div.bind("mousemove",m.infoMouseMove);this.$div.bind("mouseover",m.infoMouseOver);this.$div.bind("mouseout",m.infoMouseOut);this.$div.bind("touchmove touchend mousewheel mousedown mouseover mouseout click keyup keydown keypress dblclick",this.infoStopPropagation)},init:function(b){b=b?b:{};this.ellipsis=!1===b.ellipsis?!1:!0;this.infoWidth=parseInt(b.width);this.infoHeight=parseInt(b.height);this.background=
b.background?b.background:"#F5F5F9";this.title_string=b.title?b.title:"";this.tailStyle=this.closeButtonStyle=null;b.infoWindowStyle?("string"==typeof b.infoWindowStyle?(this.infoWindowStyle={},this.infoWindowStyle=this.toJsonCss(b.infoWindowStyle)):this.infoWindowStyle=b.infoWindowStyle,this.infoWindowStyle["background-color"]&&(this.infoWindowStyle.background=this.infoWindowStyle["background-color"]),this.background=this.infoWindowStyle.background,this.infoWindowStyle&&this.infoWindowStyle.background||
(this.background=this.infoWindowStyle.background="#F5F5F9")):this.infoWindowStyle={};b.titleStyle?"string"==typeof b.titleStyle?(this.titleStyle={},this.titleStyle=this.toJsonCss(b.titleStyle)):this.titleStyle=b.titleStyle:this.titleStyle={};b.contentStyle?"string"==typeof b.contentStyle?(this.contentStyle={},this.contentStyle=this.toJsonCss(b.contentStyle)):this.contentStyle=b.contentStyle:this.contentStyle={};this.tailStyle=b.tailStyle?b.tailStyle:{};b.closeButtonStyle&&(this.closeButtonStyle=b.closeButtonStyle);
this.infoWinId=this.idPrefix+b.id+"_";this.clrIntervalFlag=!1;this.typeId=b.typeId?b.typeId:this.parentMap.mapInstanceId+"_1";this.$infoWindow=a.$("\x3cdiv class\x3d'omv2_infoWindow_info' id\x3d\""+this.infoWinId+'"\x3e\x3c/div\x3e');this.$container=a.$("\x3cdiv\x3e\x3c/div\x3e")},showTabInfoWindow:function(b,K,A){this.init(A);b=this.parentMap.getScreenLocation(b);for(var m=0;m<this.infoWindows.length;m++){if(this.infoWinId&&this.infoWindows[m].nid==this.infoWinId){this.deleteInfoWindow(this.infoWindows[m]);
return}this.typeId&&this.infoWindows[m].typeId==this.typeId&&this.deleteInfoWindow(this.infoWindows[m])}this.infoWidth||(this.infoWidth=150);this.infoHeight||(this.infoHeight=50);this.getPageDirection();this.$infoWindow.css({background:"none repeat scroll 0 0 "+this.background,width:this.infoWidth,height:this.infoHeight});this.$infoWindow.css(this.infoWindowStyle);this.$container.css({position:"absolute",width:this.infoWidth-5,height:this.infoHeight-3,left:"6px","z-index":"2"});this.div.appendChild(this.$infoWindow[0]);
this.createCloseButtonDiv();var p=a.$("\x3cimg class\x3d'omv2_l_arrow_info' src\x3d'"+a.gv.resourcePath()+"overflow_left_ena.png'\x3e\x3c/img\x3e"),E=a.$("\x3cimg class\x3d'omv2_r_arrow_info' src\x3d'"+a.gv.resourcePath()+"overflow_right_ena.png'\x3e\x3c/img\x3e");E.css({right:"10px",top:"14px"});p.css({left:"0px",top:"14px"});E.bind("click touchstart",function(){p.css({visibility:"visible"});ha.css({left:parseInt(ha.css("left"))-60});parseInt(ha.css("left"))<=60*-(K.length-1)&&E.css({visibility:"hidden"})}).mouseover(function(){a.$(this)[0].src=
a.gv.resourcePath()+"overflow_right_ovr.png"}).mouseout(function(){a.$(this)[0].src=a.gv.resourcePath()+"overflow_right_ena.png"});p.bind("click touchstart",function(){E.css({visibility:"visible"});ha.css({left:parseInt(ha.css("left"))+60});0<=parseInt(ha.css("left"))&&(p.css({visibility:"hidden"}),E.css({visibility:"visible"}))}).mouseover(function(){a.$(this)[0].src=a.gv.resourcePath()+"overflow_left_ovr.png"}).mouseout(function(){a.$(this)[0].src=a.gv.resourcePath()+"overflow_left_ena.png"});var m=
this.infoWinId+"tabs",S=this.infoWinId+"tab_",Q=this.infoWinId+"subTab_",v=a.$("\x3cdiv class\x3d'omv2_tabDiv_info'\x3e\x3c/div\x3e"),ha=a.$("\x3cdiv class\x3d'omv2_tab_info' id\x3d'"+m+"'\x3e\x3c/div\x3e"),pa;if(0===K.length)m=a.$("\x3cdiv class\x3d'omv2_tab_select_info' name\x3d'#tab'\x3esample\x3c/div\x3e"),m.data("ts","sample"),ha[0].appendChild(m[0]);else for(m=0;m<K.length;m++)pa=a.$("\x3cdiv id\x3d'"+Q+m+"' class\x3d'"+(0===m?"omv2_tab_select_info":"omv2_tab_unselect_info")+"' style\x3d'left:"+
60*m+"px' name\x3d'#tab"+m+"'\x3e"+K[m].title+"\x3c/div\x3e"),pa.data("ts",K[m].title),a.browser.touchSupported||this.tipLengthAdjust(pa,60),ha[0].appendChild(pa[0]);this.createTip(ha.find("div"));var ra=a.$("\x3cdiv id\x3d'"+(this.infoWinId+"content")+"' class\x3d'omv2_defaultContent_info'\x3e\x3c/div\x3e");if(0===K.length)Q=a.$("\x3cdiv id\x3d'"+S+"' style\x3d'margin-top:5px;'\x3e \x3ch2\x3etab sample\x3c/h2\x3e  \x3c/div\x3e"),ra[0].appendChild(Q[0]);else for(m=0;m<K.length;m++)Q=a.$("\x3cdiv id\x3d'"+
S+m+"' style\x3d'margin-top:5px;'\x3e "+K[m].content+"  \x3c/div\x3e"),ra[0].appendChild(Q[0]);this.createGeneralDiv();this.$infoWindow[0].appendChild(E[0]);this.$infoWindow[0].appendChild(p[0]);this.infoWindows.push(this.$infoWindow);this.$infoWindow.nid=this.infoWinId;this.$infoWindow.typeId=this.typeId;this.$infoWindow.winX=b.x;this.$infoWindow.winY=b.y;v[0].appendChild(ha[0]);this.$container[0].appendChild(v[0]);this.$container[0].appendChild(ra[0]);this.$infoWindow[0].appendChild(this.$container[0]);
for(m=0;m<K.length;m++)this.touchscroll("subtab"+m);this.touchscroll("content");v.css({width:this.$infoWindow.width()-38});v.css({left:"8px"});60*K.length<this.$infoWindow.width()?(p.css({visibility:"hidden"}),E.css({visibility:"hidden"})):p.css({visibility:"hidden"});ra.css({position:"absolute",top:v.height(),height:this.infoHeight-v.height(),width:this.$infoWindow.width()-12,overflow:"auto"});ra.css(this.contentStyle);0<ra.find("a").length&&ra.find("a").bind("touchstart",function(){c.location.href=
ra.find("a").attr("href")});b=this.checkInfoWindowOverLayer(this,this.$infoWindow,b);this.$infoWindow.css({left:b.x,top:b.y,visibility:"visible"});this.tabControl();a.$("#tabs").find("div").mouseover(function(){a.$(this).css({cursor:"pointer"})});ra.mouseover(function(){a.$(this).css({cursor:"default"})});if(a.notNull(A)&&a.notNull(A.activeIndex))for(a.$("#tabs div[name\x3d#tab"+(A.activeIndex-1)+"]").click(),m=0;m<A.activeIndex-1;m++);},showInfoWindow:function(a,b,c){var m=this;m.init(c);b.wraparoundMapIndex&&
(b=m.parentMap.getACL(b,b.wraparoundMapIndex));m.screenLoc=m.parentMap.getScreenLocation(b);for(b=0;b<m.infoWindows.length;b++)m.infoWinId&&m.infoWindows[b].nid==m.infoWinId?m.deleteInfoWindow(m.infoWindows[b]):m.typeId&&m.infoWindows[b].typeId==m.typeId&&m.deleteInfoWindow(m.infoWindows[b]);m.getPageDirection();m.infoWindows.push(m.$infoWindow);m.$infoWindow.nid=m.infoWinId;m.$infoWindow.typeId=m.typeId;m.$infoWindow.winX=m.screenLoc.x;m.$infoWindow.winY=m.screenLoc.y;m.createCloseButtonDiv();a=
m.initCss(a);var p=a[0],E=a[1];m.calculatePosition(p,E,m.screenLoc,c);var S=setInterval(function(){m.$closeButton&&p&&E&&(clearInterval(S),m.titleContentCloseAdjust(p,E,m.$closeButton))},10)},initCss:function(b){var K=this.infoWinId+"content",A=a.$("\x3cdiv id\x3d'"+(this.infoWinId+"title")+"' class\x3d'omv2_defaultTitle_info'\x3e"+this.title_string.replace(/[ ]/g,"\x26nbsp;")+"\x3c/div\x3e"),m=a.$("\x3cdiv id\x3d'"+K+"' class\x3d'omv2_defaultContent_info'\x3e"+b+"\x3c/div\x3e");this.$infoWindow.css({width:this.infoWidth,
height:this.infoHeight});this.$infoWindow.css(this.infoWindowStyle);this.$container.css({position:"absolute",width:this.infoWidth-5,height:this.infoHeight-3,"z-index":"2"});this.div.appendChild(this.$infoWindow[0]);A.css({left:"5px"});this.$container[0].appendChild(A[0]);this.$container[0].appendChild(m[0]);this.$infoWindow[0].appendChild(this.$container[0]);m.css({top:parseInt(A.height())+2,height:"",width:""});this.infoWidth&&(""!==this.title_string?m.css({width:this.$infoWindow.width()-10}):m.css({width:this.$infoWindow.width()-
20}));this.infoHeight&&(""!==this.title_string?m.css({height:this.$infoWindow.height()-A.height()-3}):m.css({height:this.$infoWindow.height()-3}));m.css(this.contentStyle);0<m.find("a").length&&m.find("a").bind("touchstart",function(){c.location.href=m.find("a").attr("href")});this.touchscroll("content");m.css({left:"5px","margin-right":"5px"});A.data("ts",A.html());this.titleStyle.width&&!a.browser.touchSupported&&this.tipLengthAdjust(A,parseInt(this.titleStyle.width)-20);1<this.$infoWindow.width()&&
A.width(this.$infoWindow.width()-20);A.css(this.titleStyle);this.touchscroll("title");m.mouseover(function(){a.$(this).css({cursor:"default"})});A.mouseover(function(){a.$(this).css({cursor:"default"})});""===this.title_string&&(A.width("0px"),A.height("0px"));return[A,m]},infoResize:function(b,c,A,m){var p=this.height-A.y,E=this.width-A.x;if(this.$infoWindow.height()>p-20&&this.$infoWindow.height()>A.y-20&&(parseInt(this.$infoWindow.css("top"))+this.$infoWindow.height()>this.height||0>parseInt(this.$infoWindow.css("top")))||
this.$infoWindow.width()>E-20&&this.$infoWindow.width()>A.x-20)this.infoDomResize(b,c,A),this.$infoWindow.height()>p-20&&this.$infoWindow.height()>A.y-20&&(parseInt(this.$infoWindow.css("top"))+this.$infoWindow.height()>this.height||0>parseInt(this.$infoWindow.css("top")))&&(p>=A.y?0>parseInt(this.$infoWindow.css("top"))?(c.height(p-60),a.browser.firefox&&""!==this.title_string?c.width(c.width()+45):c.width(c.width()+25),""!==this.title_string?this.$infoWindow.width(c.width()+11):this.$infoWindow.width(c.width()+
20),this.$infoWindow.height(p+5-60)):(c.height(p),a.browser.firefox&&""!==this.title_string?c.width(c.width()+45):c.width(c.width()+25),""!==this.title_string?this.$infoWindow.width(c.width()+11):this.$infoWindow.width(c.width()+20),this.$infoWindow.height(p+5)):50>p?(c.height(A.y-60),a.browser.firefox&&""!==this.title_string?c.width(c.width()+45):c.width(c.width()+25),""!==this.title_string?this.$infoWindow.width(c.width()+11):this.$infoWindow.width(c.width()+20),this.$infoWindow.height(A.y+5-60)):
(c.height(A.y),a.browser.firefox&&""!==this.title_string?c.width(c.width()+45):c.width(c.width()+25),""!==this.title_string?this.$infoWindow.width(c.width()+11):this.$infoWindow.width(c.width()+20),this.$infoWindow.height(A.y+5))),this.$infoWindow.width()>E-20&&this.$infoWindow.width()>A.x-20&&(E>=A.x?(c.width(E-40),this.$infoWindow.width(E-40+20)):(c.width(A.x-40),this.$infoWindow.width(A.x-40+20))),5<=b.height()+c.height()-this.$infoWindow.height()&&this.$infoWindow.height(b.height()+c.height()+
5),m&&a.notNull(m.title)&&(b.width()>this.$infoWindow.width()-20&&b.width(this.$infoWindow.width()-20),a.browser.touchSupported||this.tipLengthAdjust(b,parseInt(this.$infoWindow.width())-19)),30>this.$infoWindow.height()&&this.checkMinHeightInfowindow(b,c),this.adjustInfowindowLayout(this,A);this.clrIntervalFlag=!0},infoDomResize:function(a,b,c){b.width()>this.$infoWindow.width()&&(this.$infoWindow.width(b.width()+20),this.$infoWindow[0].removeChild(this.$hideDiv[0]),this.$infoWindow[0].removeChild(this.$fadeDiv[0]),
this.$infoWindow[0].removeChild(this.$vancantDiv[0]),this.createGeneralDiv(),this.adjustInfowindowLayout(this,c),this.clrIntervalFlag=!0);b.height()>this.$infoWindow.height()-a.height()&&(0===a.height()?(b.css({width:this.$infoWindow.width()-19}),b.height(b.height()),this.$infoWindow.height(b.height()+parseInt(a.css("top"))+2)):(b.css({width:this.$infoWindow.width()-11}),this.$infoWindow.height(b.height()+a.height()+parseInt(a.css("top"))+2)),30>this.$infoWindow.height()&&this.checkMinHeightInfowindow(a,
b),this.$infoWindow[0].removeChild(this.$hideDiv[0]),this.$infoWindow[0].removeChild(this.$fadeDiv[0]),this.$infoWindow[0].removeChild(this.$vancantDiv[0]),this.createGeneralDiv(),this.adjustInfowindowLayout(this,c),this.clrIntervalFlag=!0)},setInfoSize:function(b,c){this.infoWidth?(b.width()>this.$infoWindow.width()-20&&b.width(this.$infoWindow.width()-20),""!==this.title_string?c.width()>this.$infoWindow.width()-10&&c.width(this.$infoWindow.width()-10):c.width()>this.$infoWindow.width()-20&&c.width(this.$infoWindow.width()-
20),!a.browser.touchSupported&&(a.isNull(this.titleStyle.width)||this.titleStyle.width>=this.infoWidth||""===this.titleStyle.width)&&this.tipLengthAdjust(b,parseInt(this.$infoWindow.width())-20)):(b.width()+6>c.width()?(b.width(b.width()+6),b.width()>1.5*c.width()&&this.ellipsis&&b.width(1.5*c.width()),this.$infoWindow.width(b.width()+20),this.contentStyle.width||c.width(b.width())):(""!==this.title_string?this.$infoWindow.width(c.width()+11):this.$infoWindow.width(c.width()+20),this.titleStyle.width||
""===this.title_string||b.width(c.width()-10)),120>this.$infoWindow.width()&&this.checkMinWidthInfowindow(b,c),a.browser.touchSupported||this.tipLengthAdjust(b,parseInt(this.$infoWindow.width())-18),this.infoWidth=this.$infoWindow.width());this.infoHeight?(b.height()>this.$infoWindow.height()-2&&b.height(this.$infoWindow.height()),c.height()>this.infoHeight-parseInt(b.height())&&c.height(this.infoHeight-parseInt(b.height())-3),c.css({top:parseInt(b.height())+2})):(this.$infoWindow.height(c.height()+
b.height()+parseInt(b.css("top"))+2),30>this.$infoWindow.height()&&this.checkMinHeightInfowindow(b,c),c.css({top:parseInt(b.height())+2}),this.infoHeight=this.$infoWindow.height())},checkMinWidthInfowindow:function(a,b){this.$infoWindow.width("120px");""!==this.title_string?(a.width("100px"),b.width("110px")):b.width("100px")},checkMinHeightInfowindow:function(a,b){this.$infoWindow.height("30px");b.height(30-parseInt(a.height())-3)},calculatePosition:function(b,c,A,m){var p=this;p.setInfoSize(b,c);
p.createGeneralDiv();p.t_h=b.height();(a.browser.chrome||a.browser.touchSupported)&&0===c.find("img").length&&6>p.$infoWindow.width()-c.width()&&c.width(c.width()-1);var E=0;if(!p.infoHeight||!p.infoWidth)if(a.isNull(p.contentStyle.width)||a.isNull(p.contentStyle.height))var S=setInterval(function(){121>=p.$infoWindow.width()?p.checkMinWidthInfowindow(b,c):p.infoWidth||c.width("");30>=p.$infoWindow.height()?p.checkMinHeightInfowindow(b,c):p.infoHeight||c.height("");(a.browser.chrome||a.browser.touchSupported)&&
0===c.find("img").length&&6>p.$infoWindow.width()-c.width()&&c.width(c.width()-1);E++;20<E&&clearInterval(S);p.infoDomResize(b,c,A);p.infoResize(b,c,A,m);p.clrIntervalFlag&&(clearInterval(S),""!==p.title_string&&(b.width(p.$infoWindow.width()-20),b.html(b.data("ts")),a.browser.touchSupported||p.tipLengthAdjust(b,parseInt(p.$infoWindow.width())-19)));""!==p.title_string&&b.width()>c.width()&&c.width(b.width());p.$infoWindow.css({visibility:"visible"})},100);var Q=0,v=setInterval(function(){Q++;p.infoResize(b,
c,A,m);if(20<Q||p.clrIntervalFlag)clearInterval(v),0!==c.find("img").length&&c.height(p.$infoWindow.height()-b.height()-3)},100);a.browser.chrome&&c.find("img").length&&c.find("img").load(function(){c.width(a.$("#content").children().first().width()+25);p.infoDomResize(b,c,A)});p.adjustInfowindowLayout(p,A);p.infoHeight&&p.infoWidth||(a.isNull(p.contentStyle.width)||a.isNull(p.contentStyle.height))&&p.$infoWindow.css({visibility:"hidden"});p.createTip(b)},adjustInfowindowLayout:function(a,b){var c=
a.checkInfoWindowOverLayer(a,a.$infoWindow,b);a.$infoWindow.css({left:c.x,top:c.y,visibility:"visible"})},titleContentCloseAdjust:function(a,b,c){var m;m=a.width()>b.width()?a.width():b.width();b.width()==this.$infoWindow.width()-10&&(m=a.width());var p=parseInt(c.width()),E=parseInt(c.height()),S,Q;this.closeButtonStyle?(S=parseInt(this.closeButtonStyle.xOffset),Q=parseInt(this.closeButtonStyle.yOffset)):Q=S=0;S||(S=0);Q||(Q=0);this.$infoWindow.width()-m<c.width()+parseInt(c.css("right"))&&c.css({right:this.$infoWindow.width()-
m-6-c.width()});0>this.$infoWindow.width()-m-6-c.width()&&c.css({right:"0"});this.$infoWindow.width()-m<=c.width()?c.width(this.$infoWindow.width()-m-6):21>this.$infoWindow.width()-m&&(c.css({right:"0"}),c.width("14px"));c.height()+parseInt(c.css("top"))>this.$infoWindow.height()&&c.css({top:this.$infoWindow.height()-c.height()});c.height()>this.$infoWindow.height()-parseInt(c.css("top"))&&c.height(this.$infoWindow.height()-parseInt(c.css("top")));c.height()>this.$infoWindow.height()&&(c.css({top:"0"}),
c.height(this.$infoWindow.height()));p+S<this.$infoWindow.width()-m&&(c.css({right:S+"px"}),c.width(p));p+S>=this.$infoWindow.width()-m&&p<this.$infoWindow.width()-m&&(c.css({right:this.$infoWindow.width()-m-p-6+"px"}),c.width(p));E+Q<this.$infoWindow.height()&&(c.css({top:Q+"px"}),c.height(E));E+Q>=this.$infoWindow.height()&&E<this.$infoWindow.height()&&(c.css({top:this.$infoWindow.height()-E-6+"px"}),c.height(E));11>=this.$infoWindow.width()-b.width()&&(p+S<this.$infoWindow.width()-a.width()-5?
(c.css({right:S+"px"}),c.width(p)):p+S>=this.$infoWindow.width()-a.width()-5&&p<this.$infoWindow.width()-a.width()-5?(c.css({right:this.$infoWindow.width()-a.width()-5-p+"px"}),c.width(p)):(c.css({right:"0px"}),c.width("14px")),E+Q<a.height()?(c.css({top:Q+"px"}),c.height(E)):E+Q>=a.height()&&E<a.height()?(c.css({top:a.height()-E+"px"}),c.height(E)):(c.css({top:"0px"}),c.height("14px")));this.infoHeight||this.infoWidth||this.contentStyle.width||this.contentStyle.height||this.titleStyle.width||this.titleStyle.height||
(c.css({right:"0px"}),c.width("14px"),c.css({top:"0px"}),c.height("14px"))},tipLengthAdjust:function(b,c){var A;if("omv2_defaultTitle_info"!=b.attr("class")){if(A=a.$("\x3cdiv class\x3d'omv2_temp_info' \x3e"+b.html()+"\x3c/div\x3e"),this.$infoWindow[0].appendChild(A[0]),A.width()>c)for(var m=A.html().length-1;-1<m;m--){var p=A.html();if(A.width()<c){b.html(A.html().substring(0,A.html().length-3)+"...");break}A.html(p.substring(0,m))}}else if(A=a.$("\x3cdiv class\x3d'omv2_temp_info' \x3e"+b.text()+
"\x3c/div\x3e"),A.css({"font-size":"16px","font-family":"Tahoma","font-weight":"bold"}),this.titleStyle["font-size"]&&A.css({"font-size":this.titleStyle["font-size"]}),this.titleStyle["font-family"]&&A.css({"font-family":this.titleStyle["font-family"]}),this.titleStyle["font-weight"]&&A.css({"font-weight":this.titleStyle["font-weight"]}),this.$infoWindow[0].appendChild(A[0]),A.width()>c)for(A.html("..."),m=0;m<b.text().length;m++){if(A.width()>c){b.html(A.text());break}A.html(b.text().substring(0,
m)+"...")}},createCloseButtonDiv:function(){var b=this;b.$closeButton=this.closeButtonStyle&&this.closeButtonStyle.mouseOutButton&&this.closeButtonStyle.mouseOutButton.src?a.$("\x3cimg class\x3d'omv2_closeButton_info' src\x3d'"+this.closeButtonStyle.mouseOutButton.src+"'\x3e\x3c/img\x3e"):a.$("\x3cimg class\x3d'omv2_closeButton_info' src\x3d'"+a.gv.resourcePath()+"close_en.png'\x3e\x3c/img\x3e");b.$closeButton.css({right:"0"});this.closeButtonStyle&&this.closeButtonStyle.xOffset&&(b.$closeButton.css({right:this.closeButtonStyle.xOffset}),
this.closeButtonStyle&&this.closeButtonStyle.yOffset&&b.$closeButton.css({top:this.closeButtonStyle.yOffset}));a.browser.touchSupported&&b.$closeButton.bind("touchstart",function(){b.deleteInfoWindow(b.infoWindows[0]);return!1});b.$closeButton.click(function(){b.deleteInfoWindow(b.infoWindows[0]);return!1}).mouseover(function(){b.closeButtonStyle&&b.closeButtonStyle.mouseOverButton&&b.closeButtonStyle.mouseOverButton.src?a.$(this)[0].src=b.closeButtonStyle.mouseOverButton.src:a.$(this)[0].src=a.gv.resourcePath()+
"close_ov.png"}).mouseout(function(){b.closeButtonStyle&&b.closeButtonStyle.mouseOutButton&&b.closeButtonStyle.mouseOutButton.src?a.$(this)[0].src=b.closeButtonStyle.mouseOutButton.src:a.$(this)[0].src=a.gv.resourcePath()+"close_en.png"});this.closeButtonStyle&&this.closeButtonStyle.width&&b.$closeButton.width(this.closeButtonStyle.width);this.closeButtonStyle&&this.closeButtonStyle.height&&b.$closeButton.height(this.closeButtonStyle.height);this.$infoWindow[0].appendChild(b.$closeButton[0])},createGeneralDiv:function(){var b=
a.$("\x3cdiv class\x3d'omv2_tail_info'\x3e\x3c/div\x3e"),c=a.$("\x3cdiv\x3e\x3c/div\x3e"),A=a.$("\x3cdiv style\x3d'position:absolute;overflow:hidden;border:0px solid black;'\x3e\x3c/div\x3e"),m=a.$("\x3cdiv style\x3d'z-index:3001;position:absolute;background:"+this.background+"'\x3e\x3c/div\x3e");c.css({position:"absolute",background:this.background,"z-index":"1","border-radius":"5px 5px 5px 5px"});this.infoWindowStyle&&this.infoWindowStyle.border?c.css({width:parseInt(this.infoWindowStyle.border.split(" ")[0])+
1+"px"}):c.css({width:"1px"});b.width("25px");b.height("25px");60>this.$infoWindow.height()&&(b.width("15px"),b.height("15px"));this.tailStyle&&(b.css(this.tailStyle),""!==this.tailStyle.offset&&(b.width(this.tailStyle.offset),b.height(this.tailStyle.offset)));1.414*b.width()>this.$infoWindow.width()&&(b.width(this.$infoWindow.width()),b.height(b.width()));1.414*b.height()>this.$infoWindow.height()&&(b.height(.707*(this.$infoWindow.height()-25)),b.width(b.height()));if(130<b.width()||130<b.height())b.width("130px"),
b.height("130px");A.width(.707*parseInt(b.width())+3);A.height(1.414*parseInt(b.height())+3);A[0].appendChild(b[0]);this.$infoWindow[0].appendChild(m[0]);this.$infoWindow[0].appendChild(A[0]);this.$infoWindow[0].appendChild(c[0]);this.$tail=b;this.$hideDiv=A;this.$fadeDiv=c;this.$vancantDiv=m},createTip:function(b){var c=a.$("\x3cspan class\x3d'omv2_tip_info'\x3e\x3c/span\x3e");this.$infoWindow[0].appendChild(c[0]);var A,m,p;b.mouseover(function(){var E=this;A=!1;var S;S="omv2_tab_info"==b.parent().attr("class")?
a.$(E).position().left+parseInt(b.parent().css("left"))+30:a.$(E).position().left+30;m=setTimeout(function(){A=!0},1E3);p=setInterval(function(){A&&(a.$(E).data("ts"),c.html(a.$(E).data("ts").replace(/[ ]/g,"\x26nbsp;")),c.css({display:"block",left:S}))},100);"current"!=a.$(this)[0].id&&"omv2_tab_info"==b.parent().attr("class")&&a.$(this).css({background:"#2F4F4F",color:"#9cd9fe"})}).mouseout(function(){A=!1;clearTimeout(m);clearInterval(p);c.css({display:"none"});"current"!=a.$(this)[0].id&&"omv2_tab_info"==
b.parent().attr("class")&&a.$(this).css({background:"#2F4F4F",color:"#e9f6fe"})})},panEventAction:function(b){var c=b.target.infoLayer;if(!a.isNull(c)&&c.$div){var A=parseInt(c.$infoWindow[0].style.left),m=parseInt(c.$infoWindow[0].style.top),m=isNaN(m)?0:m,A=isNaN(A)?0:A;c.$infoWindow.css({left:A+b.xOffset,top:m+b.yOffset});c.screenLoc.x+=b.xOffset;c.screenLoc.y+=b.yOffset}},refreshEventAction:function(a){a.target.infoLayer.deleteInfoWindow()},zoomEventAction:function(a){a.target.infoLayer.closeInfoWindows()},
destroyEventAction:function(b){b=b.target.infoLayer;a.isNotNull(b)&&b.destroy()},resizeEventAction:function(a){a=a.target.infoLayer;a.closeInfoWindows();var b=a.parentMap.getMapContext();a.width=b.getDeviceWidth();a.height=b.getDeviceHeight()},deleteInfoWindow:function(a){for(var b=0,b=0;b<this.infoWindows.length;b++)this.infoWindows[b]==a&&this.infoWindows.splice(b,1);this.$div.off("mouseover mouseout mousedown mouseup click touchend","**");this.$div.empty();this.mouseOnInfoWindow=!1},closeInfoWindows:function(){var b=
this.parentMap,c=a.event.MapEvent;b.deleteListener(c.I_MAP_DRAGGING,this.panEventAction);b.deleteListener(c.MAP_BEFORE_REFRESH,this.refreshEventAction);b.deleteListener(c.I_MAP_CENTER_ZOOM,this.zoomEventAction);b.deleteListener(c.MAP_RESIZED,this.resizeEventAction);b.deleteListener(c.MAP_DESTROY,this.destroyEventAction);b.deleteListener(c.MAP_CLEAN,this.refreshEventAction);b=0;for(c=this.infoWindows.length;b<c;b++)this.deleteInfoWindow(this.infoWindows[b])},checkInfoWindowOverLayer:function(a,b,c){this.tailStyle&&
this.tailStyle.border||(this.tailStyle.border="1px solid #c3d0df");var m=b.width(),p=b.height(),E=a.height,S=c.x,Q=c.y,v=!0,ha=!0;S>a.width/2&&(v=!1);Q<E/2&&(ha=!1);ha?(80>=p?this.$hideDiv.css({bottom:p/10+"px"}):this.$hideDiv.css({bottom:"25px"}),Q=Q+parseInt(this.$hideDiv.css("bottom"))-p+this.$hideDiv.height()/2-1):(80>=p?this.$hideDiv.css({top:p/7.5+"px"}):this.$hideDiv.css({top:"25px"}),Q=Q-parseInt(this.$hideDiv.css("top"))-this.$hideDiv.height()/2-1);v?(this.$tail.css({right:.707*-this.$hideDiv.width(),
top:.2*this.$tail.width()}),this.$hideDiv.css({left:-this.$hideDiv.width()+1}),this.$vancantDiv.height(p-10),this.$vancantDiv.css({left:"0px",width:"3px",top:"5px"}),S=S+.707*this.$tail.width()-2,b.css({"box-shadow":"5px 5px 5px rgba(0,0,0,0.5)"})):(this.$tail.css({left:.707*-this.$hideDiv.width(),top:.2*this.$tail.width()}),this.$hideDiv.css({right:-this.$hideDiv.width()+1}),this.$vancantDiv.height(p-10),this.$vancantDiv.css({right:"0px",width:"3px",top:"5px"}),S=S-m-.707*this.$tail.width(),b.css({"box-shadow":"-5px 5px 5px rgba(0,0,0,0.5)"}));
this.$tail.css({"box-shadow":"3px 3px 3px rgba(0,0,0,0.5)"});if(E>c.y+p+20||0<c.y-p-20)0>E-Q-p&&v?(this.$hideDiv.width(1.414*parseInt(this.$tail.height())+3),this.$hideDiv.height(.707*parseInt(this.$tail.width())+3),this.$tail.css({top:.707*-this.$hideDiv.height(),left:.2*this.$tail.width()}),this.$hideDiv.css({bottom:-this.$hideDiv.height()+1}),this.$vancantDiv.width(m-10),this.$vancantDiv.css({bottom:"0px",height:"3px",left:"5px",top:""}),Q=80>=p?Q-this.$hideDiv.height()-p/10-this.$hideDiv.width()/
2+1:Q-this.$hideDiv.height()-25-this.$hideDiv.width()/2+1,this.$hideDiv.css({left:"20px"}),S=S-20-this.$hideDiv.width()/2-this.$hideDiv.width()/2+2,b.css({"box-shadow":"5px -5px 5px rgba(0,0,0,0.5)"}),this.$tail.css({"box-shadow":"3px -3px 3px rgba(0,0,0,0.5)"})):0>E-Q-p&&!v?(this.$hideDiv.width(1.414*parseInt(this.$tail.height())+3),this.$hideDiv.height(.707*parseInt(this.$tail.width())+3),this.$tail.css({top:.707*-this.$hideDiv.height(),left:.2*this.$tail.width()}),this.$hideDiv.css({bottom:-this.$hideDiv.height()+
1}),this.$vancantDiv.width(m-10),this.$vancantDiv.css({bottom:"0px",height:"3px",right:"5px",top:""}),Q=80>=p?Q-this.$hideDiv.height()-p/10-this.$hideDiv.width()/2+1:Q-this.$hideDiv.height()-25-this.$hideDiv.width()/2+1,this.$hideDiv.css({right:"20px"}),S=S+this.$hideDiv.width()/2+this.$hideDiv.width()/2+20,b.css({"box-shadow":"-5px -5px 5px rgba(0,0,0,0.5)"}),this.$tail.css({"box-shadow":"-3px 3px 3px rgba(0,0,0,0.5)"})):0>Q&&v?(this.$hideDiv.width(1.414*parseInt(this.$tail.height())+3),this.$hideDiv.height(.707*
parseInt(this.$tail.width())+3),this.$tail.css({top:.28*this.$tail.width(),left:.2*this.$tail.width()}),this.$hideDiv.css({top:-this.$hideDiv.height()+1}),this.$vancantDiv.width(m-10),this.$vancantDiv.css({top:"0px",height:"3px",left:"5px",bottom:""}),Q=80>=p?Q+p/7.5+this.$hideDiv.height()+this.$hideDiv.width()/2+1-5:Q+25+this.$hideDiv.height()+this.$hideDiv.width()/2+1-5,this.$hideDiv.css({left:"20px"}),S=S-20-this.$hideDiv.width()/2-this.$hideDiv.width()/2+2,b.css({"box-shadow":"5px 5px 5px rgba(0,0,0,0.5)"}),
this.$tail.css({"box-shadow":"3px -3px 3px rgba(0,0,0,0.5)"})):0>Q&&!v&&(this.$hideDiv.width(1.414*parseInt(this.$tail.height())+3),this.$hideDiv.height(.707*parseInt(this.$tail.width())+3),this.$tail.css({top:.28*this.$tail.width(),left:.2*this.$tail.width()}),this.$hideDiv.css({top:-this.$hideDiv.height()+1}),this.$vancantDiv.width(m-10),this.$vancantDiv.css({top:"0px",height:"3px",right:"5px",bottom:""}),Q=80>=p?Q+p/7.5+this.$hideDiv.height()+this.$hideDiv.width()/2+1-6:Q+25+this.$hideDiv.height()+
this.$hideDiv.width()/2+1-6,this.$hideDiv.css({right:"20px"}),S=S+this.$hideDiv.width()/2+this.$hideDiv.width()/2+20,b.css({"box-shadow":"-5px 5px 5px rgba(0,0,0,0.5)"}),this.$tail.css({"box-shadow":"-3px 3px 3px rgba(0,0,0,0.5)"}));return{x:S,y:Q}},destroy:function(){a.isNull(this.$div)||(this.deleteInfoWindow(),this.$div.unbind("mousewheel mousedown mouseup mouseover mouseout click keyup keydown keypress",this.infoStopPropagation),this.$div.unbind("mousemove",this.infoMouseMove),this.$div.unbind("mouseover",
this.infoMouseOver),this.$div.unbind("mouseout",this.infoMouseOut),this.infoMouseOut=this.infoMouseOver=this.infoMouseMove=this.infoStopPropagation=null,a.$(this.infoTip).empty(),this.wininfo=this.infoWindows=this.$div=this.div=this.infoTip=null)},getPageDirection:function(){var a=document.createElement("table"),b=document.createElement("tr"),c=document.createElement("td"),m=document.createElement("td"),p=document.createElement("tbody");a.cellSpacing=0;a.cellPadding=0;c.innerHTML="fsdfsds";m.innerHTML=
"p";p.appendChild(b);a.appendChild(p);b.appendChild(c);b.appendChild(m);this.div.appendChild(a);this.pageDirection=0===c.offsetLeft?!0:!1;this.div.removeChild(a)},touchscroll:function(b){var c,A;a.browser.touchSupported&&a.notNull(document.getElementById(b))&&(document.getElementById(b).addEventListener("touchstart",function(a){c=a.targetTouches[0].pageX;A=a.targetTouches[0].pageY},!1),document.getElementById(b).addEventListener("touchmove",function(a){a.preventDefault();var b=A-a.targetTouches[0].pageY;
this.scrollLeft+=c-a.targetTouches[0].pageX;this.scrollTop+=b},!1))},tabControl:function(){(function(){a.$("#content \x3e div").hide();a.$("#tabs div:first").attr("id","current");a.$("#content \x3e div:first").fadeIn();a.$("#tabs div").bind("click touchstart",function(b){b.preventDefault();"current"!=a.$(this).attr("id")&&(a.$("#content \x3e div").hide(),a.$("#tabs div").attr("id",""),a.$("#tabs div").removeClass("omv2_tab_select_info"),a.$("#tabs div").addClass("omv2_tab_unselect_info"),a.$("#tabs div").css({color:a.$("#tabs div:first").css("color")}),
a.$(this).attr("id","current"),a.$(a.$(this).attr("name")).fadeIn(),a.$(this).removeClass("omv2_tab_unselect_info"),a.$(this).addClass("omv2_tab_select_info"))})})()},toJsonCss:function(a){var b={};a=a.split(";");for(var c=0;c<a.length;c++){var m=a[c].split(":");b[m[0]]=m[1]}return b},deleteInfoWindows:function(){this.infoWindows&&0<this.infoWindows.length&&this.infoWindows.pop();this.$div.off("mouseover mouseout mousedown mouseup click touchend","**");this.$div.empty();this.mouseOnInfoWindow=!1},
deleteInfoWindowById:function(a){a="infowin_"+a;for(var b=this.infoWindows.length,c=0;c<b;c++)if(this.infoWinId&&this.infoWindows[c].nid==a){this.deleteInfoWindow(this.infoWindows[c]);break}}});a.infowindow.MVInfoWindowTab=function(a,b){this.title=a;this.content=b};a.infowindow.MVInfoWindowTab.prototype.getTitle=function(){return this.title};a.infowindow.MVInfoWindowTab.prototype.getContent=function(){return this.content};a.tool.Tool=a.Class.extend({mixin:a.event.EventSource,initialize:function(b){this._$container=
b.$oracleMapDiv;this._geometry=null;this._graphic=b.graphics;this._map=b;this._group=this._toolShape=null;this._style=new a.style.Line({stroke:"#000000",strokeThickness:1});this._style.fill=b.graphics.oui.NO_PAINT;this.toolFeature=null;this.featureStyle=this._style;this.status=a.tool.Tool.STOPPED},start:function(){a.util.Logger.info("MAPVIEWER_9036","OM.tool.Tool.start","")},clear:function(){a.util.Logger.info("MAPVIEWER_9037","OM.tool.Tool.clear","")},clear_base:function(){this._group&&(this._graphic.remove(this._group),
this._group=null);this._toolShape=null;this.status=a.tool.Tool.STOPPED;if(this.toolFeature){this.toolFeature.deleteEditingProperties&&this.toolFeature.deleteEditingProperties();var b=this._map.getToolFeatureLayer();a.isNotNull(b)&&b.removeFeature(this.toolFeature);this.toolFeature=null;b=a.event.ToolEvent;b=new b(b.TOOL_CLEAR,this);this.fire(b.type,b)}},getStatus:function(){return this.status},getGeometry:function(){return this._geometry},setDrawingStyle:function(b){if(!b)return this;this._style=
b.clone();a.isNull(b.fill)&&(this._style.fill=this._map.graphics.oui.NO_PAINT);return this},setStyle:function(a){this.featureStyle=a.clone();this.toolFeature&&this.toolFeature.setRenderingStyle(this.featureStyle);return this}});a.tool.Tool.STOPPED=0;a.tool.Tool.STARTED=1;a.tool.Tool.FINISHED=3;a.tool.CircleTool=a.tool.Tool.extend({initialize:function K(b){K.base.call(this,b);this._radius=0;this._toPntOfCircle=this._geoCenter=null;var c=this,p=a.event.ToolEvent,E=null;this.begin=function(b){if(c.status==
a.tool.Tool.STARTED){c._geoCenter=c._map.getCursorLocation();var Q=b.pageX-c._$container.offset().left;b=b.pageY-c._$container.offset().top;var v=c._graphic.getLeftTop(c._map.draggableGroup),v={cx:Q-v.x,cy:b-v.y,width:1,height:1};E={x:Q,y:b};c._style.fill=c._graphic.oui.NO_PAINT;c._toolShape?c._graphic.setEllipse(c._toolShape,v):c._toolShape=c._graphic.drawEllipse(v,c._style,{group:c._group});a.$(document).bind("mousemove",c.drawShape);a.browser.touchSupported&&c._$container.bind("touchmove",c.drawShape_touch);
b=new p(p.TOOL_START,c);c.fire(b.type,b)}};this.begin_touch=function(b){var p=a.util.DomUtil;1<p.getTouchCount(b)||(p=p.getTouchesPosition(b),b.pageX=p.x,b.pageY=p.y,c.begin(b))};this.drawShape=function(b){if(c.status==a.tool.Tool.STARTED){var Q=b.pageX-c._$container.offset().left;b=b.pageY-c._$container.offset().top;(0>=Q||0>b||Q>c._map.getMapContext().getDeviceWidth()||b>c._map.getMapContext().getDeviceHeight())&&c.finish();var v=Math.round(Math.sqrt((Q-E.x)*(Q-E.x)+(b-E.y)*(b-E.y))),A=c._map.getMapContext().getUniverse().getZoomLevels()[c._map.getMapContext().getZoomLevel()].resolution;
c._radius=v*A;c._toPntOfCircle=c._map.getScreenPointLocation(Q,b);c._graphic.setEllipse(c._toolShape,{width:2*v,height:2*v});Q=new p(p.CIRCLE_DRAG,c);c.fire(Q.type,Q)}};this.drawShape_touch=function(b){var p=a.util.DomUtil;1<p.getTouchCount(b)||(p=p.getTouchesPosition(b),b.pageX=p.x,b.pageY=p.y,c.drawShape(b))};this.finish=function(b){c._map.enableMapDrag(!0);c._map.enableMapAction.mouse=!0;E=null;c._$container.unbind("mousedown",c.begin);c.drawShape&&a.$(document).unbind("mousemove",c.drawShape);
c._$container.unbind("mouseup",c.finish);a.browser.touchSupported&&(c._$container.unbind("touchstart",c.begin_touch),c._$container.unbind("touchmove",c.drawShape_touch),c._$container.unbind("touchend",c.finish));c._graphic.remove(c._toolShape);c.status=a.tool.Tool.FINISHED;c._geoCenter&&(c._geometry=new a.geometry.Circle(c._geoCenter.getX(),c._geoCenter.getY(),c._radius,c._geoCenter.srid),c.toolFeature=new a.Feature("circleTool"+(new Date).getTime(),c._geometry,{renderingStyle:c.featureStyle}),c._map.getToolFeatureLayer().addFeature(c.toolFeature),
c._geoCenter=null,b=new p(p.TOOL_END,c),c.fire(b.type,b))}},start:function(){var b=a.event.ToolEvent;this._radius=0;this._geoCenter=null;this.clear();this._map.enableMapDrag(!1);this._map.enableMapAction.mouse=!1;this._group||(this._group=this._graphic.createGroup(),this._graphic.addGroup(this._group,this._map.draggableGroup));this._$container.bind("mousedown",this.begin);this._$container.bind("mouseup",this.finish);a.browser.touchSupported&&(this._$container.bind("touchstart",this.begin_touch),this._$container.bind("touchend",
this.finish));this.status=a.tool.Tool.STARTED;b=new b(b.TOOL_START,this);this.fire(b.type,b);return this},clear:function(){this.finish();this.clear_base()},getCenter:function(){return this._geoCenter},getRadius:function(b,c){if(!b)return null;var m=[];this._geoCenter?(m.push(this._geoCenter.getX()),m.push(this._geoCenter.getY())):this._geometry&&(m.push(this._geometry.centerX),m.push(this._geometry.centerY));m.push(this._toPntOfCircle.getX());m.push(this._toPntOfCircle.getY());var p=null;this._geoCenter?
p=new a.geometry.LineString(m,this._geoCenter.srid):this._geometry&&(p=new a.geometry.LineString(m,this._geometry.srid));return p?a.util.GeomUtil.getLength(p,c,{unit:b,transformToGeodetic:!0}):null},getDrawingRadius:function(){return this._radius}});a.tool.RectangleTool=a.tool.Tool.extend({initialize:function A(b){A.base.call(this,b);this.allowZeroSize=!1;var c=this,E=a.event.ToolEvent,S,Q,v=null;this.dragGeoPoint=this.startGeoPoint=null;this.begin=function(b){if(c.status===a.tool.Tool.STARTED){c.startGeoPoint=
c._map.getCursorLocation();c.dragGeoPoint=c._map.getCursorLocation();var m=b.pageX-c._$container.offset().left;b=b.pageY-c._$container.offset().top;S=m;Q=b;var E=c._graphic.getLeftTop(c._map.draggableGroup),m={x:m-E.x,y:b-E.y,width:1,height:1};a.isNull(c._style.fill)&&(c._style.fill=c._graphic.oui.NO_PAINT);c._toolShape?c._graphic.setRectangle(c._toolShape,m):c._toolShape=c._graphic.drawRectangle(m,c._style,{group:c._group});a.$(document).bind("mousemove",c.drawShape);a.browser.touchSupported&&c._$container.bind("touchmove",
c.drawShape_touch)}};this.begin_touch=function(b){var m=a.util.DomUtil;1<m.getTouchCount(b)||(m=m.getTouchesPosition(b),b.pageX=m.x,b.pageY=m.y,c.begin(b))};this.drawShape=function(b){if(c.status===a.tool.Tool.STARTED){var m=S,v=Q,A=b.pageX-c._$container.offset().left;b=b.pageY-c._$container.offset().top;(0>=A||0>b||A>c._map.getMapContext().getDeviceWidth()||b>c._map.getMapContext().getDeviceHeight())&&c.finish();c.dragGeoPoint=c._map.getCursorLocation();var va=c._graphic.getLeftTop(c._map.draggableGroup),
m={width:Math.abs(A-m),height:Math.abs(b-v),x:m<A?m-va.x:A-va.x,y:v<b?v-va.y:b-va.y};c._graphic.setRectangle(c._toolShape,m);b=new E(E.RECTANGLE_DRAG,c);c.fire(b.type,b)}};this.drawShape_touch=function(b){var m=a.util.DomUtil;1<m.getTouchCount(b)||(m=m.getTouchesPosition(b),b.pageX=m.x,b.pageY=m.y,c.drawShape(b))};this.finish=function(b){c._map.enableMapDrag(!0);c._map.enableMapAction.mouse=!0;a.gv.featureDrag=!0;a.gv.allowFeaturePointsInteraction=!0;c._$container.unbind("mousedown",c.begin);c.drawShape&&
a.$(document).unbind("mousemove",c.drawShape);c._$container.unbind("mouseup",c.finish);a.browser.touchSupported&&(c._$container.unbind("touchstart",c.begin_touch),c._$container.unbind("touchmove",c.drawShape_touch),c._$container.unbind("touchend",c.finish));c._graphic.remove(c._toolShape);c.status=a.tool.Tool.FINISHED;c.dragGeoPoint=null;if(c.startGeoPoint)if(v=c._map.getCursorLocation(),c.startGeoPoint.getX()!==v.getX()&&c.startGeoPoint.getY()!==v.getY()||c.allowZeroSize){b=[c.startGeoPoint.getX(),
c.startGeoPoint.getY(),v.getX(),v.getY()];var m=0;b[0]>b[2]&&(m=b[0],b[0]=b[2],b[2]=m);b[1]>b[3]&&(m=b[1],b[1]=b[3],b[3]=m);c._geometry=new a.geometry.Rectangle(b[0],b[1],b[2],b[3],v.srid);c.toolFeature=new a.Feature("rectangleTool"+(new Date).getTime(),c._geometry,{renderingStyle:c.featureStyle});c._map.getToolFeatureLayer().addFeature(c.toolFeature);c.startGeoPoint=null;b=new E(E.TOOL_END,c);c.fire(b.type,b)}else c._geometry=null,c.startGeoPoint=null,a.util.Logger.alert("MAPVIEWER_9045","OM.tool.RectangleTool.finish",
""),c.start()}},setZeroSizeAllowed:function(a){this.allowZeroSize=a},start:function(){var b=a.event.ToolEvent;this.clear();this._map.enableMapDrag(!1);this._map.enableMapAction.mouse=!1;this._group||(this._group=this._graphic.createGroup(),this._graphic.addGroup(this._group,this._map.draggableGroup));this._$container.bind("mousedown",this.begin);this._$container.bind("mouseup",this.finish);a.browser.touchSupported&&(this._$container.bind("touchstart",this.begin_touch),this._$container.bind("touchend",
this.finish));this.status=a.tool.Tool.STARTED;a.gv.featureDrag=!1;a.gv.allowFeaturePointsInteraction=!1;b=new b(b.TOOL_START,this);this.fire(b.type,b);return this},clear:function(){this.finish();this.clear_base()},getDraggingWidth:function(){return this.status!==a.tool.Tool.STARTED||a.isNull(this.startGeoPoint)||a.isNull(this.dragGeoPoint)?0:Math.abs(this.startGeoPoint.getX()-this.dragGeoPoint.getX())},getDraggingHeight:function(){return this.status!==a.tool.Tool.STARTED||a.isNull(this.startGeoPoint)||
a.isNull(this.dragGeoPoint)?0:Math.abs(this.startGeoPoint.getY()-this.dragGeoPoint.getY())}});a.tool.DistanceTool=a.tool.Tool.extend({initialize:function m(b,c){m.base.call(this,b);this._tool=new a.tool.RedlineTool(b,a.tool.RedlineTool.TYPE_LINESTRING,{continuousMode:!1});this.unit="kilometer";c&&c.unit&&(this.unit=c.unit);this.transformToGeodetic=!0;c&&!1===c.transformToGeodetic&&(this.transformToGeodetic=c.transformToGeodetic);c&&c.dataSource&&(this.dataSource=c.dataSource);this._map=b;this._distanceInfo=
null;this._lastSubTotalDis=this._subTotalDis=0;this.segmentsDisArray=[];var S=this,Q=a.event.ToolEvent;this.newPoint=function(){var b=S._tool;if(1<b._points.length){for(var c=[],m=null,p=0;p<b._points.length;p++)m=b._points[p].geo,c.push(m.getX()),c.push(m.getY());S.calTotalDistance(new a.geometry.LineString(c,S._map.getMapContext().getUniverse().srid))}};this.drawing=function(b){S._map.getMapContext().getUniverse();a.$("#sub_tr_1")&&a.$("#sub_tr_1").show();S._distanceInfo.setVisible(!0);var c=S._map.getAbsoluteCursorLocation();
a.isNotNull(b.loc)&&(c=b.loc);b=S._tool._points[S._tool._points.length-1].geo;c=a.util.GeomUtil.getLength(new a.geometry.LineString([c.getX(),c.getY(),b.getX(),b.getY()],S._map.getMapContext().getUniverse().srid),null,{unit:S.unit,transformToGeodetic:S.transformToGeodetic,dataSource:S.dataSource,toServerTranform:!1});c=Math.round(100*c)/100;a.$("#distance_total_1").text(Math.round(100*(S._subTotalDis+c))/100+S.getUnitLabel(S.unit));a.$("#distance_sub_1").text(c+S.getUnitLabel(S.unit))};this.finish=
function(){if(S.status==a.tool.Tool.STARTED){S.status=a.tool.Tool.FINISHED;S.calTotalDistance(S._tool.toolFeature.geo);S._tool.finish();var b=new Q(Q.TOOL_END,S);S.fire(b.type,b);S._tool.toolFeature.on(a.event.LayerEvent.FEATURE_EDITED,S.edit,S._tool.toolFeature)}};this.edit=function(){S.calSegmentsDistance(S._tool.toolFeature.geo)};this._tool.on(Q.REDLINE_POINT_CREATE,S.newPoint);this._tool.on(Q.REDLINE_DRAW,S.drawing);this._tool.on(Q.TOOL_END,S.finish);this._tool.on(Q.REDLINE_EDITED,S.edit)},start:function(){this.clear();
this._distanceInfo=new a.control.MapDecoration("\x3ctable style\x3d'width:100%;border:0'\x3e \x3ctr\x3e\x3ctd align\x3d'right'\x3e"+a.gv.getLabel("MAPVIEWER_SB_TOTAL_DISTANCE").replace(/[ ]/g,"\x26nbsp;")+":\x3c/td\x3e\x3ctd align\x3d'left'\x3e\x3cspan id\x3d'distance_total_1'\x3e0"+this.getUnitLabel(this.unit)+"\x3c/span\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr id\x3d'sub_tr_1'\x3e\x3ctd align\x3d'right'\x3e"+a.gv.getLabel("MAPVIEWER_SB_SUB_DISTANCE").replace(/[ ]/g,"\x26nbsp;")+":\x3c/td\x3e\x3ctd align\x3d'left'\x3e\x3cspan id\x3d'distance_sub_1'\x3e0"+
this.getUnitLabel(this.unit)+"\x3c/span\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e",{left:.5,top:.7},{draggable:!0,panelOptions:{style:{"border-style":"solid","border-color":"#0000ff","border-width":"1px",backgroundColor:"#FDFDFD",filter:"alpha(Opacity\x3d80)","-moz-opacity":"0.8",opacity:"0.8"}}});this._map.addMapDecoration(this._distanceInfo);this._distanceInfo.setVisible(!1);this._tool.start();this.status=a.tool.Tool.STARTED;var b=new a.event.ToolEvent(a.event.ToolEvent.TOOL_START,this);this.fire(b.type,
b);return this},clear:function(){this._distanceInfo&&(this._distanceInfo.setVisible(!1),this._map.removeMapDecoration(this._distanceInfo),this._distanceInfo=null);this._subTotalDis=0;this.segmentsDisArray=[];this._tool.clear()},getGeometry:function(){return this._tool.getGeometry()},getSegmentsArray:function(){return this.segmentsDisArray},getTotalDistance:function(){return Math.round(100*this._subTotalDis)/100},calTotalDistance:function(b){var c=this,E=function(E){0!==E&&(c._subTotalDis=E,c._distanceInfo.setVisible(!0),
a.$("#distance_total_1").text(Math.round(100*c._subTotalDis)/100+c.getUnitLabel(c.unit)),c.segmentsDisArray.length&&c.status!=a.tool.Tool.FINISHED&&c.segmentsDisArray.push(Math.round(100*(c._subTotalDis-c._lastSubTotalDis))/100),0===c.segmentsDisArray.length&&c.segmentsDisArray.push(Math.round(100*c._subTotalDis)/100),a.$("#sub_tr_1")&&a.$("#sub_tr_1").hide(),c._lastSubTotalDis=E,E=a.event.ToolEvent,E=new E(E.DISTANCE_UPDATE,c),E.point=b.getLastPoint(),c.fire(E.type,E))};c.transformToGeodetic?b.transform(8307,
function(b){4<=b.coordinates.length&&a.util.GeomUtil.getLength(b,E,{unit:c.unit,transformToGeodetic:c.transformToGeodetic,dataSource:c.dataSource})}):4<=b.coordinates.length&&a.util.GeomUtil.getLength(b,E,{unit:c.unit,transformToGeodetic:c.transformToGeodetic,dataSource:c.dataSource})},calSegmentsDistance:function(b){var c=this;c.segmentsDisArray=[];var E=[],S=0,Q=[],v=function(a,b){0!==a&&(c.segmentsDisArray[b]=Math.round(100*a)/100)};if(c.transformToGeodetic)b.transform(8307,function(b){for(var m=
0;m<b.getOrdinates().length/2-1;m++)Q[m]=v,E[m]=new a.geometry.LineString([b.getOrdinates()[2*m],b.getOrdinates()[2*m+1],b.getOrdinates()[2*m+2],b.getOrdinates()[2*m+3]],b.srid),4<=E[m].coordinates.length&&a.util.GeomUtil.getLength(E[m],Q[m],{idx:m,unit:c.unit,transformToGeodetic:c.transformToGeodetic,dataSource:c.dataSource})});else for(var ha=0;ha<b.getOrdinates().length/2-1;ha++)Q[ha]=v,E[ha]=new a.geometry.LineString([b.getOrdinates()[2*ha],b.getOrdinates()[2*ha+1],b.getOrdinates()[2*ha+2],b.getOrdinates()[2*
ha+3]],b.srid),4<=E[ha].coordinates.length&&a.util.GeomUtil.getLength(E[ha],Q[ha],{idx:ha,unit:c.unit,transformToGeodetic:c.transformToGeodetic,dataSource:c.dataSource});var pa=setInterval(function(){if(c.segmentsDisArray.length==b.getOrdinates().length/2-1){for(var E=0;E<c.segmentsDisArray.length;E++)S+=c.segmentsDisArray[E];c._distanceInfo.setVisible(!0);c._subTotalDis=S;a.$("#distance_total_1").text(Math.round(100*c._subTotalDis)/100+c.getUnitLabel(c.unit));a.$("#sub_tr_1")&&a.$("#sub_tr_1").hide();
E=a.event.ToolEvent;E=new E(E.DISTANCE_UPDATE,c);E.point=b.getLastPoint();c.fire(E.type,E);clearInterval(pa)}},100)},getUnitLabel:function(b){b||(b=this.unit);return b?(b=b.toUpperCase(),"KILOMETER"===b||"KM"===b?a.gv.getLabel("MAPVIEWER_SB_KILOMETERS"):"METER"===b||"M"===b?a.gv.getLabel("MAPVIEWER_SB_METERS"):"MILE"===b?a.gv.getLabel("MAPVIEWER_SB_MILES"):"FOOT"===b?a.gv.getLabel("MAPVIEWER_SB_FEET"):"CENTIMETER"===b||"CM"===b?a.gv.getLabel("MAPVIEWER_SB_CENTIMETER"):"YARD"===b?a.gv.getLabel("MAPVIEWER_SB_YARD"):
b):"KM"},setDrawingStyle:function(a){if(!a)return this;this._tool&&this._tool.setDrawingStyle(a)},setStyle:function(b){this._tool&&this._tool.setStyle({type:a.tool.DistanceTool.TYPE_LINESTRING,style:b})}});a.tool.DistanceTool.TYPE_POINT=1;a.tool.DistanceTool.TYPE_LINESTRING=2;a.tool.RedlineTool=a.tool.Tool.extend({initialize:function p(c,S,Q){p.base.call(this,c);var v=this;this.activeMapIndex=null;this.finishMode=a.tool.RedlineTool.FINISH_ON_CLICK;this.simplified=!0;Q&&(a.notNull(Q.simplified)&&(this.simplified=
Q.simplified),a.notNull(Q.finishMode)&&(this.finishMode=Q.finishMode));this.start_move_line_mode=!1;this._geoType=S&&"number"==typeof S?S:a.tool.RedlineTool.TYPE_POLYGON;this._pointStyle=new a.style.Marker({width:10,height:10,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:10,height:10},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1}}]});this._pointEndHoverStyle=new a.style.Marker({width:15,height:15,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:15,height:15},style:{fill:"#ffffff",
stroke:"#0000ff",strokeThickness:1}}]});this.featurePointStyle=this._pointStyle;this.featurePolygonStyle=this.featureStyle=this._style;this._nextPointId=0;v._nextLineId=0;this._points=[];this._continuousPoints=[];this._screenPoints=[];this._lines=[];this._shapeGroup=null;this._editFlag=!0;var ha=null,pa=null,ra=null,Ca=null;this.dragging=!1;var va=a.event.ToolEvent;this.snapPoint=null;this.mouseDown=function(b){0===b.button&&(ha=b.pageX,v.dragging=!0,v._group&&v._group.bringToFront(),v._geoType!==
a.tool.RedlineTool.TYPE_POINT&&v._map.enableMapDrag(!1));b.stopPropagation()};this.nextPoint=function(b,c){if(v.status==a.tool.Tool.STARTED){var E=a.util.ValidationUtil.isNumber;a.notNull(b)&&a.notNull(c)&&E(b)&&E(c)&&(E=a.MapContext(v._map).getUniverse().srid,E=new a.geometry.Point(b,c,E),v.addVertex(null,E))}};this.mouseUp=function(b){if(2===b.button)b=new va(a.event.ToolEvent.MOUSE_RIGHT_CLICK,v),v.fire(b.type,b);else if(v.status!=a.tool.Tool.STOPPED&&v.status!=a.tool.Tool.FINISHED){v._graphic.getLeftTop(v._map.draggableGroup);
v._$container.offset();v._$container.offset();if(0<v._continuousPoints.length){var c;c=v.simplified?a.util.GeomUtil.simplify(v._continuousPoints,3):v._continuousPoints;v._continuousPoints=[];v._screenPoints=[];v._map.getUndoManager().startChangeBlock();for(var E=1;E<c.length;E++){var p=c[E];p&&v.addVertex(null,p)}v.endBlock=v._map.getUndoManager().endChangeBlock()}v.dragging=!1;a.notNull(v.snapPoint)&&2===v.snapPoint.length&&(v._map.mLocX=v.snapPoint[0],v._map.mLocY=v.snapPoint[1]);(b.isRedo||b.pageX==
ha&&b.pageX!=Ca)&&v.addVertex(null,{x:v._map.mLocX,y:v._map.mLocY});Ca=b.pageX;v.done(b,v.finishMode===a.tool.RedlineTool.FINISH_ON_RELEASE)}};this.done=function(a,b){return v.clicktofinish||b?(v.finishAndCleanUp(a),!0):!1};this.finishAndCleanUp=function(a){a.preventDefault();v.finish();v.finishFeature=null;ra=pa=v.clicktofinish=null;v.dragging=!1};this.mouseMove=function(b){v.snapPoint=null;if(a.isNotNull(v.finishFeature)){var c=v._map.getScreenLocation(v.finishFeature.getGeometry()),E=v._map.getScreenLocation(v._map.getAbsoluteCursorLocation());
if(5>=Math.abs(E.x-c.x)&&5>=Math.abs(E.y-c.y)){var p;switch(v._geoType){case a.tool.RedlineTool.TYPE_POINT:p=1;break;case a.tool.RedlineTool.TYPE_LINESTRING:p=2;break;case a.tool.RedlineTool.TYPE_POLYGON:p=3}if(v._points.length>p-1&&(v.finishFeature.bringToTop(),a.isNotNull(v.finishFeature.movedOut)||v.touchEnabled)&&(v.finishFeature.setRenderingStyle(v._pointEndHoverStyle),v.clicktofinish=!0,v._geoType==a.tool.RedlineTool.TYPE_LINESTRING)){v.setPath(v._shapeGroup,[[0,0,0,0]],v._style);b=new va(va.REDLINE_DRAW,
v);b.loc=v.finishFeature.getGeometry();v.fire(b.type,b);return}}else v.clicktofinish=!1,v.finishFeature.setRenderingStyle(v._pointStyle),v.finishFeature.bringToTop(),v.finishFeature.movedOut=!0}if(v.status!=a.tool.Tool.STOPPED&&v.status!=a.tool.Tool.FINISHED){if(a.isNull(v.clicktofinish)||!1===v.clicktofinish)c=new va(a.event.ToolEvent.SNAP_POINT,v),v.fire(c.type,c);v._geoType!=a.tool.RedlineTool.TYPE_POINT&&(E=v._graphic.getLeftTop(v._map.draggableGroup),c=b.pageX-v._$container.offset().left-E.x,
b=b.pageY-v._$container.offset().top-E.y,v.dragging?(v._screenPoints.push(c),v._screenPoints.push(b),b=v._map.getAbsoluteCursorLocation(),b=new a.Feature("_rlcpt"+v._continuousPoints.length,b,{renderingStyle:v._pointStyle}),b.x=v._map.mLocX,b.y=v._map.mLocY,v._continuousPoints.push(b),1<v._continuousPoints.length?v._shapeGroup?v.setPath(v._shapeGroup,[v._screenPoints],v._style):v._shapeGroup=v.drawLine([v._continuousPoints],v._style,{group:v._group}):v.addVertex(null,{x:v._map.mLocX,y:v._map.mLocY})):
pa&&ra&&(v._shapeGroup?v.setPath(v._shapeGroup,[[pa,ra,c,b]],v._style):(v._zoom&&(E=v._map.getScreenLocation(v._points[v._points.length-1].geo),pa=E[0],ra=E[1],v._zoom=!1),v._shapeGroup=v.drawLine([[pa,ra,c,b]],v._style,{group:v._group})),b=new va(va.REDLINE_DRAW,v),v.fire(b.type,b)))}};this.addVertex=function(b,c,E){var p=a.MapContext(v._map),Q=v._points,S=v._lines,Ca=v._map.getToolFeatureLayer(),ha;if("number"!==typeof b||0>b||b>Q.length)b=Q.length;c instanceof a.geometry.Point?(ha=a.MapContext(v._map).getUniverse(),
ha=ha.srid,ha!=c.srid&&(c=c.transform(ha)),c.wraparoundMapIndex=p.getBaseWholeMapIndex()):c=v._map.getScreenPointLocation(c.x,c.y);v.activeMapIndex||(v.activeMapIndex=c.wraparoundMapIndex);if(c.wraparoundMapIndex===v.activeMapIndex){c.wraparoundMapIndex&&(c=v._map.getACL(c,c.wraparoundMapIndex));var ob;if(0===Q.length||v._geoType!==a.tool.RedlineTool.TYPE_POINT){p=new a.Feature("RedlinePoints"+v._nextPointId++,c,{renderingStyle:v._pointStyle});p.activeIdx=v.activeIdx;Q.splice(b,0,p);Ca.addFeature(p);
switch(v._geoType){case a.tool.RedlineTool.TYPE_POINT:v.finish();break;case a.tool.RedlineTool.TYPE_LINESTRING:1<Q.length&&(v.finishFeature=p);break;case a.tool.RedlineTool.TYPE_POLYGON:1==Q.length?v.finishFeature=p:a.isNotNull(v.finishFeature)&&v.finishFeature.bringToTop()}p=!1;Q[b-1]&&(ha=Q[b-1].getGeometry(),ha=new a.geometry.LineString([ha.getX(),ha.getY(),c.getX(),c.getY()],ha.srid),ha=new a.Feature("RedlineLines"+v._nextLineId++,ha,{renderingStyle:v._style}),ha.activeIdx=v.activeIdx,S.splice(b,
0,ha),Ca.addFeature(ha),p=!0);Q[b+1]&&(ha=Q[b+1].getGeometry(),ha=new a.geometry.LineString([c.getX(),c.getY(),ha.getX(),ha.getY()],ha.srid),ha=new a.Feature("RedlineLines"+v._nextLineId++,ha,{renderingStyle:v._style}),p&&(Ca.removeFeature(S[b-1]),S.splice(b-1,1)),S.splice(b,0,ha),Ca.addFeature(ha))}else ob=Q[0].getGeometry(),Q[0].setGeometry(c),v.finishFeature=Q[0],v.finishFeature.movedOut=null;E||v._geoType===a.tool.RedlineTool.TYPE_POINT||(E=v._map.getUndoManager().addEdit({index:b,vertex:c,prevVertex:ob,
canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"Redline tool point ("+this.x+","+this.y+")"},undo:function(){this.prevVertex?v.addVertex(this.index,this.prevVertex,!0):v.removeVertex(this.index,!0)},redo:function(){v.addVertex(this.index,this.vertex,!0)}}),a.isNull(v.startBlock)&&(v.startBlock=E),v.endBlock=E);b==Q.length-1&&(v.removeShapeGroup(v),v._shapeGroup=null,b=v._map.getScreenLocation(c),c=v._graphic.getLeftTop(v._map.draggableGroup),pa=b.x-
c.x,ra=b.y-c.y);b=new va(va.REDLINE_POINT_CREATE,v);v.fire(b.type,b)}};this.removeVertex=function(b,c){var E=v._points;if(!(0>b||b>=E.length)){var p=v._lines,Q=v._map.getToolFeatureLayer(),S,ha=1,Ca=E[b-1],ob=E[b+1];Ca&&ob&&(ha=2,S=Ca.getGeometry(),ob=ob.getGeometry(),S=new a.geometry.LineString([S.getX(),S.getY(),ob.getX(),ob.getY()],S.srid),S=new a.Feature("RedlineLines"+v._nextLineId++,S,{renderingStyle:v._style}),Q.addFeature(S));ob=E.splice(b,1)[0];Q.removeFeature(ob);ob=ob.getGeometry();p=S?
p.splice(Math.max(0,b-1),ha,S):p.splice(Math.max(0,b-1),ha);for(ha=0;ha<p.length;ha++)Q.removeFeature(p[ha]);c||v._geoType===a.tool.RedlineTool.TYPE_POINT||(Q=v._map.getUndoManager().addEdit({index:b,vertex:ob,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"Redline tool point ("+this.x+","+this.y+")"},undo:function(){v.addVertex(this.index,this.vertex,!0)},redo:function(){v.removeVertex(this.index,!0)}}),a.isNull(v.startBlock)&&(v.startBlock=Q),v.endBlock=
Q);b==E.length&&(v.removeShapeGroup(v),ra=pa=v._shapeGroup=null,Ca&&(E=v._map.getScreenLocation(Ca.getGeometry()),Ca=v._graphic.getLeftTop(v._map.draggableGroup),pa=E.x-Ca.x,ra=E.y-Ca.y));E=new va(va.REDLINE_POINT_REMOVE,v);v.fire(E.type,E)}};this.newShapePoint=function(a,b,c,E,p){this.addVertex(null,v._map.getScreenPointLocation(a,b,!0))};this.zoomAction=function(){v.finish()};this.finish=function(){if(v.status==a.tool.Tool.STARTED){a.isNotNull(this.startBlock)&&a.isNotNull(this.endBlock)&&(v._map.getUndoManager().trimEdits(this.startBlock,
this.endBlock+1),this.endBlock=this.startBlock=b);var c=v._map.getToolFeatureLayer();v._map.deleteListener(a.event.MapEvent.MAP_BEFORE_ZOOM,v.zoomAction,v);var E=!0;a.browser.touchSupported||a.gv.isWin8Touch||(E=!1);v._$container.unbind("mousemove",v.mouseMove);v._$container.unbind("mouseup",v.mouseUp);v._$container.unbind("mousedown",v.mouseDown);a.gv.isWin8Touch&&(v._$container[0].removeEventListener("MSPointerUp",v.mouseUp),v._$container[0].removeEventListener("MSPointerDown",v.mouseDown));a.browser.touchSupported&&
(v._$container.unbind("touchstart",v.touchStart),v._$container.unbind("touchmove",v.touchMove),v._$container.unbind("touchend",v.touchEnd));v.touchEnabled=null;E&&a.Hammer(v._$container[0]).off("hold",v.finishAndCleanUp);v.removeShapeGroup(v);if(0===v._points.length)v.status=a.tool.Tool.FINISHED;else{var E=[],p;for(p=0;p<v._points.length;p++)0<p&&v._points[p].getGeometry().getX()==v._points[p-1].getGeometry().getX()&&v._points[p].getGeometry().getY()==v._points[p-1].getGeometry().getY()||(E.push(v._points[p].getGeometry().getX()),
E.push(v._points[p].getGeometry().getY())),c.removeFeature(v._points[p]);for(p=0;p<v._lines.length;p++)c.removeFeature(v._lines[p]);switch(v._geoType){case a.tool.RedlineTool.TYPE_POINT:c=E;v._geometry=new a.geometry.Point(c[c.length-2],E[E.length-1],v._points[0].getGeometry().srid);break;case a.tool.RedlineTool.TYPE_LINESTRING:if(2>v._points.length){v.status=a.tool.Tool.FINISHED;a.util.Logger.warning("MAPVIEWER_9011","OM.tool.RedlineTool.finish","");v._map.moveflag=!1;E=new va(va.TOOL_END,v);v.fire(E.type,
E);v._map.enableMapAction.dbclick=!0;v._map.enableMapAction.mouse=!0;v._map.enableMapDrag(!0);return}v._geometry=new a.geometry.LineString(E,v._points[0].getGeometry().srid);break;case a.tool.RedlineTool.TYPE_POLYGON:if(3>v._points.length){v.status=a.tool.Tool.FINISHED;a.util.Logger.warning("MAPVIEWER_9012","OM.tool.RedlineTool.finish","");v._map.moveflag=!1;E=new va(va.TOOL_END,v);v.fire(E.type,E);v._map.enableMapAction.dbclick=!0;v._map.enableMapAction.mouse=!0;v._map.enableMapDrag(!0);return}c=
v._points[0].getGeometry();E.push(c.getX());E.push(c.getY());v._geometry=new a.geometry.Polygon(E,c.srid)}v.end();v.status=a.tool.Tool.FINISHED;E=new va(va.TOOL_END,v);v.fire(E.type,E)}v._map.enableMapAction.dbclick=!0;v._map.enableMapAction.mouse=!0;v._map.enableMapDrag(!0)}};this.touchStart=function(b){var c=a.util.DomUtil,E=c.getTouchCount(b);if(1==E)b.button=0,c=c.getTouchesPosition(b),v.touchPos=c,b.pageX=c.x,b.pageY=c.y;else if(2==E)b.button=2;else return;v.mouseDown(b)};this.touchMove=function(){v.touchPos=
null};this.touchEnd=function(a){v.touchPos&&(a.pageX=v.touchPos.x,a.pageY=v.touchPos.y,v.mouseMove(a),v.mouseUp(a))}},start:function(){var b=a.event.ToolEvent;this.clear();this._map.enableMapAction.dbclick=!1;this._map.enableMapAction.mouse=!1;this._group||(this._group=this._graphic.createGroup(),this._graphic.addGroup(this._group,this._map.draggableGroup));this.domainArea={};this.activeIdx=null;this._points=[];this._lines=[];this._map.on(a.event.MapEvent.MAP_BEFORE_ZOOM,this.zoomAction,this);var c=
!0;a.browser.touchSupported||a.gv.isWin8Touch||(c=!1);this._$container.bind("mouseup",this.mouseUp);this._$container.bind("mousedown",this.mouseDown);this._$container.bind("mousemove",this.mouseMove);a.gv.isWin8Touch&&(this._$container[0].addEventListener("MSPointerUp",this.mouseUp),this._$container[0].addEventListener("MSPointerDown",this.mouseDown));a.browser.touchSupported?(this._$container.bind("touchstart",this.touchStart),this._$container.bind("touchmove",this.touchMove),this._$container.bind("touchend",
this.touchEnd),this.touchEnabled=!0):this.touchEnabled=!1;if(c)a.Hammer(this._$container[0]).on("hold",this.finishAndCleanUp);this.status=a.tool.Tool.STARTED;this.fire(b.type,b);return this},end:function(){var b=null;switch(this._geoType){case a.tool.RedlineTool.TYPE_POINT:b=this.featurePointStyle;break;case a.tool.RedlineTool.TYPE_LINESTRING:b=this.featureStyle;break;case a.tool.RedlineTool.TYPE_POLYGON:b=this.featurePolygonStyle}var c=this._map.getToolFeatureLayer();this.toolFeature=new a.Feature("RedlineTool"+
c.featureArray.length,this._geometry,{renderingStyle:b});this._map.getToolFeatureLayer();c.enableFeatureEditing(!0);c.addFeature(this.toolFeature);this.toolFeature.on(a.event.LayerEvent.FEATURE_MOVED,function(){this._geometry=this.toolFeature.geo;var b=new a.event.ToolEvent(a.event.ToolEvent.REDLINE_EDITED,this);this.fire(b.type,b)},this);this.toolFeature.on(a.event.LayerEvent.FEATURE_EDITED,function(){this._geometry=this.toolFeature.geo;var b=new a.event.ToolEvent(a.event.ToolEvent.REDLINE_EDITED,
this);this.fire(b.type,b)},this)},clear:function(){this.finish();this._pointStyle=new a.style.Marker({width:10,height:10,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:10,height:10},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1}}]});this.clear_base()},getGeometryType:function(){return this._geoType},getGeometry:function(){return this._geometry},setDrawingStyle:function(b){if(!b)return this;var c=a.tool.RedlineTool;b.type===c.TYPE_POINT&&(this._pointStyle=b.style.clone());if(b.type===
c.TYPE_LINESTRING||b.type===c.TYPE_POLYGON)this._style=b.style.clone();return this},drawLine:function(b,c,S){var Q=[];if(c&&"Line"==c.styleType){a.style.Style.calculateStyleSize(c,this._map.getMapContext());c=c.stylelist;for(var v=c.length,ha=0;ha<v;ha++){var pa=c[ha];pa.stroke&&Q.push(this._graphic.drawPath(b,pa,S))}}else S={group:this._group,id:"lstr"},c.stroke||(c.stroke=c.fill?c.fill:"#000000"),c.fill=null,Q.push(this._graphic.drawPath(b,c,S));return Q},setPath:function(b,c,S){if(!a.isNull(b)){b=
b.length;a.style.Style.calculateStyleSize(S,this._map.getMapContext());S=S.stylelist;for(var Q=0;Q<b;Q++)this._graphic.setPath(this._shapeGroup[Q],c,S[Q])}},removeShapeGroup:function(a){if(a&&a._shapeGroup){for(var b=a._shapeGroup.length,c=0;c<b;c++)a._graphic.remove(a._shapeGroup[c]);a._shapeGroup.length=0;a._shapeGroup=null}},setStyle:function(b){b.type==a.tool.RedlineTool.TYPE_POINT&&(this.featurePointStyle=b.style.clone(),this.toolFeature&&this._geoType==a.tool.RedlineTool.TYPE_POINT&&this.toolFeature.setRenderingStyle(this.featurePointStyle));
b.type==a.tool.RedlineTool.TYPE_LINESTRING&&(this.featureStyle=b.style.clone(),this.toolFeature&&this._geoType==a.tool.RedlineTool.TYPE_LINESTRING&&this.toolFeature.setRenderingStyle(this.featureStyle));b.type==a.tool.RedlineTool.TYPE_POLYGON&&(this.featurePolygonStyle=b.style.clone(),this.toolFeature&&this._geoType==a.tool.RedlineTool.TYPE_POLYGON&&this.toolFeature.setRenderingStyle(this.featurePolygonStyle));return this}});a.tool.RedlineTool.TYPE_POINT=1;a.tool.RedlineTool.TYPE_LINESTRING=2;a.tool.RedlineTool.TYPE_POLYGON=
3;a.tool.RedlineTool.FINISH_ON_CLICK=1;a.tool.RedlineTool.FINISH_ON_RELEASE=2;a.tool.MarqueeZoomTool=a.tool.RectangleTool.extend({initialize:function E(b,c){E.base.call(this,b);var v=this;this.mode=c?c:a.tool.MarqueeZoomTool.PROMPT;this.setStyle(new a.style.Color({stroke:"#00FF00",fill:"#FF0000",strokeThickness:1,fillOpacity:.5}));this.setDrawingStyle(new a.style.Color({stroke:"#00FF00",fill:"#FF0000",strokeThickness:1,fillOpacity:.5}));this.on(a.event.ToolEvent.TOOL_END,function(){var c=v.getGeometry(),
E=function(b){v.clear();b&&(v._map.zoomToExtent(c),v.status=a.tool.Tool.FINISHED)},Q=function(){E(!1);b.deleteListener(a.event.MouseEvent.MOUSE_CLICK,Q)},Ca=function(){E(!0);b.deleteListener(a.event.MouseEvent.MOUSE_CLICK,Q)};v.mode!=a.tool.MarqueeZoomTool.PROMPT?E(!0):(v.toolFeature.on(a.event.MouseEvent.MOUSE_CLICK,Ca),b.on(a.event.MouseEvent.MOUSE_CLICK,Q));v.mode==a.tool.MarqueeZoomTool.CONTINUOUS&&v.start()})},setMode:function(a){this.mode=a}});a.tool.MarqueeZoomTool.ONE_TIME=1;a.tool.MarqueeZoomTool.CONTINUOUS=
2;a.tool.MarqueeZoomTool.PROMPT=3;a.tool.ButtonGroup=a.Class.extend({initialize:function(a){this.butGroupId=a;this.buttonArray=[]},createHTML:function(){for(var a="\x3ctable\x3e\x3ctbody\x3e\x3ctr\x3e",b=this.buttonArray.length,c=0;c<b;c++)a+="\x3ctd\x3e",a+=this.buttonArray[c].createHTML(),a+="\x3c/td\x3e";return a+"\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e"},addButton:function(a){a.parent=this;this.buttonArray.push(a)},removeButton:function(a){for(var b=this.buttonArray.length,c=0;c<b;c++)this.buttonArray[c]==
a&&(this.buttonArray.splice(c,1),a.parent=null)},attachEvents:function(){for(var a=this.buttonArray.length,b=0;b<a;b++)this.buttonArray[b].attachEvents()},setDownButton:function(a){for(var b=this.buttonArray.length,c=0;c<b;c++){var v=this.buttonArray[c];v==a?v.setStatus(!0):v.setStatus(!1)}}});a.tool.ImageButton=a.Class.extend({initialize:function(b,c){this.btID=b;c&&(this.btIcon=c.buttonEnableIcon,this.btOverIcon=c.buttonOverIcon,this.btDownIcon=c.buttonDownIcon,this.btDisableIcon=c.buttonDisableIcon,
this.tip=c.toolTip,this.width=c.width,this.height=c.height);this.status=c&&c.status?c.status:a.tool.ImageButton.STATUS_UP},createHTML:function(){var b;b='\x3ca href\x3d"javascript:void(0)" style\x3d"vertical-align:bottom"'+(a.isNull(this.tip)?"\x3e":' title\x3d"'+this.tip+'"\x3e');return b+='\x3cimg id\x3d"'+this.btID+'" src\x3d'+this.btIcon+" border\x3d0\x3e\x3c/a\x3e"},attachEvents:function(){this.$icon=a.$("#"+this.btID);this.status==a.tool.ImageButton.STATUS_DOWN&&(this.$icon.attr("src",this.btDownIcon),
this.$icon[0].down=!0);if(!this.attched){this.attched=!0;var b=this;a.$(this.$icon).hover(function(a){b.btOverIcon&&!this.down&&b.$icon.attr("src",b.btOverIcon)},function(a){b.btOverIcon&&!this.down&&b.$icon.attr("src",b.btIcon)}).mousedown(function(a){b.btDownIcon&&b.$icon.attr("src",b.btDownIcon)}).click(function(c){b.parent instanceof a.tool.ButtonGroup?this.down||(this.down=!0,b.parent.setDownButton(b)):b.setStatus(!this.down)})}},setStatus:function(b){b?(this.$icon.attr("src",this.btDownIcon),
this.$icon[0].down=!0,this.status=a.tool.ImageButton.STATUS_DOWN):(this.$icon.attr("src",this.btIcon),this.$icon[0].down=!1,this.status=a.tool.ImageButton.STATUS_UP)}});a.tool.ImageButton.STATUS_DOWN="DOWN";a.tool.ImageButton.STATUS_UP="UP";a.control.MapDecoration=a.Class.extend({mixin:a.event.EventSource,initialize:function(b,c){this.dragDiv=!1;this._randomId=""+this.s4()+this.s4();this.id="decorationDiv_"+this._randomId;this.visible=!0;this.minimized=this.collapsible=!1;this.title="";a.isNull(this.isHtml)&&
(this.isHtml=!1);this.cleaned=!1;this.Y=this.X=0;this.inAnimation=this.draggable=this.relativePosition=this.anchored=!1;this.collapsibleContainer=null;if(b&&b.substr||typeof b)this.isHtml=!0,this.content=b,this.type="CustomHtmlDecoration";if(c){this.restoredWidth=c.width?c.width:0;this.restoredHeight=c.height?c.height:0;this.mapType=c.mapType;this.draggable=c.draggable?c.draggable:!1;a.isNull(c.draggable)&&(this.draggable=!0);this.X=a.notNull(c.offsetX)?c.offsetX:20;this.Y=a.notNull(c.offsetY)?c.offsetY:
20;this.isPanel=!0;this.width=c.width?c.width:0;this.height=c.height?c.height:0;this.title=c.title?c.title:"";this.collapsible=c.collapsible?c.collapsible:!1;this.titleStyle=c.titleStyle?c.titleStyle:null;this.contentStyle=c.contentStyle?c.contentStyle:null;if(a.notNull(c.anchorPosition)){this.anchorPosition=parseInt(c.anchorPosition);if(1>this.anchorPosition||6<this.anchorPosition)a.util.Logger.warning("","OM.MapDecoration.initialize","anchorPosition value is out of range, default value is used."),
this.anchorPosition=1;this.anchored=!0}a.notNull(c.enableAnimation)&&(this.enableAnimation=c.enableAnimation)}},display:function(b){b=this.map||b;var c=this.graphics=b.graphics,Q=b.getMapContext();this.parentMapWidth=Q.getDeviceWidth();this.parentMapHeight=Q.getDeviceHeight();this.isHtml?(this.container=b.$topLayerDIV,this.generateHtmlDecoration(),this.setDraggable(this.draggable),this.delegate("mousedown",function(b){a.event.EventSource.stopEvents[b.type]=!0}),this.delegate("dblclick",function(b){a.event.EventSource.stopEvents[b.type]=
!0})):(this.container=b.fixedGroup,this.defaultGroup=c.createGroup(),c.addGroup(this.defaultGroup,this.container),this.delegate("dblclick",function(a){a.stopPropagation();a.preventDefault()}),this.delegate("mousedown",function(a){a.stopPropagation();a.preventDefault()}),this.delegate("mouseup",function(a){a.stopPropagation();a.preventDefault()}));this.map.on(a.event.MapEvent.MAP_RESIZED,this.resize,this);"NavigationPanelBar"!==this.type&&this.setPosition();a.notNull(this.anchorPosition)&&!0===this.anchored&&
this.setAnchorPosition(this.anchorPosition);this.relativePosition&&!this.draggable&&this.map.addListener(a.event.MapEvent.MAP_RESIZED,this.setPosition,this);this.graphics&&this.defaultGroup&&!this.visible&&this.graphics.setVisible(this.defaultGroup,this.visible);b=new a.event.MapDecorationEvent(a.event.MapDecorationEvent.DISPLAYED,this);this.fire(a.event.MapDecorationEvent.DISPLAYED,b)},remove:function(){this.relativePosition&&this.map.deleteListener(a.event.MapEvent.MAP_RESIZED,this.setPosition,
this);this.unDelegate();this.isHtml&&this.$DecorationDiv&&(this.$DecorationDiv.unbind(),this.map&&(this.map.$oracleMapDiv.unbind("mousemove",this.mapDiv_msmove),this.map.$oracleMapDiv.unbind("touchmove",this.mapDiv_touchmove),this.map.$oracleMapDiv.unbind("touchend",this.mapDiv_touchend)),this.$DecorationDiv.remove(),this.$DecorationBtnDiv&&this.$DecorationBtnDiv.remove())},clean:function(){this.unDelegate&&this.unDelegate();this.isHtml?(this.$DecorationDiv.remove(),this.$DecorationBtnDiv&&this.$DecorationBtnDiv.remove()):
this.graphics.clearGroup(this.defaultGroup);this.cleaned=!0},setPosition:function(b,c){1<=b&&(b=parseInt(b));1<=c&&(c=parseInt(c));this.X=b||this.X;this.Y=c||this.Y;this.map&&this.parentMapWidth&&(1>this.X&&0<this.X&&(this.X*=this.parentMapWidth,this.relativePosition=!0),1>this.Y&&0<this.Y&&(this.Y*=this.parentMapHeight,this.relativePosition=!0));this.defaultGroup&&this.graphics?this.graphics.setLeftTop(this.defaultGroup,this.X,this.Y):this.isHtml&&a.notNull(this.$DecorationDiv)&&(this.container.append(this.$DecorationDiv),
this.$DecorationDiv.css({top:this.Y,left:this.X,bottom:"",right:""}))},setAnchorPosition:function(b){isNaN(b)&&(b=this.anchorPosition);var c=b||this.anchorPosition;this.anchorPosition=c;if(!a.isNull(this.map)){var Q=this.container.find("div[id^\x3domv2_anchorBox]");"ScaleBar"===this.type?(this.setMainDecorationAnchorCss(b),$(Q[b-1]).append(this.$DecorationDiv[0])):"CopyRight"===this.type?(this.setCopyRightStyle(b),this.container.append(this.$DecorationDiv)):"NavigationPanelBar"===this.type?(this.setMainDecorationAnchorCss(b),
$(Q[b-1]).append(this.$DecorationDiv[0])):"OverviewMap"===this.type?(this.setMainDecorationAnchorCss(b),$(Q[b-1]).append(this.$DecorationDiv)):"Magnifier"===this.type?(this.$DecorationDiv.detach(),this.setMainDecorationAnchorCss(b),$(Q[b-1]).append(this.$DecorationDiv)):"LayerControl"===this.type?(this.$DecorationDiv.detach(),this.setMainDecorationAnchorCss(b),$(Q[b-1]).append(this.$DecorationDiv)):(this.$DecorationDiv||this.graphics)&&this.doSetAnchorPosition(c);this.anchored=!0}},setMainDecorationAnchorCss:function(a){switch(a){case 1:case 2:case 3:this.$DecorationDiv.css({top:"0px",
bottom:""});break;case 4:case 5:case 6:this.$DecorationDiv.css({bottom:"0px",top:""})}switch(a){case 1:case 4:this.$DecorationDiv.css({left:"0px",right:""});break;case 2:case 5:this.$DecorationDiv.css({left:"",right:""});break;case 3:case 6:this.$DecorationDiv.css({left:"",right:"0px"})}},setCopyRightStyle:function(a){this.$DecorationDiv.css({display:"inline-flex"});switch(a){case 1:this.$DecorationDiv.css({display:"inline-flex",left:"0px","justify-content":"center","align-items":"flex-start","align-content":"flex-start",
top:"0px",right:"",bottom:""});break;case 2:this.$DecorationDiv.css({display:"inline-flex",left:"calc(50% - "+this.$DecorationDiv.width()/2+"px )","justify-content":"center","align-items":"flex-start","align-content":"flex-start",top:"0px",right:"",bottom:""});break;case 3:this.$DecorationDiv.css({display:"inline-flex",right:"0px","justify-content":"center","align-items":"flex-end","align-content":"flex-end",top:"0px",left:"",bottom:""});break;case 4:this.$DecorationDiv.css({display:"inline-flex",
left:"0px","justify-content":"center","align-items":"flex-start","align-content":"flex-start",bottom:"0px",right:"",top:""});break;case 5:this.$DecorationDiv.css({display:"inline-flex",left:"calc(50% - "+this.$DecorationDiv.width()/2+"px )","justify-content":"center","align-items":"flex-start","align-content":"flex-start",bottom:"0px",right:"",top:""});break;case 6:this.$DecorationDiv.css({display:"inline-flex",right:"0px","justify-content":"center","align-items":"flex-end","align-content":"flex-end",
bottom:"0px",left:"",top:""})}},doSetAnchorPosition:function(a){if(1>a||6<a)a=4;this.isHtml?this.setHtmlAnchorPosition(a):this.graphics&&this.setGraphicsAnchorPosition(a)},setSize:function(a,b){a&&b&&(this.width=a,this.height=b,this.restoredWidth=a,this.restoredHeight=b,this.isHtml&&(this.$DecorationDiv.width(this.width),this.$DecorationDiv.height(this.height)))},setDraggable:function(a){this.draggable=a},setVisible:function(b){this.visible=b;this.isHtml?a.isNull(this.$DecorationDiv)&&a.isNull(this.$DecorationBtnDiv)||
(b?(this.$DecorationDiv.css("display",""),a.notNull(this.$DecorationBtnDiv)&&this.$DecorationBtnDiv.css("display","")):(this.$DecorationDiv.css("display","none"),a.notNull(this.$DecorationBtnDiv)&&this.$DecorationBtnDiv.css("display","none"))):this.graphics&&this.graphics.setVisible(this.defaultGroup,b)},getHtmlElementId:function(b){return a.isNull(b)?this.id:this._randomId},s4:function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},generateHtmlDecoration:function(){var b=this;this.$DecorationDiv=
a.$("\x3cdiv onselectstart\x3d'return false'\x3e\x3c/div\x3e");this.$DecorationDiv.attr("id",this.id);a.isNull(this.type)?this.$DecorationDiv.css({"z-index":"6",position:"absolute",overflow:"auto"}):this.$DecorationDiv.css({"z-index":"6",position:"absolute"});this.visible||this.$DecorationDiv.css("display","none");this.mapWidth=this.map.getMapContext().getDeviceWidth();this.mapHeight=this.map.getMapContext().getDeviceHeight();this.container.append(this.$DecorationDiv);this.$DecorationBtnDiv&&this.$DecorationBtnDiv.bind("mouseup mousedown",
function(a){a.stopPropagation()});this.$DecorationDiv.bind("mouseup mousedown",function(a){a.stopPropagation()});"Magnifier"===this.type&&(this.$Content=a.$("\x3cdiv class\x3d'defaultStyle_magni'\x3e\x3c/div\x3e"),this.$hideDiv=a.$("\x3cdiv class\x3d'hideStyle_magni'\x3e\x3c/div\x3e"),this.$hideDiv.css({width:this.width,height:this.height}),this.$Content.css({width:this.width,height:this.height}),this.$DecorationDiv.append(this.$Content),this.$DecorationDiv.append(this.$hideDiv));"LayerControl"===
this.type&&(this.$Content=a.$("\x3cdiv class\x3d'defaultStyle_layerctrl'\x3e\x3c/div\x3e"),this.$Content.css({width:this.width,"z-index":0}),this.$title=a.$("\x3cdiv class\x3d'titleStyleBasic_layerctrl titleStyleEna_layerctrl'\x3e"+a.gv.getLabel("MAPVIEWER_LC_TITLE")+"\x3c/div\x3e"),this.$title.css({width:this.width-4,"font-size":this.title_font_size,"font-family":this.title_font_family,"z-index":1}),this.collapsibleContainer=a.$("\x3cdiv id\x3d'_customContainer' \x3e\x3c/div\x3e"),this.collapsibleContainer.css({display:"inline-flex",
margin:"5px","flex-direction":"column",flex:"content"}),this.collapsibleContainer.append(this.$title,this.$Content),this.$DecorationDiv.append(this.collapsibleContainer));"OverviewMap"===this.type&&(this.$DecorationDiv.css({display:"inline-flex","flex-direction":"row","align-items":"flex-end","align-content":"flex-end"}),this.overviewMapDIV=a.$("\x3cdiv id\x3d'_DecorationOverview' class\x3d'style_overviewMap'\x3e\x3c/div\x3e"),this.overviewMapDIV.css({height:.3*this.parentMapHeight,width:.3*this.parentMapWidth}));
if("ToolBar"===this.type||this.mapType){var S=this.$Content=a.$("\x3cdiv style\x3d'overflow:false'\x3e\x3c/div\x3e"),Q=this.$realContent=a.$("\x3cdiv\x3e"+this.content+"\x3c/div\x3e"),v=this.$tb_title=a.$("\x3cdiv class\x3d'titleStyleEna_layerctrl'\x3e\x3c/div\x3e");v.css({height:"6px"});this.defaultStyle={"border-style":"solid","border-color":"#101418","border-width":"1px",padding:"0px","font-size":"16px",color:"#000000",backgroundColor:"#FDFDFD"};this.contentStyle?Q.css(this.contentStyle):Q.css(this.defaultStyle);
if(this.title){this.title=this.title.replace(/\ /g,"\x26nbsp;");var ha=this.$titleDiv=a.$("\x3cdiv\x3e"+this.title+"\x3c/div\x3e");this.defaultTitleStyle={"border-style":"solid","border-color":"#391EA6","border-width":"1px",backgroundColor:"#0D0D0D","font-size":"18px","font-weight":"bold",color:"#FDFDFD"};this.titleStyle?ha.css(this.titleStyle):ha.css(this.defaultTitleStyle);S.append(this.$titleDiv)}S.append(Q);"ToolBar"===this.type&&this.draggable&&this.$DecorationDiv.append(v);this.$DecorationDiv.append(S);
this.width&&S.width(this.width);this.height&&S.height(this.height);this.width||(this.width=this.$DecorationDiv.width());this.height||(this.height=this.$DecorationDiv.height())}if("CustomHtmlDecoration"===this.type&&!this.mapType){S=a.$('\x3ctable border\x3d"0" cellspacing\x3d"0"\x3e');this.title&&(this.title=this.title.replace(/\ /g,"\x26nbsp;"),Q=a.$("\x3ctr\x3e\x3c/tr\x3e"),Q.appendTo(S),v=a.$("\x3ctd\x3e"+this.title+"\x3c/td\x3e"),v.appendTo(Q),this.titleStyle?v.css(this.titleStyle):v.addClass("defaultTitleStyle_noType"));
Q=a.$("\x3ctr\x3e\x3c/tr\x3e");Q.appendTo(S);var pa=a.$("\x3ctd id\x3d'content_td'\x3e"+this.content+"\x3c/td\x3e");0<pa.find("a").length&&pa.find("a").bind("touchstart",function(){c.location.href=pa.find("a").attr("href")});pa.appendTo(Q);this.contentStyle?pa.css(this.contentStyle):pa.addClass("defaultContentStyle_noType");this.collapsibleContainer=a.$("\x3cdiv id\x3d'_customContainer' \x3e\x3c/div\x3e");this.collapsibleContainer.css({display:"inline-flex",margin:"5px"});this.collapsibleContainer.append(S);
this.$DecorationDiv.append(this.collapsibleContainer);"ScaleBar"!==this.type&&(this.width=this.$DecorationDiv.width(),this.restoredHeight=this.height=this.$DecorationDiv.height(),this.restoredWidth=this.width);this.width&&S.width(this.width);this.height&&S.height(this.height);this.width||(this.width=this.$DecorationDiv.width());this.height||(this.height=this.$DecorationDiv.height())}this.collapsible&&(a.browser.touchSupported?(this.btnW=this.btnH=a.gv.decorationCollapseButtonSizeTouch,this.$DecorationBtnDiv=
a.$("\x3cdiv id\x3d'_DecorationBtnDiv' class\x3d'omv2_collapse_button'\x3e\x3cimg src\x3d'"+a.control.MapDecoration.getImage(this)+"' style\x3d'height:24px;width:24px'\x3e\x3c/div\x3e"),this.$DecorationBtnDiv.bind("touchstart",function(c){"OverviewMap"===b.type?b.collapsible&&(b.minimized?b.restore():b.collapse()):b.minimized?b.restore():b.collapse();a.event.EventSource.stopEvents[c.type]=!0})):(this.btnW=this.btnH=a.gv.decorationCollapseButtonSizeNoTouch,this.$DecorationBtnDiv=a.$("\x3cdiv id\x3d'_DecorationBtnDiv' class\x3d'omv2_collapse_button'\x3e\x3cimg src\x3d'"+
a.control.MapDecoration.getImage(this)+"' style\x3d'height:18px;width:18px'\x3e\x3c/div\x3e")),this.$DecorationBtnDiv.css({"z-index":"201",position:"relative"}),this.visible||this.$DecorationBtnDiv.css("display","none"),this.$DecorationBtnDiv.mouseover(function(c){c.target.src=!0===b.minimized?b.getMinimizeIcon():b.getRestoreIcon();a.event.EventSource.stopEvents[c.type]=!0}).mouseout(function(c){c.target.src=a.control.MapDecoration.getImage(b);a.event.EventSource.stopEvents[c.type]=!0}).click(function(c){b.collapsible&&
(b.minimized?b.restore():b.collapse());a.event.EventSource.stopEvents[c.type]=!0}),this.$DecorationBtnDiv.bind("dblclick mousemove mousedown",function(b){a.event.EventSource.stopEvents[b.type]=!0}),"OverviewMap"===this.type?this.$DecorationDiv.append(this.$DecorationBtnDiv[0],this.overviewMapDIV[0]):"CustomHtmlDecoration"===this.type||"LayerControl"===this.type?(this.$DecorationBtnDiv.css({position:"absolute"}),this.$DecorationDiv.css({"flex-direction":"column"}),this.$DecorationDiv.append(this.$DecorationBtnDiv)):
this.container.append(this.$DecorationBtnDiv));"Magnifier"===this.type&&(this.width&&this.$Content.width(this.width),this.height&&this.$Content.height(this.height),this.width||(this.width=this.$DecorationDiv.width()),this.height||(this.height=this.$DecorationDiv.height()));b=this;this.moveY=this.moveX=0;this.flag=!1;"LayerControl"===this.type&&(this.$title.mousedown(function(a){b.mousedown(a)}).mouseup(function(c){b.mouseup(c);a.event.EventSource.stopEvents[c.type]=!0}).dblclick(function(b){a.event.EventSource.stopEvents[b.type]=
!0}).mouseover(function(c){b.map.$oracleMapDiv.css("cursor","pointer");a.event.EventSource.stopEvents[c.type]=!0}).mouseout(function(c){b.map.$oracleMapDiv.css("cursor","default");a.event.EventSource.stopEvents[c.type]=!0}),this.$title.bind("touchstart",function(a){a.preventDefault();b.touchstart(a)}),this.$title.bind("touchend",function(a){a.stopPropagation();a.preventDefault();b.touchend(a)}),this.$Content.bind("touchmove touchstart touchend",function(a){a.stopPropagation();a.preventDefault()}),
this.$DecorationDiv.bind("mousedown mouseup mouseover mouseout mousewheel click dblclick",function(c){b.fire(c.type,c);a.event.EventSource.stopEvents[c.type]=!0}));if(a.isNull(this.type)||"Magnifier"===this.type||"ToolBar"===this.type||"CustomHtmlDecoration"===this.type)this.$tb_title&&this.$tb_title.mouseover(function(){b.dragging||(a.$(this).removeClass("titleStyleEna_layerctrl"),a.$(this).removeClass("titleStyleDwn_layerctrl"),a.$(this).addClass("titleStyleOvr_layerctrl"),a.$(this).css("cursor",
"move"))}).mouseout(function(){b.dragging||(a.$(this).removeClass("titleStyleOvr_layerctrl"),a.$(this).removeClass("titleStyleDwn_layerctrl"),a.$(this).addClass("titleStyleEna_layerctrl"),a.$(this).css("cursor","default"))}).mousedown(function(){a.$(this).removeClass("titleStyleOvr_layerctrl");a.$(this).removeClass("titleStyleEna_layerctrl");a.$(this).addClass("titleStyleDwn_layerctrl")}).mouseup(function(){a.$(this).removeClass("titleStyleDwn_layerctrl");a.$(this).removeClass("titleStyleEna_layerctrl");
a.$(this).addClass("titleStyleOvr_layerctrl")}),this.$DecorationDiv.bind("touchend",function(b){var c=this.lastTouchTimeStamp,v=b.timeStamp;this.lastTouchTimeStamp=v;500>v-c&&(a.event.EventSource.stopEvents[b.type]=!0)}),this.$DecorationDiv.bind("touchstart",function(a){b.touchstart(a)}),this.$DecorationDiv.mousedown(function(c){a.browser.chrome&&(c.offsetY>a.$(this).height()-21&&c.offsetY<a.$(this).height()||c.offsetX>a.$(this).width()-21)||a.browser.msie&&(c.offsetY>a.$(this).height()-17&&c.offsetY<
a.$(this).height()||c.offsetX>a.$(this).width()-17)||(a.$(this).css("cursor","default"),b.draggable&&a.$(this).css("cursor","move"),b.mousedown(c))}).mouseup(function(c){a.$(this).css("cursor","default");b.map.moveflag=!1;b.mouseup(c);a.event.EventSource.stopEvents[c.type]=!0}).scroll(function(c){b.mouseup(c);a.event.EventSource.stopEvents[c.type]=!0}),this.$DecorationDiv.bind("dblclick mouseover mouseout mousewheel click keyup keydown keypress",function(b){a.event.EventSource.stopEvents[b.type]=
!0});"OverviewMap"!==this.type&&(a.$(document).mouseup(function(a){b.mouseup(a)}),this.mapDiv_msmove=function(v){a.browser.msie&&1!==c.event.button&&b.mouseup(v);b.mousemove(v)},this.mapDiv_touchmove=function(a){a.stopPropagation();a.preventDefault();b.touchmove(a)},this.mapDiv_touchend=function(a){a.preventDefault();b.touchend(a)},this.map.$oracleMapDiv.mousemove(this.mapDiv_msmove),this.map.$oracleMapDiv.bind("touchmove",this.mapDiv_touchmove),this.map.$oracleMapDiv.bind("touchend",this.mapDiv_touchend));
a.isNull(this.type)&&this.map._decoration[this.type]&&this.map._decoration[this.type].$DecorationDiv.append(this.$DecorationDiv)},resize:function(){this.mapWidth=this.map.getMapContext().getDeviceWidth();this.mapHeight=this.map.getMapContext().getDeviceHeight()},mousedown:function(b){!a.isNull(this.map)&&this.draggable&&(this.dragDiv=!0,this.map.enableMapAction.drag&&(this.dragging=!0,this.map.enableMapDrag(!1),this.startX=parseInt(b.clientX),this.startY=parseInt(b.clientY),this.positionX=parseInt(this.$DecorationDiv.css("left")),
this.positionY=parseInt(this.$DecorationDiv.css("top")),this.dragStartFlag=!0,a.event.EventSource.stopEvents[b.type]=!0))},mousemove:function(b){this.parentMapHeight=this.map.getMapContext().getDeviceHeight();this.parentMapWidth=this.map.getMapContext().getDeviceWidth();this.height=this.$DecorationDiv.height();"LayerControl"===this.type&&(this.height=this.$Dom.height());if(this.dragging){if(!0===this.dragStartFlag){var c=new a.event.MapDecorationEvent(a.event.MapDecorationEvent.DRAG_START,this);this.fire(a.event.MapDecorationEvent.DRAG_START,
c);this.dragStartFlag=!1}this.moveX=this.positionX+b.clientX-this.startX;this.moveY=this.positionY+b.clientY-this.startY;this.$DecorationDiv.css("left",this.moveX);this.$DecorationDiv.css("top",this.moveY);this.top=this.moveY;c=new a.event.MapDecorationEvent(a.event.MapDecorationEvent.DRAG,this);this.fire(a.event.MapDecorationEvent.DRAG,c);a.event.EventSource.stopEvents[b.type]=!0}},mouseup:function(b){a.isNull(this.map)||(this.v_isDrag=this.dragDiv=this.flag=!1,!0===this.dragging&&this.startX!==
parseInt(b.clientX)&&this.startY!==parseInt(b.clientY)&&(b=new a.event.MapDecorationEvent(a.event.MapDecorationEvent.DRAG_END,this),this.fire(a.event.MapDecorationEvent.DRAG_END,b)),this.dragging&&(this.dragging=this.dragStartFlag=!1,this.map.enableMapDrag(!0)))},touchstart:function(b){if(!a.isNull(this.map)&&this.draggable&&(this.dragDiv=!0,this.map.enableMapAction.drag)){this.dragging=!0;this.map.enableMapDrag(!1);var c=a.util.DomUtil;this.touchCount=c.getTouchCount(b);if(!(2<this.touchCount)){var Q=
[];1===this.touchCount&&(b=c.getTouchesPosition(b),Q.push(b),this.touchStartX=parseInt(Q[0].x),this.touchStartY=parseInt(Q[0].y),this.touchPositionX=parseInt(this.$DecorationDiv.css("left")),this.touchPositionY=parseInt(this.$DecorationDiv.css("top")),this.dragStartFlag=!0)}}},touchmove:function(b){var c=a.util.DomUtil,Q=[];1===this.touchCount&&(c=c.getTouchesPosition(b),Q.push(c));this.dragging&&(!0===this.dragStartFlag&&(c=new a.event.MapDecorationEvent(a.event.MapDecorationEvent.DRAG_START,this),
this.fire(a.event.MapDecorationEvent.DRAG_START,c),this.dragStartFlag=!1),this.touchMoveX=this.touchPositionX+Q[0].x-this.touchStartX,this.touchMoveY=this.touchPositionY+Q[0].y-this.touchStartY,this.moveX=this.touchMoveX,this.moveY=this.touchMoveY,this.$DecorationDiv.css("left",this.touchMoveX),this.$DecorationDiv.css("top",this.touchMoveY),Q=new a.event.MapDecorationEvent(a.event.MapDecorationEvent.DRAG,this),this.fire(a.event.MapDecorationEvent.DRAG,Q),0>parseInt(this.$DecorationDiv.css("left"))&&
(this.$DecorationDiv.css("left","0px"),this.touchend(b)),0>parseInt(this.$DecorationDiv.css("top"))&&(this.$DecorationDiv.css("top","0px"),this.touchend(b)),this.parentMapWidth-parseInt(this.$DecorationDiv.css("left"))<this.width&&(this.$DecorationDiv.css("left",this.parentMapWidth-this.width),this.touchend(b)),this.parentMapHeight-parseInt(this.$DecorationDiv.css("top"))<this.height&&(this.$DecorationDiv.css("top",this.parentMapHeight-this.height),this.touchend(b)))},touchend:function(b){if(!a.isNull(this.map)){this.dragDiv=
this.flag=!1;var c=a.util.DomUtil,Q=[];1==this.touchCount&&(b=c.getTouchesPosition(b),Q.push(b));!0===this.dragging&&this.touchStartX!==parseInt(Q[0].x)&&this.touchStartY!==parseInt(Q[0].y)&&(Q=new a.event.MapDecorationEvent(a.event.MapDecorationEvent.DRAG_END,this),this.fire(a.event.MapDecorationEvent.DRAG_END,Q));this.dragging&&(this.dragging=this.dragStartFlag=!1,this.map.enableMapDrag(!0));this.map.touchStartLocs=[]}},touchscroll:function(b){var c,Q;a.browser.touchSupported&&(document.getElementById(b).addEventListener("touchstart",
function(a){c=a.targetTouches[0].pageX;Q=a.targetTouches[0].pageY;a.stopPropagation()},!1),document.getElementById(b).addEventListener("touchmove",function(a){a.preventDefault();a.stopPropagation();var b=Q-a.targetTouches[0].pageY;this.scrollLeft+=c-a.targetTouches[0].pageX;this.scrollTop+=b},!1))},delegate:function(b,c,Q){var v,ha=c instanceof Object?!0:!1;if(this.isHtml)if(v=this.$DecorationDiv,ha&&a.notNull(Q)){var pa=c.attr("id")||"selector_"+Math.random().toString().replace(/\./,0);c.attr("id",
pa);a.$(v).on(b,"#"+pa,Q)}else a.$(v).on(b,c,Q);else{v=this.defaultGroup;if(c&&"function"===typeof c)return this.delegate(b,v,c);pa=this.delegateListeners=this.delegateListeners||[];pa[b]=pa[b]||[];var ra=Q.id=Q.id||"fn_"+Math.random().toString().replace(/\./,0),Ca;Ca=function(a){for(var b=a.target.getAncestors(),v=b.length-1;0<v&&(ha?b[v]===c&&(a.delegateTarget=b[v],Q.call(null,a)):b[v].queryType&&-1!=b[v].queryType.indexOf("#"+c)&&(a.delegateTarget=b[v],Q.call(null,a)),b[v]!==a.currentTarget);v--);
};Ca.id=ra;v.addEventListener(b,Ca);pa[b].push(Ca)}return this},unDelegate:function(b,c,Q){var v;b=b||"mouseover mouseout mousemove mousedown mouseup click dblclick";var ha=c instanceof Object?!0:!1;if(this.isHtml)if(v=this.$DecorationDiv,ha){var pa=c.attr("id");a.$(v).off(b,"#"+pa,Q)}else a.$(v).off(b,c,Q);else if(this.defaultGroup)for(v=this.defaultGroup,c=this.delegateListeners,b=b.split(" "),ha=0;ha<b.length;ha++){var ra=b[ha];if(v.listeners&&v.listeners[ra])if(Q){for(var Ca=0;Ca<c[ra].length;Ca++)if(c[ra][Ca].id===
Q.id){pa=c[ra][Ca];c[ra].splice(Ca,1);break}v.removeEventListener(ra,pa)}else v.listeners[ra]=[],this.delegateListeners[ra]=[]}return this},getRestoreIcon:function(){switch(this.anchorPosition||1){case 1:return a.control.MapDecoration.BUTTON_RESTORE_TOP_LEFT;case 2:return a.control.MapDecoration.BUTTON_RESTORE_TOP_LEFT;case 3:return a.control.MapDecoration.BUTTON_RESTORE_TOP_RIGHT;case 4:return a.control.MapDecoration.BUTTON_RESTORE_LOWER_LEFT;case 5:return a.control.MapDecoration.BUTTON_RESTORE_LOWER_LEFT;
case 6:return a.control.MapDecoration.BUTTON_RESTORE_LOWER_RIGHT}},getMinimizeIcon:function(){switch(this.anchorPosition||1){case 1:return a.control.MapDecoration.BUTTON_MINIMIZE_TOP_LEFT;case 2:return a.control.MapDecoration.BUTTON_MINIMIZE_TOP_LEFT;case 3:return a.control.MapDecoration.BUTTON_MINIMIZE_TOP_RIGHT;case 4:return a.control.MapDecoration.BUTTON_MINIMIZE_LOWER_LEFT;case 5:return a.control.MapDecoration.BUTTON_MINIMIZE_LOWER_LEFT;case 6:return a.control.MapDecoration.BUTTON_MINIMIZE_LOWER_RIGHT}},
collapse:function(){if(!this.inAnimation&&!this.minimized&&this.collapsible){var b=new a.event.MapDecorationEvent(a.event.MapDecorationEvent.BEFORE_COLLAPSE,this);this.fire(b.type,b);this.collapsibleContainer.detach();this.inAnimation=!1;this.minimized=!0;this.$DecorationBtnDiv.children("img").attr("src",this.getMinimizeIcon())}},restore:function(){this.collapsible&&(this.minimized=this.inAnimation=!1,this.$DecorationDiv.append(this.collapsibleContainer,this.$DecorationBtnDiv),this.$DecorationBtnDiv.children("img").attr("src",
this.getRestoreIcon()))},isVisible:function(){return this.visible}});a.control.MapDecoration.POSITION_UPPER_LEFT=1;a.control.MapDecoration.POSITION_UPPER_CENTER=2;a.control.MapDecoration.POSITION_UPPER_RIGHT=3;a.control.MapDecoration.POSITION_LOWER_LEFT=4;a.control.MapDecoration.POSITION_LOWER_CENTER=5;a.control.MapDecoration.POSITION_LOWER_RIGHT=6;a.control.MapDecoration.setIconsPath=function(){var b=a.gv.resourcePath(),c=a.control.MapDecoration;c.OVER_VIEW_ICON=b+"overviewicon.gif";c.BUTTON_MINIMIZE_LOWER_LEFT=
b+"button_minimize_l.gif";c.BUTTON_RESTORE_LOWER_LEFT=b+"button_restore_l.gif";c.BUTTON_MINIMIZE_LOWER_RIGHT=b+"button_minimize.gif";c.BUTTON_RESTORE_LOWER_RIGHT=b+"button_restore.gif";c.BUTTON_MINIMIZE_TOP_LEFT=b+"button_restore.gif";c.BUTTON_RESTORE_TOP_LEFT=b+"button_minimize.gif";c.BUTTON_MINIMIZE_TOP_RIGHT=b+"button_restore_l.gif";c.BUTTON_RESTORE_TOP_RIGHT=b+"button_minimize_l.gif";c.MAGNIFIER=b+"func_search_16_ena.png";c.TH_BG_S=b+"th_bg_s.png"};a.control.MapDecoration.setIconsPath();a.control.MapDecoration.setCustomIcons=
function(b){b&&(b.overview&&(a.control.MapDecoration.OVER_VIEW_ICON=b.overview),b.minimize&&(a.control.MapDecoration.BUTTON_MINIMIZE=b.minimize),b.restore&&(a.control.MapDecoration.BUTTON_RESTORE=b.restore),b.magnifier&&(a.control.MapDecoration.MAGNIFIER=b.magnifier))};a.control.MapDecoration.getImage=function(b){return"Magnifier"==b.type?a.control.MapDecoration.MAGNIFIER:a.control.MapDecoration.OVER_VIEW_ICON};a.control.NavigationPanelBar=a.control.MapDecoration.extend({initialize:function S(b){S.base.call(this,
"no content",a.$.extend({},b));b=b?b:{};this.isInternal=!0;this.type="NavigationPanelBar";a.isNull(this.anchorPosition)&&(this.anchorPosition=a.control.MapDecoration.POSITION_UPPER_LEFT);this.style=a.control.NavigationPanelBar.STYLE_ZOOM_BUTTONS_ONLY;a.notNull(b.style)&&(this.style=parseInt(b.style),1>this.style||4<this.style)&&(a.util.Logger.warning("","OM.control.NavigationPanelBar.initialize","style value is out of range, default value is used."),this.style=a.control.NavigationPanelBar.STYLE_ZOOM_BUTTONS_ONLY);
a.notNull(b.infoTips)&&(this.infoTips=b.infoTips);a.isNull(b.offsetX)?this.left=this.getOffset().offsetX:this.left=b.offsetX;a.isNull(b.offsetY)?this.top=this.getOffset().offsetY:this.top=b.offsetY;this.tipTimer=new a.util.TimerManager;this.centerCss={"margin-left":"auto","margin-right":"auto",display:"inline-block"};this.borderAndBackgroundCss={"border-style":"solid","border-width":"1px","border-color":"#dddddd","border-radius":"2px","background-color":"#fefefe",opacity:"0.75"};this.zoomInFont="\ue65c";
this.zoomOutFont="\ue65d";this.defaultColor="#878c90";this.hoverColor="#85bbe7";this.disabledColor="#c3c3c3"},getButtons:function(b){a.isNull(this.buttons)&&(this.buttons=[{name:"up",img:"func_shuffleup_16_btn_ena.png",img_hov:"func_shuffleup_16_btn_hov.png",css:{top:"0px",left:"20px"}},{name:"right",img:"func_shuffleright_16_btn_ena.png",img_hov:"func_shuffleright_16_btn_hov.png",css:{right:"0px",top:"20px"}},{name:"down",img:"func_shuffledown_16_btn_ena.png",img_hov:"func_shuffledown_16_btn_hov.png",
css:{bottom:"0px",left:"20px"}},{name:"left",img:"func_shuffleleft_16_btn_ena.png",img_hov:"func_shuffleleft_16_btn_hov.png",css:{left:"0px",top:"20px"}}]);return a.isNull(b)?this.buttons:this.buttons[b]},display:function Q(b,c){Q.base.call(this,b,c);var pa=this,ra=this.map;if(ra.displayed||ra.getMapContext().getZoomLevel())pa.$DecorationDiv.css({"text-align":"center"}),pa.hasPanel()&&pa.$DecorationDiv.append(pa.createPanHtml()),(pa.hasZoombar()||pa.hasZoombtn())&&pa.$DecorationDiv.append(pa.createZoomHtml()),
ra.navigationPanelBar=pa,0!==pa.$DecorationDiv.width()&&(pa.width=pa.$DecorationDiv.width(),pa.height=pa.$DecorationDiv.height()),(!1===this.anchored||1>this.anchorPosition||6<this.anchorPosition)&&this.setPosition(),pa.hasZoombar()&&(pa.recenter=function(){pa.updateBarByLevel()},ra.on(a.event.MapEvent.I_MAP_CENTER_ZOOM,this.recenter,this),pa.recenter()),pa.hasZoombtn()&&(pa.updateIamge=function(){var b=pa.map.getMapContext(),c=b.getUniverse().getZoomLevelNumber(),b=b.getZoomLevel();0===b?(a.util.DomUtil.setFontIcon(a.$(pa.zoomOut).find("div"),
pa.zoomOutFont,pa.disabledColor),a.$(this.zoomOut).css("cursor","")):(a.util.DomUtil.setFontIcon(a.$(pa.zoomOut).find("div"),pa.zoomOutFont,pa.defaultColor),a.$(this.zoomOut).css("cursor","pointer"));b===c-1?(a.util.DomUtil.setFontIcon(a.$(pa.zoomIn).find("div"),pa.zoomInFont,pa.disabledColor),a.$(this.zoomIn).css("cursor","")):(a.util.DomUtil.setFontIcon(a.$(pa.zoomIn).find("div"),pa.zoomInFont,pa.defaultColor),a.$(this.zoomIn).css("cursor","pointer"))},ra.on(a.event.MapEvent.I_MAP_CENTER_ZOOM,pa.updateIamge,
this),ra.on(a.event.MapEvent.MAP_RESIZED,function(){this.anchorPosition&&this.setAnchorPosition(this.anchorPosition)}.bind(this)),pa.updateIamge())},setPosition:function(b,c){a.notNull(b)&&a.notNull(c)&&(this.anchored=!1);a.isNull(this.$DecorationDiv)&&(this.$DecorationDiv=a.$("\x3cdiv onselectstart\x3d'return false'\x3e\x3c/div\x3e"),this.$DecorationDiv.attr("id",this.id));1<=b&&(b=parseInt(b));1<=c&&(c=parseInt(c));this.X=b||this.X;this.Y=c||this.Y;this.map&&this.parentMapWidth&&(1>this.X&&0<this.X&&
(this.X*=this.parentMapWidth,this.relativePosition=!0),1>this.Y&&0<this.Y&&(this.Y*=this.parentMapHeight,this.relativePosition=!0));a.notNull(this.$DecorationDiv)&&this.$DecorationDiv.css({top:this.Y,left:this.X,bottom:"",right:""})},createPanHtml:function(){for(var b=this,c={cursor:"pointer",position:"absolute",width:"16px",height:"16px"},ha=a.$.extend({},b.borderAndBackgroundCss,{width:"56px",height:"56px",margin:5,position:"relative","border-radius":"28px",cursor:"pointer"}),ha=a.$("\x3cdiv\x3e\x3c/div\x3e").css(ha),
pa=this.getButtons(),ra=this.map.getMapContext(),Ca=.25*(ra.getDeviceHeight()+ra.getDeviceWidth()),va=this.map,Da=0;Da<pa.length;Da++){var Aa=b.setBackground(a.$("\x3cdiv\x3e\x3c/div\x3e").css(c).css(pa[Da].css),pa[Da].img);(function(){var c=pa[Da],v=Da;Aa.hover(function(){b.setBackground(a.$(this),c.img_hov)},function(){b.setBackground(a.$(this),c.img)});Aa.click(function(){0===v?va.pan(0,Ca,!1):1===v?va.pan(-Ca,0,!1):2===v?va.pan(0,-Ca,!1):3===v&&va.pan(Ca,0,!1)})})();ha.append(Aa)}return ha},createZoomHtml:function(){var b=
this,c=this.map,ha=a.$.extend({},b.borderAndBackgroundCss,{"border-radius":"2px 2px 2px 2px",cursor:"pointer"}),pa={width:"26px",height:"26px","background-position":"center",margin:"0px","text-align":"center","line-height":"26px"},ra=this.centerCss,ra=a.$("\x3cdiv\x3e\x3c/div\x3e").css(ra),Ca=a.$("\x3cdiv\x3e\x3c/div\x3e").css(pa),pa=a.$("\x3cdiv\x3e\x3c/div\x3e").css(pa);a.util.DomUtil.setFontIcon(pa,b.zoomOutFont,b.defaultColor);a.util.DomUtil.setFontIcon(Ca,b.zoomInFont,b.defaultColor);Ca=a.$('\x3cdiv id\x3d"zoomin_'+
this._randomId+'"\x3e\x3c/div\x3e').css(ha).append(Ca);ha=a.$('\x3cdiv id\x3d"zoomout_'+this._randomId+'"\x3e\x3c/div\x3e').css(ha).append(pa);b.zoomIn=Ca;b.zoomOut=ha;b.style===a.control.NavigationPanelBar.STYLE_ZOOM_BUTTONS_ONLY&&Ca.css({"margin-bottom":"5px"});Ca.hover(function(){b.zoomdisabled(!0)||a.util.DomUtil.setFontIcon(a.$(this).find("div"),b.zoomInFont,b.hoverColor)},function(){b.zoomdisabled(!0)||a.util.DomUtil.setFontIcon(a.$(this).find("div"),b.zoomInFont,b.defaultColor)});Ca.on("touchend click",
function(a){b.zoomdisabled(!0)||(a.preventDefault(),c.zoomIn())});ha.hover(function(){b.zoomdisabled()||a.util.DomUtil.setFontIcon(a.$(this).find("div"),b.zoomOutFont,b.hoverColor)},function(){b.zoomdisabled()||a.util.DomUtil.setFontIcon(a.$(this).find("div"),b.zoomOutFont,b.defaultColor)});ha.on("touchend click",function(a){b.zoomdisabled()||(a.preventDefault(),c.zoomOut())});if(b.hasZoombar())ra.on("mouseover",function(){b.tipTimer.schedule("tip",2E3,function(){b.tipContainer.fadeOut()});b.tipContainer.show()});
b.hasZoombtn()&&ra.append(Ca);b.hasZoombar()&&ra.append(b.createBarHtml());b.hasZoombtn()&&ra.append(ha);return b.zoomContainer=ra},zoomdisabled:function(a){var b=this.map.getMapContext(),c=b.getZoomLevel(),b=b.getUniverse().getZoomLevelNumber();return!0===a?c===b-1:0===c},createBarHtml:function(){var b=this,c=a.$("\x3cdiv\x3e\x3c/div\x3e").css({position:"relative",top:0,left:0,bottom:0,right:0,height:"100px"}),ha=b.setBackground(a.$("\x3cdiv\x3e\x3c/div\x3e"),"func_zoomout_16_btn_ena.png").css({width:"16px",
height:"12px","margin-left":"auto","margin-right":"auto","background-position":"center"}),pa=a.$("\x3cdiv\x3e\x3c/div\x3e").css({width:3,height:"98px",cursor:"pointer"}).css(this.centerCss).css(this.borderAndBackgroundCss),ra=a.$("\x3cdiv\x3e\x3c/div\x3e").css({position:"absolute",cursor:"pointer",top:0,left:5,bottom:0,width:"16px",height:"12px"}).css(this.centerCss).css(this.borderAndBackgroundCss);ra.append(ha);ra.hover(function(){b.setBackground(a.$(this).find("div"),"func_zoomout_16_btn_hov.png")},
function(){b.setBackground(a.$(this).find("div"),"func_zoomout_16_btn_ena.png")});var Ca,va,Da;ra.on("mousedown",function(a){Ca=!0;va=a.clientY;Da=ra.position().top});ra.on("mouseup",function(){!0===Ca&&b.updateBar();Ca=!1});ra.on("mousemove",function(a){!0===Ca&&b.updateBarPos(Da+a.clientY-va)});pa.on("mousedown",function(a){b.updateBarPos(a.offsetY);b.updateBar()});b.draggerBarContainer=ra;c.append(pa).append(ra).append(b.createTips());return c},createTips:function(){var b=this,c=a.$("\x3cdiv\x3e\x3c/div\x3e").css({position:"absolute",
top:0,left:"5px",display:"none"}),ha={position:"absolute","border-radius":"1px",left:"20px","z-index":1,"text-align":"left",cursor:"pointer"},pa;for(pa in this.infoTips)if(!(0>parseInt(pa))){var ra=a.$("\x3cdiv\x3e\x3c/div\x3e").css(ha);ra.attr("maplevel",pa);ra.on("click",function(){b.map.setMapZoomLevel(a.$(this).attr("maplevel"))});ra.hover(function(){a.$(this).parent().find("\x3ediv").css({"z-index":1,"font-weight":"normal"});a.$(this).css({"z-index":2,"font-weight":"bold"});b.tipTimer.cancel("tip")},
function(){a.$(this).parent().find("\x3ediv").css({"z-index":1,"font-weight":"normal"});b.tipTimer.schedule("tip",2E3,function(){b.tipContainer.fadeOut()})});ra.on("mouseover",function(){return!1});ra.css({top:this.levelToTop(pa)+"px"});var Ca=a.$("\x3cdiv\x3e\x3c/div\x3e").css({"line-height":"15px",position:"absolute",left:"15px"}).css(b.borderAndBackgroundCss).css({"border-left":""}).html(this.infoTips[pa]),va=b.setBackground(a.$("\x3cdiv\x3e\x3c/div\x3e"),"arrow.png").css({width:"15px",height:"15px",
position:"absolute",top:0,opacity:"0.85"});ra.append(va).append(Ca);c.append(ra)}return b.tipContainer=c},updateBarPos:function(a){var b=this.draggerBarContainer.height(),c=this.draggerBarContainer.parent().height()-2;a=Math.max(0,Math.min(a,c-b));this.draggerBarContainer.css("top",a)},levelToTop:function(b){var c=this.map.getMapContext(),ha=c.getUniverse().getZoomLevelNumber();a.isNull(b)&&(b=c.getZoomLevel());b=Math.max(0,Math.min(b,ha-1));c=this.draggerBarContainer.height();return(this.draggerBarContainer.parent().height()-
2-c)*(ha-b-1)/(ha-1)},updateBar:function(){var a=this.map.getMapContext().getUniverse().getZoomLevelNumber(),b=this.draggerBarContainer.height(),c=this.draggerBarContainer.parent().height()-2,pa=this.draggerBarContainer.position().top;this.updateBarByLevel(a-1-parseInt(pa/(c-b)*(a-1)))},updateBarByLevel:function(b){var c=!0,ha=this.map.getMapContext(),pa=ha.getUniverse().getZoomLevelNumber();a.isNull(b)&&(b=ha.getZoomLevel(),c=!1);b=Math.max(0,Math.min(b,pa-1));ha=this.draggerBarContainer.height();
pa=(this.draggerBarContainer.parent().height()-2-ha)*(pa-b-1)/(pa-1);this.draggerBarContainer.css("top",pa);!0===c&&this.map.setMapZoomLevel(b)},setBackground:function(b,c){b.css({background:'url("'+a.gv.resourcePath()+"navicontrol/"+c+'") no-repeat',"background-position":"center"});return b},setZoomLevelInfoTips:function(a){this.infoTips=a},setStyle:function(b){a.isNull(b)||(a.notNull(b.position)&&this.setPosition(b.position.left,b.position.top),a.notNull(b.backgroundColor)&&a.$.extend(this.borderAndBackgroundCss,
{"background-color":b.backgroundColor}),a.notNull(b.borderColor)&&a.$.extend(this.borderAndBackgroundCss,{"border-color":b.borderColor}))},remove:function v(){v.base.call(this);this.map.navigationPanelBar=null;this.map.deleteListener(a.event.MapEvent.I_MAP_CENTER_ZOOM,this.recenter,this)},hasPanel:function(){switch(this.style){case a.control.NavigationPanelBar.STYLE_FULL:return!0;case a.control.NavigationPanelBar.STYLE_ZOOM_ONLY:return!1;case a.control.NavigationPanelBar.STYLE_ZOOM_BUTTONS_ONLY:return!1;
case a.control.NavigationPanelBar.STYLE_PAN_ONLY:return!0}},hasZoombar:function(){switch(this.style){case a.control.NavigationPanelBar.STYLE_FULL:return!0;case a.control.NavigationPanelBar.STYLE_ZOOM_ONLY:return!0;case a.control.NavigationPanelBar.STYLE_ZOOM_BUTTONS_ONLY:return!1;case a.control.NavigationPanelBar.STYLE_PAN_ONLY:return!1}},hasZoombtn:function(){switch(this.style){case a.control.NavigationPanelBar.STYLE_FULL:return!0;case a.control.NavigationPanelBar.STYLE_ZOOM_ONLY:return!0;case a.control.NavigationPanelBar.STYLE_ZOOM_BUTTONS_ONLY:return!0;
case a.control.NavigationPanelBar.STYLE_PAN_ONLY:return!1}},getOffset:function(){switch(this.style){case a.control.NavigationPanelBar.STYLE_FULL:return{offsetX:0,offsetY:0};case a.control.NavigationPanelBar.STYLE_ZOOM_ONLY:return{offsetX:10,offsetY:10};case a.control.NavigationPanelBar.STYLE_ZOOM_BUTTONS_ONLY:return{offsetX:0,offsetY:0};case a.control.NavigationPanelBar.STYLE_PAN_ONLY:return{offsetX:0,offsetY:0}}}});a.control.NavigationPanelBar.STYLE_FULL=1;a.control.NavigationPanelBar.STYLE_ZOOM_ONLY=
2;a.control.NavigationPanelBar.STYLE_ZOOM_BUTTONS_ONLY=3;a.control.NavigationPanelBar.STYLE_PAN_ONLY=4;a.control.NavigationPanelBar.ORIENTATION_VERTICAL=1;a.control.NavigationPanelBar.ORIENTATION_HORIZONTAL=2;a.control.CopyRight=a.control.MapDecoration.extend({initialize:function ha(b){ha.base.call(this,"no content",a.$.extend({},{offsetX:0,offsetY:0},b));this.isInternal=!0;this.anchorPosition=a.control.MapDecoration.POSITION_LOWER_RIGHT;this.anchored=!0;this.fontSize=12;this.textValue="";this.type=
"CopyRight";b&&(this.textValue=b.textValue?b.textValue:"",this.anchorPosition=b.anchorPosition?b.anchorPosition:a.control.MapDecoration.POSITION_LOWER_CENTER,this.fontSize=b.fontSize?b.fontSize:12,this.fontFamily=b.fontFamily?b.fontFamily:"Tahoma",this.fill=b.fontColor?b.fontColor:"black")},setStyle:function(a){a&&(a.fontSize&&(this.fontSize=a.fontSize),a.fontFamily&&(this.fontFamily=a.fontFamily),a.fontColor&&(this.fill=a.fontColor))},display:function pa(a,b){pa.base.call(this,a,b);this.$DecorationDiv.empty();
this.$DecorationDiv=this.createHtml();this.setAnchorPosition(this.anchorPosition)},createHtml:function(){return this.createDiv()},createDiv:function(){var b=a.$('\x3cdiv class\x3d"cpdiv"\x3e\x3c/div\x3e').css({"font-size":this.fontSize,"font-family":this.fontFamily,color:this.fill,"white-space":"nowrap",display:"inline-flex","align-items":"baseline",position:"absolute","z-index":6});b.html(this.textValue);b.wrapInner('\x3cspan style\x3d"background-color: white; opacity:0.7; width:100%"\x3e\x3c/span\x3e');
return b},remove:function ra(){ra.base.call(this);this.map.CopyRight=null}});a.control.DrawerPanel=a.Class.extend({initialize:function(b,c){var va=this,Da=(new Date).getTime();this.title=b.title;this.ID="omv2_drp_"+Da;this.drawer=c;this.editPanel=null;this.panelTab=a.$("\x3cli\x3e\x3c/li\x3e");this.panelTab.id=this.ID;this.panelTab.addClass("omv2_drp_drawer_tabs");this.singleTabContainer=a.$("\x3cdiv\x3e\x3c/div\x3e");this.singleTabContainer.id="omv2_drp_singleTabContainer_"+Da;this.singleTabContainer.addClass("omv2_drp_single_tab_container");
this.singleTabContainer.appendTo(this.panelTab);this.singleTabContainer_a=a.$("\x3ca\x3e\x3c/a\x3e");this.singleTabContainer_a.id="omv2_drp_singleTabContainer_a_"+Da;this.singleTabContainer_a.href="#";this.singleTabContainer_a.role="presentation";this.singleTabContainer_a.tabindex=-1;this.singleTabContainer_a.appendTo(this.singleTabContainer);this.tabHeader=a.$("\x3cdiv\x3e\x3c/div\x3e");this.tabHeader.id="omv2_drp_tabHeader_"+Da;this.tabHeader.addClass("omv2_drp_tab_header");this.tabHeader.appendTo(this.singleTabContainer_a);
if(b.mode===a.control.DrawerPanel.TEXT_AND_ICON||b.mode===a.control.DrawerPanel.ICON_ONLY)this.tabHeader_icon=a.$("\x3cspan\x3e\x3c/span\x3e",{title:va.title}),this.tabHeader_icon.id="omv2_drp_tabHeader_icon_"+Da,this.tabHeader_icon.role="img",b.urlIcon&&null!==b.urlIcon?(this.tabHeader_icon.css("width","21px"),this.tabHeader_icon.css("height","21px"),this.tabHeader_icon.css("display","inline-block"),this.tabHeader_icon.css("vertical-align","middle"),this.tabHeader_icon.css("background-image","url("+
b.urlIcon+")"),this.tabHeader_icon.css("background-repeat","no-repeat"),this.tabHeader_icon.css("background-size","contain")):b.altaIcon&&null!==b.altaIcon&&this.tabHeader_icon.addClass("omv2_drp_tab_header_icon "+b.altaIcon),this.tabHeader_icon.appendTo(this.tabHeader);this.tabHeader_title=null;if(b.mode===a.control.DrawerPanel.TEXT_AND_ICON||b.mode===a.control.DrawerPanel.TEXT_ONLY)this.tabHeader_title=a.$("\x3cspan\x3e\x3c/span\x3e"),this.tabHeader_title.id="omv2_drp_tabHeader_title"+Da,this.tabHeader_title.addClass("omv2_drp_tab_header_title"),
this.tabHeader_title.appendTo(this.tabHeader),this.tabHeader_title.text(b.title);this.tabHeader_closeIcon=a.$("\x3cspan\x3e\x3c/span\x3e");this.tabHeader_closeIcon.id="omv2_drp_tabHeader_closeIcon"+Da;this.tabHeader_closeIcon.addClass("omv2_drp_tab_header_close_icon");this.tabHeader_closeIcon.appendTo(this.tabHeader);this.panelContent=a.$("\x3cdiv\x3e\x3c/div\x3e");this.panelContent.id||(this.panelContent.id="omv2_drp_panel_"+Da);this.panelContent.addClass("omv2_drp_drawer_tabs_content");b.panelDiv&&
a.isNotNull(b.panelDiv)&&b.panelDiv.appendTo(this.panelContent);this.tabHeader_closeIcon.click(function(){va.panelTab.remove();va.panelContent.remove();va.drawer.updateScrollButtons();"edit_panel"===b.type&&va.drawer.removeEditPanel()})},getID:function(){return this.ID},getTitle:function(){return this.title},getPanelTab:function(){return this.panelTab},getPanelContent:function(){return this.panelContent},getSingleTabContainer:function(){return this.singleTabContainer},getTabHeaderTitle:function(){return this.tabHeader_title}});
a.control.DrawerPanel.ICON_ONLY=1;a.control.DrawerPanel.TEXT_ONLY=2;a.control.DrawerPanel.TEXT_AND_ICON=3;a.control.DrawerPanel.ALTA_ICON_HOME="home";a.control.DrawerPanel.ALTA_ICON_TOOLS="tools";a.control.Drawer=a.Class.extend({mixin:a.event.EventSource,initialize:function(b,c){var va=this;a.isNull(c)?(c={},c.width=a.control.Drawer.MINIMUM_WIDTH,c.height=a.control.Drawer.MINIMUM_HEIGHT,c.position=a.control.Drawer.LEFT):(c.width||(c.width=a.control.Drawer.MINIMUM_WIDTH),c.height||(c.height=a.control.Drawer.MINIMUM_HEIGHT),
c.position||(c.position=a.control.Drawer.LEFT));this.parentID=b;this.minWidth=a.control.Drawer.MINIMUM_WIDTH;this.minHeight=a.control.Drawer.MINIMUM_HEIGHT;this.fixedTabWidth=a.control.Drawer.TAB_SIZE;this.tabBarPosition=c.position;var Da=(new Date).getTime();this.parent=a.$("#"+b);this.drawerID="omv2_drawer__"+Da;this.visible=!1;this.width=Math.max(c.width,this.minWidth);this.height=Math.max(c.height,this.minHeight);this.position=c.position;this.direction=this.position===a.control.Drawer.LEFT?"left":
"right";this.drawerContainer=a.$("\x3cdiv\x3e\x3c/div\x3e");this.drawerContainer.id=this.drawerID;this.drawerContainer.addClass("omv2_drawer_container");this.drawerContainer.css("width",this.width+"px");this.drawerContainer.css("height",this.height+"px");this.drawerContainer.css("display","none");this.drawerContainer.draggable({containment:"parent",cursor:"move",handle:".omv2_drawer_title_container"});this.drawerContainer.resizable({minWidth:this.minWidth,minHeight:this.minHeight,handles:"sw, se"});
this.drawerIcon=a.$("\x3cdiv\x3e\x3c/div\x3e");this.drawerIcon.id="omv2_drawer_icon_"+Da;this.drawerIcon.addClass("omv2_drawer_circle");this.drawerContainer.appendTo(this.parent);this.drawerIcon.appendTo(this.parent);this.setPosition(this.position);this.drawerIcon.click(function(){va.showDrawer()});this.titleContainer=a.$("\x3cdiv\x3e\x3c/div\x3e");this.titleContainer.id="omv2_drawer_title_container_"+Da;this.titleContainer.addClass("omv2_drawer_title_container");this.titleContainer.appendTo(this.drawerContainer);
var Aa=a.$("\x3cdiv\x3e\x3c/div\x3e");Aa.addClass("omv2_drawer_title_div");Aa.appendTo(this.titleContainer);a.$("\x3cspan\x3e\x3c/span\x3e",{text:"Editing Tool Panel"}).appendTo(Aa);Aa=a.$("\x3cdiv\x3e\x3c/div\x3e");Aa.addClass("omv2_drawer_title_close_icon_div");Aa.appendTo(this.titleContainer);var Sa=a.$("\x3cspan\x3e\x3c/span\x3e");Sa.addClass("omv2_drawer_title_close_icon_span");Sa.bind("click",function(){va.hideDrawer()});Sa.appendTo(Aa);this.tabAndContentContainer=a.$("\x3cdiv\x3e\x3c/div\x3e");
this.tabAndContentContainer.id="omv2_drawer_tabAndContentContainer_"+Da;this.tabAndContentContainer.addClass("omv2_drawer_tab_and_content_container");this.tabAndContentContainer.appendTo(this.drawerContainer);Aa=a.$("\x3cdiv\x3e\x3c/div\x3e");Aa.addClass("omv2_drawer_tab_bar");Aa.appendTo(this.tabAndContentContainer);this.leftArrow_div=a.$("\x3cdiv\x3e\x3c/div\x3e");this.leftArrow_div.addClass("omv2_drawer_tabs_arrow_div");this.leftArrow_div.appendTo(Aa);this.leftArrow_icon=a.$("\x3cspan\x3e\x3c/span\x3e");
this.leftArrow_icon.addClass("omv2_drawer_left_arrow_icon");this.leftArrow_icon.css("visibility","hidden");this.leftArrow_icon.appendTo(this.leftArrow_div);this.leftArrow_icon.click(function(){va.moveTabsToLeft()});this.tabContainer=a.$("\x3cdiv\x3e\x3c/div\x3e");this.tabContainer.id="omv2_drawer_tabContainer_"+Da;this.tabContainer.addClass("omv2_drawer_tabs_container");this.tabContainer.appendTo(Aa);this.rightArrow_div=a.$("\x3cdiv\x3e\x3c/div\x3e");this.rightArrow_div.addClass("omv2_drawer_tabs_arrow_div");
this.rightArrow_div.appendTo(Aa);this.rightArrow_icon=a.$("\x3cspan\x3e\x3c/span\x3e");this.rightArrow_icon.addClass("omv2_drawer_right_arrow_icon");this.rightArrow_icon.css("visibility","hidden");this.rightArrow_icon.appendTo(this.rightArrow_div);this.rightArrow_icon.click(function(){va.moveTabsToRight()});this.tabTable=a.$("\x3cdiv\x3e\x3c/div\x3e");this.tabTable.id="omv2_drawer_tabTable_"+Da;this.tabTable.css("display","table");this.tabTable.appendTo(this.tabContainer);Sa=a.$("\x3cdiv\x3e\x3c/div\x3e");
Sa.id="omv2_drawer_tabTableRow_"+Da;Sa.css("display","table-row");Sa.appendTo(this.tabTable);Aa=a.$("\x3cdiv\x3e\x3c/div\x3e");Aa.id="omv2_drawer_tabTableRow_"+Da;Aa.css("display","table-cell");Aa.appendTo(Sa);Sa=a.$("\x3cdiv\x3e\x3c/div\x3e");Sa.id="omv2_drawer_cellContainer_"+Da;Sa.css("overflow","hidden");Sa.css("display","inline_block");Sa.css("position","relative");Sa.css("vertical-align","top");Sa.css("margin-bottom","0px");Sa.appendTo(Aa);Aa=a.$("\x3cdiv\x3e\x3c/div\x3e");Aa.id="omv2_drawer_cellContainerChild_"+
Da;Aa.css("display","inline_block");Aa.css("position","relative");Aa.appendTo(Sa);Sa=a.$("\x3cdiv\x3e\x3c/div\x3e");Sa.id="omv2_drawer_tabInnerTable_"+Da;Sa.css("display","table");Sa.appendTo(Aa);Aa=a.$("\x3cdiv\x3e\x3c/div\x3e");Aa.id="omv2_drawer_tabInnerRow_"+Da;Aa.css("display","table-row");Aa.appendTo(Sa);Sa=a.$("\x3cdiv\x3e\x3c/div\x3e");Sa.id="omv2_drawer_tabInnerCell_"+Da;Sa.css("display","table-cell");Sa.appendTo(Aa);this.tabListContainer=a.$("\x3cdiv\x3e\x3c/div\x3e");this.tabListContainer.id=
"omv2_drawer_tabListContainer_"+Da;this.tabListContainer.addClass("omv2_drawer_tabs_list_container");this.tabListContainer.appendTo(Sa);this.tabList=a.$("\x3cul\x3e\x3c/ul\x3e");this.tabList.id="omv2_drawer_tabList_"+Da;this.tabList.addClass("omv2_drawer_tabs-list");this.tabList.appendTo(this.tabListContainer)},moveTabsToRight:function(){var a=0,a=this.fixedTabWidth,b=this.tabContainer.width(),c=this.tabListContainer.width()-this.tabBarPosition;c<=b||(a=Math.min(a,c-b),this.tabListContainer.animate({marginLeft:"-\x3d"+
a}),this.tabBarPosition+=a,this.updateScrollButtons())},moveTabsToLeft:function(){var a=0,a=this.fixedTabWidth,b=this.tabBarPosition;0>=b||(a=Math.min(a,b),this.tabListContainer.animate({marginLeft:"+\x3d"+a}),this.tabBarPosition-=a,this.updateScrollButtons())},updateScrollButtons:function(){var a=this.tabContainer.width(),b=this.tabListContainer.width()-this.tabBarPosition;0===this.tabList.children().length?(this.leftArrow_icon.css("visibility","hidden"),this.rightArrow_icon.css("visibility","hidden")):
(this.leftArrow_icon.css("visibility","visible"),this.rightArrow_icon.css("visibility","visible"));b<=a?this.rightArrow_icon.removeClass("enabled"):this.rightArrow_icon.addClass("enabled");0>=this.tabBarPosition?this.leftArrow_icon.removeClass("enabled"):this.leftArrow_icon.addClass("enabled")},setPosition:function(b){var c=(this.parent.height()-this.drawerContainer.height())/2,va=this.parent.width()-this.drawerContainer.width()-5;switch(b){case a.control.Drawer.LEFT:this.drawerContainer.removeClass();
this.drawerContainer.addClass("omv2_drawer_container");this.drawerContainer.css("left","5px");this.drawerContainer.css("top",c+"px");this.drawerIcon.removeClass();this.drawerIcon.addClass("omv2_drawer_circle left");this.position=a.control.Drawer.LEFT;this.direction="left";break;case a.control.Drawer.RIGHT:this.drawerIcon.removeClass(),this.drawerIcon.addClass("omv2_drawer_circle right"),this.drawerContainer.removeClass(),this.drawerContainer.addClass("omv2_drawer_container"),this.drawerContainer.css("top",
c+"px"),this.drawerContainer.css("left",va+"px"),this.position=a.control.Drawer.RIGHT,this.direction="right"}},isVisible:function(){return this.visible},showDrawer:function(){this.isVisible()||(this.drawerIcon.hide(),this.visible=!this.visible,this.setPosition(this.position),this.drawerContainer.toggle("slide",{direction:this.direction},function(){}))},hideDrawer:function(){this.isVisible()&&(this.visible=!1,this.drawerContainer.hide(),this.drawerIcon.show())},addTab:function(b){if(b.title){b.type||
(b.type="regular_tab");b=new a.control.DrawerPanel(b,this);this.attachTab(b);var c=b.getPanelTab().width(),va=b.getTabHeaderTitle().width(),c=c-this.fixedTabWidth;b.getTabHeaderTitle().css("width",va-c);this.updateScrollButtons()}},attachTab:function(b){var c=b.getPanelTab(),va=b.getPanelContent(),Da=b.getSingleTabContainer(),Aa=b.getTabHeaderTitle();c.appendTo(this.tabList);va.appendTo(this.tabAndContentContainer);c.click(function(){a.$(".omv2_drp_drawer_tabs").removeClass("selected");a.$(".omv2_drp_single_tab_container").removeClass("selected");
a.$(".omv2_drp_drawer_tabs_content").removeClass("selected");a.$(".omv2_drp_tab_header_title").removeClass("selected");c.addClass("selected");Da.addClass("selected");va.addClass("selected");null!==Aa&&Aa.addClass("selected")})},addEditPanel:function(b){a.isNotNull(this.editPanel)||(this.editPanel=new a.control.EditPanel({width:this.width,target_layer:b}),this.editPanel.addSelectTool(),this.editPanel.addNewPolygonTool(),this.editPanel.addVoidPolygonTool(),this.editPanel.addNewLineTool(),this.editPanel.addNewPointTool(),
b={title:"Edition Tools",altaIcon:a.control.DrawerPanel.ALTA_ICON_TOOLS,panelDiv:this.editPanel.getEditPanelDiv(),mode:a.control.DrawerPanel.TEXT_AND_ICON,type:"edit_panel"},this.addTab(b))},removeEditPanel:function(){a.isNotNull(this.editPanel)&&(this.editPanel=null)},getEditPanel:function(){return this.editPanel}});a.control.Drawer.MINIMUM_WIDTH=200;a.control.Drawer.MINIMUM_HEIGHT=300;a.control.Drawer.TAB_SIZE=120;a.control.Drawer.PANEL_SHOWN="panelShown";a.control.Drawer.PANEL_TOGGLE="panelToggle";
a.control.Drawer.PANEL_HIDEN="panelHide";a.control.Drawer.LEFT=1;a.control.Drawer.RIGHT=2;a.control.EditPanel=a.Class.extend({mixin:a.event.EventSource,initialize:function(b){this.rndID=(new Date).getTime();this.prefixID="omv2_editpanel_";!b||a.isNull(b)?(b={},b.width=a.control.EditPanel.MINIMUM_WIDTH):b.width||(b.width=a.control.EditPanel.MINIMUM_WIDTH);this.tool=null;this.snapLayer=new a.layer.VectorLayer("snap_layer",{def:{type:a.layer.VectorLayer.TYPE_LOCAL}});this.snaplineStyle=new a.style.Marker({width:12,
height:12,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:10,height:10},style:{fill:"#ffffff",stroke:"#ff0000",strokeThickness:1}}]});this.snapLayer.setRenderingStyle(this.snaplineStyle);this.snapFeature=null;this.newFeatCounter=0;this.toolMap={};this.width=Math.max(b.width,a.control.EditPanel.MINIMUM_WIDTH);this.targetLayer=b.target_layer?b.target_layer:null;this.isEnabled=!1;this.targetLayer.isFeatureEditable()&&(this.isEnabled=!0);this.targetLayer.parentMap.addLayer(this.snapLayer);this.editPanel_div=
a.$("\x3cdiv\x3e\x3c/div\x3e");this.editPanel_div.id=this.prefixID+"main_div"+this.rndID;this.editPanel_div.addClass("omv2_edit_panel_container")},setTargetLayer:function(a){this.targetLayer=a;this.refreshEditPanel()},getEditPanelDiv:function(){return this.editPanel_div},addNewEditTool:function(b,c){var va=this.targetLayer.isFeatureEditable()?" enabled":" disabled",Da={};Da.container=a.$("\x3cdiv\x3e\x3c/div\x3e");Da.container.id=this.prefixID+b+"Tool"+this.rndID;Da.container.addClass("omv2_edit_panel_tool_container");
Da.container.appendTo(this.editPanel_div);Da.icon=a.$("\x3cdiv\x3e\x3c/div\x3e");Da.icon.id=this.prefixID+b+"Tool_icon"+this.rndID;Da.icon.addClass("omv2_edit_panel_tool_icon "+b+" "+va);Da.icon.appendTo(Da.container);Da.title_container=a.$("\x3cdiv\x3e\x3c/div\x3e");Da.title_container.id=this.prefixID+b+"Tool_title_container"+this.rndID;Da.title_container.addClass("omv2_edit_panel_tool_title_container");Da.title_container.appendTo(Da.container);Da.title_text=a.$("\x3cspan\x3e\x3c/span\x3e");Da.title_text.id=
this.prefixID+b+"Tool_title_text"+this.rndID;Da.title_text.addClass("omv2_edit_panel_tool_title_text");Da.title_text.appendTo(Da.title_container);Da.title_text.text(c);return Da},refresh:function(){var a=this.targetLayer.isFeatureEditable()?" enabled":" disabled",b;for(b in this.toolMap)this.toolMap[b]&&null!==this.toolMap[b]&&(this.toolMap[b].icon.removeClass("enabled disabled"),this.toolMap[b].icon.addClass("omv2_edit_panel_tool_icon "+b+" "+a))},addSelectTool:function(){this.toolMap[a.control.EditPanel.SELECT_TOOL]&&
null!==this.toolMap[a.control.EditPanel.SELECT_TOOL]||(this.toolMap[a.control.EditPanel.SELECT_TOOL]=this.addNewEditTool(a.control.EditPanel.SELECT_TOOL,"Select"),this.goToSelectState())},addNewPolygonTool:function(){if(!this.toolMap[a.control.EditPanel.NEW_POLYGON_TOOL]||null===this.toolMap[a.control.EditPanel.NEW_POLYGON_TOOL]){var b=this;this.toolMap[a.control.EditPanel.NEW_POLYGON_TOOL]=this.addNewEditTool(a.control.EditPanel.NEW_POLYGON_TOOL,"New Polygon");this.toolMap[a.control.EditPanel.NEW_POLYGON_TOOL].icon.click(function(){b.newPolygon()})}},
addVoidPolygonTool:function(){if(!this.toolMap[a.control.EditPanel.VOID_POLYGON_TOOL]||null===this.toolMap[a.control.EditPanel.VOID_POLYGON_TOOL]){var b=this;this.toolMap[a.control.EditPanel.VOID_POLYGON_TOOL]=this.addNewEditTool(a.control.EditPanel.VOID_POLYGON_TOOL,"Void Polygon");this.toolMap[a.control.EditPanel.VOID_POLYGON_TOOL].icon.click(function(){b.newVoidPolygon()})}},addNewLineTool:function(){if(!this.toolMap[a.control.EditPanel.NEW_LINE_TOOL]||null===this.toolMap[a.control.EditPanel.NEW_LINE_TOOL]){var b=
this;this.toolMap[a.control.EditPanel.NEW_LINE_TOOL]=this.addNewEditTool(a.control.EditPanel.NEW_LINE_TOOL,"New Line");this.toolMap[a.control.EditPanel.NEW_LINE_TOOL].icon.click(function(){b.newLine()})}},addNewPointTool:function(){if(!this.toolMap[a.control.EditPanel.NEW_POINT_TOOL]||null===this.toolMap[a.control.EditPanel.NEW_POINT_TOOL]){var b=this;this.toolMap[a.control.EditPanel.NEW_POINT_TOOL]=this.addNewEditTool(a.control.EditPanel.NEW_POINT_TOOL,"New Point");this.toolMap[a.control.EditPanel.NEW_POINT_TOOL].icon.click(function(){b.newPoint()})}},
addNewRectangleTool:function(){if(!this.toolMap[a.control.EditPanel.NEW_RECTANGLE_TOOL]||null===this.toolMap[a.control.EditPanel.NEW_RECTANGLE_TOOL]){var b=this;this.toolMap[a.control.EditPanel.NEW_RECTANGLE_TOOL]=this.addNewEditTool(a.control.EditPanel.NEW_RECTANGLE_TOOL,"New Rectangle");this.toolMap[a.control.EditPanel.NEW_RECTANGLE_TOOL].icon.click(function(){b.newRectangle()})}},goToSelectState:function(){$(".omv2_edit_panel_tool_title_text").css("text-decoration","none");this.toolMap[a.control.EditPanel.SELECT_TOOL].title_text.css("text-decoration",
"underline")},newPolygon:function(){this.targetLayer.isFeatureEditable()&&($(".omv2_edit_panel_tool_title_text").css("text-decoration","none"),this.toolMap[a.control.EditPanel.NEW_POLYGON_TOOL].title_text.css("text-decoration","underline"),this.newFeature(3))},newVoidPolygon:function(){this.targetLayer.isFeatureEditable()&&($(".omv2_edit_panel_tool_title_text").css("text-decoration","none"),this.toolMap[a.control.EditPanel.VOID_POLYGON_TOOL].title_text.css("text-decoration","underline"),this.createVoidPolygon())},
newLine:function(){this.targetLayer.isFeatureEditable()&&($(".omv2_edit_panel_tool_title_text").css("text-decoration","none"),this.toolMap[a.control.EditPanel.NEW_LINE_TOOL].title_text.css("text-decoration","underline"),this.newFeature(2))},newPoint:function(){this.targetLayer.isFeatureEditable()&&($(".omv2_edit_panel_tool_title_text").css("text-decoration","none"),this.toolMap[a.control.EditPanel.NEW_POINT_TOOL].title_text.css("text-decoration","underline"),this.newFeature(1))},newRectangle:function(){this.targetLayer.isFeatureEditable()&&
($(".omv2_edit_panel_tool_title_text").css("text-decoration","none"),this.toolMap[a.control.EditPanel.NEW_RECTANGLE_TOOL].title_text.css("text-decoration","underline"))},newFeature:function(b){var c=this.targetLayer.parentMap,va=this;!this.tool||this.tool instanceof a.tool.RedlineTool&&b===this.tool.getGeometryType()||this.removeTool();this.tool||(a.isNull(b)||b===a.tool.RedlineTool.TYPE_POLYGON?this.tool=new a.tool.RedlineTool(c,a.tool.RedlineTool.TYPE_POLYGON):this.tool=b===a.tool.RedlineTool.TYPE_LINESTRING?
new a.tool.RedlineTool(c,a.tool.RedlineTool.TYPE_LINESTRING):new a.tool.RedlineTool(c,a.tool.RedlineTool.TYPE_POINT),this.tool.addListener(a.event.ToolEvent.SNAP_POINT,function(){a.notNull(va.snapFeature)&&(va.snapLayer.removeFeature(va.snapFeature),va.snapLayer.redraw(),va.snapFeature=null);va.tool.snapPoint=null;var b=c.getScreenPointLocation(c.mLocX,c.mLocY);if(a.notNull(b)){var Aa=c.getScreenPointLocation(c.mLocX-3,c.mLocY-3),ra=b.coordinates[0]-Aa.coordinates[0],Aa=Aa.coordinates[1]-b.coordinates[1],
ra=Math.sqrt(ra*ra+Aa*Aa),ra=a.edit.GeometrySegmentUtil.getLayerSegmentPoint(va.targetLayer,[b.coordinates[0],b.coordinates[1]],ra,!1,!1,!1,!1);a.notNull(ra)&&(ra=ra.getPoint(),b=new a.geometry.Point(ra[0],ra[1],b.getSRID()),ra=c.getScreenLocation(b),va.tool.snapPoint=[],va.tool.snapPoint.push(ra.x),va.tool.snapPoint.push(ra.y),va.snapFeature=new a.Feature("SnapPoint",b,{renderingStyle:va.snaplineStyle}),va.snapLayer.addFeature(va.snapFeature),va.snapLayer.redraw())}}),this.tool.addListener(a.event.ToolEvent.TOOL_END,
function(){if(!a.isNull(va.tool.getGeometry())){var b=va.tool.getGeometry();if(va.tool.getGeometryType()===a.tool.RedlineTool.TYPE_POLYGON){var c=b.getOrdinates()[0];a.util.GeomUtil.isClockwise(c[0])&&(c=a.util.GeomUtil.reverseCoordinates(c),b.coordinates[0]=c)}b=new a.Feature("newfeat_"+va.rndID+"_"+va.newFeatCounter++,b);b=va.targetLayer.changeManager.addFeature(b.id,b);a.notNull(b)&&va.targetLayer.getUndoManager().addEdit({changeManager:va.targetLayer.changeManager,editChangeEvent:b,canUndo:function(){return!0},
canRedo:function(){return!0},getPresentationName:function(){return"feature added"},undo:function(){this.changeManager.undo(this.editChangeEvent)},redo:function(){this.changeManager.redo(this.editChangeEvent)}});a.notNull(va.snapFeature)&&(va.snapLayer.removeFeature(va.snapFeature),va.snapLayer.redraw(),va.snapFeature=null);va.tool.snapPoint=null;va.tool.clear();va.tool=null;va.goToSelectState()}}),this.tool.start())},createVoidPolygon:function(){var b=this,c=this.targetLayer.parentMap,va=this.targetLayer.getSelectedFeatures();
a.isNull(va)||1!==va.length?this.goToSelectState():(!this.tool||this.tool instanceof a.tool.VoidPolygonTool||this.removeTool(),this.tool||(this.tool=new a.tool.VoidPolygonTool(c,va[0]),this.tool.addListener(a.event.ToolEvent.TOOL_END,function(){b.removeTool();b.goToSelectState()}),a.isNull(this.tool.polygonFeature)?(this.goToSelectState(),this.removeTool()):this.tool.start()))},removeTool:function(){this.tool&&(this.tool.clear(),this.tool=null)}});a.control.EditPanel.MINIMUM_WIDTH=200;a.control.EditPanel.MINIMUM_HEIGHT=
200;a.control.EditPanel.SELECT_TOOL="select";a.control.EditPanel.NEW_POLYGON_TOOL="new_polygon";a.control.EditPanel.VOID_POLYGON_TOOL="void_polygon";a.control.EditPanel.NEW_LINE_TOOL="new_line";a.control.EditPanel.NEW_POINT_TOOL="new_point";a.control.EditPanel.NEW_RECTANGLE_TOOL="new_ractangle";a.control.ScaleBar=a.control.MapDecoration.extend({initialize:function Ca(b){Ca.base.call(this);this.anchored=this.isInternal=!0;this.anchorPosition=a.control.MapDecoration.POSITION_LOWER_LEFT;this.format=
"BOTH";this.maxLength=100;this.transformToGeodetic=!1;this.fontSize=12;this.fontColor="#000000";this.fontWeight="bold";this.scaleBarColor="#000000";this.textShadow=this.barShadow=this.boxColor=this.boxShadow="";this.barThickness=3;this.fontFamily="arial,bold";this.barColummn=this.textColumn=this.flexContainer=this.botBarText=this.topBarText=this.botBarDiv=this.topBarDiv=this.botTextDiv=this.topTextDiv=null;this.topScaleBarHost={};this.bottomScaleBarHost={};this.type="ScaleBar";this.isHtml=!0;this.style=
{};b&&(this.format=b.format?b.format:"BOTH",this.anchorPosition=b.anchorPosition?b.anchorPosition:a.control.MapDecoration.POSITION_LOWER_LEFT,a.isNotNull(b.style)&&this.setStyle(b.style))},updateScale:function(){if(this.map){var a=this;this.decideScale(this.map,this.maxLength,function(b){var c=b.fpsLength,Aa=b.metricLength,Sa=b.fpsText;b=b.metricText;"METRIC"===a.format?(a.topScaleBarHost.length=Aa,a.topScaleBarHost.text=b):"IMPERIAL"===a.format?(a.topScaleBarHost.length=c,a.topScaleBarHost.text=
Sa):(a.topScaleBarHost.length=c,a.topScaleBarHost.text=Sa,a.bottomScaleBarHost.length=Aa,a.bottomScaleBarHost.text=b);a.renderDivLength(a.topBarDiv,a.botBarDiv);a.renderTextElement(a.topBarText,a.topScaleBarHost.text);a.renderTextElement(a.botBarText,a.bottomScaleBarHost.text)})}},setStyle:function(b){a.isNull(b)||(b.fontSize&&(this.fontSize="string"===typeof b.fontSize?parseInt(b.fontSize,10):b.fontSize),b.fontColor&&(this.fontColor=b.fontColor),b.scaleBarColor&&(this.scaleBarColor=b.scaleBarColor),
b.fontWeight&&(this.fontWeight=b.fontWeight),b.boxShadow&&(this.boxShadow=b.boxShadow),b.textShadow&&(this.textShadow=b.textShadow),b.scaleBarShadow&&(this.barShadow=b.scaleBarShadow),b.maxLength&&(this.maxLength=b.maxLength),b.barThickness&&(this.barThickness=b.barThickness),b.fontFamily&&(this.fontFamily=b.fontFamily),b.boxColor&&(this.boxColor=b.boxColor),this.style=b,this.updateScaleBarGroup())},setFormat:function(b){a.isNull(b)||(this.format=b,a.notNull(this.map)&&this.updateScaleBarGroup())},
display:function va(b,c){va.base.call(this,b,c);this.pageDirection=a.util.DomUtil.getPageDirection(this.map);this.updateScaleBarGroup()},updateScaleBarGroup:function(){var b=this,c=this.map;!a.isNull(c)&&c.displayed&&(c.ScaleBar=this,b.shadowFilter=null,this.decideScale(c,this.maxLength,function(Aa){var Sa=Aa.fpsLength,xb=Aa.metricLength,yb=Aa.fpsText;Aa=Aa.metricText;"METRIC"===b.format||"IMPERIAL"===b.format?"METRIC"===b.format?(b.topScaleBarHost.length=xb,b.topScaleBarHost.text=Aa):(b.topScaleBarHost.length=
Sa,b.topScaleBarHost.text=yb):(b.topScaleBarHost.length=Sa,b.topScaleBarHost.text=yb,b.bottomScaleBarHost.length=xb,b.bottomScaleBarHost.text=Aa);b.createScaleBar();Sa=a.event.MapEvent;b.anchorPosition&&(b.setAnchorPosition(),c.on(Sa.MAP_RESIZED,b.setAnchorPosition,b));c.on(Sa.I_MAP_CENTER_ZOOM,b.updateScale,b);c.on(Sa.MAP_RECENTERED,b.updateScale,b)}))},createScaleBar:function(){if(!a.isNull(this.$DecorationDiv)){this.$DecorationDiv.empty();this.$DecorationDiv.css({display:"inline-flex"});this.flexContainer=
a.$("\x3cdiv id\x3d'flexContainer'\x3e\x3c/div\x3e");this.flexContainer.css({display:"inline-flex","flex-direction":"row"});this.flexContainer.css({"box-shadow":this.boxShadow,"background-color":this.boxColor});this.$DecorationDiv.append(this.flexContainer);var b=a.$("\x3cdiv id\x3d'fRow'\x3e\x3c/div\x3e");this.textColumn=b;b.css({display:"inline-flex","flex-direction":"column","align-items":"baseline","justify-content":"space-around"});var c=a.$("\x3cdiv id\x3d'sRow'\x3e\x3c/div\x3e");this.barColumn=
c;c.css({display:"inline-flex","flex-direction":"column","align-items":"baseline","justify-content":"space-around"});this.flexContainer.append(b,c);this.topTextDiv=a.$("\x3cdiv id\x3d'flxTtxt'\x3e\x3c/div\x3e");this.topTextDiv.css({display:"inline-flex","padding-right":"10px"});this.botTextDiv=a.$("\x3cdiv id\x3d'flxBtxt'\x3e\x3c/div\x3e");this.botTextDiv.css({display:"inline-flex","padding-right":"10px"});this.topBarText=a.$("\x3cspan class\x3d'omv2_scaleText'\x3e\x3c/span\x3e");this.renderTextElement(this.topBarText,
this.topScaleBarHost.text);this.topTextDiv.append(this.topBarText);this.botBarText=a.$("\x3cspan class\x3d'omv2_scaleText'\x3e\x3c/span\x3e");this.renderTextElement(this.botBarText,this.bottomScaleBarHost.text);this.botTextDiv.append(this.botBarText);this.topBarDiv=a.$("\x3cdiv id\x3d'flxTbr'\x3e\x3c/div\x3e");this.topBarDiv.css({display:"inline-flex"});this.botBarDiv=a.$("\x3cdiv id\x3d'flxBbr'\x3e\x3c/div\x3e");this.botBarDiv.css({display:"inline-flex"});b.append(this.topTextDiv,this.botTextDiv);
c.append(this.topBarDiv,this.botBarDiv);this.renderDivLength(this.topBarDiv,this.botBarDiv);if(this.map._decoration[this.type]){this.map._decoration[this.type].$DecorationDiv.find("table").remove();this.map._decoration[this.type].contentStyle?this.map._decoration[this.type].$DecorationDiv.css(this.map._decoration[this.type].contentStyle):this.map._decoration[this.type].$DecorationDiv.css({background:"white"});var Aa=this,Sa=Aa.map._decoration[this.type].$DecorationDiv.height();setTimeout(function(){Aa.$DecorationDiv.css({position:"absolute",
top:Sa-Aa.height})},100);this.map._decoration[this.type].$DecorationDiv.append(this.$DecorationDiv);this.$DecorationDiv.css({"z-index":"9999999999"})}}},renderDivLength:function(b,c){b.empty();c.empty();var Aa=a.$("\x3cspan\x3e\x3c/span\x3e"),Sa=a.$("\x3cspan\x3e\x3c/span\x3e"),xb=a.$("\x3cdiv class\x3d'omv2_scaleBar'\x3e\x3c/div\x3e");xb.append(Aa);var yb=a.$("\x3cdiv class\x3d'omv2_scaleBar'\x3e\x3c/div\x3e");yb.append(Sa);xb.css({"background-color":this.scaleBarColor,"box-shadow":this.barShadow,
height:this.barThickness,width:this.topScaleBarHost.length});yb.css({"background-color":this.scaleBarColor,"box-shadow":this.barShadow,height:this.barThickness,width:this.bottomScaleBarHost.length});b.append(xb);c.append(yb);Aa.css({display:"inline-block","white-space":"nowrap",width:"100%"});Sa.css({display:"inline-block","white-space":"nowrap",width:"100%"})},renderText:function(){this.$topScaleText.css({"font-size":this.fontSize,color:this.fontColor,"font-weight":this.fontWeight});this.$bottomScaleText.css({"font-size":this.fontSize,
color:this.fontColor,"font-weight":this.fontWeight});this.pageDirection?(this.$topScaleText.text(this.topScaleBarHost.text),this.$bottomScaleText.text(this.bottomScaleBarHost.text)):(this.$topScaleText.text(this.topScaleBarHost.text.split(" ").reverse().join(" ")),this.$bottomScaleText.text(this.bottomScaleBarHost.text.split(" ").reverse().join(" ")))},renderTextElement:function(a,b){this.pageDirection?a.text(b):a.text(b.split(" ").reverse().join(" "));a.css({"font-size":this.fontSize,color:this.fontColor,
"font-weight":this.fontWeight,"text-shadow":this.textShadow,"font-family":this.fontFamily})},round125:function(a){if(1<a){for(var b=0;10<=a;)a/=10,b+=1;for(a=5<=a?5:2<=a?2:1;0<b;)a*=10,--b}return a},decideScale:function(b,c,Aa){var Sa,xb,yb,eb,Ma=this,Db=c/2;c=b.getScreenPointLocation(b.getMapContext().getDeviceWidth()/2-Db,b.getMapContext().getDeviceHeight()/2);Db=b.getScreenPointLocation(b.getMapContext().getDeviceWidth()/2+Db,b.getMapContext().getDeviceHeight()/2);c=new a.geometry.LineString([c.getX(),
c.getY(),Db.getX(),Db.getY()],c.srid);c.srid===a.util.BaiduUtil.SRID&&(c=a.util.BaiduUtil.transformGeom({geom:c,toSrid:8307,map:b}));Sa=a.util.GeomUtil.getLength(c,function(b){Sa=b;xb=Ma.round125(Sa);1E3<=xb?(b=Ma.round125(Sa/1E3),eb=Math.round(Ma.maxLength*b/(Sa/1E3)),yb=b+" "+a.gv.getLabel("MAPVIEWER_SB_KILOMETERS")):(eb=Math.round(Ma.maxLength*xb/Sa),yb=xb+" "+a.gv.getLabel("MAPVIEWER_SB_METERS"));b=Sa/1609.344;var c=3.28084*Sa;if(1<=b)c=Ma.round125(b),b=Math.round(Ma.maxLength*c/b),c=c+" "+a.gv.getLabel("MAPVIEWER_SB_MILES");
else{var na=Ma.round125(c);b=Math.round(Ma.maxLength*na/c);c=na+" "+a.gv.getLabel("MAPVIEWER_SB_FEET")}na={};na.fpsLength=b;na.metricLength=eb;na.fpsText=c;na.metricText=yb;Aa(na)},{unit:"METER",transformToGeodetic:!0})},remove:function Da(){Da.base.call(this);var b=this.map,c=a.event.MapEvent;this.anchored&&b.deleteListener(c.MAP_RESIZED,this._setAnchorPosition,this);b.deleteListener(c.I_MAP_CENTER_ZOOM,this.updateScale,this);b.deleteListener(c.MAP_RECENTERED,this.updateScale,this);this.map.ScaleBar=
null},getTopScaleValue:function(){return this.topScaleBarHost.text.split(" ")[0]},getBottomScaleValue:function(){return"BOTH"===this.format?this.bottomScaleBarHost.text.split(" ")[0]:""},getTopScaleUnit:function(){return this.topScaleBarHost.text.split(" ")[1]},getBottomScaleUnit:function(){return"BOTH"===this.format?this.bottomScaleBarHost.text.split(" ")[1]:""},getTopScaleBar:function(){return this.$topScaleBar.css({position:"relative",top:"0px",left:""})},getBottomScaleBar:function(){if("BOTH"===
this.format)return this.$bottomScaleBar.css({position:"relative",top:this.padding,left:""})}});a.control.OverviewMap=a.control.MapDecoration.extend({initialize:function(b){this.isInternal=!0;this.type="OverviewMap";this.visible=this.isHtml=!0;this.overFeatureLayer=this.rectangleFeature=this.layer=this.submap=this.mainmap=null;this.cursorStyleDefault=this.cursorStyleDragging=a.CursorTypes.POINTER;this.scaleRatio=null;this.enableAnimation=!1;this.rectangleStyle=b.rectStyle||new a.style.Color({strokeThickness:1,
stroke:"#f0ff00",fill:"#ff0000",fillOpacity:.3});this.actionOnSubMap=this.actionOnMainMap=!1;this.collapsible=!0;this.minimized=!1;this.anchorPosition=b.anchorPosition?parseInt(b.anchorPosition):6},display:function Aa(b,c){this.minimized=!1;Aa.base.call(this,b,c);a.$(this.overviewMapDIV).mousewheel(function(a){a.stopPropagation()});this.mainmap=this.map;this.submap=new a.Map(this.overviewMapDIV,{mapviewerURL:this.mainmap.mapviewerURL,over:!0,wraparound:!1});this.setOverviewMapSize();this.submap.enableMapZoom(this.mainmap.zoomEnabled);
this.mainmap.displayed&&(this.map.changeOverView(),this.doinit(),this.anchorPosition&&this.setAnchorPosition(this.anchorPosition))},doinit:function(){a.notNull(this.mainmap.overviewLayer)&&(this.layer=this.mainmap.overviewLayer.clone("over_"+this.mainmap.overviewLayer.name,!0));if(this.layer){if(this.submap.getLayerByName(this.layer.name))return;this.submap.addLayer(this.layer)}this.overFeatureLayer=this.submap.getDefaultFeatureLayer();var b=this.mainmap.getMapContext();this.submap.getMapContextToken().universe=
b.getUniverse().clone();this.submap.setMapCenter(b.getCenterPoint().clone());this.submap.setMapZoomLevel(b.getZoomLevel()-this.calMapZoomDiff());this.submap.enableMapDrag(!1);this.submap.enableMapAction.click=!1;this.submap.enableMapAction.dbclick=!1;this.submap.enableMapAction.mousewheel=!1;var c=this,xb=function(){var b=c.mainmap.getMapWindowBoundingBox();a.isNull(c.rectangleFeature)&&(c.rectangleFeature=new a.layer.EditableFeature("overview_rectangle",b,{renderingStyle:c.rectangleStyle}));var Aa=
a.event.LayerEvent;c.overFeatureLayer.addFeature(c.rectangleFeature);c.rectangleFeature.on(Aa.FEATURE_MOVED,c.endDragRect,c);c.rectangleFeature.on(Aa.FEATURE_MOVING,c.draggingRect,c);c.overFeatureLayer.on(Aa.FEATURES_DISPLAYED,function(){this.rectangleFeature.shape.applyStyle({cursor:this.cursorStyleDefault})},c);b.getWidth()>=c.submap.getMapWindowBoundingBox().getWidth()&&c.rectangleFeature.setVisible(!1)};this.submap.on(a.event.MapEvent.MAP_INITIALIZED,xb);this.submap.init();this.on(a.event.MapDecorationEvent.AFTER_RESTORE,
function(){c.layer&&c.layer.layerType===a.LayerTypes.EXTERNAL?(c.setCenterAndZoomlevel(),c.submap.refreshMap()):c.setCenterAndZoomlevel();xb()});this.mainmap.on(a.event.MapEvent.MAP_RESIZED,function(){this.resize();this.setAnchorPosition(this.anchorPosition);this.setRectangleFeature();this.endDragRect()},this);this.collapse()},clean:function(){},collapse:function(){this.overviewMapDIV.css({width:"0px",height:"0px",overflow:"hidden","border-width":"0px"});this.inAnimation=!1;this.minimized=!0;var a=
this.$DecorationBtnDiv.children("img");a.attr("src")===this.getMinimizeIcon()?a.attr("src",this.getRestoreIcon()):a.attr("src")===this.getRestoreIcon()&&a.attr("src",this.getMinimizeIcon())},restore:function(){this.setOverviewMapSize();this.minimized=this.inAnimation=!1;if(a.notNull(this.$DecorationBtnDiv)){this.overviewMapDIV.css({"border-width":"1px"});var b=this.$DecorationBtnDiv.children("img");b.attr("src")===this.getRestoreIcon()?b.attr("src",this.getMinimizeIcon()):b.attr("src")===this.getMinimizeIcon()&&
b.attr("src",this.getRestoreIcon())}},setAnchorPosition:function(a){this.decideButtonAndMapLayout(a);var b=this.container.find("div[id^\x3domv2_anchorBox]");$(b[a-1]).append(this.$DecorationDiv)},decideButtonAndMapLayout:function(a){var b=this.$DecorationBtnDiv,c=this.overviewMapDIV;switch(a){case 1:case 2:case 3:this.$DecorationDiv.css({top:"0px",bottom:""});break;case 4:case 5:case 6:this.$DecorationDiv.css({bottom:"0px",top:""})}switch(a){case 1:this.$DecorationDiv.css({left:"0px",right:"","flex-direction":"row",
"align-items":"flex-end"});this.$DecorationDiv.append(c,b);break;case 4:this.$DecorationDiv.css({left:"0px",right:"","flex-direction":"row","align-items":"flex-end"});this.$DecorationDiv.append(c,b);break;case 2:this.$DecorationDiv.css({left:"",right:"","flex-direction":"column","align-items":"center"});this.$DecorationDiv.append(c,b);break;case 5:this.$DecorationDiv.css({left:"",right:"","flex-direction":"column","align-items":"center"});this.$DecorationDiv.append(b,c);break;case 3:this.$DecorationDiv.css({left:"",
right:"0px","flex-direction":"row","align-items":"flex-end"});this.$DecorationDiv.append(b,c);break;case 6:this.$DecorationDiv.css({left:"",right:"0px","flex-direction":"row","align-items":"flex-end"}),this.$DecorationDiv.append(b,c)}},resize:function Sa(){this.setOverviewMapSize();Sa.base.call(this)},setOverviewMapSize:function(){var b=this.mainmap.getMapContext().getDeviceWindow(),c=Math.round(.3*b.w),b=Math.round(.3*b.h);if(a.notNull(this.submap)){var yb=this.submap.getMapContextToken();yb.deviceWindow.w=
c;yb.deviceWindow.h=b}a.notNull(this.overviewMapDIV)&&(this.overviewMapDIV.width(c),this.overviewMapDIV.height(b))},draggingRect:function(){this.cursorStyleDragging&&this.rectangleFeature.shape.applyStyle({cursor:this.cursorStyleDragging})},endDragRect:function(){var a=this.rectangleFeature.geo.getCenter(),b=this.mainmap.getMapContext().getZoomLevel();this.mainmap.setMapCenterAndZoomLevel(a,b);this.setRectangleFeature();this.rectangleFeature.shape.applyStyle({cursor:this.cursorStyleDefault})},remove:function xb(){xb.base.call(this);
this.layer=this.overFeatureLayer=this.rectangleFeature=null;this.submap&&this.submap.destroyMap();this.layerDel=this.layerAdd=this.styleChange=this.setRectangleFeature=this.endDragRect=this.refreshMainMap=this.resize=this._display=this.map=this.submap=this.mainmap=this.overviewMapDIV=this.rectangleStyle=null},setRectangleFeature:function(){var b=this.mainmap.getMapWindowBoundingBox();a.isNull(b)||a.isNull(this.submap.getMapWindowBoundingBox())||(b.getWidth()>=this.submap.getMapWindowBoundingBox().getWidth()&&
!this.mainmap.wraparound?this.rectangleFeature.setVisible(!1):(b.getWidth()>=this.submap.getMapWindowBoundingBox().getWidth()&&this.mainmap.wraparound||this.rectangleFeature.setGeometry(b),this.rectangleFeature.setVisible(!0),3>this.mainmap.getMapZoomLevel()&&this.mainmap.wraparound&&this.rectangleFeature.setVisible(!1)))},styleChange:function(a){var b=a.affectLayer;this.layer&&"over_"+b.name===this.layer.name&&b.layerType==this.layer.layerType&&((b=a.newStyle)&&"HeatMap"===b.styleType&&b.containerVectorLayer&&
(b=b.clone(),b.containerVectorLayer=b.containerVectorLayer.clone("over_"+b.containerVectorLayer.name,!0,!0)),this.layer.setRenderingStyle(b,a.attributes))},nsdpMapped:function(a){a=a.affectLayer;if(this.layer&&"over_"+a.name===this.layer.name&&a.layerType==this.layer.layerType){this.layer.clearFeatureShapes();this.layer.featureArray=[];for(var b=a.featureArray.length,c=0;c<b;c++){var Ma=a.featureArray[c].clone();this.layer.featureArray.push(Ma)}this.layer.redraw()}},layerAdd:function(){},layerDel:function(b){(b=
b.affectedLayer)&&this.layer&&this.layer.name==="over_"+b.name&&b.layerType==this.layer.layerType&&(this.layer.copyFeatures&&this.mainmap.overviewLayer.deleteListener(a.event.LayerEvent.FEATURES_LOADED,this.layer.copyFeatures),this.submap.removeLayer(this.layer),this.layer=this.mainmap.overviewLayer=null)},setCenterAndZoomlevel:function(){if(!this.minimized){var a=this.mainmap.getMapContext();this.submap.setMapCenterAndZoomLevel(a.getCenterPoint(),a.getZoomLevel()-this.calMapZoomDiff());this.setRectangleFeature()}},
calMapZoomDiff:function(){for(var a=null,b=this.mainmap.getMapContext(),c=b.getUniverse(),a=1<this.scaleRatio?c.getZoomLevels()[b.getZoomLevel()].resolution*this.scaleRatio:this.mainmap.getMapWindowBoundingBox().getWidth()/(Math.round(.3*b.getDeviceWidth())/2),Ma=0;Ma<b.getZoomLevel();Ma++)if(c.getZoomLevels()[Ma+1].resolution<=a&&c.getZoomLevels()[Ma].resolution>=a)return b.getZoomLevel()-Ma;if(c.getZoomLevels()[0].resolution<a)return b.getZoomLevel()},setOverviewMapOptions:function(b){if(b.scaleRatio&&
1<b.scaleRatio){if(this.scaleRatio===b.scaleRatio)return;this.scaleRatio=b.scaleRatio;this.submap&&this.submap.displayed&&this.mainmap&&this.submap.setMapZoomLevel(this.mainmap.getMapContext().getZoomLevel()-this.calMapZoomDiff())}b.overviewLayer&&(this.mainmap.overviewLayer=b.overviewLayer,this.submap&&this.submap.displayed&&(this.submap.removeLayer(this.layer),this.layer=b.overviewLayer.clone("over_"+b.overviewLayer.name,!0),this.submap.addLayer(this.layer)));if(b.panelOptions){var c=b.panelOptions;
c.style&&(this.rectangleStyle=c.style,this.submap.displayed&&this.rectangleFeature.setRenderingStyle(this.rectangleStyle));a.notNull(c.draggingCursorStyle)&&(this.cursorStyleDragging=c.draggingCursorStyle);a.notNull(c.defaultCursorStyle)&&(this.cursorStyleDefault=c.defaultCursorStyle,this.rectangleFeature&&this.rectangleFeature.shape&&this.rectangleFeature.shape.applyStyle({cursor:this.cursorStyleDefault}));a.notNull(c.enableAnimation)&&(this.enableAnimation=c.enableAnimation)}a.notNull(b.anchorPosition)&&
(this.anchorPosition=b.anchorPosition,this.setAnchorPosition(this.anchorPosition));a.notNull(b.display)&&this.setVisible(b.display);a.notNull(b.collapse)&&(b.collapse?this.collapse():this.restore())},refreshMainMap:function(){if(!this.actionOnMainMap){this.actionOnSubMap=!0;var a=this.submap.getMapContext();this.mainmap.setMapCenterAndZoomLevel(a.getCenterPoint(),a.getZoomLevel()+this.calMapZoomDiff());this.actionOnSubMap=!1}this.setRectangleFeature()},getMapConfig:function(){if(this.overviewTileLayer.config)return this.overviewTileLayer.config;
a.util.Logger.warning("MAPVIEWER_9001","MVOverviewMap.getMapConfig")},getZoomLevel:function(){return this.submap.getZoomLevel()},errLoadLayer:function(){var a=this.mainmap.overviewLayer;this.layer=a.clone("over_"+a.name,!0);this.submap.inited=!1;this.submap.displayed||(this.submap.addLayer(this.layer),this.submap.init())},enableOverViewMapZoom:function(a){this.submap&&this.submap.enableMapZoom(a)}});a.control.ToolButton=a.Class.extend({mixin:a.event.EventSource,initialize:function(b,c,eb){this.btID=
b;this.btType=c;this.btName=eb&&eb.buttonName;this.btIcon=eb&&eb.buttonIcon;this.btSelectedIcon=eb&&eb.buttonSelectedIcon;this.btState=a.control.ToolButton.UP;this.tip=eb&&eb.tooltip;this.parentToolBar=null;this.btDiv=document.createElement("div");this.btDiv.id=this.btID;this.btImg=document.createElement("img");this.tipDiv=document.createElement("div");this.width=eb&&eb.width;this.height=eb&&eb.height;this.positionPending=!1;var Ma=this;Ma.initButton();var Db=function(b){var c=a.event.ToolbarEvent,
ya=new a.event.ToolbarEvent(c.BUTTON_STATE_CHANGE,Ma);ya.btID=Ma.btID;Ma.fire(ya.type,ya);b.stopPropagation();Ma.btType==a.control.ToolButton.COMMAND?(Ma.btImg.setAttribute("src",Ma.btSelectedIcon),Ma.btState=a.control.ToolButton.DOWN,b=new a.event.ToolbarEvent(c.BUTTON_DOWN,Ma),b.btID=Ma.btID,Ma.fire(b.type,b)):Ma.btType==a.control.ToolButton.TOGGLE&&(Ma.btState==a.control.ToolButton.UP?(Ma.btImg.setAttribute("src",Ma.btSelectedIcon),Ma.btState=a.control.ToolButton.DOWN,b=new a.event.ToolbarEvent(c.BUTTON_DOWN,
Ma)):(Ma.btImg.setAttribute("src",Ma.btIcon),Ma.btState=a.control.ToolButton.UP,b=new a.event.ToolbarEvent(c.BUTTON_UP,Ma)),b.btID=Ma.btID,Ma.fire(b.type,b))},ob=function(b){Ma.btType==a.control.ToolButton.COMMAND&&Ma.btState==a.control.ToolButton.DOWN&&Ma.reset();b.stopPropagation()};a.$(this.btImg).mouseover(function(){if(Ma.btType!=a.control.ToolButton.SEPARATOR){if(a.$(Ma.parentToolBar.toolBarDecorationDiv).css("cursor","pointer"),Ma.tip){Ma.parentToolBar.toolBarDecorationDiv.appendChild(Ma.tipDiv);
Ma.tipDiv.innerHTML=Ma.tip;a.$(Ma.tipDiv).addClass("tip_toolbar");var b={display:"inline",left:Ma.btDiv.parentNode.offsetLeft+5,top:Ma.btDiv.parentNode.offsetTop+30,"white-space":"nowrap"};a.$(Ma.tipDiv).css(b);setTimeout(function(){a.$(Ma.tipDiv).css({display:"none"})},4E3)}}else a.$(Ma.parentToolBar.toolBarDecorationDiv).css("cursor","default")}).mouseout(function(b){Ma.tip&&a.$(Ma.tipDiv).css({display:"none"});Ma.btType==a.control.ToolButton.COMMAND&&Ma.btState==a.control.ToolButton.DOWN&&Ma.reset();
b.stopPropagation()}).mousedown(Db).mouseup(ob);a.browser.touchSupported&&(a.$(this.btImg).bind("touchstart",function(a){a.preventDefault();a.stopPropagation();Db(a)}),a.$(this.btImg).bind("touchend",function(a){a.preventDefault();a.stopPropagation();ob(a)}))},initButton:function(){this.btDiv.appendChild(this.btImg);a.$(this.tipDiv).css({display:"none"});a.$(this.btDiv).addClass("btDiv_toolbar");"clear"!=this.btID.substring(this.btID.lastIndexOf("bt_")+3)||a.control.ToolBar.ENABLECLEAR||a.$(this.btDiv).css({display:"none"});
this.btType!=a.control.ToolButton.SEPARATOR&&(this.btImg.setAttribute("src",this.btIcon),this.width&&this.btImg.setAttribute("width",this.width),this.height&&this.btImg.setAttribute("height",this.height))},destroy:function(){a.$(this.btDiv).empty();this.tipDiv=this.btImg=this.btDiv=null},setToolTip:function(a){this.tip=a},reset:function(b){this.tool&&b&&this.tool.clear();this.btState==a.control.ToolButton.DOWN&&(this.btImg.setAttribute("src",this.btIcon),this.btState=a.control.ToolButton.UP,this.tool&&
this.tool.getStatus()==a.tool.Tool.STARTED&&this.tool.clear(),b=new a.event.ToolbarEvent(a.event.ToolbarEvent.BUTTON_UP,this),b.btID=this.btID,this.fire(b.type,b))}});a.control.ToolButton.COMMAND=0;a.control.ToolButton.TOGGLE=1;a.control.ToolButton.SEPARATOR=2;a.control.ToolButton.UP=0;a.control.ToolButton.DOWN=1;a.control.ButtonGroup=a.Class.extend({initialize:function(){this.toolButtons=[];this.toolBar=null;var b=this;this.onToolButtonStateChange=function(c){c=c.btID;var eb=!1;"clear"==c.substring(c.lastIndexOf("bt_")+
3)&&(eb=!0);if(b.toolButtons)for(var Ma in b.toolButtons)c!=Ma&&b.toolButtons[Ma]instanceof a.control.ToolButton&&b.toolButtons[Ma].reset(eb)}},add:function(b){this.toolButtons[b.btID]=b;b.group=this;b.on(a.event.ToolbarEvent.BUTTON_STATE_CHANGE,this.onToolButtonStateChange);this.toolBar&&this.toolBar.addButton(b)}});a.control.ToolBar=a.control.MapDecoration.extend({initialize:function(b,c){c&&a.notNull(c.orientation)&&c.orientation==a.control.ToolBar.VERTICAL?this.direction=c.orientation:this.direction=
a.control.ToolBar.HORIZONTAL;c&&a.notNull(c.enableClear)?a.control.ToolBar.ENABLECLEAR=c.enableClear:a.control.ToolBar.ENABLECLEAR=!0;this.innerID=b=(new Date).getTime();this.toolBarTB=this.toolBarDecorationDiv=this.toolBarDecoration=this.map=null;this.left=.35;this.top=.05;var eb=this,Ma=a.gv.toolButtonW,Db=a.gv.toolButtonH;a.browser.touchSupported&&(Ma*=1.5,Db*=1.5);this.addedBuiltInbts=c.builtInButtons;this.enableBuiltInBts=[!1,!1,!1,!1,!1,!1];this.builtInBts=[];this.allToolBts=[];this.toBeAddedBts=
[];this.builtInButtonGroup=new a.control.ButtonGroup;this.buttonGroups=[this.builtInButtonGroup];this.toolBarDecoration=new a.control.MapDecoration('\x3cdiv id\x3d"div_'+eb.innerID+'" style\x3d"background: white;"\x3e\x3c/div\x3e',{offsetX:this.left,offsetY:this.top,draggable:!0,contentStyle:{"border-style":"solid","border-color":"#ffffff","border-width":"2px",backgroundColor:"#ffffff",filter:"alpha(Opacity\x3d80)","-moz-opacity":"0.8",opacity:"1"}});this.toolBarDecoration.type="ToolBar";this.toolBarDecoration.clean=
function(){};this.builtInBtSelected=function(c){c=c.btID;var lb=eb.map;if(c==b+"_bt_clear"){a.notNull(lb)&&lb.setMaskOutInfoWindow(!1);for(var na in eb.allToolBts)eb.allToolBts[na].tool&&(c=eb.allToolBts[na].btID,c!=b+"_bt_redline"&&c!=b+"_bt_distance"&&c!=b+"_bt_circle"&&c!=b+"_bt_rectangle"||eb.allToolBts[na].tool.clear())}else if(a.notNull(lb)&&lb.setMaskOutInfoWindow(!0),c==b+"_bt_redline"||c==b+"_bt_distance"||c==b+"_bt_circle"||c==b+"_bt_rectangle"||c==b+"_bt_zoom")for(na=0;na<eb.builtInBts.length;na++)if(eb.builtInBts[na].btID==
c){eb.builtInBts[na].tool.start();break}};this.builtInBtUnSelected=function(b){var c=null;if(b.btID)c=eb.allToolBts[b.btID];else if(b.target.bt)c=b.target.bt;else return;a.notNull(eb.map)&&eb.map.setMaskOutInfoWindow(!1);c.reset()};this.clearTools=function(){for(var a=0;a<eb.builtInBts.length;a++)eb.builtInBts[a].reset()};(function(){eb.toolBarTB=document.createElement("Table");eb.toolBarTB.id="tb_"+eb.innerID;eb.toolBarTB.style.backgroundColor="rgb(242, 237, 242)";eb.toolBarTB.cellSpacing=1;eb.toolBarTB.cellPadding=
0;eb.toolBarTB.style.border="0px solid #7F9DB9";eb.toolBarTB.style.width="100%";eb.builtInBts.push(new a.control.ToolButton(b+"_bt_clear",a.control.ToolButton.COMMAND,{buttonIcon:a.gv.resourcePath()+"tbicons/clear.gif",buttonSelectedIcon:a.gv.resourcePath()+"tbicons/p_clear.gif",width:Ma,height:Db,tooltip:a.gv.getLabel("MAPVIEWER_TB_TIP_CLEAR")}));eb.builtInBts.push(new a.control.ToolButton(b+"_bt_circle",a.control.ToolButton.TOGGLE,{buttonIcon:a.gv.resourcePath()+"tbicons/func_circleselect_16_ena.png",
buttonSelectedIcon:a.gv.resourcePath()+"tbicons/func_circleselect_16_act.png",width:Ma,height:Db,tooltip:a.gv.getLabel("MAPVIEWER_TB_TIP_CIRCLE"),buttonName:a.control.ToolBar.BUILTIN_CIRCLE}));eb.builtInBts.push(new a.control.ToolButton(b+"_bt_rectangle",a.control.ToolButton.TOGGLE,{buttonIcon:a.gv.resourcePath()+"tbicons/func_rectangleselect_16_ena.png",buttonSelectedIcon:a.gv.resourcePath()+"tbicons/func_rectangleselect_16_act.png",width:Ma,height:Db,tooltip:a.gv.getLabel("MAPVIEWER_TB_TIP_RECTANGLE"),
buttonName:a.control.ToolBar.BUILTIN_RECTANGLE}));eb.builtInBts.push(new a.control.ToolButton(b+"_bt_redline",a.control.ToolButton.TOGGLE,{buttonIcon:a.gv.resourcePath()+"tbicons/func_polyselect_16_ena.png",buttonSelectedIcon:a.gv.resourcePath()+"tbicons/func_polyselect_16_act.png",width:Ma,height:Db,tooltip:a.gv.getLabel("MAPVIEWER_TB_TIP_REDLINE"),buttonName:a.control.ToolBar.BUILTIN_REDLINE}));eb.builtInBts.push(new a.control.ToolButton(b+"_bt_distance",a.control.ToolButton.TOGGLE,{buttonIcon:a.gv.resourcePath()+
"tbicons/func_distance_11_ena.png",buttonSelectedIcon:a.gv.resourcePath()+"tbicons/func_distance_11_act.png",width:Ma,height:Db,tooltip:a.gv.getLabel("MAPVIEWER_TB_TIP_DISTANCE"),buttonName:a.control.ToolBar.BUILTIN_DISTANCE}));eb.builtInBts.push(new a.control.ToolButton(b+"_bt_zoom",a.control.ToolButton.TOGGLE,{buttonIcon:a.gv.resourcePath()+"tbicons/zoom.gif",buttonSelectedIcon:a.gv.resourcePath()+"tbicons/p_zoom.gif",width:Ma,height:Db,tooltip:a.gv.getLabel("MAPVIEWER_TB_TIP_ZOOM"),buttonName:a.control.ToolBar.BUILTIN_MARQUEE_ZOOM}));
for(var c=0;c<eb.builtInBts.length;c++)eb.builtInBts[c].on(a.event.ToolbarEvent.BUTTON_DOWN,eb.builtInBtSelected),eb.builtInButtonGroup.add(eb.builtInBts[c])})()},setPosition:function(b,c){this.left=b||this.left;this.top=c||this.top;this.positionPending=!1;0<this.left&&1>this.left&&(a.notNull(this.toolBarDecoration.map)?this.left*=this.toolBarDecoration.map.getMapContext().getDeviceWidth():this.positionPending=!0);0<this.top&&1>this.top&&(a.notNull(this.toolBarDecoration.map)?this.top*=this.toolBarDecoration.map.getMapContext().getDeviceHeight():
this.positionPending=!0);this.toolBarDecoration.left=this.left;this.toolBarDecoration.top=this.top;a.notNull(this.toolBarDecoration.$DecorationDiv)?this.toolBarDecoration.$DecorationDiv.css({left:this.left,top:this.top,right:"",bottom:""}):this.positionPending=!0},display:function yb(a,b){yb.base.call(this,a,b);!0===this.positionPending&&this.setPosition()},setVisible:function(a){this.toolBarDecoration&&this.toolBarDecoration.setVisible(a)},setDraggable:function(a){this.toolBarDecoration&&this.toolBarDecoration.setDraggable(a)},
isVisible:function(){if(this.toolBarDecoration)return this.toolBarDecoration.isVisible()},initBuiltInTools:function(){var b=a.control.ToolBar,c=a.event.ToolEvent;this.toolBarDecorationDiv=document.getElementById("div_"+this.innerID);this.toolBarDecorationDiv.appendChild(this.toolBarTB);this.builtInBts[b.BUILTIN_CIRCLE].tool=new a.tool.CircleTool(this.map);this.builtInBts[b.BUILTIN_CIRCLE].tool.bt=this.builtInBts[b.BUILTIN_CIRCLE];this.builtInBts[b.BUILTIN_CIRCLE].tool.on(c.TOOL_END,this.builtInBtUnSelected);
this.builtInBts[b.BUILTIN_RECTANGLE].tool=new a.tool.RectangleTool(this.map);this.builtInBts[b.BUILTIN_RECTANGLE].tool.bt=this.builtInBts[b.BUILTIN_RECTANGLE];this.builtInBts[b.BUILTIN_RECTANGLE].tool.on(c.TOOL_END,this.builtInBtUnSelected);this.builtInBts[b.BUILTIN_REDLINE].tool=new a.tool.RedlineTool(this.map);this.builtInBts[b.BUILTIN_REDLINE].tool.bt=this.builtInBts[b.BUILTIN_REDLINE];this.builtInBts[b.BUILTIN_REDLINE].tool.on(c.TOOL_END,this.builtInBtUnSelected);this.builtInBts[b.BUILTIN_DISTANCE].tool=
new a.tool.DistanceTool(this.map);this.builtInBts[b.BUILTIN_DISTANCE].tool.bt=this.builtInBts[b.BUILTIN_DISTANCE];this.builtInBts[b.BUILTIN_DISTANCE].tool.on(c.TOOL_END,this.builtInBtUnSelected);this.builtInBts[b.BUILTIN_MARQUEE_ZOOM].tool=new a.tool.MarqueeZoomTool(this.map,a.tool.MarqueeZoomTool.ONE_TIME);this.builtInBts[b.BUILTIN_MARQUEE_ZOOM].tool.bt=this.builtInBts[b.BUILTIN_MARQUEE_ZOOM];this.builtInBts[b.BUILTIN_MARQUEE_ZOOM].tool.on(c.TOOL_END,this.builtInBtUnSelected);this.enableBuiltInButton(this.addedBuiltInbts);
var Ma=this,b=function(){for(var a=0;a<Ma.builtInBts.length;a++)Ma.getBuiltInToolButton(a).reset()};this.toolBarDecoration.$DecorationDiv.mousedown(b);if(a.browser.touchSupported)this.toolBarDecoration.$DecorationDiv.on("touchend",b)},enableBuiltInButton:function(b){for(var c=0;c<b.length;c++)if(b[c]==a.control.ToolBar.BUILTIN_ALL){for(b=0;b<this.enableBuiltInBts.length;b++)this.enableBuiltInBts[b]||(this.enableBuiltInBts[b]=!0);break}else b[c]<this.enableBuiltInBts.length&&0<=b[c]&&(this.enableBuiltInBts[0]=
!0,this.enableBuiltInBts[b[c]]=!0);for(b=0;b<this.builtInBts.length;b++)this.enableBuiltInBts[b]&&this.addButton(this.builtInBts[b])},removeButton:function(b){if(b){for(var c=this.toBeAddedBts.length-1;0<=c;c--)this.toBeAddedBts[c]==b&&this.toBeAddedBts.splice(c,1);if(this.map)if(delete this.allToolBts[b.btID],b.group&&(delete b.group.toolButtons[b.btID],b.group=null),this.direction==a.control.ToolBar.HORIZONTAL){var Ma=this.toolBarTB.firstChild.firstChild;if(0!==Ma.childNodes.length)for(var c=Ma.childNodes,
Db=0;Db<c.length;Db++)c[Db].id=="_td_"+b.btID&&Ma.deleteCell(Db)}else if(0!==this.toolBarTB.firstChild.childNodes.length)for(c=this.toolBarTB.firstChild.childNodes,Ma=0;Ma<c.length;Ma++)c[Ma].id=="_tr_"+b.btID&&this.toolBarTB.firstChild.deleteRow(Ma)}},addButton:function(b){if(this.map){b.btType==a.control.ToolButton.SEPARATOR&&(this.direction==a.control.ToolBar.HORIZONTAL?b.btImg.setAttribute("src",a.gv.resourcePath()+"tbicons/bk_v.png"):b.btImg.setAttribute("src",a.gv.resourcePath()+"tbicons/bk_h.png"));
var c=null,c=null;this.direction==a.control.ToolBar.HORIZONTAL?(c=0===this.toolBarTB.childNodes.length?this.toolBarTB.insertRow(0):this.toolBarTB.firstChild.firstChild,c=c.insertCell(c.childNodes.length),c.id="_td_"+b.btID):(c=0===this.toolBarTB.childNodes.length?this.toolBarTB.insertRow(0):this.toolBarTB.insertRow(this.toolBarTB.firstChild.childNodes.length),c.id="_tr_"+b.btID,c=c.insertCell(0));b.parentToolBar=this;c.appendChild(b.btDiv);this.allToolBts[b.btID]=b}else this.toBeAddedBts.push(b)},
initCustomBts:function(){for(var a=0;a<this.toBeAddedBts.length;a++)this.addButton(this.toBeAddedBts[a])},getBuiltInTool:function(a){return this.builtInBts[a]?this.builtInBts[a].tool:null},getBuiltInToolButton:function(a){return this.builtInBts[a]?this.builtInBts[a]:null},addSeparator:function(b){b=new a.control.ToolButton(b,a.control.ToolButton.SEPARATOR);this.addButton(b)},removeSeparator:function(a){for(var b=this.toBeAddedBts.length-1;0<=b;b--)if(this.toBeAddedBts[b].btID==a){this.removeButton(this.toBeAddedBts[b]);
break}},destroy:function(){this.allToolBts=this.toolBarDecorationDiv=this.toolBarDecoration=this.map=null;for(var a=0;a<this.builtInBts&&this.builtInBts.length;a++)this.builtInBts[a].destroy(),this.builtInBts[a]=null;this.buttonsToAdd=this.buttonGroups=this.DrawingButtonGroup=this.builtInBts=null}});a.control.ToolBar.VERTICAL=0;a.control.ToolBar.HORIZONTAL=1;a.control.ToolBar.ENABLECLEAR=!0;a.control.ToolBar.BUILTIN_CLEAR=0;a.control.ToolBar.BUILTIN_CIRCLE=1;a.control.ToolBar.BUILTIN_RECTANGLE=2;
a.control.ToolBar.BUILTIN_REDLINE=3;a.control.ToolBar.BUILTIN_DISTANCE=4;a.control.ToolBar.BUILTIN_MARQUEE_ZOOM=5;a.control.ToolBar.BUILTIN_ALL=6;a.control.Magnifier=a.control.MapDecoration.extend({initialize:function eb(a){eb.base.call(this);this.collapsible=this.draggable=this.isInternal=!0;this.innerID=null;this.width=a.width?a.width:150;this.height=a.height?a.height:150;this.zoomIncrement=a.zoomIncrement?a.zoomIncrement:1;this.anchorPosition=a.anchorPosition?a.anchorPosition:1;!1===a.collapsible&&
(this.collapsible=!1);!1===a.draggable&&(this.draggable=!1);this.left=a.offsetX?a.offsetX:20;this.top=a.offsetY?a.offsetY:20;this.type="Magnifier";this.isHtml=!0;this.scaleRatio=this.cursorStyleDefault=this.cursorStyleDragging=this.overFeatureLayer=this.layer=this.submap=this.mainmap=null;this.actionOnSubMap=this.actionOnMainMap=!1;this.zommLevel=this.mapHeight=this.mapWidth=0},display:function Ma(a,b){Ma.base.call(this,a,b);this.MagnifierMapDIV=this.$Content;this.mainmap=this.map;this.doinit()},
centerAndZoomlevel:function(a){this.actionOnSubMap||(this.actionOnMainMap=!0,this.setCenterAndZoomlevel(a),this.actionOnMainMap=!1)},resize:function(){this.submap.getMapContextToken().transform=null;this.submap.getMapContext().getTransform();this.submap.graphics.setLeftTop(this.submap.draggableGroup,0,0);this.refreshSubMap();this.mapWidth=this.mainmap.getMapContext().getDeviceWidth();this.mapHeight=this.mainmap.getMapContext().getDeviceHeight()},refreshSubMap:function(){var b=this.mainmap.getMapContext(),
c=b.getDeviceWidth()/2-this.moveX-this.width/2,ob=b.getDeviceHeight()/2-this.moveY-this.height/2,lb=b.getZoomLevel(),na=b.getUniverse().getZoomLevels()[lb],c=c*na.resolution,ob=ob*na.resolution*na.stretchRatio,na=b.getCenterPoint(),na=new a.geometry.Point(na.getX()-c,na.getY()+ob,na.getSRID()),b=b.getUniverse().getZoomLevelNumber();lb+this.zoomIncrement>=b?this.submap.setMapCenterAndZoomLevel(na,b-1):this.submap.setMapCenterAndZoomLevel(na,lb+this.zoomIncrement);this.X=-c;this.Y=ob},remove:function(){this.layer=
this.overFeatureLayer=null;this.submap&&this.submap.destroyMap();this.refreshSubMap=this.resize=this.centerAndZoomlevel=this.display=this.map=this.submap=this.mainmap=this.MagnifierMapDIV=null},doinit:function(){this.mainmap.on(a.event.MapEvent.MAP_RESIZED,this.resize,this);this.setAnchorPosition(this.anchorPosition);this.submap=new a.Map(this.MagnifierMapDIV,{mapviewerURL:this.mainmap.mapviewerURL,magnifier:!0});this.mapWidth=this.mainmap.getMapContext().getDeviceWidth();this.mapHeight=this.mainmap.getMapContext().getDeviceHeight();
this.zoomLevel=this.mainmap.getMapContext().getZoomLevel();for(var b=0;b<this.mainmap.divLayers.length;b++){var c=this.mainmap.divLayers[b],c=c.clone("clone_"+c.name);this.submap.addLayer(c)}for(b=2;b<this.mainmap.svgLayers.length;b++){var c=this.mainmap.svgLayers[b],ob=c.name;"ii_oracle_maps_internal_editing"!==ob&&"ii_oracle_maps_internal_others"!==ob&&(c=c.clone("clone_"+ob),this.submap.addLayer(c))}this.overFeatureLayer=this.submap.getDefaultFeatureLayer();var ob=this.mapWidth/2-this.X-this.width/
2,c=this.mapHeight/2-this.Y-this.height/2,b=this.mainmap.getMapContext(),lb=b.getZoomLevel(),lb=b.getUniverse().getZoomLevels()[lb],ob=ob*lb.resolution,c=c*lb.resolution*lb.stretchRatio,b=b.getCenterPoint(),b=new a.geometry.Point(b.getX()-ob,b.getY()+c,b.getSRID());this.mainmap.getMapContext().getZoomLevel()+this.zoomIncrement>=this.mainmap.getMapContext().getUniverse().getZoomLevelNumber()?this.submap.setMapCenterAndZoomLevel(b,this.mainmap.getMapContext().getUniverse().getZoomLevelNumber()-1):this.submap.setMapCenterAndZoomLevel(b,
this.mainmap.getMapContext().getZoomLevel()+this.zoomIncrement);this.submap.enableMapAction.mouse=!1;var na=this;this.flag=!1;this.submap.init();this.mapdown=!1;a.browser.touchSupported||(this.map.$oracleMapDiv.mousedown(function(){na.mapdown=!0}),this.map.$oracleMapDiv.mouseup(function(){na.mapdown=!1}),this.map.$oracleMapDiv.mousemove(function(a){na.mapdown&&na.refreshSubMap(a)}),this.$DecorationDiv.mousedown(function(){a.$(this).css("cursor","default");na.draggable&&a.$(this).css("cursor","move");
na.flag=!0;na.map.$oracleMapDiv.mousemove(function(){if(na.flag){var b=na.mapWidth/2-na.moveX-na.width/2,c=na.mapHeight/2-na.moveY-na.height/2,lb=na.mainmap.getMapContext(),Za=lb.getZoomLevel(),Ma=lb.getUniverse().getZoomLevels()[Za],b=b*Ma.resolution,c=c*Ma.resolution*Ma.stretchRatio,Ma=lb.getCenterPoint(),Ma=new a.geometry.Point(Ma.getX()-b,Ma.getY()+c,Ma.getSRID()),lb=lb.getUniverse().getZoomLevelNumber();Za+na.zoomIncrement>=lb?na.submap.setMapCenterAndZoomLevel(Ma,lb-1):na.submap.setMapCenterAndZoomLevel(Ma,
Za+na.zoomIncrement);na.X=-b;na.Y=c}})}).mouseup(function(){a.$(this).css("cursor","default")}),na.submap.$oracleMapDiv.mouseup(function(){na.flag=!1}));a.browser.touchSupported&&(this.$DecorationDiv.bind("touchstart",function(a){na.touchStart(a)}),this.map.$oracleMapDiv.bind("touchmove",function(a){na.touchMove(a)}),this.$DecorationDiv.bind("touchend",function(a){na.touchEnd(a)}));b=a.event.MapEvent;this.mainmap.on(b.I_MAP_CENTER_ZOOM,this.refreshSubMap,this);this.mainmap.on(b.MAP_RECENTERED,this.refreshSubMap,
this);a.browser.touchSupported&&(this.map.$oracleMapDiv.bind("touchstart",function(){na.mapdown=!0}),this.map.$oracleMapDiv.bind("touchmove",function(a){na.mapdown&&na.refreshSubMap(a)}),this.map.$oracleMapDiv.bind("touchend",function(){na.mapdown=!1}))},touchStart:function(){this.flag=!0},touchMove:function(){if(this.flag){var b=this.mapWidth/2-this.touchMoveX-this.width/2,c=this.mapHeight/2-this.touchMoveY-this.height/2;this.submap.$oracleMapDiv.css("cursor","pointer");var ob=this.mainmap.getMapContext(),
lb=ob.getZoomLevel(),lb=ob.getUniverse().getZoomLevels()[lb],b=b*lb.resolution,c=c*lb.resolution*lb.stretchRatio,ob=ob.getCenterPoint(),ob=new a.geometry.Point(ob.getX()-b,ob.getY()+c,ob.getSRID());this.mainmap.getMapContext().getZoomLevel()+this.zoomIncrement>=this.mainmap.getMapContext().getUniverse().getZoomLevelNumber()?this.submap.setMapCenterAndZoomLevel(ob,this.mainmap.getMapContext().getUniverse().getZoomLevelNumber()-1):this.submap.setMapCenterAndZoomLevel(ob,this.mainmap.getMapContext().getZoomLevel()+
this.zoomIncrement);this.X=-b;this.Y=c}},touchEnd:function(){this.flag=!1},setCenterAndZoomlevel:function(){this.minimized||(this.submap.setMapCenterAndZoomLevel(this.mainmap.getMapContext().getCenterPoint(),this.mainmap.getMapContext().getZoomLevel()+1),this.setRectangleFeature())}});a.control.LayerControl=a.control.MapDecoration.extend({initialize:function Db(a){Db.base.call(this);this.collapsible=this.draggable=this.isInternal=!0;a=a?a:{};a.position=a.position?a.position:{};this.left=a.offsetX?
a.offsetX:20;this.top=a.offsetY?a.offsetY:20;a.contentStyle=a.contentStyle?a.contentStyle:{};this.minWidth=this.width=parseInt(a.contentStyle.minWidth)?parseInt(a.contentStyle.minWidth):150;this.maxHeight=parseInt(a.contentStyle.maxHeight)?parseInt(a.contentStyle.maxHeight):500;a.titleStyle=a.titleStyle?a.titleStyle:{};this.title_font_size=a.titleStyle.font_size?a.titleStyle.font_size:11;this.title_font_family=a.titleStyle.font_family?a.titleStyle.font_family:"Tahoma";this.content_font_size=a.contentStyle.font_size?
a.contentStyle.font_size:11;this.content_font_family=a.contentStyle.font_family?a.contentStyle.font_family:"Tahoma";this.anchorPosition=a.anchorPosition?a.anchorPosition:1;this.layerDeleteEnable=a.layerDeleteEnable?a.layerDeleteEnable:!1;!1===a.collapsible&&(this.collapsible=!1);!1===a.draggable&&(this.draggable=!1);this.type="LayerControl";this.isHtml=!0;this.layer=this.mainmap=null},display:function ob(a,b){ob.base.call(this,a,b);this.panelDIV=this.$Content;this.mainmap=this.map;this.doinit()},
remove:function lb(){lb.base.call(this);this.map&&(this.map.$oracleMapDiv.unbind("mousemove",this.mapDiv_mousemove),this.map.$oracleMapDiv.unbind("mouseup",this.mapDiv_mouseup));this.resize=this._display=this.map=null;this.document_mousemove&&a.$(document).unbind("mousemove",this.document_mousemove);this.document_mouseup&&a.$(document).unbind("mouseup",this.document_mouseup);this.document_msup&&a.$(document).unbind("mouseup",this.document_msup)},resize:function(){this.setAnchorPosition(this.anchorPosition)},
doinit:function(){this.el=null;this.aY=this.pY=this.moveY=this.scrollTop=0;this.preStyleId=this.aftStyleId=this.preClass=this.aftClass=this.preId=this.aftId="";var b=this;this.ck4=this.ck3=this.ck2=this.ck1=!1;this.chkAll=!0;var na=0;this.flag=!1;this._width=b.width;this.v_isDrag=!1;this.offsetX=0;this.array=[];this._currentWidth=this.width;var ya={};b.currentWidth=this._currentWidth;this.setAnchorPosition(this.anchorPosition,5,5);this.mapWidth=this.map.getMapContext().getDeviceWidth();this.mapHeight=
this.map.getMapContext().getDeviceHeight();this.map.on(a.event.MapEvent.MAP_RESIZED,this.resize,this);var Qa=this.mainmap.typeArray.slice(3);0===this.mainmap.divLayers.length&&(Qa=this.mainmap.typeArray.slice(2));for(var ab=Qa.length,Za=ab-1;1<=Za;Za--)Qa[Za-1]==Qa[Za]&&Qa.splice(Za,1);for(var mb=[],Za=0,ab=Qa.length;Za<ab;Za++)!RegExp(Qa[Za],"g").test(mb.join(","))&&mb.push(Qa[Za]);Qa=mb;this.$Dom=a.$("\x3cdiv id\x3d'content' class\x3d'outDom_layerctrl'\x3e\x3c/div\x3e");this.panelDIV.append(this.$Dom);
this.touchscroll("content");this.list={};this.dataSource={};for(Za=0;Za<this.mainmap.svgLayers.length;Za++)ab=this.mainmap.svgLayers[Za].name,mb=this.mainmap.getLayerByName(ab).themeName,this.list[ab]=mb,this.dataSource[ab]=this.mainmap.getLayerByName(ab).getDataSouce();for(Za=0;Za<Qa.length;Za++)if(0!==this.mainmap.nameArray[Qa[Za]].length){var Ob;if("undefined"===Qa[Za])for(Ob=!0,ab=this.mainmap.nameArray[Qa[Za]].length-1;0<=ab;ab--)this.mainmap.getLayerByName(this.mainmap.nameArray[Qa[Za]][ab])&&
"ii_oracle_maps_internal_others"!==this.mainmap.getLayerByName(this.mainmap.nameArray[Qa[Za]][ab]).name&&"ii_oracle_maps_internal_editing"!==this.mainmap.getLayerByName(this.mainmap.nameArray[Qa[Za]][ab]).name&&this.mainmap.getLayerByName(this.mainmap.nameArray[Qa[Za]][ab]).layerType==a.LayerTypes.VECTOR&&(Ob=!1);if(!Ob){na++;mb=document.createElement("div");mb.id="dom"+Za;mb.setAttribute("style","position:absolute");mb.setAttribute("style","padding-top:10px;padding-left:9px;height:20px;width:"+(this.width-
9+2)+"px;background:#F5F5F9;border: 0px solid #C6CAD5");var Eb=document.createElement("img");Eb.setAttribute("name",Qa[Za]);Eb.setAttribute("type","checkbox");Eb.setAttribute("value",Qa[Za]);Eb.setAttribute("checked","true");Eb.src=a.gv.resourcePath()+"checkMark_readonly.png";Eb.setAttribute("style","padding-left:6px;display:'';");ab=document.createElement("img");ab.src=a.gv.resourcePath()+"zoomout.gif";ab.alt=Qa[Za];a.browser.touchSupported||this.typeCheckBoxEvent(Eb,"click");a.browser.touchSupported&&
this.typeCheckBoxEvent(Eb,"touchstart");var zb=document.createElement("text");zb.id="typeText"+na;a.$(zb).addClass("typeText_layerctrl");a.$(zb).css({"font-size":this.content_font_size,"font-family":this.content_font_family});var pb;pb="undefined"==Qa[Za]?document.createTextNode("vector layers"):document.createTextNode(Qa[Za]);zb.appendChild(pb);a.browser.touchSupported||(ya[ab.alt]=1,a.$(ab).click(function(){1==ya[a.$(this)[0].alt]?(a.$("img[name \x3d "+this.alt+"]")[0].setAttribute("style","display:none"),
a.$("."+this.alt).css({display:"none"}),a.$(".style_"+this.alt).css({display:"none"}),b.adjustSize(),this.src=a.gv.resourcePath()+"zoomin.gif",ya[a.$(this)[0].alt]=0):(a.$("img[name \x3d "+this.alt+"]")[0].setAttribute("style","padding-left:3px;display:inline;"),a.$("."+this.alt).css({display:""}),b.adjustSize(),this.src=a.gv.resourcePath()+"zoomout.gif",ya[a.$(this)[0].alt]=1)}));mb.appendChild(ab);mb.appendChild(Eb);mb.appendChild(zb);b.$Dom.append(mb);a.$(mb).height(a.$(zb).height()+7);for(mb=
this.mainmap.nameArray[Qa[Za]].length-1;0<=mb;mb--)if(this.mainmap.getLayerByName(this.mainmap.nameArray[Qa[Za]][mb])&&!this.mainmap.getLayerByName(this.mainmap.nameArray[Qa[Za]][mb]).ignoreLayerControl&&"ii_oracle_maps_internal_editing"!=this.mainmap.getLayerByName(this.mainmap.nameArray[Qa[Za]][mb]).name&&"ii_oracle_maps_internal_others"!=this.mainmap.getLayerByName(this.mainmap.nameArray[Qa[Za]][mb]).name&&this.mainmap.getLayerByName(this.mainmap.nameArray[Qa[Za]][mb]).layerType==a.LayerTypes.VECTOR){Eb=
document.createElement("div");Eb.id="item"+na+mb;Eb.className="item "+Qa[Za];Eb.setAttribute("style","display:'';padding-left:20px;height:20px;width:"+(this.width-20+2)+"px;background:#F5F5F9;border-top:0px solid white");Eb.setAttribute("draggable","false");Eb.setAttribute("z-index","999999");this.layerDeleteEnable&&(zb=document.createElement("img"),zb.setAttribute("style","display:none;margin-left:-10px;padding-top:6px;width:12px;height:12px"),zb.src=a.gv.resourcePath()+"cross.png",zb.setAttribute("value",
this.mainmap.nameArray[Qa[Za]][mb]),zb.setAttribute("name","deletebutton_layercontrol"),a.$(zb).bind("click touchstart",function(){b.mainmap.removeLayer(b.mainmap.getLayerByName(a.$(this).attr("value")))}),a.$(zb).bind("mouseover",function(c){c.stopPropagation();a.$(this)[0].src=a.gv.resourcePath()+"delete_ena.png";b.layerDeleteEnable&&a.$(this).css({display:""});a.$(this).css({cursor:"pointer"})}),a.$(zb).bind("mouseout",function(){a.$(this)[0].src=a.gv.resourcePath()+"cross.png"}),Eb.appendChild(zb));
pb=document.createElement("img");pb.setAttribute("name","item_"+Qa[Za]);pb.setAttribute("type","checkbox");pb.setAttribute("value",this.mainmap.nameArray[Qa[Za]][mb]);pb.className=this.mainmap.nameArray[Qa[Za]][mb];pb.setAttribute("checked","true");pb.setAttribute("style","padding-left:6px;padding-top:6px");pb.src=a.gv.resourcePath()+"checkMark_readonly.png";a.$(pb).mouseover(function(c){b.layerDeleteEnable&&a.$(this).prev().css({display:""});c.stopPropagation()}).mousedown(function(a){a.stopPropagation()});
a.browser.touchSupported||(this.itemCheckBoxEvent(pb,"click"),this.mainmap.getLayerByName(this.mainmap.nameArray[Qa[Za]][mb]).visible||a.$(pb).click());a.browser.touchSupported&&(this.itemCheckBoxEvent(pb,"touchstart"),this.mainmap.getLayerByName(this.mainmap.nameArray[Qa[Za]][mb]).visible||a.$(pb).trigger("touchstart"));zb=document.createElement("text");zb.id="itemText"+na+mb;a.$(zb).addClass("itemText_layerctrl");a.$(zb).css({"font-size":this.content_font_size,"font-family":this.content_font_family});
var Ib=document.createTextNode(this.mainmap.nameArray[Qa[Za]][mb]);zb.appendChild(Ib);Eb.appendChild(pb);Eb.appendChild(zb);a.browser.touchSupported||a.$(zb).mouseover(function(c){a.$(this).css({cursor:"pointer","font-weight":"600"});b.layerDeleteEnable&&a.$(this).prev().prev().css({display:""});c.stopPropagation()}).bind("mouseout",function(c){a.$(this).css({cursor:"default","font-weight":"normal"});b.layerDeleteEnable&&a.$(this).prev().prev().css({display:"none"});c.stopPropagation()}).bind("mousedown",
function(a){a.stopPropagation()});a.browser.touchSupported&&(a.$(zb).bind("touchend",function(c){a.$(this).css({cursor:"default","font-weight":"normal"});b.layerDeleteEnable&&a.$(this).prev().prev().css({display:"none"});c.stopPropagation()}),a.$(zb).bind("touchstart",function(a){a.stopPropagation()}));if(!a.browser.touchSupported){var nb=1,tb;a.$(zb).click(function(){1==nb?("none"==a.$("#style"+a.$(this).attr("id")).css("display")?(a.$("#style"+a.$(this).attr("id")).css({display:""}),tb=this,b.getThemeStyle(tb)):
a.$("#style"+a.$(this).attr("id")).css({display:"none"}),b.adjustSize(),nb=0):("block"==a.$("#style"+a.$(this).attr("id")).css("display")||""===a.$("#style"+a.$(this).attr("id")).css("display")?a.$("#style"+a.$(this).attr("id")).css({display:"none"}):(a.$("#style"+a.$(this).attr("id")).css({display:""}),tb=this,b.getThemeStyle(tb)),b.adjustSize(),nb=1)})}a.browser.touchSupported&&b.touchEvent(ab,zb);pb=document.createElement("div");pb.id="styleitemText"+na+mb;pb.setAttribute("style","display:none;padding-left:40px;height:20;width:"+
(this.width-40+2)+"px;background:#ECF9FF;border-top:0px solid white;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;");pb.className="style style_"+Qa[Za]+" style_"+this.mainmap.nameArray[Qa[Za]][mb];Ib=document.createElement("text");Ib.id="styleTextitemText"+na+mb;a.$(Ib).addClass("styleText_layerctrl");a.$(Ib).css({"font-size":this.content_font_size,"font-family":this.content_font_family});var Hb=document.createTextNode(""),ab=document.createElement("img");ab.id="imgitemText"+na+mb;ab.setAttribute("style",
"width:18px;height:18px;");ab.setAttribute("value",this.mainmap.nameArray[Qa[Za]][mb]);pb.appendChild(ab);Ib.appendChild(Hb);pb.appendChild(Ib);b.$Dom.append(Eb);b.$Dom.append(pb);a.$(Eb).height(a.$(zb).height()+10);a.$(pb).mouseover(function(){a.$(this).css({cursor:"default"})})}a.browser.touchSupported||a.$("#dom"+Za).mouseover(function(){a.$(this).css({cursor:"default"});b.flag&&a.$(this).css({background:"#B8DFFD","border-bottom":"2px solid black",opacity:"1",cursor:"n-resize"})}).mouseout(function(){a.$(this).css({background:"#ECF9FF",
"border-bottom":"0px solid black","border-top":"0px solid black",opacity:"1"})}).bind("mouseup",function(c){b.flag&&0<a.$(this).find("img[alt]").attr("src").indexOf("zoomin")&&a.$(this).find("img[alt]").click();b.touchFlag&&0<a.$(this).find("img[alt]").attr("src").indexOf("zoomin")&&a.$(this).find("img[alt]").trigger("touchstart");b.itemMoveEventOnTypeDiv(c,this);a.browser.touchSupported&&(b.flag=!1,b.touchFlag=!1,b.ff=!1)});a.browser.touchSupported&&a.$("#dom"+Za).bind("touchstart",function(c){b.flag&&
0<a.$(this).find("img[alt]").attr("src").indexOf("zoomin")&&a.$(this).find("img[alt]").click();b.touchFlag&&0<a.$(this).find("img[alt]").attr("src").indexOf("zoomin")&&a.$(this).find("img[alt]").trigger("touchstart");b.itemMoveEventOnTypeDiv(c,this);a.browser.touchSupported&&(b.flag=!1,b.touchFlag=!1,b.ff=!1)});a.browser.touchSupported||a.$("div[id^\x3d'item']").each(function(){a.$(this)[0].onmousedown=function(na){3==na.which?alert("right click event!"):(a.$("div[id^\x3d'item']").each(function(){a.$(this).css({background:"#ECF9FF"})}),
a.$(this).css({background:"gray"}),b.scrollTop=a.$(b.$Dom)[0].scrollTop,b.flag=!0,b.preId=this.id,b.preStyleId="styleitemText"+this.id.substring(4),b.preClass=a.$(this).attr("class"),b.pY=(na||c.event).clientY,b.cloneDiv(na))}});b.touchFlag=!1;b.ff=!1;a.$("div[id^\x3d'item']").bind("touchstart",function(){if(!b.touchFlag){var c=[],na=a.util.DomUtil.getTouchesPosition(event);c.push(na);b.flag=!0;b.preId=this.id;b.preStyleId="styleitemText"+this.id.substring(4);b.preClass=a.$(this).attr("class");b.pY=
c[0].y;b.pX=c[0].x;b.touchFlag=!0;a.$(this).css({background:"#B8DFFD"})}}).bind("touchend",function(){b.ff=b.touchFlag?!0:!1;a.$("div[id^\x3d'item']").css({background:"#ECF9FF"})});a.browser.touchSupported||a.$("div[id^\x3d'item']").click(function(){a.$(this).css({background:"#B8DFFD",cursor:"n-resize"})}).mouseover(function(){b.layerDeleteEnable&&a.$(a.$(this).find("img")[0]).css({display:""});a.$(this).css({background:"#B8DFFD"});b.flag&&a.$(this).css({"border-bottom":"2px solid black",opacity:"1"});
a.$(this).css({cursor:"n-resize"})}).mouseout(function(){b.layerDeleteEnable&&a.$(a.$(this).find("img")[0]).css({display:"none"});a.$(this).css({background:"#ECF9FF","border-top":"0px solid white","border-bottom":"0px solid white"});b.flag?a.$("#"+b.preId).css({background:"gray"}):(a.$(this)[0].id==b.preId&&(b.preId=""),a.$("div[id^\x3d'item']").each(function(){a.$(this).css({background:"#ECF9FF"})}))}).bind("mouseup",function(a){b.itemMoveEventOnItemDiv(a,this)})}}a.browser.touchSupported&&a.$("div[id^\x3d'item']").bind("touchstart",
function(a){b.itemMoveEventOnItemDiv(a,this)});this.$Dom.height()>this.maxHeight&&this.$Dom.height(this.maxHeight);na=document.createElement("div");na.id="v_drag";a.browser.touchSupported?na.setAttribute("style","cursor: e-resize;z-index:5000000;position:absolute;top:0px;left:"+(parseInt(this.width)-10)+"px;height:"+this.$title.height()+"px;width:12px;background:#E0E0E0;border:0px solid gray"):na.setAttribute("style","cursor: e-resize;z-index:5000000;position:absolute;top:0px;left:"+this.width+"px;height:"+
this.$title.height()+"px;width:2px;background:#E0E0E0;border:0px solid gray");this.panelDIV[0].appendChild(na);this.mouseEvent();a.$("img[class][type\x3d'checkbox'][checked\x3d'true']").each(function(){b.array.push(a.$(this).attr("value"))});b.array=[];this.height=this.$Dom.height();this.setAnchorPosition(this.anchorPosition,5,5);this.panelDIV.height(this.$Dom.height())},typeCheckBoxEvent:function(b,c){var ya=this,Qa=!0;a.$(b).mouseover(function(){a.$(this).css({cursor:"default"})});a.$(b).bind(c,
function(){"false"==a.$(this)[0].getAttribute("checked")&&(Qa=!1);Qa?(ya.chkAll=!1,a.$(this)[0].setAttribute("checked","false"),a.$(this)[0].src=a.gv.resourcePath()+"checkMark_NS_readonly.png",a.$("img[name \x3d item_"+this.name+"]").attr("src",a.gv.resourcePath()+"checkMark_NS_readonly.png"),a.$("img[name \x3d item_"+this.name+"]").each(function(){a.$(this)[0].setAttribute("checked","false");ya.map.getLayerByName(a.$(this).attr("value")).setVisible(!1)}),Qa=!1):(ya.chkAll=!0,a.$(this)[0].setAttribute("checked",
"true"),a.$(this)[0].src=a.gv.resourcePath()+"checkMark_readonly.png",a.$("img[name \x3d item_"+this.name+"]").attr("src",a.gv.resourcePath()+"checkMark_readonly.png"),a.$("img[name \x3d item_"+this.name+"]").each(function(){a.$(this)[0].setAttribute("checked","true");ya.map.getLayerByName(a.$(this).attr("value")).setVisible(!0)}),Qa=!0)})},itemCheckBoxEvent:function(b,c){var ya=this,Qa=!0;a.$(b).mouseover(function(){a.$(this).css({cursor:"default"})});a.$(b).bind(c,function(b){b.stopPropagation();
Qa="true"==a.$(this)[0].getAttribute("checked")?!0:!1;var c=0;Qa?(a.$("img[name \x3d "+this.name+"]").each(function(){"true"==a.$(this)[0].getAttribute("checked")&&(c+=1)}),a.$(this)[0].setAttribute("checked","false"),b=this.name.substr(5),a.$(this)[0].src=a.gv.resourcePath()+"checkMark_NS_readonly.png",2>c&&(a.$("img[name \x3d "+b+"]")[0].src=a.gv.resourcePath()+"checkMark_NS_readonly.png"),ya.map.getLayerByName(a.$(this).attr("value")).setVisible(!1)):(a.$(this)[0].setAttribute("checked","true"),
b=this.name.substr(5),a.$(this)[0].src=a.gv.resourcePath()+"checkMark_readonly.png",a.$("img[name \x3d "+b+"]")[0].src=a.gv.resourcePath()+"checkMark_readonly.png",ya.map.getLayerByName(a.$(this).attr("value")).setVisible(!0))})},typeDivEvent:function(){},itemDivEvent:function(){},mouseEvent:function(){var b=this;a.$("#v_drag").mousedown(function(a){b.v_isDrag=!0;b.offsetX=a.clientX}).mouseup(function(){b.v_isDrag=!1;b._currentWidth=b._width;b.currentWidth=b._currentWidth});this.panelDIV.mouseup(function(){b.v_isDrag=
!1;b._currentWidth=b._width;b.currentWidth=b._currentWidth});this.document_mouseup=function(){b.v_isDrag=!1;b._currentWidth=b._width;b.currentWidth=b._currentWidth};a.$(document).mouseup(this.document_mouseup);a.$("#v_drag").mouseout(function(){b.$title.removeClass("titleStyleDwn_layerctrl");b.$title.removeClass("titleStyleOvr_layerctrl");b.$title.addClass("titleStyleEna_layerctrl")});b.mapDiv_mousemove=function(na){b.v_isDrag&&(na=c.event?c.event:na,b._width=na.clientX-b.offsetX+b._currentWidth,
b._width>=b.minWidth?(a.$("#content div").width(b._width-9+2),a.$(".item").width(b._width-20+2),a.$(".style").width(b._width-49+11),b.panelDIV.width(b._width),a.$("#v_drag")[0].style.left=b._width+"px",b.$title.width(b._width-6)):b._width=b.minWidth)};b.mapDiv_mouseup=function(){b.v_isDrag=!1;b._currentWidth=b._width;b.currentWidth=b._currentWidth};this.map.$oracleMapDiv.mousemove(b.mapDiv_mousemove);this.map.$oracleMapDiv.mouseup(b.mapDiv_mouseup);this.$title.mouseup(function(c){c.stopPropagation();
b.v_isDrag=!1;b._currentWidth=b._width;b.currentWidth=b._currentWidth;a.$(this).removeClass("titleStyleEna_layerctrl");a.$(this).removeClass("titleStyleDwn_layerctrl");a.$(this).addClass("titleStyleOvr_layerctrl");b.flag=!1;a.$("div[id^\x3d'item']").each(function(){a.$(this).css({background:"#ECF9FF"})});b.el&&(b.container[0].removeChild(b.el),b.el=null)}).mouseover(function(){b.draggable||a.$(this).css({cursor:"default"});b.dragging?(a.$(this).removeClass("titleStyleEna_layerctrl"),a.$(this).removeClass("titleStyleOvr_layerctrl"),
a.$(this).addClass("titleStyleDwn_layerctrl")):(a.$(this).removeClass("titleStyleEna_layerctrl"),a.$(this).removeClass("titleStyleDwn_layerctrl"),a.$(this).addClass("titleStyleOvr_layerctrl"))}).mousedown(function(){a.$(this).removeClass("titleStyleEna_layerctrl");a.$(this).removeClass("titleStyleOvr_layerctrl");a.$(this).addClass("titleStyleDwn_layerctrl")}).mouseout(function(){b.dragging?(a.$(this).removeClass("titleStyleEna_layerctrl"),a.$(this).removeClass("titleStyleOvr_layerctrl"),a.$(this).addClass("titleStyleDwn_layerctrl")):
(a.$(this).removeClass("titleStyleDwn_layerctrl"),a.$(this).removeClass("titleStyleOvr_layerctrl"),a.$(this).addClass("titleStyleEna_layerctrl"))});a.browser.touchSupported&&(a.$("#v_drag").bind("touchstart",function(c){b.v_isDrag=!0;var ya=[];c=a.util.DomUtil.getTouchesPosition(c);ya.push(c);b.offsetX=ya[0].x}),a.$("#v_drag").bind("touchend",function(){b.v_isDrag=!1;b._currentWidth=b._width;b.currentWidth=b._currentWidth}),a.$("#v_drag").bind("touchmove",function(c){if(b.v_isDrag){var ya=[];c=a.util.DomUtil.getTouchesPosition(c);
ya.push(c);b._width=ya[0].x-b.offsetX+b._currentWidth;b._width>b.minWidth?(a.$("#content div").width(b._width-9+2),a.$(".item").width(b._width-20+2),a.$(".style").width(b._width-49+11),b.panelDIV.width(b._width),a.$("#v_drag")[0].style.left=b._width-10+"px",b.$title.width(b._width-6)):b._width=b.width}}),this.$title.bind("touchend",function(c){c.stopPropagation();b.v_isDrag=!1;b._currentWidth=b._width;b.currentWidth=b._currentWidth;a.$(this).removeClass("titleStyleDwn_layerctrl");a.$(this).removeClass("titleStyleOvr_layerctrl");
a.$(this).addClass("titleStyleEna_layerctrl")}).bind("touchstart",function(){a.$(this).removeClass("titleStyleEna_layerctrl");a.$(this).removeClass("titleStyleOvr_layerctrl");a.$(this).addClass("titleStyleDwn_layerctrl")}))},itemMoveEventOnTypeDiv:function(b,c){var ya=this;a.$("div[id^\x3d'item']").css({background:"#ECF9FF"});a.$(c).css({cursor:"default",background:"#ECF9FF","border-bottom":"0px solid black","border-top":"0px solid black",opacity:"1"});if(ya.flag){ya.el&&(ya.container[0].removeChild(ya.el),
ya.el=null);ya.aftId=c.id;ya.aftClass="item "+a.$(c).find("img[name]").attr("name");ya.aftStyleId="styleitemText"+c.id.substring(4);c.$preDiv=a.$("#"+ya.preId);c.$aftDiv=a.$("#"+ya.aftId);c.$preStyleDiv=a.$("#"+ya.preStyleId);c.$aftStyleDiv=a.$("#"+ya.aftStyleId);c.$temp=c.$aftDiv.next();var Qa=c.$preDiv.attr("class"),Qa=Qa.substring(5),ab=a.$(".item."+Qa).length;if(1==ab&&Qa==a.$(c).find("img[name]").attr("name"))ya.flag=!1;else{1==ab?a.$("img[name\x3d"+Qa+"]").parent().find("img").css("display",
"none"):a.$("img[name\x3d"+Qa+"]").parent().find("img").css({display:"inline"});0===a.$(".item."+a.$(c).find("img[name]").attr("name")).length&&a.$("img[name\x3d"+a.$(c).find("img[name]").attr("name")+"]").parent().find("img").css({display:"inline"});c.$preDiv.insertAfter(c.$aftDiv);c.$preStyleDiv.insertAfter(c.$preDiv);c.$preDiv.attr("class",ya.aftClass);Qa=c.$preStyleDiv.attr("class").split(" ");Qa[1]="style_"+a.$(c).find("img[name]").attr("name");c.$preStyleDiv.attr("class",Qa[0]+" "+Qa[1]+" "+
Qa[2]);ya.aftClass=ya.aftClass.replace(" ","_");ya.layerDeleteEnable?a.$("#"+ya.preId).children().eq(1).attr("name",ya.aftClass):a.$("#"+ya.preId).children().eq(0).attr("name",ya.aftClass);ya.flag=!1;a.$("img[class][type\x3d'checkbox']").each(function(){ya.array.push(a.$(this).attr("value"))});Qa=ya.array.length;for(ab=ya.array.length-1;0<=ab;ab--)ya.map.getLayerByName(ya.array[ab]).setZIndex(Qa+1-ab);a.$("img[class][type\x3d'checkbox']").each(function(){"false"==a.$(this)[0].getAttribute("checked")&&
ya.map.getLayerByName(a.$(this).attr("value")).setVisible(!1)});ya.array=[];var Za=ya.aftClass.substring(5),mb=ya.preClass.substring(5);a.$("img[name \x3d item_"+Za+"]").each(function(){"false"==a.$(this)[0].getAttribute("checked")&&(ya.ck2=!0);a.$("img[name \x3d "+Za+"]")[0].src=a.gv.resourcePath()+"checkMark_readonly.png"});ya.ck2&&(a.$("img[name \x3d "+Za+"]")[0].src=a.gv.resourcePath()+"checkMark_NS_readonly.png",ya.ck2=!1);ya.ck4=!1;a.$("img[name \x3d item_"+mb+"]").each(function(){"false"==
a.$(this)[0].getAttribute("checked")&&(ya.ck4=!0);a.$("img[name \x3d"+mb+"]")[0].src=a.gv.resourcePath()+"checkMark_NS_readonly.png"});ya.ck4||(a.$("img[name \x3d"+mb+"]")[0].src=a.gv.resourcePath()+"checkMark_readonly.png",ya.ck4=!1)}}},itemMoveEventOnItemDiv:function(b,na){var ya=this;a.browser.touchSupported||(ya.ff=!0);if(ya.ff){a.$("div[id^\x3d'item']").css({background:"#ECF9FF"});a.$(na).css({background:"#B8DFFD",cursor:"n-resize"});if(ya.flag){a.$(na).css({"border-top":"0px solid white","border-bottom":"0px solid white"});
ya.el&&(ya.container[0].removeChild(ya.el),ya.el=null);ya.aftId=na.id;ya.aftClass=a.$(na).attr("class");ya.aftStyleId="styleitemText"+na.id.substring(4);var Qa;a.browser.touchSupported||(Qa=b||c.event);na.$preDiv=a.$("#"+ya.preId);na.$aftDiv=a.$("#"+ya.aftId);var ab=na.$preDiv.attr("class"),ab=ab.substring(5);1==a.$(".item."+ab).length?a.$("img[name\x3d"+ab+"]").parent().find("img").css("display","none"):a.$("img[name\x3d"+ab+"]").parent().find("img").css({display:"inline"});0!==a.$(".item."+ya.aftClass.substring(5)).length&&
a.$("img[name\x3d"+ya.aftClass.substring(5)+"]").parent().find("img").css({display:"inline"});na.$preStyleDiv=a.$("#"+ya.preStyleId);na.$aftStyleDiv=a.$("#"+ya.aftStyleId);if(na.$preDiv[0]!=na.$aftDiv[0]){a.browser.touchSupported?(Qa=[],ab=a.util.DomUtil.getTouchesPosition(event),Qa.push(ab),ya.aY=Qa[0].y):ya.aY=Qa.clientY;ya.moveY=ya.aY-ya.pY;na.$temp=na.$aftDiv.next();na.$temp1=na.$preDiv.next();ya.preId!=ya.aftId&&(0<ya.moveY&&(na.$aftDiv[0].nextSibling||na.$aftDiv[0].previousSibling==na.$preDiv[0]?
(na.$preDiv.next().next(),na.$preDiv.insertAfter(na.$aftDiv)):(na.$tt=a.$(na.$aftDiv[0].previousSibling),na.$aftDiv.insertBefore(na.$preDiv),na.$preDiv.insertAfter(na.$tt)),na.$preStyleDiv.insertAfter(na.$preDiv),na.$aftStyleDiv.insertAfter(na.$aftDiv),ya.changeClassName(na),na.$preDiv.attr("class",ya.aftClass),ya.aftClass=ya.aftClass.replace(" ","_"),ya.layerDeleteEnable?a.$("#"+ya.preId).children().eq(1).attr("name",ya.aftClass):a.$("#"+ya.preId).children().eq(0).attr("name",ya.aftClass)),0>ya.moveY&&
(na.$aftDiv[0].previousSibling||na.$aftDiv[0].nextSibling==na.$preDiv[0]?na.$preDiv.insertAfter(na.$aftDiv):(na.$qq=a.$(na.$aftDiv[0].nextSibling),na.$aftDiv.insertBefore(na.$preDiv),na.$preDiv.insertBefore(na.$qq)),na.$preStyleDiv.insertAfter(na.$preDiv),na.$aftStyleDiv.insertAfter(na.$aftDiv),ya.changeClassName(na),na.$preDiv.attr("class",ya.aftClass),ya.aftClass=ya.aftClass.replace(" ","_"),ya.layerDeleteEnable?a.$("#"+ya.preId).children().eq(1).attr("name",ya.aftClass):a.$("#"+ya.preId).children().eq(0).attr("name",
ya.aftClass)));a.$("img[class][type\x3d'checkbox']").each(function(){ya.array.push(a.$(this).attr("value"))});Qa=ya.array.length;for(ab=ya.array.length-1;0<=ab;ab--)ya.map.getLayerByName(ya.array[ab]).setZIndex(Qa+1-ab);a.$("img[class][type\x3d'checkbox']").each(function(){"false"==a.$(this)[0].getAttribute("checked")&&ya.map.getLayerByName(a.$(this).attr("value")).setVisible(!1)});ya.array=[];var Za=a.$(na).attr("class").substring(5),mb=ya.preClass.substring(5);a.$("img[name \x3d item_"+Za+"]").each(function(){"false"==
a.$(this)[0].getAttribute("checked")&&(ya.ck3=!0);a.$("img[name \x3d"+Za+"]")[0].src=a.gv.resourcePath()+"checkMark_readonly.png"});ya.ck3&&(a.$("img[name \x3d"+Za+"]")[0].src=a.gv.resourcePath()+"checkMark_NS_readonly.png",ya.ck3=!1);ya.ck4=!1;a.$("img[name \x3d item_"+mb+"]").each(function(){"false"==a.$(this)[0].getAttribute("checked")&&(ya.ck4=!0);a.$("img[name \x3d"+mb+"]")[0].src=a.gv.resourcePath()+"checkMark_NS_readonly.png"});ya.ck4||(a.$("img[name \x3d"+mb+"]")[0].src=a.gv.resourcePath()+
"checkMark_readonly.png",ya.ck4=!1)}}ya.flag=!1;ya.touchFlag=!1;a.browser.android&&a.$(na).css({background:"#ECF9FF"})}},changeClassName:function(b){var c=b.$preStyleDiv.attr("class").split(" ");c[1]=this.layerDeleteEnable?"style_"+a.$(a.$(b).find("img[name]")[1]).attr("name").slice(5):"style_"+a.$(b).find("img[name]").attr("name").slice(5);b.$preStyleDiv.attr("class",c[0]+" "+c[1]+" "+c[2])},touchEvent:function(b,c){var ya=this,Qa=!0;a.$(b).bind("touchstart",function(){Qa?(a.$("img[name \x3d "+this.alt+
"]")[0].setAttribute("style","display:none"),a.$("."+this.alt).css({display:"none"}),a.$(".style_"+this.alt).css({display:"none"}),ya.adjustSize(),this.src=a.gv.resourcePath()+"zoomin.gif",Qa=!1):(a.$("img[name \x3d "+this.alt+"]")[0].setAttribute("style","padding-left:3px;display:inline;"),a.$("."+this.alt).css({display:""}),ya.adjustSize(),this.src=a.gv.resourcePath()+"zoomout.gif",Qa=!0)});var ab=!0;a.$(c).bind("touchstart",function(b){b.stopPropagation();ab?(a.$("#style"+a.$(this).attr("id")).css({display:""}),
ya.getThemeStyle(this),ya.adjustSize(),ab=!1):(a.$("#style"+a.$(this).attr("id")).css({display:"none"}),ya.adjustSize(),ab=!0);a.browser.android&&ya.panelDIV.height(ya.$Dom.height())})},getThemeStyle:function(b){var c=this;a.util.HttpRequest.send("/mapviewer/omserver",{xml_request:'\x3cnon_map_request\x3e\x3cget_theme_info data_source\x3d"'+c.dataSource[a.$(b).text()]+'" theme\x3d"'+c.list[a.$(b).text()]+'"/\x3e\x3c/non_map_request\x3e'},function(ya){a.$("#img"+a.$(b).attr("id"))[0]&&(ya=a.$(ya).find("theme_style[label\x3d'false']").attr("name"),
a.$("#styleText"+a.$(b).attr("id")).text(ya),a.$("#img"+a.$(b).attr("id"))[0].src="/mapviewer/omserver?sty\x3d"+ya+"\x26ds\x3d"+c.dataSource[a.$(b).text()],c.map&&c.map.getLayerByName(a.$("#img"+a.$(b).attr("id")).attr("value")).customImg&&(a.$("#img"+a.$(b).attr("id"))[0].src=c.map.getLayerByName(a.$("#img"+a.$(b).attr("id")).attr("value")).customImg),c.map&&c.map.getLayerByName(a.$("#img"+a.$(b).attr("id")).attr("value")).getRenderingStyle()&&(a.$("#img"+a.$(b).attr("id"))[0].src=c.map.getLayerByName(a.$("#img"+
a.$(b).attr("id")).attr("value")).getRenderingStyle().src))},"xml")},cloneDiv:function(b){for(var na=this,ya=a.$("div[id^\x3d'item']"),Qa=0;Qa<ya.length;Qa++)ya[Qa].pos=na.getElementPos(ya[Qa]),ya[Qa].size=na.getElementSize(ya[Qa]);b=b||c.event;b=b.target||b.srcElement;"deletebutton_layercontrol"!=a.$(b).attr("name")&&(na.el=b.cloneNode(!0),na.el.style.position="absolute",na.el.style.left=b.pos.x-7+"px",na.el.style.display="none",na.el.style.width=b.size.width-20+"px",na.el.style.height=b.size.height+
"px",na.el.style.border="1px solid #d4d4d4",na.el.style.background="lightgray",na.el.style.opacity="1",na.el.style.color="red",this.container[0].appendChild(na.el),this.document_mousemove=function(b){if(na.flag){b=b||c.event;var ya=na.getMousePos(b);na.el.style.display="";na.el.style.left=na.left;na.el.style.top=parseInt(ya.y)-parseInt(na.map.$oracleMapDiv.parent()[0].offsetTop)-10+"px";parseInt(na.el.style.top)<na.top+na.$title.height()&&(na.el.style.top=na.top+na.$title.height()+"px");parseInt(na.el.style.top)>
na.top+na.$Dom.height()-10&&(na.el.style.top=na.top+na.$Dom.height()-10+"px");na.aY=b.clientY;a.$(na.$Dom)[0].scrollTop=na.scrollTop+(na.aY-na.pY)*(a.$(na.$Dom)[0].scrollHeight/a.$(na.$Dom).height())}},this.document_msup=function(){na.flag=!1;a.$("div[id^\x3d'item']").each(function(){a.$(this).css({background:"#ECF9FF"})});na.el&&(na.container[0].removeChild(na.el),na.el=null)},a.$(document).mousemove(this.document_mousemove),a.$(document).mouseup(this.document_msup),a.$(na.$Dom).mouseup(function(){na.flag=
!1;na.el&&(na.container[0].removeChild(na.el),na.el=null)}).mouseout(function(){na.map.$oracleMapDiv.css({cursor:"default"})}))},adjustSize:function(){this.$Dom.height()>this.maxHeight+1&&this.$Dom.height(this.maxHeight);this.panelDIV.height(this.$Dom.height());a.$("#v_drag").height(this.$title.height())},getMousePos:function(a){return{x:a.pageX||a.clientX+document.body.scrollLeft,y:a.pageY||a.clientY+document.body.scrollTop}},getElementPos:function(a){return{x:a.offsetParent?a.offsetLeft+arguments.callee(a.offsetParent).x:
a.offsetLeft,y:a.offsetParent?a.offsetTop+arguments.callee(a.offsetParent).y:a.offsetTop}},getElementSize:function(a){return{width:a.offsetWidth,height:a.offsetHeight}}});a.control.MapTypeControl=a.control.MapDecoration.extend({initialize:function(b,c,ya){this.map=b;this.tileLayer=c;this.enableTypes=ya?ya.enableTypes:null;this.type=ya?ya.type:null;var Qa=this;this.addListener=function(){a.$("#div_type").bind("click touchend",function(b){b=b.target;b.style.backgroundImage="url('"+a.gv.resourcePath()+
"button_bg_dwn.png')";b.style.color="#000000";b.style.borderColor="#e0e3e8 #606974 #606974 #e0e3e8";if(Qa.tileLayer){Qa.tileLayer.setMapType(Qa.enableTypes[b.id]);var c=document.getElementById(Qa.type);Qa.type!==b.id&&(c.style.backgroundImage="url('"+a.gv.resourcePath()+"button_bg_ena.png')",c.style.color="#003d5b",c.style.borderColor="#e0e3e8 #606974 #606974 #e0e3e8");Qa.type=b.id}}).mouseover(function(b){b=b.target;b.id!==Qa.type&&(b.style.backgroundImage="url('"+a.gv.resourcePath()+"button_bg_ovr.png')",
b.style.color="#000000")}).mouseout(function(b){b=b.target;b.id!==Qa.type&&(b.style.backgroundImage="url('"+a.gv.resourcePath()+"button_bg_ena.png')",b.style.color="#003d5b")})};if(!this.infoDecoration){b="";c=0;for(var ab in this.enableTypes)this.enableTypes[ab]&&(b=ab===this.type?b+"\x3ctd\x3e\x3ca class\x3d'selectedLinkStyle_mapTypeCtrl' id\x3d\""+ab+'" href\x3d"javascript:void(0);"\x3e '+ab+"\x3c/a\x3e\x3c/td\x3e":b+"\x3ctd\x3e\x3ca class\x3d'linkStyle_mapTypeCtrl' id\x3d\""+ab+'" href\x3d"javascript:void(0);"\x3e '+
ab+"\x3c/a\x3e\x3c/td\x3e",c+=60);0<c&&(this.infoDecoration=new a.control.MapDecoration('\x3cdiv id\x3d"div_type" style\x3d"background: white;"\x3e\x3ctable width\x3d100% cellspacing\x3d0 cellpadding\x3d0\x3e\x3ctr\x3e'+b+"\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e",{mapType:"mapTypeControl",offsetX:10,offsetY:10,draggable:!1,height:20,contentStyle:{"border-style":"solid","border-color":"#ffffff",border:"0px",backgroundColor:"#ffffff",filter:"alpha(Opacity\x3d80)","-moz-opacity":"0.8"}}),this.infoDecoration.setAnchorPosition(3),
this.map.addMapDecoration(this.infoDecoration),this.addListener(),this.infoDecoration.$DecorationDiv.css({"z-index":5}))}},destroy:function(){this.infoDecoration&&this.map.removeMapDecoration(this.infoDecoration)}});a.filter.Filter=a.Class.extend({initialize:function(){this.filterMode=a.filter.Filter.CLIENT_SIDE;this.sql=null},setFilterMode:function(){this.filterMode=a.filter.Filter.CLIENT_SIDE},evaluate:function(a){return this.invokeClient(a)},invokeClient:function(){return!1}});a.filter.Filter.CLIENT_SIDE=
"client_side";a.filter.Equals=a.filter.Filter.extend({initialize:function na(a,b){na.base.call(this);this.filterType="equalsFilter";this.filterAttribute=a?a.toUpperCase():"";this.filterValue=b},invokeClient:function(a){return a.attributes&&a.attributes[this.filterAttribute]?(a=a.attributes[this.filterAttribute],isNaN(a)||isNaN(this.filterValue)?a===this.filterValue:parseFloat(a)===parseFloat(this.filterValue)):!1}});a.filter.NotEquals=a.filter.Filter.extend({initialize:function ya(b,c){ya.base.call(this);
this.filterType="notEqualsFilter";this.equalsFilter=new a.filter.Equals(b,c)},invokeClient:function(a){return!this.equalsFilter.evaluate(a)}});a.filter.Greater=a.filter.Filter.extend({initialize:function Qa(a,b){Qa.base.call(this);this.filterType="greaterFilter";this.filterAttribute=a?a.toUpperCase():"";this.filterValue=b},invokeClient:function(a){return a.attributes&&a.attributes[this.filterAttribute]&&a.attributes[this.filterAttribute]>this.filterValue?!0:!1}});a.filter.GreaterEquals=a.filter.Filter.extend({initialize:function ab(a,
b){ab.base.call(this);this.filterType="greaterEqualsFilter";this.filterAttribute=a?a.toUpperCase():"";this.filterValue=b},invokeClient:function(a){return a.attributes&&a.attributes[this.filterAttribute]&&a.attributes[this.filterAttribute]>=this.filterValue?!0:!1}});a.filter.Less=a.filter.Filter.extend({initialize:function Za(a,b){Za.base.call(this);this.filterType="lessFilter";this.filterAttribute=a?a.toUpperCase():"";this.filterValue=b},invokeClient:function(a){return a.attributes&&a.attributes[this.filterAttribute]&&
a.attributes[this.filterAttribute]<this.filterValue?!0:!1}});a.filter.LessEquals=a.filter.Filter.extend({initialize:function mb(a,b){mb.base.call(this);this.filterType="lessEqualsFilter";this.filterAttribute=a?a.toUpperCase():"";this.filterValue=b},invokeClient:function(a){return a.attributes&&a.attributes[this.filterAttribute]&&a.attributes[this.filterAttribute]<=this.filterValue?!0:!1}});a.filter.Between=a.filter.Filter.extend({initialize:function Ob(a,b,c){Ob.base.call(this);this.filterType="betweenFilter";
this.filterAttribute=a?a.toUpperCase():"";this.lowValue=parseFloat(b);this.highValue=parseFloat(c)},invokeClient:function(a){return a.attributes&&a.attributes[this.filterAttribute]&&parseFloat(a.attributes[this.filterAttribute])>=this.lowValue&&parseFloat(a.attributes[this.filterAttribute])<=this.highValue?!0:!1}});a.filter.Like=a.filter.Filter.extend({initialize:function Eb(a,b){Eb.base.call(this);this.filterType="likeFilter";this.filterAttribute=a?a.toUpperCase():"";this.filterValue=b},invokeClient:function(a){return a.attributes&&
a.attributes[this.filterAttribute]?this.executeLikeReg(this.filterValue,a.attributes[this.filterAttribute]):!1},executeLikeReg:function(b,c){if(b===c)return!0;var pb=""+b,Ib=""+c;-1!==pb.indexOf("_")&&(pb=pb.replace(/\_/g,"."));-1!==pb.indexOf("%")&&(pb=pb.replace(/\%/g,"[a-zA-Z0-9.@!#$^\x26*() \\s]+"));pb=new RegExp(pb);return a.notNull(Ib.match(pb))&&0<Ib.match(pb).length?Ib.match(pb)[0]===c:!1}});a.filter.InsidePolygon=a.filter.Filter.extend({initialize:function zb(a){zb.base.call(this);this.filterType=
"InsidePolygonFilter";this.filterGeom=a;this.filterMBR=this.filterGeom.getMBR()},invokeClient:function(a){var b;if(a.geo)if(a.geo.srid!==this.filterGeom.srid){var c=this;this.filterGeom.transform(a.geo.srid,function(b){c.filterGeom=b;c.evaluate(a)})}else{var nb=this.filterGeom.type;b=a.getGeometry().getMBR();if("Rectangle"===nb){if(b.getMinX()>=this.filterGeom.getMinX()&&b.getMaxX()<=this.filterGeom.getMaxX()&&b.getMinY()>=this.filterGeom.getMinY()&&b.getMaxY()<=this.filterGeom.getMaxY())return!0}else if("Polygon"===
nb){if(b.getMinX()>=this.filterMBR.getMinX()&&b.getMaxX()<=this.filterMBR.getMaxX()&&b.getMinY()>=this.filterMBR.getMinY()&&b.getMaxY()<=this.filterMBR.getMaxY()&&(this._MBRInPolygon(b,this.filterGeom)||this.geomInPolygon(a.geo,this.filterGeom)))return!0}else if("MultiPolygon"===nb&&b.getMinX()>=this.filterMBR.getMinX()&&b.getMaxX()<=this.filterMBR.getMaxX()&&b.getMinY()>=this.filterMBR.getMinY()&&b.getMaxY()<=this.filterMBR.getMaxY()&&(this._MBRInPolygon(b,this.filterGeom)||this.geomInPolygon(a.geo,
this.filterGeom)))return!0;return!1}else return!1},pointInsidePolygonRing:function(a,b,c){for(var nb=[],tb=[],Hb=c[0].length/2,Gb=0;Gb<Hb;Gb++)nb[Gb]=parseFloat(c[0][2*Gb]),tb[Gb]=parseFloat(c[0][2*Gb+1]);var Nb=0;c=0;for(Gb=Hb-1;c<Hb;Gb=c++)tb[c]>b!==tb[Gb]>b&&a<(nb[Gb]-nb[c])*(b-tb[c])/(tb[Gb]-tb[c])+nb[c]&&(Nb=!Nb);return Nb},pointInsideCircle:function(a,b,c){var nb=c.centerX,tb=c.centerY,Hb=0;(nb-a)*(nb-a)+(tb-b)*(tb-b)<c.radius*c.radius&&(Hb=!Hb);return Hb},pointInPolygon:function(a,b,c){var nb=
c.getType(),tb=0;if("Polygon"===nb)tb=c.circlePolygon?this.pointInsideCircle(a,b,c):this.pointInsidePolygonRing(a,b,c.coordinates);else if("MultiPolygon"===nb){c=c.coordinates;for(var nb=c.length,Hb=0;Hb<nb;Hb++){var Gb=this.pointInsidePolygonRing(a,b,c[Hb]);if(Gb){tb=Gb;break}}}return tb},geomInPolygon:function(a,b){var c,nb,tb;if("Point"===a.type||"OrientedPoint"===a.type){if(c=a.coordinates,this.pointInPolygon(c[0],c[1],this.filterGeom))return!0}else{if("MultiPoint"===a.type||"OrientedMultiPoint"===
a.type){nb=a.coordinates;for(tb=0;tb<nb.length;tb++)if(c=nb[tb],!this.pointInPolygon(c[0],c[1],b))return!1;return!0}if("Rectangle"===a.type)return c=a.coordinates,c.push(c[0],c[3],c[2],c[1]),this._geomInPolygon(c,b)?!0:!1;if("LineString"===a.type)return c=a.coordinates,this._geomInPolygon(c,b)?!0:!1;if("MultiLineString"===a.type){nb=a.coordinates;for(tb=0;tb<nb.length;tb++)if(c=nb[tb],!this._geomInPolygon(c,b))return!1;return!0}if("Polygon"===a.type)return c=a.coordinates[0],this._geomInPolygon(c,
b)?!0:!1;if("MultiPolygon"===a.type){nb=a.coordinates;for(tb=0;tb<nb.length;tb++)if(c=nb[tb][0],!this._geomInPolygon(c,b))return!1;return!0}}return!1},_geomInPolygon:function(a,b){var c=a.length/2;if(b.circlePolygon)return this._geomInPolygonCircle(a,b);for(var nb=0,tb=c-1;nb<c;nb++)if(!this.pointInPolygon(a[2*nb],a[2*nb+1],b)||this.segmentCrossPolygon({coordinates:[a[2*nb],a[2*nb+1],a[2*tb],a[2*tb+1]]},b))return!1;return!0},_geomInPolygonCircle:function(a,b){for(var c=a.length/2,nb=0;nb<c;nb++)if(!this.pointInPolygon(a[2*
nb],a[2*nb+1],b))return!1;return!0},_MBRInPolygon:function(a,b){return this.geomInPolygon(a,b)},segmentCrossPolygon:function(b,c){this.proxy||(this.proxy=new a.filter.AnyInteract(this.filterGeom));return this.proxy.segmentCrossPolygon(b,c)}});a.filter.All=a.filter.Filter.extend({initialize:function pb(a){pb.base.call(this);this.filterType="allFilter";this.filterArray=a},invokeClient:function(a){for(var b=0;b<this.filterArray.length;b++)if(!1===this.filterArray[b].evaluate(a))return!1;return!0}});
a.filter.And=a.filter.Filter.extend({initialize:function Ib(a,b){Ib.base.call(this);this.filterType="andFilter";this.filter1=a;this.filter2=b},invokeClient:function(a){var b=this.filter1.evaluate(a);a=this.filter2.evaluate(a);return!!(b&a)}});a.filter.Any=a.filter.Filter.extend({initialize:function nb(a){nb.base.call(this);this.filterType="anyFilter";this.filterArray=a},invokeClient:function(a){for(var b=0;b<this.filterArray.length;b++)if(!0===this.filterArray[b].evaluate(a))return!0;return!1}});
a.filter.In=a.filter.Any.extend({initialize:function tb(b,c){var Nb=[];"[object Array]"!==Object.prototype.toString.call(c)&&(c=[c]);for(var Pb=0;Pb<c.length;Pb++)Nb.push(new a.filter.Equals(b,c[Pb]));tb.base.call(this,Nb);this.filterType="inFilter"}});a.filter.IsNotNull=a.filter.Filter.extend({initialize:function Hb(a){Hb.base.call(this);this.filterType="isNotNullFilter";this.filterAttribute=a?a.toUpperCase():""},invokeClient:function(b){return a.notNull(b.attributes)&&a.notNull(b.attributes[this.filterAttribute])?
!0:!1}});a.filter.IsNull=a.filter.Filter.extend({initialize:function Gb(a){Gb.base.call(this);this.filterType="isNullFilter";this.filterAttribute=a?a.toUpperCase():""},invokeClient:function(b){return a.isNull(b.attributes)||a.isNull(b.attributes[this.filterAttribute])?!0:!1}});a.filter.Not=a.filter.Filter.extend({initialize:function Nb(a){Nb.base.call(this);this.filterType="notFilter";this.negateFilter=a},invokeClient:function(a){return!this.negateFilter.evaluate(a)}});a.filter.Or=a.filter.Filter.extend({initialize:function Pb(a,
b){Pb.base.call(this);this.filterType="orFilter";this.filter1=a;this.filter2=b},invokeClient:function(a){var b=this.filter1.evaluate(a);a=this.filter2.evaluate(a);return b||a}});a.filter.Xor=a.filter.Filter.extend({initialize:function Sb(a,b){Sb.base.call(this);this.filterType="xorFilter";this.filter1=a;this.filter2=b},invokeClient:function(a){var b=this.filter1.evaluate(a);a=this.filter2.evaluate(a);return!!(b^a)}});a.filter.AnyInteract=a.filter.Filter.extend({initialize:function Tb(a){Tb.base.call(this);
this.filterType="AnyInteractFilter";this.filterGeom=a;this.filterMBR=this.filterGeom.getMBR();this.sqlStr=null},invokeClient:function(b){if(b.geo)if(b.geo.srid!==this.filterGeom.srid){var c=this;this.filterGeom.transform(b.geo.srid,function(a){var V=a.getMBR();c.filterGeom=a;c.filterMBR=c.filterGeom.getMBR();a=b.getGeometry().getMBR();a.getMinX()>V.getMinX()&&a.getMaxX()<V.getMaxX()&&a.getMinY()>V.getMinY()&&a.getMaxY()<V.getMaxY()&&this._AnyInteractWithPolygon(b.geo,this.filterGeom);return!1})}else{var V=
b.getGeometry(),T=V.getMBR(),B=V.type,D=this.filterGeom.type;return a.isNull(T)?!1:T.getMaxX()<this.filterMBR.getMinX()||T.getMinX()>this.filterMBR.getMaxX()||T.getMaxY()<this.filterMBR.getMinY()||T.getMinY()>this.filterMBR.getMaxY()?!1:"Polygon"===D||"Rectangle"===D||"MultiPolygon"===D?this._AnyInteractWithPolygon(V,this.filterGeom):"Polygon"===B||"Rectangle"===B||"MultiPolygon"===B?this._AnyInteractWithPolygon(this.filterGeom,V):"LineString"!==D&&"MultiLineString"!==D||"LineString"!==B&&"MultiLineString"!==
B?"LineString"===D||"MultiLineString"===D?this.isPointOnLine(V,this.filterGeom):"LineString"===B||"MultiLineString"===B?this.isPointOnLine(this.filterGeom,V):this.isSamePoints(this.filterGeom,V):this.isInteractLine(V,this.filterGeom)}else return!1},_AnyInteractWithPolygon:function(a,b){return this.intersectWithPolygon(a,b)||this.hasPointsInPolygon(a,b)?!0:!1},intersectWithPolygon:function(a,b){var c=a.type,T,B,D,W,da;if("Point"===c||"OrientedPoint"===c)return this.pointInPolygon(a.getX(),a.getY(),
b);if("MultiPoint"===c||"OrientedMultiPoint"===c)for(c=a.coordinates,D=0,T=c.length;D<T;D++){if(this.pointInPolygon(c[D][0],c[D][1],b))return!0}else if("LineString"===c)for(c=a.coordinates,D=0,T=c.length/2;D<T-1;D++){if(B={coordinates:[c[2*D],c[2*D+1],c[2*(D+1)],c[2*(D+1)+1]]},this.segmentCrossPolygon(B,b))return!0}else if("MultiLineString"===c){W=a.coordinates;da=W.length;for(var ka=0;ka<da;ka++)for(c=W[ka],D=0,T=c.length/2;D<T-1;D++)if(B={coordinates:[c[2*D],c[2*D+1],c[2*(D+1)],c[2*(D+1)+1]]},this.segmentCrossPolygon(B,
b))return!0}else if("Rectangle"===c)for(c=a.coordinates,c.push(c[0],c[3],c[2],c[1]),T=c.length/2,D=0,B=T-1;D<T;B=D++){if(B={coordinates:[c[2*D],c[2*D+1],c[2*B],c[2*B+1]]},this.segmentCrossPolygon(B,b))return!0}else if("Polygon"===c)for(c=a.coordinates[0],T=c.length/2,D=0,B=T-1;D<T;B=D++){if(B={coordinates:[c[2*D],c[2*D+1],c[2*B],c[2*B+1]]},this.segmentCrossPolygon(B,b))return!0}else if("MultiPolygon"===c)for(W=a.coordinates,da=W.length,T=0;T<da;T++)for(c=W[T][0],ka=c.length/2,D=0,B=ka-1;D<ka;B=D++)if(B=
{coordinates:[c[2*D],c[2*D+1],c[2*B],c[2*B+1]]},this.segmentCrossPolygon(B,b))return!0;return!1},segmentCrossPolygon:function(a,b){var c=b.coordinates;if("Rectangle"==b.type){var T=b.coordinates,c=T[0],B=T[1],D=T[2],T=T[3],W=a.coordinates;if(W[0]>=c&&W[0]<=D&&W[1]>=B&&W[1]<=T||W[2]>=c&&W[2]<=D&&W[3]>=B&&W[3]<=T)return!0;c=[[[c,B,D,B,D,T,c,T,c,B]]]}"Polygon"===b.type&&(c=[c]);B=0;for(D=c.length;B<D;B++)for(var T=c[B][0],W=T.length/2,da=0,ka=W-1;da<W;ka=da++)if(this.segmentsStraddle(a,{coordinates:[T[2*
da],T[2*da+1],T[2*ka],T[2*ka+1]]}))return!0;return!1},segmentsStraddle:function(a,b){if(!this.rectangleScopeOverlap(a,b))return!1;var c={x:a.coordinates[2]-b.coordinates[0],y:a.coordinates[3]-b.coordinates[1]},T={x:b.coordinates[2]-b.coordinates[0],y:b.coordinates[3]-b.coordinates[1]},B={x:b.coordinates[0]-a.coordinates[0],y:b.coordinates[1]-a.coordinates[1]},D={x:b.coordinates[2]-a.coordinates[0],y:b.coordinates[3]-a.coordinates[1]},W={x:a.coordinates[2]-a.coordinates[0],y:a.coordinates[3]-a.coordinates[1]},
c=this.crossProduct({x:a.coordinates[0]-b.coordinates[0],y:a.coordinates[1]-b.coordinates[1]},T)*this.crossProduct(T,c),B=this.crossProduct(B,W)*this.crossProduct(W,D);return 0<=c&&0<=B?!0:!1},crossProduct:function(a,b){return Math.round(1E5*(a.x*b.y-a.y*b.x))/1E5},rectangleScopeOverlap:function(a,b){var c=function(a,b){var c={};a>=b?(c.max=a,c.min=b):(c.max=b,c.min=a);return c},T=c(a.coordinates[0],a.coordinates[2]),B=c(a.coordinates[1],a.coordinates[3]),D=c(b.coordinates[0],b.coordinates[2]),c=
c(b.coordinates[1],b.coordinates[3]);return T.max<D.min||T.min>D.max||B.max<c.min||B.min>c.max?!1:!0},hasPointsInPolygon:function(a,b){var c=a.type,T,B,D,W;if("Point"===c||"OrientedPoint"===c)return this.pointInPolygon(a.getX(),a.getY(),b);if("MultiPoint"===c||"OrientedMultiPoint"===c){c=0;for(B=a.coordinates.length/2;c<B;c++)if(this.pointInPolygon(a.coordinates[2*c],a.coordinates[2*c+1],b))return!0;return!1}if("LineString"===a.type){c=0;for(T=a.coordinates.length/2;c<T;c++)if(this.pointInPolygon(a.coordinates[2*
c],a.coordinates[2*c+1],b))return!0;return!1}if("MultiLineString"===a.type){B=0;for(D=a.coordinates.length;B<D;B++)for(W=a.coordinates[B],c=0,T=W.length/2;c<T;c++)if(this.pointInPolygon(W[2*c],W[2*c+1],b))return!0;return!1}if("Rectangle"===a.type)return c=a.coordinates,this.pointInPolygon(c[0],c[1],b)||this.pointInPolygon(c[2],c[3],b)||this.pointInPolygon(c[0],c[3],b)||this.pointInPolygon(c[2],c[1],b)?!0:!1;if("Polygon"===a.type){c=0;for(T=a.coordinates[0].length/2;c<T;c++)if(this.pointInPolygon(a.coordinates[0][2*
c],a.coordinates[0][2*c+1],b))return!0;return!1}if("MultiPolygon"===a.type){B=0;for(D=a.coordinates.length;B<D;B++)for(W=a.coordinates[B][0],c=0,T=W.length/2;c<T;c++)if(this.pointInPolygon(W[2*c],W[2*c+1],b))return!0;return!1}},pointInPolygon:function(a,b,c){var T;if("Polygon"===c.type)T=c.coordinates[0],T=this._pointInPolygon(a,b,T);else if("Rectangle"==c.type)T=[c.getMinX(),c.getMinY(),c.getMaxX(),c.getMinY(),c.getMaxX(),c.getMaxY(),c.getMinX(),c.getMaxY(),c.getMinX(),c.getMinY()],T=this._pointInPolygon(a,
b,T);else if("MultiPolygon"===c.type)for(var B=c.coordinates,D=0;D<B.length;D++)if(T=B[D][0],T=this._pointInPolygon(a,b,T))return!0;return T?!0:this.isPointOnLine({coordinates:[a,b],type:"Point"},c)},_pointInPolygon:function(a,b,c){for(var T=[],B=[],D=c.length/2,W=0;W<D;W++)T[W]=parseFloat(c[2*W]),B[W]=parseFloat(c[2*W+1]);var da=0;c=0;for(W=D-1;c<D;W=c++)B[c]>b!==B[W]>b&&a<(T[W]-T[c])*(b-B[c])/(B[W]-B[c])+T[c]&&(da=!da);return da},isInteractLine:function(a,b){for(var c=this.getSegments(a),T=this.getSegments(b),
B=0,D=c.length;B<D;B++)for(var W=0,da=T.length;W<da;W++)if(this.segmentsStraddle(c[B],T[W]))return!0;return!1},getSegments:function(a){var b=a.type;a=a.coordinates;var c=[],T,B,D,W;if("LineString"===b)for(b=0,T=a.length/2;b<T-1;b++)c.push({coordinates:[a[2*b],a[2*b+1],a[2*(b+1)],a[2*(b+1)+1]]});else if("MultiLineString"===b)for(B=0,D=a.length;B<D;B++)for(W=a[B],b=0,T=W.length/2;b<T-1;b++)c.push({coordinates:[W[2*b],W[2*b+1],W[2*(b+1)],W[2*(b+1)+1]]});else if("Polygon"===b)for(a=a[0],b=0,T=a.length/
2;b<T-1;b++)c.push({coordinates:[a[2*b],a[2*b+1],a[2*(b+1)],a[2*(b+1)+1]]});else if("MultiPolygon"===b)for(B=0,D=a.length;B<D;B++)for(W=a[B][0],b=0,T=W.length/2;b<T-1;b++)c.push({coordinates:[W[2*b],W[2*b+1],W[2*(b+1)],W[2*(b+1)+1]]});else"Rectangle"===b&&(c.push({coordinates:[a[0],a[1],a[2],a[1]]}),c.push({coordinates:[a[2],a[1],a[2],a[3]]}),c.push({coordinates:[a[2],a[3],a[0],a[3]]}),c.push({coordinates:[a[0],a[3],a[0],a[1]]}));return c},isPointOnLine:function(a,b){var c=this.getSegments(b),T=a.coordinates;
if("Point"===a.type||"OrientedPoint"===a.type)T=[T];for(var B=0,D=T.length;B<D;B++)for(var W=0,da=c.length;W<da;W++)if(this.isPointOnSegment(T[B][0],T[B][1],c[W]))return!0;return!1},isPointOnSegment:function(a,b,c){c=c.coordinates;return 0!==this.crossProduct({x:a-c[0],y:b-c[1]},{x:c[2]-c[0],y:c[3]-c[1]})?!1:Math.min(c[0],c[2])<=a&&a<=Math.max(c[0],c[2])&&Math.min(c[1],c[3])<=b&&b<=Math.max(c[1],c[3])?!0:!1},isSamePoints:function(a,b){var c=a.coordinates,T=b.coordinates;if("Point"===a.type||"OrientedPoint"===
a.type)c=[c];if("Point"===b.type||"OrientedPoint"===b.type)T=[T];for(var B=0,D=c.length;B<D;B++)for(var W=0,da=T.length;W<da;W++){var ka=c[B],ta=T[W];if(ka[0]===ta[0]&&ka[1]===ta[1])return!0}return!1}});a.template.TemplateConfig=a.Class.extend({initialize:function(b,c){this.baseFolder=this.url="";var V={};c?this.config=c:(b&&-1!==b.indexOf("config.json",b.length-11)&&(this.url=b,this.baseFolder=b.substring(0,b.lastIndexOf("/")+1),a.$.ajax({url:b,async:!1,dataType:"json",success:function(a){V=a}})),
this.config=V)},vectorLayerList:function(){var a=this.config,b=[];if(a.vectorLayers)for(var c=0;c<a.vectorLayers.length;c++)b.push(a.vectorLayers[c].dn);return b},initVectorLayerList:function(){},tileLayerList:function(){var a=this.config,b=[];if(a.tileLayers)for(var c=0;c<a.tileLayers.length;c++)b.push(a.tileLayers[c].dn);return b},styleList:function(){var a=this.config,b=[];if(a.styles)for(var c=0;c<a.styles.length;c++)b.push(a.styles[c].dn);return b},getTileLayer:function(b){if(!this.config.vectorLayers)return null;
var c=this.getTileLayerConfig(b);if(a.isNull(c))return null;var V=null,T=c.vendor;if("google"===T)V=new a.layer.GoogleTileLayer(b);else if("oracle"===T)V=new a.layer.ElocationTileLayer(b);else if("nokia"===T){var V=c.key,T=c.secondary_key,B=null;if(c.mapTypes)for(var c=c.mapTypes.split(","),B="",D=0;D<c.length;D++)0<D&&(B+=";"),B+="OM.layer.NokiaTileLayer.TYPE_"+c[D].toUpperCase();V=new a.layer.NokiaTileLayer(b,{key:V,appID:T,mapTyleList:B})}else"bing"===T&&(V=new a.layer.BingTileLayer(b,{key:c.key}));
return V},getVectorLayer:function(b,c){if(!this.config.vectorLayers)return null;var V=this.getVectorLayerConfig(c);if(a.isNull(V))return null;var T=V.uri;this.baseFolder&&0>V.uri.indexOf("http")&&(T=this.baseFolder+V.uri);T=new a.layer.VectorLayer(b,{def:{type:a.layer.VectorLayer.TYPE_DATAPACK,url:T}});if(V.styles){var B=V.styles;B.normal&&T.setRenderingStyle(this.getStyle(B.normal));B.selected&&T.setSelectStyle(this.getStyle(B.selected));B.mouseOver&&(T.enableFeatureHover(!0),T.setHoverStyle(this.getStyle(B.mouseOver)))}V.nsdp&&
T.setNSDP(V.nsdp);return T},getStyle:function(b){var c=this.config;if(!c.styles)return null;for(var c=c.styles,V=null,T=0;T<c.length;T++)if(c[T].dn===b){switch(c[T].type){case "color":V=new a.style.Color(c[T].def);break;case "marker":V=new a.style.Marker(c[T].def);break;case "linear-gradient":V=new a.style.LinearGradient(c[T].def);break;case "pulse_animation":V=new a.style.PulseAnimation(c[T].def);break;case "color_animation":b={};c[T].beginColor&&(b.beginColor=this.getStyle(c[T].beginColor));c[T].endColor&&
(b.endColor=this.getStyle(c[T].endColor));c[T].duration&&(b.duration=c[T].duration);c[T].movingDashLine&&(b.enableMovingDashLine=c[T].movingDashLine);V=new a.style.AnimationColor(b);break;case "line":V=new a.style.Line(c[T].def);break;case "text":V=new a.style.Text(c[T].def);break;case "heat_map":b=c[T].container;b=this.getVectorLayer(c[T].dn+" "+b,b);c=c[T].def;c.containerVectorLayer=b;V=new a.style.HeatMap(c);break;case "bar_chart":var B=c[T].barArr,D=B.length,V=[];for(b=0;b<D;b++)V.push(new a.style.Bar(B[b].name,
B[b].color));c=c[T].def;c.bars=V;V=new a.style.BarChart(c);break;case "pie_chart":B=c[T].pieArr;D=B.length;V=[];for(b=0;b<D;b++)V.push(new a.style.PieSlice(B[b].name,B[b].color));c=c[T].def;c.pieSlices=V;V=new a.style.PieChart(c)}break}return V},getConfig:function(){return this.config},setConfig:function(a){this.config=a},initMap:function(b){var c=this.config;if(c.init){c=c.init;if(c.tileLayer)b.addLayer(this.getTileLayer(c.tileLayer));else if(c.customUniverse){var V=c.customUniverse,T=V.bounds,V=
new a.universe.Universe({srid:V.srid,bounds:new a.geometry.Rectangle(T[0],T[1],T[2],T[3],T[4]),numberOfZoomLevels:V.numberOfZoomLevels});b.getMapContextToken().universe=V}else return;if(c.layers)for(b.removeAllFeatureLayers(),V=c.layers,T=0;T<V.length;T++)b.addLayer(this.getVectorLayer(V[T],V[T]));if(c.center){var V=c.center[0],T=c.center[1],B=b.getMapContext().getUniverse().srid,V=new a.geometry.Point(V,T,B);b.setMapCenter(V)}c.zoomLevel&&b.setMapZoomLevel(c.zoomLevel);c.copyright&&b.addMapDecoration(new a.control.CopyRight(c.copyright));
c.navigation&&b.addMapDecoration(new a.control.NavigationPanelBar(c.navigation))}},getVectorLayerConfig:function(a){a=this.indexOfVectorLayer(a);return-1===a?null:this.config.vectorLayers[a]},getTileLayerConfig:function(a){a=this.tileLayerList().indexOf(a);return-1===a?null:this.config.tileLayers[a]},indexOfVectorLayer:function(a){var b=this.vectorLayerList().indexOf(a);if(-1===b)for(var c=this.config.vectorLayers,T=0;T<c.length;T++){var B=c[T];if(B.cn&&(b=B.cn.indexOf(a),-1!==b)){b=T;break}}return b}});
a.template.Template=a.Class.extend({initialize:function(b){this.name="default";this.containerMap=null;b&&b.name&&(this.name=b.name);this.config=null;b.url?this.config=new a.template.TemplateConfig(b.url):b.data&&(this.config=new a.template.TemplateConfig(null,b.data))},getConfig:function(){return this.config},setConfig:function(b){var c=new a.template.TemplateConfig(null);c.setConfig(b);this.config=c},getVectorLayer:function(b,c,V){if(!this.config)return null;var T=this.config.getVectorLayer(b,c);
if(a.isNull(T))return null;if(!(V&&V instanceof Array&&0<V.length))return T;c=this.config.getVectorLayerConfig(c).uri;var B=null;a.$.ajax({url:c,async:!1,dataType:"json",success:function(a){B=a}});if(a.isNull(B))return null;c=B.features;for(var T=c.length,D=B.attr_names,W=B.srs,da=[],ka=0;ka<T;ka++){var ta=c[ka],Ga=0;a:for(;Ga<V.length;Ga++)for(var Ja=V[Ga].toUpperCase(),La=0;La<D.length;La++){var Ra=D[La].toUpperCase();if(ta.properties[Ra].toUpperCase()===Ja){Ja=ta.geometry;Ja.srid=W;Ga=a.notNull(ta._id)?
ta._id:ka;Ja=a.geometry.Geometry.createGeometry(Ja,W);Ga=new a.Feature(Ga,Ja,{attributes:ta.properties});Ga.srid=W;Ga.label_box=ta.label_box;da.push(Ga);break a}}}return new a.layer.VectorLayer(b,{def:{type:a.layer.VectorLayer.TYPE_LOCAL,features:da}})},getTileLayer:function(a){return this.config?this.config.getTileLayer(a):null},getStyle:function(a){return this.config?this.config.getStyle(a):null},setupMapControls:function(a){try{this.config.initMap(a),a.template=this,this.containerMap=a}catch(b){}},
getVectorLayerNames:function(){return this.config.vectorLayerList()},getTileLayerNames:function(){return this.config.tileLayerList()},getStyleNames:function(){return this.config.styleList()},getChildLayerNames:function(a){if(!this.config)return null;var b=[];a=this.config.getVectorLayerConfig(a);null!==a&&a.cl&&(b=a.cl);return b},getParentLayerNames:function(a){if(!this.config)return null;var b=[];a=this.config.getVectorLayerConfig(a);null!==a&&a.pl&&(b=a.pl);return b},getChildLayer:function(b,c,
V,T){if(!this.config)return null;c=this.config.getVectorLayerConfig(c);if(a.isNull(c)||!c.cl)return null;c=c.cl;if("string"===typeof V)if(-1===c.indexOf(V)){var B=this.config.indexOfVectorLayer(V);if(-1===B)return null;for(var D=!1,W=0;W<c.length;W++){var da=this.config.indexOfVectorLayer(c[W]);if(B===da){D=!0;break}}if(D)return this.getVectorLayer(b,V,T)}else return this.getVectorLayer(b,V,T);else if("number"===typeof V&&!(0>V||V>=c.length))return this.getVectorLayer(b,c[V],T);return null},switchTileLayer:function(b){if(this.getTileLayerNames()&&
b){var c=this.containerMap.getLayerByName(b);if(!c){var V=this.getTileLayer(b);V?(c&&this.containerMap.removeLayer(c),this.containerMap.addLayer(V)):a.util.Logger.warning("MAPVIEWER_9031","OM.template.Template",b)}}},destroy:function(){this.containerMap=null}});(function(a){a.lbs.OutputAddress=a.Class.extend({initialize:function(a){this.id=a;this.edgeId=this.percent=this.side=this.postalAddonCode=this.postalCode=this.country=this.region=this.municipality=this.settlement=this.street=this.houseNumber=
this.name=null}})})(a);(function(a){a.lbs.Match=a.Class.extend({initialize:function(a,b){this.id=a;this.sequence=b;this.outputAddress=this.srid=this.matchVector=this.errorMessage=this.matchCode=this.latitude=this.longitude=null},getErrorMessage:function(){return this.errorMessage},setErrorMessage:function(a){this.errorMessage=a},getId:function(){return this.id},setId:function(a){this.id=a},getLatitude:function(){return this.latitude},setLatitude:function(a){this.latitude=a},getLongitude:function(){return this.longitude},
setLongitude:function(a){this.longitude=a},getMatchCode:function(){return this.matchCode},setMatchCode:function(a){this.matchCode=a},getMatchVector:function(){return this.matchVector},setMatchVector:function(a){this.matchVector=a},getSequence:function(){return this.sequence},setSequence:function(a){this.sequence=a},getOutputAddress:function(){return this.outputAddress},setOutputAddress:function(a){this.outputAddress=a},getSrid:function(){return this.srid},setSrid:function(a){this.srid=a}})})(a);(function(a){a.lbs.GCResult=
a.Class.extend({initialize:function(){this.MATCH_CODE1=1;this.MATCH_CODE2=2;this.MATCH_CODE3=3;this.MATCH_CODE4=4;this.MATCH_CODE10=10;this.MATCH_CODE11=11},getId:function(){},succeeded:function(){},getMatches:function(){}})})(a);(function(a){a.lbs.DefaultGCResult=a.lbs.GCResult.extend({initialize:function V(b,c){V.base.call(this);this.id=b;this.rawResponse=c;this.matchCount=0;this.matches=null;a.gv.proxyEnabled?this.parseResult():this.parseJsonResult()},getId:function(){return this.id},succeeded:function(){return 0<
this.matchCount},getMatches:function(){return this.matches},parseJsonResult:function(){this.matchCount=0;this.matches=null;var b=this.rawResponse;if(!(a.isNull(b)||(this.matchCount=b.length,0>=this.matchCount))){this.matches=[];for(var c=0;c<this.matchCount;c++){var B={};B.longitude=b[c].x;B.latitude=b[c].y;B.matchCode=b[c].matchCode;B.matchVector=b[c].matchVector;B.errorMessage=b[c].errorMessage;var D={name:""};D.houseNumber=b[c].houseNumber;D.street=b[c].street;D.country=b[c].country;D.postalCode=
b[c].postalCode;D.region=b[c].region;D.settlement=b[c].settlement;D.municipality=b[c].municipality;D.side=b[c].side;D.percent=b[c].percent;D.edgeId=b[c].edgeId;B.outputAddress=D;a.isNotNull(B)&&"not geocoded"!=B.errorMessage&&this.matches.push(B)}}},parseResult:function(){this.matchCount=0;this.matches=null;var b=this.rawResponse;if(!(a.isNull(b)||7>b.length)){this.id||(this.id=a.lbs.MetaData.DefaultAddressId);var c='\x3cgeocode id\x3d"'+this.id+'"',c=b.indexOf(c),B=b.indexOf("\x3c/geocode\x3e",c+
7),b=b.substring(c,B);if(0>c)return null;this.matchCount=this.getAttribute(b,"match_count",0);if(!(0>=this.matchCount))for(this.matches=[],c=0;c<this.matchCount;c++)B=this.parseMatch(this.id,c,b),a.isNotNull(B)&&this.matches.push(B)}},getAttribute:function(a,b,c){b+='\x3d"';c=a.indexOf(b,c);var D=a.indexOf('"',c+b.length);return a.substring(c+b.length,D)},parseMatch:function(b,c,B){var D=B.indexOf('\x3cmatch sequence\x3d"'+c+'"');if(0>D)return null;var W=B.indexOf("\x3c/match\x3e",D+7);B=B.substring(D,
W);c=new a.lbs.Match(b,c);D=Number(this.getAttribute(B,"longitude",0));W=Number(this.getAttribute(B,"latitude",0));c.setLongitude(D);c.setLatitude(W);c.setErrorMessage(this.getAttribute(B,"error_message",0));c.setMatchVector(this.getAttribute(B,"match_vector",0));c.setSrid(this.getAttribute(B,"srid",0));D=this.getAttribute(B,"match_code",0);c.setMatchCode(D);b=this.parseOutputAddress(b,B);c.setOutputAddress(b);return c},parseOutputAddress:function(b,c){var B=c.indexOf("\x3coutput_address");if(0>B)return null;
var D=c.indexOf("/\x3e",B+1);c=c.substring(B,D);B=new a.lbs.OutputAddress(b);B.name=this.getAttribute(c,"name",0);B.houseNumber=this.getAttribute(c,"house_number",0);B.street=this.getAttribute(c,"street",0);B.settlement=this.getAttribute(c,"settlement",0);B.region=this.getAttribute(c,"region",0);B.municipality=this.getAttribute(c,"municipality",0);B.country=this.getAttribute(c,"country",0);B.postalCode=this.getAttribute(c,"postal_code",0);B.postalAddonCode=this.getAttribute(c,"postal_addon_code",
0);B.side=this.getAttribute(c,"side",0);B.percent=this.getAttribute(c,"percent",0);B.edgeId=this.getAttribute(c,"edge_id",0);return B}})})(a);(function(a){a.lbs.MetaData=a.Class.extend({initialize:function(a){a?("/"==a.substr(a.length-1,1)&&(a=a.substr(0,a.length-1)),this.baseURL=a):this.baseURL="http://elocation.oracle.com";this.mappingUrl=this.baseURL+"/mapviewer";this.geocoderUrl=this.baseURL+"/geocoder/gcserver";this.elocationLbsUrl=this.baseURL+"/elocation/lbs"},getElocationLbsUrl:function(){return this.elocationLbsUrl},
setElocationLbsUrl:function(a){this.elocationLbsUrl=a},getGeocoderUrl:function(){return this.geocoderUrl},setGeocoderUrl:function(a){this.geocoderUrl=a},getMappingUrl:function(){return this.mappingUrl},setMappingUrl:function(a){this.mappingUrl=a},getRoutingUrl:function(){return this.routingUrl},setRoutingUrl:function(a){this.routingUrl=a}});a.lbs.MetaData.DefaultAddressId="0"})(a);(function(a){a.lbs.Geocoder=a.Class.extend({initialize:function(b){(this.metaData=b)&&b.getGeocoderUrl()&&a.gv.proxyEnabled&&
(this.geocoderUrl=b.getGeocoderUrl());b&&b.getGeocoderUrl()&&!a.gv.proxyEnabled&&(this.elocationLbsUrl=b.getElocationLbsUrl())},geocode:function(a,b){var c=this.wrapAddress2Xml(a);this.send_geocode(a.id,c,b)},parseJson:function(b){return a.notNull(b)&&a.notNull(b.replace)?(b=b.replace(/([{,])(?:\s*)([^:"{},]+)(?:\s*):/g,'$1"$2":'),a.$.parseJSON(b)):null},batchGeoCode:function(b,c){for(var T="",B=0;B<b.length;B++)T+=this.wrapAddress2Xml(b[B]);var D=this.wrapRequests(T);a.util.Logger.fine("","OM.Geocoder.batchGeoCode",
"gc batch request\x3d"+D);var T=function(D){for(var B=a.lbs.Geocoder.STATUS_FAILED,W=[],B=0;B<b.length;B++){var T=new a.lbs.DefaultGCResult(b[B].id,D);W.push(T)}B=a.lbs.Geocoder.STATUS_OK;a.util.Logger.fine("","OM.Geocoder.batchGeoCode","gc batch response\x3d"+D);a.notNull(c)&&c(W,B)},W=this;MVXMLHttpRequest={callBack:function(D,B){B=W.parseJson(B);for(var T=a.lbs.Geocoder.STATUS_FAILED,da=[],T=0;T<B.length;T++)if(1<B.length&&a.notNull(B[T][0].x)){var ka=new a.lbs.DefaultGCResult(b[T].id,B[T]);da.push(ka)}T=
a.lbs.Geocoder.STATUS_OK;a.util.Logger.fine("","OM.Geocoder.batchGeoCode","gc batch response\x3d"+B);a.notNull(c)&&c(da,T)}};var B=function(b,c,D){"abort"!==D&&(c="URL: "+ka,D&&(c+="\nError: "+D),b&&b.responseText&&(c+="\nResponse : "+b.responseText),a.util.Logger.warning("MAPVIEWER_9014","OM.lbs.Geocoder.geocode",c))},da=a.util.HttpRequest,D={xml_request:D,format:"xml"},ka;a.gv.proxyEnabled?(ka=this.geocoderUrl,da.send(ka,D,T,"text",B,!0,!0)):(D.format="JSON",ka=this.elocationLbsUrl,a.util.HttpRequest.sendAsScripts(ka,
D,MVXMLHttpRequest.callBack,"JSON",!0))},reverseGeocode:function(b,c,T){b=this.wrapLatLon2Xml(b,c);this.send_geocode(a.lbs.MetaData.DefaultAddressId,b,T)},reverseGeocodePoint:function(b,c){if(!a.isNull(b)){var T=this,B=b.getSRID();8307===B||4326===B?this.reverseGeocode(b.getX(),b.getY(),c):b.transform(8307,function(a){T.reverseGeocode(a.getX(),a.getY(),c)})}},send_geocode:function(b,c,T){var B=this.wrapRequests(c);c=function(c){var D=a.lbs.Geocoder.STATUS_FAILED;c=new a.lbs.DefaultGCResult(b,c);D=
a.lbs.Geocoder.STATUS_OK;a.notNull(T)&&T(c,D)};var D=this;MVXMLHttpRequest={callBack:function(b,c){c=D.parseJson(c);var V=a.lbs.Geocoder.STATUS_FAILED,B=new a.lbs.DefaultGCResult(b,c),V=a.lbs.Geocoder.STATUS_OK;a.notNull(T)&&T(B,V)}};var W=function(b,c,D){"abort"!==D&&(c="URL: "+ka,D&&(c+="\nError: "+D),b&&b.responseText&&(c+="\nResponse : "+b.responseText),a.util.Logger.warning("MAPVIEWER_9014","OM.lbs.Geocoder.geocode",c))},da=a.util.HttpRequest,B={xml_request:B,format:"xml"},ka;a.gv.proxyEnabled?
(ka=this.geocoderUrl,da.send(ka,B,c,"text",W,!0,!0)):(B.format="JSON",ka=this.elocationLbsUrl,a.util.HttpRequest.sendAsScripts(ka,B,MVXMLHttpRequest.callBack,"JSON",!0))},wrapAddress2Xml:function(b){return b instanceof a.lbs.Address?b.toXmlString():(new a.lbs.Address(b)).toXmlString()},wrapLatLon2Xml:function(a,b){var c;c="\x3cinput_location "+('longitude\x3d"'+a+'" ')+('latitude\x3d"'+b+'"');return c+="/\x3e"},wrapRequests:function(a){var b;b='\x3c?xml version\x3d"1.0" standalone\x3d"yes"?\x3e\n\x3cgeocode_request vendor\x3d"oracle"\x3e\n\x3caddress_list\x3e\n';
b+=a;b+="\x3c/address_list\x3e\n";return b+="\x3c/geocode_request\x3e"}});a.lbs.Geocoder.MATCH_MODE_EXACT="EXACT";a.lbs.Geocoder.MATCH_MODE_RELAX_STREET_TYPE="RELAX_STREET_TYPE";a.lbs.Geocoder.MATCH_MODE_RELAX_POI_NAME="RELAX_POI_NAME";a.lbs.Geocoder.MATCH_MODE_RELAX_HOUSE_NUMBER="RELAX_HOUSE_NUMBER";a.lbs.Geocoder.MATCH_MODE_RELAX_BASE_NAME="RELAX_BASE_NAME";a.lbs.Geocoder.MATCH_MODE_RELAX_POSTAL_CODE="RELAX_POSTAL_CODE";a.lbs.Geocoder.MATCH_MODE_RELAX_BUILTUP_AREA="RELAX_BUILTUP_AREA";a.lbs.Geocoder.MATCH_MODE_RELAX_ALL=
"RELAX_ALL";a.lbs.Geocoder.MATCH_MODE_DEFAULT="RELAX_POSTAL_CODE";a.lbs.Geocoder.STATUS_FAILED=0;a.lbs.Geocoder.STATUS_OK=1})(a);(function(a){a.lbs.Address=a.Class.extend({initialize:function(b){this.id=a.lbs.MetaData.DefaultAddressId;this.address="";this.country="US";this.matchMode=a.lbs.Geocoder.MATCH_MODE_DEFAULT;b&&(b.id&&(this.id=b.id),b.address&&(this.address=b.address),b.country&&(this.country=b.country),b.matchMode&&(this.matchMode=b.matchMode))},toXmlString:function(){for(var a="",b=this.address.split(","),
a=a+('\x3cinput_location id\x3d"'+this.id+'"\x3e\x3cinput_address match_mode\x3d"'+this.matchMode+'"\x3e\x3cunformatted country\x3d"'+this.country+'"\x3e'),c=0;c<b.length;c++)a+='\x3caddress_line value \x3d"'+b[c]+'"/\x3e';return a+"\x3c/unformatted\x3e\x3c/input_address\x3e\x3c/input_location\x3e"},getStreetLine:function(b){if(!b.houseNumber)return b.street?b.street:null;var c=b.country;return a.isNull(c)||"US"==c||"AD"==c||"AU"==c||"CA"==c||"FR"==c||"GB"==c||"IE"==c||"LU"==c||"MC"==c||"NZ"==c||
"PR"==c?b.houseNumber+" "+b.street:b.street+" "+b.houseNumber},getLocalityLine:function(b){var c=b.country,T=!1;!a.notNull(c)||"AT"!=c&&"BE"!=c&&"DK"!=c&&"FI"!=c&&"FR"!=c&&"DE"!=c&&"IT"!=c&&"LI"!=c&&"LU"!=c&&"MC"!=c&&"NL"!=c&&"NO"!=c&&"PT"!=c&&"SM"!=c&&"ES"!=c&&"SE"!=c&&"CH"!=c||(T=!0);var B=!1;if(a.isNull(c)||"US"==c||"AU"==c||"CA"==c)B=!0;c="";b.settlement&&(c+=b.settlement);b.municipality&&b.municipality!=b.settlement&&(c+=(0<c.length?", ":"")+b.municipality);B&&b.region&&(c+=(0<c.length?", ":
"")+b.region);a.notNull(b.postalCode)&&(c=T?b.postalCode+" "+c:c+" "+b.postalCode);return""===c?null:c}})})(a);(function(a){a.lbs.GdfFormAddress=a.lbs.Address.extend({initialize:function V(a){V.base.call(this,a);this.postalAddonCode=this.postalCode=this.order1Area=this.order2Area=this.order8Area=this.builtupArea=this.intersectingStreet=this.street=this.name="";this.country="US";a&&(this.name=a.name,this.street=a.street,this.intersectingStreet=a.intersectingStreet,this.builtupArea=a.builtupArea,this.order8Area=
a.order8Area,this.order2Area=a.order2Area,this.order1Area=a.order1Area,this.postalCode=a.postalCode,this.postalAddonCode=a.postalAddonCode,a.country&&(this.country=a.country))},toXmlString:function(){var a;a=""+('\x3cinput_location id\x3d"'+this.id+'"\x3e\x3cinput_address match_mode\x3d"'+this.matchMode+'"\x3e\x3cgdf_form ');this.name&&(a+='name \x3d"'+this.name+'" ');this.street&&(a+='street \x3d"'+this.street+'" ');this.intersectingStreet&&(a+='intersecting_street \x3d"'+this.intersectingStreet+
'" ');this.builtupArea&&(a+='builtup_area \x3d"'+this.builtupArea+'" ');this.order8Area&&(a+='order8_area \x3d"'+this.order8Area+'" ');this.order2Area&&(a+='order2_area \x3d"'+this.order2Area+'" ');this.order1Area&&(a+='order1_area \x3d"'+this.order1Area+'" ');this.country&&(a+='country \x3d"'+this.country+'" ');this.postalCode&&(a+='postal_code \x3d"'+this.postalCode+'" ');this.postalAddonCode&&(a+='postal_addon_code \x3d"'+this.postalAddonCode+'" ');return a+"/\x3e\x3c/input_address\x3e\x3c/input_location\x3e"}})})(a);
(function(a){a.lbs.GenFormAddress=a.lbs.Address.extend({initialize:function V(a){V.base.call(this,a);this.postalAddonCode=this.postalCode=this.region=this.city=this.subArea=this.intersectingStreet=this.street=this.name="";this.country="US";a&&(this.name=a.name,this.street=a.street,this.intersectingStreet=a.intersectingStreet,this.subArea=a.subArea,this.city=a.city,this.region=a.region,this.postalCode=a.postalCode,this.postalAddonCode=a.postalAddonCode,a.country&&(this.country=a.country))},toXmlString:function(){var a;
a=""+('\x3cinput_location id\x3d"'+this.id+'"\x3e\x3cinput_address match_mode\x3d"'+this.matchMode+'"\x3e\x3cgen_form ');this.name&&(a+='name \x3d"'+this.name+'" ');this.street&&(a+='street \x3d"'+this.street+'" ');this.intersectingStreet&&(a+='intersecting_street \x3d"'+this.intersectingStreet+'" ');this.subArea&&(a+='sub_area \x3d"'+this.subArea+'" ');this.city&&(a+='city \x3d"'+this.city+'" ');this.region&&(a+='region \x3d"'+this.region+'" ');this.country&&(a+='country \x3d"'+this.country+'" ');
this.postalCode&&(a+='postal_code \x3d"'+this.postalCode+'" ');this.postalAddonCode&&(a+='postal_addon_code \x3d"'+this.postalAddonCode+'" ');return a+"/\x3e\x3c/input_address\x3e\x3c/input_location\x3e"}})})(a);(function(a){a.lbs.USForm1Address=a.lbs.Address.extend({initialize:function V(a){V.base.call(this,a);this.lastline=this.intersectingStreet=this.street=this.name="";a&&(this.name=a.name,this.street=a.street,this.intersectingStreet=a.intersectingStreet,this.lastline=a.lastline)},toXmlString:function(){var a;
a=""+('\x3cinput_location id\x3d"'+this.id+'"\x3e\x3cinput_address match_mode\x3d"'+this.matchMode+'"\x3e\x3cus_form1 ');this.name&&(a+='name \x3d"'+this.name+'" ');this.street&&(a+='street \x3d"'+this.street+'" ');this.intersectingStreet&&(a+='intersecting_street \x3d"'+this.intersectingStreet+'" ');this.lastline&&(a+='lastline \x3d"'+this.lastline+'" ');return a+"/\x3e\x3c/input_address\x3e\x3c/input_location\x3e"}})})(a);(function(a){a.lbs.USForm2Address=a.lbs.Address.extend({initialize:function V(a){V.base.call(this,
a);this.zipCode=this.state=this.city=this.intersectingStreet=this.street=this.name="";a&&(this.name=a.name,this.street=a.street,this.intersectingStreet=a.intersectingStreet,this.city=a.city,this.state=a.state,this.zipCode=a.zipCode)},toXmlString:function(){var a;a=""+('\x3cinput_location id\x3d"'+this.id+'"\x3e\x3cinput_address match_mode\x3d"'+this.matchMode+'"\x3e\x3cus_form2 ');this.name&&(a+='name \x3d"'+this.name+'" ');this.street&&(a+='street \x3d"'+this.street+'" ');this.intersectingStreet&&
(a+='intersecting_street \x3d"'+this.intersectingStreet+'" ');this.city&&(a+='city \x3d"'+this.city+'" ');this.state&&(a+='state \x3d"'+this.state+'" ');this.zipCode&&(a+='zip_code \x3d"'+this.zipCode+'" ');return a+"/\x3e\x3c/input_address\x3e\x3c/input_location\x3e"}})})(a);(function(a){a.lbs.UnformatedAddress=a.lbs.Address.extend({initialize:function(b){this.id=a.lbs.MetaData.DefaultAddressId;this.address="";this.country="US";this.matchMode="relax_street_type";b&&(b.id&&(this.id=b.id),b.address&&
(this.address=b.address),b.country&&(this.country=b.country),b.matchMode&&(this.matchMode=b.matchMode))},toXmlString:function(){for(var a="",b=this.address.split(","),a=a+('\x3cinput_location id\x3d"'+this.id+'"\x3e\x3cinput_address match_mode\x3d"'+this.matchMode+'"\x3e\x3cunformatted country\x3d"'+this.country+'"\x3e'),c=0;c<b.length;c++)a+='\x3caddress_line value \x3d"'+b[c]+'"/\x3e';return a+"\x3c/unformatted\x3e\x3c/input_address\x3e\x3c/input_location\x3e"}})})(a);a.edit.EditChangeEvent=a.Class.extend({initialize:function(b){var c=
a.edit.EditChangeEvent;this.eventType=c.NO_EVENT;this.updateType=c.NO_UPDATE;this.oldChange=this.currentChange=this.feature=this.key=null;this.isModifiedFeature=this.isNewFeature=!1;a.notNull(b)&&(a.notNull(b.eventType)&&(this.eventType=b.eventType),a.notNull(b.updateType)&&(this.updateType=b.updateType),a.notNull(b.key)&&(this.key=b.key),a.notNull(b.feature)&&(this.feature=b.feature),a.notNull(b.currentChange)&&(this.currentChange=b.currentChange),a.notNull(b.oldChange)&&(this.oldChange=b.oldChange),
a.notNull(b.isNewFeature)&&(this.isNewFeature=b.isNewFeature),a.notNull(b.isModifiedFeature)&&(this.isModifiedFeature=b.isModifiedFeature))},getEventType:function(){return this.eventType},getUpdateType:function(){return this.updateType},getKey:function(){return this.key},getFeature:function(){return this.feature},getCurrentChange:function(){return this.currentChange},getOldChange:function(){return this.oldChange},isNewFeature:function(){return this.isNewFeature},isModifiedFeature:function(){return this.isModifiedFeature}});
a.edit.EditChangeEvent.NO_EVENT=0;a.edit.EditChangeEvent.NEW_EVENT=1;a.edit.EditChangeEvent.UPDATE_EVENT=2;a.edit.EditChangeEvent.REMOVE_EVENT=3;a.edit.EditChangeEvent.NO_UPDATE=0;a.edit.EditChangeEvent.SPATIAL_UPDATE=1;a.edit.EditChangeEvent.ATTRIBUTE_UPDATE=2;a.edit.EditChangeManager=a.Class.extend({initialize:function(b){this.layer=a.notNull(b)?b.layer:null;this.newFeatures={};this.removedFeatures={};this.modifiedFeatures={};this.updateChanges={}},addFeature:function(b,c){if(a.isNull(this.layer)||
a.isNull(b)||a.isNull(c))return null;this.layer.addFeature(c);this.newFeatures[b]=c;var V=a.edit.EditChangeEvent;return new a.edit.EditChangeEvent({eventType:V.NEW_EVENT,updateType:V.NO_UPDATE,key:b,feature:c,currentChange:c,oldChange:null,isNewFeature:!0,isModifiedFeature:!1})},removeFeature:function(b,c){if(a.isNull(this.layer)||a.isNull(b)||a.isNull(c))return null;this.layer.removeFeature(c);var V=!1,T=!1;a.notNull(this.newFeatures[b])?(V=!0,delete this.newFeatures[b]):(this.removedFeatures[b]=
c,a.notNull(this.modifiedFeatures[b])&&(delete this.modifiedFeatures[b],T=!0));var B=a.edit.EditChangeEvent;return new a.edit.EditChangeEvent({eventType:B.REMOVE_EVENT,updateType:B.NO_UPDATE,key:b,feature:c,currentChange:null,oldChange:c,isNewFeature:V,isModifiedFeature:T})},updateFeature:function(b,c,V,T){if(a.isNull(this.layer)||a.isNull(b))return null;var B=null,D=a.edit.EditChangeEvent;if(T===D.SPATIAL_UPDATE)B=c.geo,c.geo=V;else if(T===D.ATTRIBUTE_UPDATE){if(B={},a.notNull(V))for(var W in V)V.hasOwnProperty(W)&&
(B[W]=c.getAttributeValue(W),a.isNull(c.attributes)&&(c.attributes={}),c.attributes[W]=V[W])}else return null;var da=!1;W=!1;a.isNull(this.newFeatures[b])?(a.notNull(this.modifiedFeatures[b])&&(W=!0),this.modifiedFeatures[b]=c):(da=!0,this.newFeatures[b]=c);W=new a.edit.EditChangeEvent({eventType:D.UPDATE_EVENT,updateType:T,key:b,feature:c,currentChange:V,oldChange:B,isNewFeature:da,isModifiedFeature:W});!1===da&&(da=this.updateChanges[b],a.isNull(da)&&(da=[],this.updateChanges[b]=da),da.push(W));
a.notNull(this.layer.rtree)&&T===D.SPATIAL_UPDATE&&(a.notNull(B)&&(b=B.getMBR(),a.notNull(b)&&(this.layer.removeFromRtree(c),delete this.layer.segmentRtree[c.id])),a.notNull(V)&&(V=V.getMBR(),a.notNull(V)&&this.layer.addToRtree(c)));return W},getNewFeatures:function(){var a=[],b;for(b in this.newFeatures)this.newFeatures.hasOwnProperty(b)&&a.push(this.newFeatures[b]);return a},getRemovedFeatures:function(){var a=[],b;for(b in this.removedFeatures)this.removedFeatures.hasOwnProperty(b)&&a.push(this.removedFeatures[b]);
return a},getModifiedFeatures:function(){var a=[],b;for(b in this.modifiedFeatures)this.modifiedFeatures.hasOwnProperty(b)&&a.push(this.modifiedFeatures[b]);return a},hasChanges:function(){for(var a in this.newFeatures)if(this.newFeatures.hasOwnProperty(a))return!0;for(a in this.removedFeatures)if(this.removedFeatures.hasOwnProperty(a))return!0;for(a in this.modifiedFeatures)if(this.modifiedFeatures.hasOwnProperty(a))return!0;return!1},hasSpatialAttributeChanged:function(b){if(a.isNull(b)||a.isNull(this.modifiedFeatures[b]))return!1;
b=this.updateChanges[b];if(a.isNull(b))return!1;for(var c=a.edit.EditChangeEvent,V=b.length,T=0;T<V;T++)if(b[T].getUpdateType()===c.SPATIAL_UPDATE)return!0;return!1},getChangedAttributesOfModifiedFeature:function(b){if(a.isNull(b))return null;if(a.isNull(this.modifiedFeatures[b]))return!1;b=this.updateChanges[b];if(a.isNull(b))return!1;for(var c=[],V=a.edit.EditChangeEvent,T=b.length,B=0;B<T;B++)if(b[B].getUpdateType()===V.ATTRIBUTE_UPDATE){var D=b[B].getCurrentChange();if(!a.isNull(D))for(var W in D)if(D.hasOwnProperty(W)){for(var da=
!1,ka=0;ka<c.length;ka++)if(c[ka]==W){da=!0;break}!1===da&&c.push(W)}}return c},undo:function(b){if(!a.isNull(b)){var c=b.key,V=b.eventType,T=a.edit.EditChangeEvent;if(V===T.NEW_EVENT)this.layer.removeFeature(b.currentChange),delete this.newFeatures[c],a.notNull(this.layer.rtree)&&a.notNull(b.currentChange.geo)&&(c=b.currentChange.geo.getMBR(),a.notNull(c)&&(this.layer.removeFromRtree(b.currentChange),delete this.layer.segmentRtree[b.currentChange.id]));else if(V===T.UPDATE_EVENT){V=b.updateType;
if(V===T.SPATIAL_UPDATE){if(a.isNull(b.feature))return;b.feature.setGeometry(b.oldChange)}else if(V===T.ATTRIBUTE_UPDATE&&a.notNull(b.oldChange))for(var B in b.oldChange)b.oldChange.hasOwnProperty(B)&&(b.feature.attributes[B]=b.oldChange[B]);!1===b.isNewFeature&&(B=this.updateChanges[c],a.notNull(B)&&0<B.length&&(B.pop(),0===B.length&&delete this.updateChanges[c]),!1===b.isModifiedFeature&&delete this.modifiedFeatures[c]);a.notNull(this.layer.rtree)&&V===T.SPATIAL_UPDATE&&(a.notNull(b.currentChange)&&
(c=b.currentChange.getMBR(),a.notNull(c)&&(this.layer.removeFromRtree(b.feature),delete this.layer.segmentRtree[b.feature.id])),a.notNull(b.oldChange)&&(c=b.oldChange.getMBR(),a.notNull(c)&&this.layer.addToRtree(b.feature)))}else V===T.REMOVE_EVENT&&(this.layer.addFeature(b.oldChange),!1===b.isNewFeature?(delete this.removedFeatures[c],!0===b.isModifiedFeature&&(this.modifiedFeatures[c]=b.oldChange)):this.newFeatures[c]=b.oldChange,a.notNull(this.layer.rtree)&&a.notNull(b.oldChange.geo)&&(c=b.oldChange.geo.getMBR(),
a.notNull(c)&&this.layer.addToRtree(b.oldChange)))}},redo:function(b){if(!a.isNull(b)){var c=b.key,V=b.eventType,T=a.edit.EditChangeEvent;if(V===T.NEW_EVENT)this.layer.addFeature(b.currentChange),this.newFeatures[c]=b.currentChange,a.notNull(this.layer.rtree)&&a.notNull(b.currentChange.geo)&&(c=b.currentChange.geo.getMBR(),a.notNull(c)&&this.layer.addToRtree(b.currentChange));else if(V===T.UPDATE_EVENT){V=b.updateType;if(V===T.SPATIAL_UPDATE){if(a.isNull(b.feature))return;b.feature.setGeometry(b.currentChange)}else if(V===
T.ATTRIBUTE_UPDATE&&a.notNull(b.currentChange))for(var B in b.currentChange)b.currentChange.hasOwnProperty(B)&&(b.feature.attributes[B]=b.currentChange[B]);!1===b.isNewFeature&&(B=this.updateChanges[c],a.isNull(B)&&(B=[],this.updateChanges[c]=B),B.push(b),!1===b.isModifiedFeature&&(this.modifiedFeatures[c]=b.feature));a.notNull(this.layer.rtree)&&V===T.SPATIAL_UPDATE&&(a.notNull(b.oldChange)&&(c=b.oldChange.getMBR(),a.notNull(c)&&(this.layer.removeFromRtree(b.feature),delete this.layer.segmentRtree[b.feature.id])),
a.notNull(b.currentChange)&&(c=b.currentChange.getMBR(),a.notNull(c)&&this.layer.addToRtree(b.feature)))}else V===T.REMOVE_EVENT&&(this.layer.removeFeature(b.oldChange),!1===b.isNewFeature?(this.removedFeatures[c]=b.oldChange,!0===b.isModifiedFeature&&delete this.modifiedFeatures[c]):delete this.newFeatures[c],a.notNull(this.layer.rtree)&&a.notNull(b.oldChange.geo)&&(c=b.oldChange.geo.getMBR(),a.notNull(c)&&(this.layer.removeFromRtree(b.oldChange),delete this.layer.segmentRtree[b.oldChange.id])))}},
clearChanges:function(){this.newFeatures={};this.removedFeatures={};this.modifiedFeatures={};this.updateChanges={}},isNewFeature:function(b){return a.isNotNull(this.newFeatures[b])?!0:!1},isRemovedFeature:function(b){return a.isNotNull(this.removedFeatures[b])?!0:!1},isModifiedFeature:function(b){return a.isNotNull(this.modifiedFeatures[b])?!0:!1}});a.edit.GeometrySegment=a.Class.extend({initialize:function(b){var c=a.edit.GeometrySegment;this.subElemIndex=this.elemIndex=this.segIndex=-1;this.segType=
c.UNDEFINED_TYPE;a.notNull(b)&&(a.notNull(b.segIndex)&&(this.segIndex=b.segIndex),a.notNull(b.elemIndex)&&(this.elemIndex=b.elemIndex),a.notNull(b.subElemIndex)&&(this.subElemIndex=b.subElemIndex),a.notNull(b.segType)&&(this.segType=b.segType))},getSegmentIndex:function(){return this.segIndex},setSegmentIndex:function(a){this.segIndex=a},getElementIndex:function(){return this.elemIndex},setElementIndex:function(a){this.elemIndex=a},getSubElementIndex:function(){return this.subElemIndex},setSubElementIndex:function(a){this.subElemIndex=
a},getSegmentType:function(){return this.segType},setSegmentType:function(a){this.segType=a}});a.edit.GeometrySegment.UNDEFINED_TYPE=0;a.edit.GeometrySegment.POINT_TYPE=1;a.edit.GeometrySegment.LINE_TYPE=2;a.edit.GeometrySegment.RECTANGLE_TYPE=3;a.edit.GeometrySegment.ARC_TYPE=4;a.edit.GeometrySegment.CIRCLE_TYPE=5;a.edit.GeometrySegmentPoint=a.Class.extend({initialize:function(b){var c=a.edit.GeometrySegmentPoint;this.point=this.segment=this.feature=null;this.pointLocation=c.UNDEFSEG_POINT;a.notNull(b)&&
(a.notNull(b.feature)&&(this.feature=b.feature),a.notNull(b.segment)&&(this.segment=b.segment),a.notNull(b.point)&&(this.point=b.point),a.notNull(b.pointLocation)&&(this.pointLocation=b.pointLocation))},getFeature:function(){return this.feature},setFeature:function(a){this.feature=a},getGeometrySegment:function(){return this.segment},setGeometrySegment:function(a){this.segment=a},getPoint:function(){return this.point},setPoint:function(a){this.point=a},getPointLocation:function(){return this.pointLocation},
setPointLocation:function(a){this.pointLocation=a}});a.edit.GeometrySegmentPoint.UNDEFSEG_POINT=-1;a.edit.GeometrySegmentPoint.STARTSEG_POINT=0;a.edit.GeometrySegmentPoint.ENDSEG_POINT=1;a.edit.GeometrySegmentPoint.MIDSEG_POINT=2;a.edit.GeometrySegmentUtil=a.edit.GeometrySegmentUtil||{};a.edit.GeometrySegmentUtil.buildSegmentTree=function(b){if(a.isNull(b))return null;var c=b.getGeometry();if(a.isNull(c))return null;b=new a.RTree(10);var V=c.getType(),T=a.edit.GeometrySegment,B=c.getMBR();if(a.isNull(B))return null;
var D={x:B.minX,y:B.minY,w:B.maxX-B.minX,h:B.maxY-B.minY},B=c.getDimension();switch(V){case "Point":case "OrientedPoint":case "Rectangle":c=new a.edit.GeometrySegment;c.setElementIndex(0);c.setSegmentIndex(0);c.setSubElementIndex(0);"Point"===V||"OrientedPoint"===V?c.setSegmentType(T.POINT_TYPE):c.setSegmentType(T.RECTANGLE_TYPE);b.insert(D,c);break;case "MultiPoint":case "OrientedMultiPoint":for(var D=c.coordinates.length,W=0;W<D;W++){var da={minX:Number.POSITIVE_INFINITY,minY:Number.POSITIVE_INFINITY,
maxX:Number.NEGATIVE_INFINITY,maxY:Number.NEGATIVE_INFINITY},da="MultiPoint"===V?a.geometry.Geometry.getCoordsMBR(c.coordinates[W],B,da):a.geometry.Geometry.getCoordsMBR([c.coordinates[W][0],c.coordinates[W][1]],B,da),ka=new a.edit.GeometrySegment;ka.setElementIndex(W);ka.setSegmentIndex(0);ka.setSubElementIndex(0);ka.setSegmentType(T.POINT_TYPE);b.insert({x:da.minX,y:da.minY,w:da.maxX-da.minX,h:da.maxY-da.minY},ka)}break;case "LineString":V=c.coordinates.length;for(W=D=0;W<V-B;W+=B){var ka=da=Number.POSITIVE_INFINITY,
ta=Number.NEGATIVE_INFINITY,Ga=Number.NEGATIVE_INFINITY,Ja=new a.edit.GeometrySegment;Ja.setElementIndex(0);Ja.setSegmentIndex(D++);Ja.setSubElementIndex(0);Ja.setSegmentType(T.LINE_TYPE);da=Math.min(c.coordinates[W],c.coordinates[W+B]);ta=Math.max(c.coordinates[W],c.coordinates[W+B]);ka=Math.min(c.coordinates[W+1],c.coordinates[W+1+B]);Ga=Math.max(c.coordinates[W+1],c.coordinates[W+1+B]);b.insert({x:da,y:ka,w:ta-da,h:Ga-ka},Ja)}break;case "MultiLineString":V=c.coordinates.length;for(D=0;D<V;D++)for(W=
c.coordinates[D].length,ka=da=0;ka<W-B;ka+=B){var Ga=ta=Number.POSITIVE_INFINITY,La=Ja=Number.NEGATIVE_INFINITY,Ra=new a.edit.GeometrySegment;Ra.setElementIndex(D);Ra.setSegmentIndex(da++);Ra.setSubElementIndex(0);Ra.setSegmentType(T.LINE_TYPE);ta=Math.min(c.coordinates[D][ka],c.coordinates[D][ka+B]);Ja=Math.max(c.coordinates[D][ka],c.coordinates[D][ka+B]);Ga=Math.min(c.coordinates[D][ka+1],c.coordinates[D][ka+1+B]);La=Math.max(c.coordinates[D][ka+1],c.coordinates[D][ka+1+B]);b.insert({x:ta,y:Ga,
w:Ja-ta,h:La-Ga},Ra)}break;case "Polygon":V=c.coordinates.length;for(D=0;D<V;D++)for(W=c.coordinates[D].length,ka=da=0;ka<W-B;ka+=B)Ga=ta=Number.POSITIVE_INFINITY,La=Ja=Number.NEGATIVE_INFINITY,Ra=new a.edit.GeometrySegment,Ra.setElementIndex(0),Ra.setSegmentIndex(da++),Ra.setSubElementIndex(D),Ra.setSegmentType(T.LINE_TYPE),ta=Math.min(c.coordinates[D][ka],c.coordinates[D][ka+B]),Ja=Math.max(c.coordinates[D][ka],c.coordinates[D][ka+B]),Ga=Math.min(c.coordinates[D][ka+1],c.coordinates[D][ka+1+B]),
La=Math.max(c.coordinates[D][ka+1],c.coordinates[D][ka+1+B]),b.insert({x:ta,y:Ga,w:Ja-ta,h:La-Ga},Ra);break;case "MultiPolygon":for(V=c.coordinates.length,D=0;D<V;D++)for(W=c.coordinates[D].length,da=0;da<W;da++)for(ka=c.coordinates[D][da].length,Ga=ta=0;Ga<ka-B;Ga+=B){var La=Ja=Number.POSITIVE_INFINITY,jb=Ra=Number.NEGATIVE_INFINITY,gb=new a.edit.GeometrySegment;gb.setElementIndex(D);gb.setSegmentIndex(ta++);gb.setSubElementIndex(da);gb.setSegmentType(T.LINE_TYPE);Ja=Math.min(c.coordinates[D][da][Ga],
c.coordinates[D][da][Ga+B]);Ra=Math.max(c.coordinates[D][da][Ga],c.coordinates[D][da][Ga+B]);La=Math.min(c.coordinates[D][da][Ga+1],c.coordinates[D][da][Ga+1+B]);jb=Math.max(c.coordinates[D][da][Ga+1],c.coordinates[D][da][Ga+1+B]);b.insert({x:Ja,y:La,w:Ra-Ja,h:jb-La},gb)}}return b};a.edit.GeometrySegmentUtil.getFeatureSegmentPoint=function(b,c,V,T,B,D,W,da){if(a.isNull(b)||a.isNull(b.getGeometry()))return null;var ka=null,ka=a.isNull(c)?a.edit.GeometrySegmentUtil.buildSegmentTree(b):c;if(a.isNull(ka))return null;
c={x:V[0]-T,y:V[1]-T,w:2*T,h:2*T};a.isNull(B)&&(B=!1);a.isNull(da)&&(da=!1);a.isNull(W)&&(W=!1);a.isNull(D);var ta=ka.search(c);if(a.isNull(ta)||0===ta.length)return null;var Ga=a.edit.GeometrySegment,Ja=a.edit.GeometrySegmentPoint;c=ka=D=null;for(var La,Ra,jb,gb=Number.MAX_VALUE,bb=b.getGeometry(),qb=bb.getDimension(),$a=0;$a<ta.length;$a++){var ib=ta[$a];if(ib.getSegmentType()===Ga.POINT_TYPE)!1!==B&&(La=bb.getX()-V[0],Ra=bb.getY()-V[1],jb=Math.sqrt(La*La+Ra*Ra),jb<=T&&jb<gb&&(gb=jb,D=ib,ka=[bb.getX(),
bb.getY()],c=Ja.STARTSEG_POINT));else if(ib.getSegmentType()===Ga.LINE_TYPE){La=ib.getElementIndex();Ra=ib.getSegmentIndex();var vb=ib.getSubElementIndex(),Kb=jb=0,Lb=0,Mb=0;if("Polygon"===bb.getType())jb=bb.coordinates[vb][Ra*qb],Kb=bb.coordinates[vb][Ra*qb+1],Lb=bb.coordinates[vb][Ra*qb+qb],Mb=bb.coordinates[vb][Ra*qb+qb+1];else if("MultiPolygon"===bb.getType())jb=bb.coordinates[La][vb][Ra*qb],Kb=bb.coordinates[La][vb][Ra*qb+1],Lb=bb.coordinates[La][vb][Ra*qb+qb],Mb=bb.coordinates[La][vb][Ra*qb+
qb+1];else if("LineString"===bb.getType())jb=bb.coordinates[Ra*qb],Kb=bb.coordinates[Ra*qb+1],Lb=bb.coordinates[Ra*qb+qb],Mb=bb.coordinates[Ra*qb+qb+1];else if("MultiLineString"===bb.getType())jb=bb.coordinates[La][Ra*qb],Kb=bb.coordinates[La][Ra*qb+1],Lb=bb.coordinates[La][Ra*qb+qb],Mb=bb.coordinates[La][Ra*qb+qb+1];else continue;La=a.util.GeomUtil.distanceToSegment(V[0],V[1],jb,Kb,Lb,Mb);a.notNull(La)&&La[0]<=T&&(gb=La[0],D=ib,c=Math.floor(La[1]),0===c?ka=[jb,Kb]:1===c?ka=[Lb,Mb]:(ka=a.util.GeomUtil.getSegmentPoint(V[0],
V[1],jb,Kb,Lb,Mb),c=Ja.MIDSEG_POINT,a.notNull(ka)&&(La=ka[0]-jb,Ra=ka[1]-Kb,Math.sqrt(La*La+Ra*Ra)<=T?(ka=[jb,Kb],c=Ja.STARTSEG_POINT):(La=ka[0]-Lb,Ra=ka[1]-Mb,Math.sqrt(La*La+Ra*Ra)<=T&&(ka=[Lb,Mb],c=Ja.ENDSEG_POINT)))))}else ib.getSegmentType()===Ga.ARC_TYPE&&da||ib.getSegmentType()===Ga.CIRCLE_TYPE&&W||ib.getSegmentType()}if(a.isNull(D))return null;V=new a.edit.GeometrySegmentPoint;V.feature=b;V.segment=D;V.point=ka;V.pointLocation=c;return V};a.edit.GeometrySegmentUtil.getLayerSegmentPoint=function(b,
c,V,T,B,D,W){if(a.isNull(b)||a.isNull(c)||a.isNull(V))return null;var da=b.searchFeatures({x:c[0]-V,y:c[1]-V,w:2*V,h:2*V});if(a.isNull(da)||0===da.length)return null;for(var ka=Number.MAX_VALUE,ta=null,Ga=0;Ga<da.length;Ga++){var Ja=b.segmentRtree[da[Ga].id];if(a.isNull(Ja))if(Ja=a.edit.GeometrySegmentUtil.buildSegmentTree(da[Ga]),a.isNull(Ja))continue;else b.segmentRtree[da[Ga].id]=Ja;Ja=a.edit.GeometrySegmentUtil.getFeatureSegmentPoint(da[Ga],Ja,c,V,T,W,D,B);if(!a.isNull(Ja)){var La=Ja.getPoint();
if(null!==La){var Ra=c[0]-La[0],La=c[1]-La[1],Ra=Math.sqrt(Ra*Ra+La*La);Ra<ka&&(ka=Ra,ta=Ja)}}}return ta};a.edit.GeometrySegmentUtil.getLayerSegmentPoints=function(b,c,V,T,B,D,W){if(a.isNull(b)||a.isNull(c)||a.isNull(V))return null;var da=b.searchFeatures({x:c[0]-V,y:c[1]-V,w:2*V,h:2*V});if(a.isNull(da)||0===da.length)return null;for(var ka=[],ta=0;ta<da.length;ta++){var Ga=b.segmentRtree[da[ta].id];if(a.isNull(Ga))if(Ga=a.edit.GeometrySegmentUtil.buildSegmentTree(da[ta]),a.isNull(Ga))continue;else b.segmentRtree[da[ta].id]=
Ga;Ga=a.edit.GeometrySegmentUtil.getFeatureSegmentPoint(da[ta],Ga,c,V,T,B,D,W);a.isNull(Ga)||ka.push(Ga)}return 0===ka.length?null:ka};a.edit.GeometrySegmentUtil.getFeatureSegmentPointsWithinBox=function(b,c,V){if(a.isNull(b)||a.isNull(V)||a.isNull(b.getGeometry()))return null;var T=null,T=a.isNull(c)?a.edit.GeometrySegmentUtil.buildSegmentTree(b):c;if(a.isNull(T))return null;c=T.search(V);if(a.isNull(c)||0===c.length)return null;for(var T=a.edit.GeometrySegment,B=a.edit.GeometrySegmentPoint,D=b.getGeometry(),
W=D.getDimension(),da=[],ka={},ta=null,Ga=0;Ga<c.length;Ga++){var Ja=c[Ga],La=Ja.getElementIndex(),Ra=Ja.getSegmentIndex(),jb=Ja.getSubElementIndex();if(Ja.getSegmentType()===T.LINE_TYPE){var gb=0,bb=0,qb=0,$a=0;if("Polygon"===D.getType())gb=D.coordinates[jb][Ra*W],bb=D.coordinates[jb][Ra*W+1],qb=D.coordinates[jb][Ra*W+W],$a=D.coordinates[jb][Ra*W+W+1];else if("MultiPolygon"===D.getType())gb=D.coordinates[La][jb][Ra*W],bb=D.coordinates[La][jb][Ra*W+1],qb=D.coordinates[La][jb][Ra*W+W],$a=D.coordinates[La][jb][Ra*
W+W+1];else if("LineString"===D.getType())gb=D.coordinates[Ra*W],bb=D.coordinates[Ra*W+1],qb=D.coordinates[Ra*W+W],$a=D.coordinates[Ra*W+W+1];else if("MultiLineString"===D.getType())gb=D.coordinates[La][Ra*W],bb=D.coordinates[La][Ra*W+1],qb=D.coordinates[La][Ra*W+W],$a=D.coordinates[La][Ra*W+W+1];else continue;ta=""+La+":"+(Ra-1)+":"+jb+":"+B.ENDSEG_POINT;a.util.GeomUtil.pointInRect(gb,bb,V.x,V.y,V.x+V.w,V.y+V.h)&&a.isNull(ka[ta])&&(ta=new a.edit.GeometrySegmentPoint,ta.feature=b,ta.segment=Ja,ta.point=
[gb,bb],ta.pointLocation=B.STARTSEG_POINT,da.push(ta),ka[""+La+":"+Ra+":"+jb+":"+B.STARTSEG_POINT]="*");ta=""+La+":"+(Ra+1)+":"+jb+":"+B.STARTSEG_POINT;a.util.GeomUtil.pointInRect(qb,$a,V.x,V.y,V.x+V.w,V.y+V.h)&&a.isNull(ka[ta])&&(gb=new a.edit.GeometrySegmentPoint,gb.feature=b,gb.segment=Ja,gb.point=[qb,$a],gb.pointLocation=B.ENDSEG_POINT,da.push(gb),ka[""+La+":"+Ra+":"+jb+":"+B.ENDSEG_POINT]="*")}}return 0===da.length?null:da};a.edit.GeometrySegmentUtil.getLayerSegmentPointsWithinBox=function(b,
c){if(a.isNull(b)||a.isNull(c))return null;var V=b.searchFeatures(c);if(a.isNull(V)||0===V.length)return null;for(var T={},B=0;B<V.length;B++){var D=[],W=b.segmentRtree[V[B].id];if(a.isNull(W))if(W=a.edit.GeometrySegmentUtil.buildSegmentTree(V[B]),a.isNull(W))continue;else b.segmentRtree[V[B].id]=W;W=a.edit.GeometrySegmentUtil.getFeatureSegmentPointsWithinBox(V[B],W,c);if(!a.isNull(W)){for(var da=0;da<W.length;da++)D.push(W[da]);T[V[B].id]=D}}var V=!1,ka;for(ka in T)if(T.hasOwnProperty(ka)){V=!0;
break}return V?T:null};a.edit.GeometrySegmentUtil.removeVertexFromGeometry=function(b,c){if(a.isNull(b)||a.isNull(c))return!1;var V=b.getType();if("Point"===V||"MultiPoint"===V||"OrientedPoint"===V)return!1;var T=b.getOrdinates();if(a.isNull(T))return!1;var B=c.getGeometrySegment(),D=c.getPoint(),W=c.getPointLocation();if(a.isNull(B)||a.isNull(D))return!1;var D=a.edit.GeometrySegment,da=a.edit.GeometrySegmentPoint;if(B.getSegmentType()!==D.LINE_TYPE||W===da.MIDSEG_POINT)return!1;var D=B.getElementIndex(),
ka=B.getSegmentIndex(),B=B.getSubElementIndex(),da=b.getDimension(),W=ka*da+W*da,ka=0;switch(V){case "LineString":ka=T.length/da;if(3>ka)return!1;T.splice(W,da);break;case "MultiLineString":ka=T[D].length/da;if(3>ka)return!1;T[D].splice(W,da);break;case "Polygon":ka=T[B].length/da;if(5>ka)return!1;T[B].splice(W,da);break;case "MultiPolygon":ka=T[D][B].length/da;if(5>ka)return!1;T[D][B].splice(W,da);break;default:return!1}b.mbr=null;b.getMBR();return!0};a.edit.GeometrySegmentUtil.addVertexToGeometry=
function(b,c){if(a.isNull(b)||a.isNull(c))return!1;var V=b.getType();if("Point"===V||"MultiPoint"===V||"OrientedPoint"===V)return!1;var T=b.getOrdinates();if(a.isNull(T))return!1;var B=c.getGeometrySegment(),D=c.getPoint(),W=c.getPointLocation();if(a.isNull(B)||a.isNull(D))return!1;var da=a.edit.GeometrySegment,ka=a.edit.GeometrySegmentPoint;if(B.getSegmentType()!==da.LINE_TYPE||W!==ka.MIDSEG_POINT)return!1;W=B.getElementIndex();da=B.getSegmentIndex();ka=B.getSubElementIndex();B=b.getDimension();
da*=B;switch(V){case "LineString":for(V=0;V<B;V++)2>V?T.splice(da+V+B,0,D[V]):T.splice(da+V+B,0,0);break;case "MultiLineString":for(V=0;V<B;V++)2>V?T[W].splice(da+V+B,0,D[V]):T[W].splice(da+V+B,0,0);break;case "Polygon":for(V=0;V<B;V++)2>V?T[ka].splice(da+V+B,0,D[V]):T[ka].splice(da+V+B,0,0);break;case "MultiPolygon":for(V=0;V<B;V++)2>V?T[W][ka].splice(da+V+B,0,D[V]):T[W][ka].splice(da+V+B,0,0);break;default:return!1}b.mbr=null;b.getMBR();return!0};a.edit.GeometrySegmentUtil.moveGeometryVertex=function(b,
c,V){if(a.isNull(b)||a.isNull(c)||a.isNull(V))return!1;var T=b.getType();if("Point"===T||"MultiPoint"===T||"OrientedPoint"===T)return!1;var B=b.getOrdinates();if(a.isNull(B))return!1;var D=c.getGeometrySegment(),W=c.getPoint();c=c.getPointLocation();if(a.isNull(D)||a.isNull(W))return!1;var W=a.edit.GeometrySegment,da=a.edit.GeometrySegmentPoint;if(D.getSegmentType()!==W.LINE_TYPE||c===da.MIDSEG_POINT)return!1;var W=D.getElementIndex(),da=D.getSegmentIndex(),D=D.getSubElementIndex(),ka=b.getDimension();
c=da*ka+c*ka;switch(T){case "LineString":B[c]=V[0];B[c+1]=V[1];break;case "MultiLineString":B[W][c]=V[0];B[W][c+1]=V[1];break;case "Polygon":B[D][c]=V[0];B[D][c+1]=V[1];break;case "MultiPolygon":B[W][D][c]=V[0];B[W][D][c+1]=V[1];break;default:return!1}b.mbr=null;b.getMBR();return!0};a.edit.GeometrySegmentUtil.removeVertexesFromGeometry=function(b,c){if(a.isNull(b)||a.isNull(c))return!1;var V=b.getType();if("Point"===V||"MultiPoint"===V||"OrientedPoint"===V)return!1;var T=b.getOrdinates();if(a.isNull(T))return!1;
for(var B=b.getDimension(),D=!1,W={},da=0;da<c.length;da++){var ka=c[da].getGeometrySegment(),ta=c[da].getPoint(),Ga=c[da].getPointLocation();if(!a.isNull(ka)&&!a.isNull(ta)){var ta=a.edit.GeometrySegment,Ja=a.edit.GeometrySegmentPoint;if(ka.getSegmentType()===ta.LINE_TYPE&&Ga!==Ja.MIDSEG_POINT){var ta=ka.getElementIndex(),Ja=ka.getSegmentIndex(),ka=ka.getSubElementIndex(),Ga=Ja*B+Ga*B,La=Ja=0;switch(V){case "LineString":Ja=T.length/B;if(2>Ja-c.length)break;for(;La!=B;)T[Ga+La]=Number.NaN,La++;D=
!0;break;case "MultiLineString":for(;La!=B;)T[ta][Ga+La]=Number.NaN,La++,W[""+ta]=!0;D=!0;break;case "Polygon":for(;La!=B;)T[ka][Ga+La]=Number.NaN,La++,W[""+ka]=!0;D=!0;break;case "MultiPolygon":for(;La!=B;)T[ta][ka][Ga+La]=Number.NaN,La++,W[""+ta+":"+ka]=!0;D=!0;break;default:return!1}}}}if(!D)return!1;switch(V){case "LineString":W=[];for(V=0;V<T.length;V++)isNaN(T[V])||W.push(T[V]);b.coordinates=W;break;case "MultiLineString":for(V=0;V<T.length;V++)if(!a.isNull(W[""+V])){B=[];for(D=0;D<T[V].length;D++)isNaN(T[V][D])||
B.push(T[V][D]);T[V]=B}for(W=0;W<T.length;W++)2>T[W].length&&(T.splice(W,1),W--);break;case "Polygon":for(V=0;V<T.length;V++)if(!a.isNull(W[""+V])){B=[];for(D=0;D<T[V].length;D++)isNaN(T[V][D])||B.push(T[V][D]);T[V]=B}for(W=0;W<T.length;W++)if(4>T[W].length){if(0===W)return!1;T.splice(W,1);W--}break;case "MultiPolygon":for(V=0;V<T.length;V++)for(B=0;B<T[V].length;B++)if(!a.isNull(W[""+V+":"+B])){D=[];for(da=0;da<T[V][B].length;da++)isNaN(T[V][B][da])||D.push(T[V][B][da]);T[V][B]=D}for(W=0;W<T.length;W++)for(V=
0;V<T[W].length;V++)if(4>T[W][V].length)if(0===V){T.splice(W,1);W--;break}else T[W].splice(V,1),V--}b.mbr=null;b.getMBR();return!0};a.edit.GeometrySegmentUtil.breakLineGeometry=function(b,c){if(a.isNull(b)||a.isNull(c))return!1;var V=b.getType();if("LineString"!==V&&"MultiLineString"!==V)return!1;var T=b.getOrdinates();if(a.isNull(T))return!1;var B=c.getGeometrySegment(),D=c.getPoint(),W=c.getPointLocation();if(a.isNull(B)||a.isNull(D))return!1;var da=a.edit.GeometrySegment,ka=a.edit.GeometrySegmentPoint;
if(B.getSegmentType()!==da.LINE_TYPE)return!1;var ta=B.getElementIndex(),B=B.getSegmentIndex(),Ga=b.getDimension(),Ja=-1;if(W!==ka.MIDSEG_POINT)if(Ja=B*Ga+W*Ga,"LineString"===V){if(0===Ja||Ja===T.length-Ga)return!1}else{if(0===Ja||Ja===T[ta].length-Ga)return!1}else Ja=B*Ga+Ga;var B=[],da=[],La=[],Ra=null;if("LineString"===V)Ra=T;else for(Ra=T[ta],V=0;V<T.length;V++)V!==ta&&B.push(T[V]);for(T=0;T<Ja;T++)da.push(Ra[T]);if(W!==ka.MIDSEG_POINT)for(D=0;D<Ga;D++)da.push(Ra[Ja+D]);else for(W=0;W<Ga;W++)2>
W?(da.push(D[W]),La.push(D[W])):(da.push(0),La.push(0));for(D=Ja;D<Ra.length;D++)La.push(Ra[D]);B.push(da);B.push(La);b.type="MultiLineString";b.coordinates=B;return!0};a.edit.GeometrySegmentUtil.splitPolygonGeometry=function(b,c,V){if(a.isNull(b)||a.isNull(c)||a.isNull(V))return!1;var T=b.getType();if("Polygon"!==T&&"MultiPolygon"!==T)return!1;var B=c.length;if(0===B||0!==B%2||c[0].getGeometrySegment().getElementIndex()!==c[B-1].getGeometrySegment().getElementIndex())return!1;var D;if(2<c.length)for(D=
1;D<B-1;D+=2)if(c[D].getSubElementIndex()!=c[D+1].getSegment().getSubElementIndex())return!1;for(D=0;D<V.length;D++){var W=V[D];if(a.isNull(W)||2>W.length/2)return!1}var da=b.getDimension(),W=c[0].getGeometrySegment().getElementIndex();if(-1===W)return!1;var ka=null,ka="Polygon"===T?b.getOrdinates():b.getOrdinates()[W],ta=c[0].getPointLocation(),Ga=c[B-1].getPointLocation(),Ja=c[0].getGeometrySegment().getSegmentIndex(),La=c[B-1].getGeometrySegment().getSegmentIndex(),Ra=ka[0].length-1;if(c[0].getPoint()[0]===
c[B-1].getPoint()[0]&&c[0].getPoint()[1]===c[B-1].getPoint()[1])return!1;if(2<c.length)for(D=1;D<B-2;D+=2)if(c[D].getPoint()[0]===c[D+1].getPoint()[0]&&c[D].getPoint()[1]==c[D+1].getPoint()[1])return!1;var jb=[],gb=a.edit.GeometrySegmentPoint;if(2===c.length)jb.push(V[0]),jb.push(V[0]);else return!1;D=!1;var bb=NaN,qb=NaN,$a,ib,vb;Ja===La&&(D=!0,$a=c[0].getPoint(),V=c[B-1].getPoint(),ib=ka[Ja*da],vb=ka[Ja*da+1],bb=$a[0]-ib,$a=$a[1]-vb,bb=Math.sqrt(bb*bb+$a*$a),ib=V.getX()-ib,V=V.getY()-vb,qb=Math.sqrt(ib*
ib+V*V));V=[];vb=[];$a=ib=-1;ib=2;if(Ja<La||D&&bb<qb){ta===gb.STARTSEG_POINT?ib=Ja*da:ta===gb.ENDSEG_POINT?ib=(Ja+1)*da:(ib=(Ja+1)*da,V.push(c[0].getPoint()[0]),V.push(c[0].getPoint()[1]));Ga===gb.STARTSEG_POINT||Ga===gb.MIDSEG_POINT?$a=La*da+da:Ga===gb.ENDSEG_POINT&&($a=(La+1)*da+da);D&&ta===gb.MIDSEG_POINT&&Ga===gb.MIDSEG_POINT&&($a=ib);for(D=ib;D<$a;D+=da)V.push(ka[0][D]),V.push(ka[0][D+1]);Ga===gb.MIDSEG_POINT&&(V.push(c[B-1].getPoint()[0]),V.push(c[B-1].getPoint()[1]));D=jb[0];ib=2;for(bb=D.length-
da;0<bb;bb-=ib)V.push(D[bb-ib]),V.push(D[bb-ib+1]);Ga===gb.STARTSEG_POINT?ib=La*da:Ga===gb.ENDSEG_POINT?ib=(La+1)*da:(ib=(La+1)*da,vb.push(c[B-1].getPoint()[0]),vb.push(c[B-1].getPoint()[1]));$a=Ra+1;for(D=ib;D<$a;D+=da)vb.push(ka[0][D]),vb.push(ka[0][D+1]);ta===gb.STARTSEG_POINT||ta===gb.MIDSEG_POINT?$a=Ja*da+da:ta===gb.ENDSEG_POINT&&($a=(Ja+1)*da+da);for(D=da;D<$a;D+=da)vb.push(ka[0][D]),vb.push(ka[0][D+1]);ta===gb.MIDSEG_POINT&&(vb.push(c[0].getPoint()[0]),vb.push(c[0].getPoint()[1]));D=jb[1];
ib=2;for(c=da;c<D.length;c+=ib)vb.push(D[c]),vb.push(D[c+1])}else if(Ja>La||D&&bb>qb){Ga===gb.STARTSEG_POINT?ib=La*da:Ga===gb.ENDSEG_POINT?ib=(La+1)*da:(ib=(La+1)*da,V.push(c[B-1].getPoint()[0]),V.push(c[B-1].getPoint()[1]));ta===gb.STARTSEG_POINT||ta===gb.MIDSEG_POINT?$a=Ja*da+da:ta===gb.ENDSEG_POINT&&($a=(Ja+1)*da+da);for(D=ib;D<$a;D+=da)V.push(ka[0][D]),V.push(ka[0][D+1]);ta===gb.MIDSEG_POINT&&(V.push(c[0].getPoint()[0]),V.push(c[0].getPoint()[1]));D=jb[0];ib=2;for(bb=da;bb<D.length;bb+=ib)V.push(D[bb]),
V.push(D[bb+1]);ta===gb.STARTSEG_POINT?ib=Ja*da:ta===gb.ENDSEG_POINT?ib=(Ja+1)*da:(ib=(Ja+1)*da,vb.push(c[0].getPoint()[0]),vb.push(c[0].getPoint()[1]));$a=Ra+1;for(D=ib;D<$a;D+=da)vb.push(ka[0][D]),vb.push(ka[0][D+1]);Ga===gb.STARTSEG_POINT||Ga===gb.MIDSEG_POINT?$a=La*da+da:Ga===gb.ENDSEG_POINT&&($a=(La+1)*da+da);for(D=da;D<$a;D+=da)vb.push(ka[0][D]),vb.push(ka[0][D+1]);Ga===gb.MIDSEG_POINT&&(vb.push(c[B-1].getPoint()[0]),vb.push(c[B-1].getPoint()[1]));D=jb[1];ib=2;for(bb=D.length-da;0<bb;bb-=ib)vb.push(D[bb-
ib]),vb.push(D[bb-ib+1])}else return!1;c=[];B=-1;"Polygon"===T?(B=1,c[0]=[],c[1]=[]):(B=b.getOrdinates().length,c=b.getOrdinates());c[W]=[V];c[B]=[vb];b.coordinates=c;b.type="MultiPolygon";b.mbr=null;b.getMBR();return!0};a.tool.BreakLineTool=a.tool.RedlineTool.extend({initialize:function Ub(b,c){Ub.base.call(this,b,a.tool.RedlineTool.TYPE_POINT);var B=this;this.lineFeature=c;this.lineElement=-1;this.snapSegment=this.snapFeature=this.secondLine=this.firstLine=null;a.isNull(this.lineFeature)?(a.util.Logger.alert("MAPVIEWER_9054",
"OM.tool.BreakLineTool.initialize",""),this.clear()):(a.notNull(this.lineFeature)&&a.notNull(this.lineFeature.getGeometry())&&("LineString"===this.lineFeature.getGeometry().getType()||"MultiLineString"===this.lineFeature.getGeometry().getType())?this.lineFeature.editable=!1:(a.util.Logger.alert("MAPVIEWER_9055","OM.tool.BreakLineTool.initialize",""),this.lineFeature=null,this.clear()),a.gv.featureDrag=!1,a.gv.allowFeaturePointsInteraction=!1,this.addListener(a.event.ToolEvent.TOOL_END,this.processPoint),
this.snapLayer=new a.layer.VectorLayer("snap_layer_"+Math.random(),{def:{type:a.layer.VectorLayer.TYPE_LOCAL}}),this.snapLayerStyle=new a.style.Marker({width:12,height:12,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:10,height:10},style:{fill:"#ffffff",stroke:"#ff0000",strokeThickness:1}}]}),this.snapLayer.setRenderingStyle(this.snapLayerStyle),this.snapLayer.setDisplayFeaturesTaskEnabled(!1),b.addLayer(this.snapLayer),this.addListener(a.event.ToolEvent.SNAP_POINT,function(){if(!a.isNull(B.lineFeature)){a.notNull(B.snapFeature)&&
(B.snapLayer.removeFeature(B.snapFeature),B.snapLayer.redraw(),B.snapFeature=null);B.snapPoint=null;var b=B._map.getScreenPointLocation(B._map.mLocX,B._map.mLocY);if(a.notNull(b)){var c=B._map.getScreenPointLocation(B._map.mLocX-3,B._map.mLocY-3),T=b.coordinates[0]-c.coordinates[0],c=c.coordinates[1]-b.coordinates[1],T=Math.sqrt(T*T+c*c),c=[b.coordinates[0],b.coordinates[1]],V=null;a.notNull(B.lineFeature.parentLayer)&&(V=B.lineFeature.parentLayer.segmentRtree[B.lineFeature.id],a.isNull(V)&&(V=a.edit.GeometrySegmentUtil.buildSegmentTree(B.lineFeature),
a.notNull(V)&&(B.lineFeature.parentLayer.segmentRtree[B.lineFeature.id]=V)));T=a.edit.GeometrySegmentUtil.getFeatureSegmentPoint(B.lineFeature,V,c,T,!1,!1,!1,!1);B.snapSegment=null;if(a.notNull(T)){var ta=T.getGeometrySegment(),c=T.getPointLocation(),V=a.edit.GeometrySegmentPoint,Ga=ta.getElementIndex(),ta=ta.getSegmentIndex(),Ja=B.lineFeature.getGeometry().getDimension(),La=B.lineFeature.getGeometry().getType(),Ra=B.lineFeature.getGeometry().getOrdinates(),jb=-1;if(c!==V.MIDSEG_POINT)if(jb=ta*Ja+
c*Ja,"LineString"===La){if(0===jb||jb===Ra.length-Ja)return}else if(0===jb||jb===Ra[Ga].length-Ja)return;B.snapSegment=T;T=T.getPoint();b=new a.geometry.Point(T[0],T[1],b.getSRID());T=B._map.getScreenLocation(b);B.snapPoint=[];B.snapPoint.push(T.x);B.snapPoint.push(T.y);B.snapFeature=new a.Feature("SnapPoint",b,{renderingStyle:B.snapLayerStyle});B.snapLayer.addFeature(B.snapFeature);B.snapLayer.redraw()}}}}))},clear:function(){a.gv.featureDrag=!0;a.gv.allowFeaturePointsInteraction=!0;a.notNull(this.snapFeature)&&
(this.snapLayer.removeFeature(this.snapFeature),this.snapLayer.redraw(),this.snapFeature=null);this.finish();this.clear_base()},processPoint:function(){this.lineElement=-1;this.secondLine=this.firstLine=null;if(!a.isNull(this.lineFeature)){if(a.notNull(this._geometry)&&a.notNull(this.snapSegment)){var b=this.lineFeature.getGeometry().clone(!0);if(a.edit.GeometrySegmentUtil.breakLineGeometry(b,this.snapSegment)){this.lineElement=this.snapSegment.getElementIndex;var c=b.getOrdinates().length;this.firstLine=
b.getOrdinates()[c-2];this.secondLine=b.getOrdinates()[c-1];a.notNull(this.lineFeature.parentLayer.changeManager)&&(c=this.lineFeature.parentLayer.changeManager.updateFeature(this.lineFeature.id,this.lineFeature,b,a.edit.EditChangeEvent.SPATIAL_UPDATE),a.notNull(c)&&this.lineFeature.parentLayer.getUndoManager().addEdit({feature:this.lineFeature,changeManager:this.lineFeature.parentLayer.changeManager,editChangeEvent:c,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"break line"},
undo:function(){this.changeManager.undo(this.editChangeEvent);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()},redo:function(){this.changeManager.redo(this.editChangeEvent);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()}}));this.lineFeature.editable=!0;this.lineFeature.deleteEditingProperties();this.lineFeature.addEditProperties();this.lineFeature.setGeometry(b);this.lineFeature.parentLayer.selectFeature(this.lineFeature)}}this._map.getToolFeatureLayer().removeFeature(this._points[0])}this.start()}});
a.tool.RemoveVertexesTool=a.tool.RectangleTool.extend({initialize:function V(b,c){V.base.call(this,b);this.selectedFeature=c;this.addListener(a.event.ToolEvent.TOOL_END,this.processRectangle);this.registerUpdate=function(b,c){a.isNull(b)||a.isNull(c)||a.isNull(this.selectedFeature)||(c===this.selectedFeature?this.selectedFeature.parentLayer.getUndoManager().addEdit({feature:this.selectedFeature,changeManager:this.selectedFeature.parentLayer.changeManager,editChangeEvent:b,canUndo:function(){return!0},
canRedo:function(){return!0},getPresentationName:function(){return"feature vertexes remove"},undo:function(){this.changeManager.undo(this.editChangeEvent);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()},redo:function(){this.changeManager.redo(this.editChangeEvent);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()}}):this.selectedFeature.parentLayer.getUndoManager().addEdit({feature:c,changeManager:this.selectedFeature.parentLayer.changeManager,
editChangeEvent:b,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"feature vertexes remove"},undo:function(){this.changeManager.undo(this.editChangeEvent)},redo:function(){this.changeManager.redo(this.editChangeEvent)}}))}},processRectangle:function(){if(a.notNull(this._geometry)){var b=[],c={},B={x:this._geometry.getMinX(),y:this._geometry.getMinY(),w:this._geometry.getWidth(),h:this._geometry.getHeight()},B=a.edit.GeometrySegmentUtil.getLayerSegmentPointsWithinBox(this.selectedFeature.parentLayer,
B);if(a.notNull(B)&&a.notNull(B[this.selectedFeature.id]))for(var D in B)if(B.hasOwnProperty(D)){var W=B[D];if(a.notNull(W)&&0<W.length&&(D===this.selectedFeature.id||this.selectedFeature.parentLayer.hasSharedBoundary())){var da=W[0].getFeature().getGeometry().clone(!0);a.edit.GeometrySegmentUtil.removeVertexesFromGeometry(da,W)&&(b.push(W[0].getFeature()),c[D]=da)}}if(a.notNull(this.selectedFeature.parentLayer.changeManager)){D=a.edit.EditChangeEvent;1<b.length&&this.selectedFeature.parentLayer.getUndoManager().startChangeBlock("feature vertexes remove");
for(B=0;B<b.length;B++)W=b[B],a.isNull(c[W.id])||(da=this.selectedFeature.parentLayer.changeManager.updateFeature(W.id,W,c[W.id],D.SPATIAL_UPDATE),a.notNull(da)&&this.registerUpdate(da,W));1<b.length&&this.selectedFeature.parentLayer.getUndoManager().endChangeBlock("feature vertexes remove")}for(D=0;D<b.length;D++)B=b[D],B.setGeometry(c[B.id]);this.selectedFeature.deleteEditingProperties();this.selectedFeature.addEditProperties()}this._geometry=null}});a.tool.SplitPolygonTool=a.tool.RedlineTool.extend({initialize:function T(b,
c){T.base.call(this,b,a.tool.RedlineTool.TYPE_POINT);var W=this;this.splitLineStyle=new a.style.Line({stroke:"#FF0000",strokeThickness:5,strokeOpacity:.5});this.splitLineStyle.fill=b.graphics.oui.NO_PAINT;this.snapSegmentPoint=this.snapFeature=null;this.splitPoints=[];this.splitLines=[];this.currentSplitLine=[];this.shapeGroup=[];this.ghostShape=null;this.lastSubElem=-1;this.hasSplitLines=this.islastActionMoveTo=this.hasSplitLines=this.isInAction=!1;this.lastPointWC=[];this.lastScreenPoint=[];a.isNull(c)?
(a.util.Logger.alert("MAPVIEWER_9054","OM.tool.SplitPolygonTool.initialize",""),this.clear()):(this.polygonFeature=c,!a.notNull(this.polygonFeature)||"Polygon"!==this.polygonFeature.getGeometry().getType()&&"MultiPolygon"!==this.polygonFeature.getGeometry().getType()?(a.util.Logger.alert("MAPVIEWER_9038","OM.tool.SplitPolygonTool.initialize",""),this.polygonFeature=null,this.clear()):this.polygonFeature.editable=!1,a.gv.featureDrag=!1,a.gv.allowFeaturePointsInteraction=!1,this.addListener(a.event.ToolEvent.REDLINE_POINT_CREATE,
this.processPoint),this.snapLayer=new a.layer.VectorLayer("snap_layer_"+Math.random(),{def:{type:a.layer.VectorLayer.TYPE_LOCAL}}),this.snapLayerStyle=new a.style.Marker({width:12,height:12,vectorDef:[{shape:{type:"rectangle",x:0,y:0,width:10,height:10},style:{fill:"#ffffff",stroke:"#ff0000",strokeThickness:1}}]}),this.snapLayer.setRenderingStyle(this.snapLayerStyle),b.addLayer(this.snapLayer),this.addListener(a.event.ToolEvent.SNAP_POINT,function(){if(!a.isNull(W.polygonFeature)){a.notNull(W.snapFeature)&&
(W.snapLayer.removeFeature(W.snapFeature),W.snapLayer.redraw(),W.snapFeature=null);W.snapPoint=null;var b=W._map.getScreenPointLocation(W._map.mLocX,W._map.mLocY);if(a.notNull(b)){var c=W._map.getScreenPointLocation(W._map.mLocX-3,W._map.mLocY-3),D=b.coordinates[0]-c.coordinates[0],c=c.coordinates[1]-b.coordinates[1],D=Math.sqrt(D*D+c*c),c=[b.coordinates[0],b.coordinates[1]],B=null;a.notNull(W.polygonFeature.parentLayer)&&(B=W.polygonFeature.parentLayer.segmentRtree[W.polygonFeature.id],a.isNull(B)&&
(B=a.edit.GeometrySegmentUtil.buildSegmentTree(W.polygonFeature),a.notNull(B)&&(W.polygonFeature.parentLayer.segmentRtree[W.polygonFeature.id]=B)));D=a.edit.GeometrySegmentUtil.getFeatureSegmentPoint(W.polygonFeature,B,c,D,!1,!1,!1,!1);W.snapSegmentPoint=null;if(a.notNull(D)){B=D.getGeometrySegment();c=B.getSubElementIndex();B=B.getSegmentIndex();if(0===W.splitPoints.length){if(0!==c)return}else{if(1===W.splitPoints.length&&1===this.currentSplitLine.length&&0===this.splitLines.length&&W.splitPoints[0].getGeometrySegment().getSegmentIndex()===
B)return;if(1<W.splitPoints.length)if(B=W.splitPoints[W.splitPoints.length-1].getGeometrySegment().getSubElementIndex(),0===W.splitPoints.length%2){if(B!==c)return}else if(B===c)return}W.snapSegmentPoint=D;D=D.getPoint();b=new a.geometry.Point(D[0],D[1],b.getSRID());D=W._map.getScreenLocation(b);W.snapPoint=[];W.snapPoint.push(D.x);W.snapPoint.push(D.y);W.snapFeature=new a.Feature("SnapPoint",b,{renderingStyle:W.snapLayerStyle});W.snapLayer.addFeature(W.snapFeature);W.snapLayer.redraw()}}a.notNull(W.ghostShape)&&
(a.notNull(W.snapPoint)?W._graphic.setPath(W.ghostShape,[[W.lastScreenPoint[0],W.lastScreenPoint[1],W.snapPoint[0],W.snapPoint[1]]]):W._graphic.setPath(W.ghostShape,[[W.lastScreenPoint[0],W.lastScreenPoint[1],W._map.mLocX,W._map.mLocY]]))}}))},reset:function(){a.notNull(this.snapFeature)&&(this.snapLayer.removeFeature(this.snapFeature),this.snapLayer.redraw(),this.snapFeature=null);this.snapSegmentPoint=this.snapFeature=null;this.splitPoints=[];this.splitLines=[];this.currentSplitLine=[];this.lastSubElem=
-1;this.hasSplitLines=this.islastActionMoveTo=this.hasSplitLines=this.isInAction=!1;this.lastPointWC=[];this.lastScreenPoint=[];if(0<this.shapeGroup.length)for(var b=this.shapeGroup.length-1;-1<b;b--)this._graphic.remove(this.shapeGroup[b]);this.shapeGroup=[];a.notNull(this.ghostShape)&&this._graphic.remove(this.ghostShape);this.ghostShape=null},clear:function(){a.gv.featureDrag=!0;a.gv.allowFeaturePointsInteraction=!0;this.polygonFeature.editable=!0;this.reset();this.finish();this.clear_base()},
processPoint:function(){this.hasSplitLines=!1;if(0!==this.splitPoints.length||!a.isNull(this.snapSegmentPoint)){var b,c,D,W=this._geometry;b=W.getX();c=W.getY();if(0===this.splitPoints.length)b=this.snapSegmentPoint.getPoint()[0],c=this.snapSegmentPoint.getPoint()[1],this.islastActionMoveTo=this.isInAction=!0,this.currentSplitLine=[],this.currentSplitLine.push(b),this.currentSplitLine.push(c),this.splitPoints.push(this.snapSegmentPoint),this.lastPointWC=[b,c],D=new a.geometry.Point(b,c,W.getSRID()),
D=this._map.getScreenLocation(D),this.lastScreenPoint=[D.x,D.y],this.ghostShape=this._graphic.drawPath([[D.x,D.y,D.x,D.y]],this.splitLineStyle,{group:this._group}),this.ghostShape.setStrokeDashArray([6]);else{var da=!0;1<this.splitPoints.length&&a.notNull(this.snapSegmentPoint)&&0===this.splitPoints.length%2&&this.splitPoints[this.splitPoints.length-1].getGeometrySegment().getSubElementIndex()==this.snapSegmentPoint.getGeometrySegment().getSubElementIndex()&&(da=!1);a.notNull(this.snapSegmentPoint)&&
(b=this.snapSegmentPoint.getPoint()[0],c=this.snapSegmentPoint.getPoint()[1]);D=new a.geometry.Point(b,c,W.getSRID());D=this._map.getScreenLocation(D);this.lastScreenPoint=[D.x,D.y];if(da){this.islastActionMoveTo=!1;this.currentSplitLine.push(b);this.currentSplitLine.push(c);for(var da=[],ka=0;ka<this.currentSplitLine.length;ka+=2)D=new a.geometry.Point(this.currentSplitLine[ka],this.currentSplitLine[ka+1],W.getSRID()),D=this._map.getScreenLocation(D),da.push(D.x),da.push(D.y),a.isNull(this.shapeGroup[this.splitLines.length])?
(this.shapeGroup[this.splitLines.length]=this._graphic.drawPath([da],this.splitLineStyle,{group:this._group}),this.shapeGroup[this.splitLines.length].setStrokeDashArray([6])):this._graphic.setPath(this.shapeGroup[this.splitLines.length],[da])}else this.islastActionMoveTo=!0,this.splitLines.push(this.currentSplitLine),this.currentSplitLine=[],this.currentSplitLine.push(b),this.currentSplitLine.push(c);a.notNull(this.snapSegmentPoint)&&(this.splitPoints.push(this.snapSegmentPoint),1<this.splitPoints.length&&
this.snapSegmentPoint.getGeometrySegment().getSubElementIndex()==this.splitPoints[0].getGeometrySegment().getSubElementIndex()&&(this.hasSplitLines=!0,this.splitLines.push(this.currentSplitLine)));this.lastPointWC=[b,c];this.hasSplitLines&&(b=this.polygonFeature.getGeometry().clone(!0),a.edit.GeometrySegmentUtil.splitPolygonGeometry(b,this.splitPoints,this.splitLines)&&(a.notNull(this.polygonFeature.parentLayer.changeManager)&&(c=this.polygonFeature.parentLayer.changeManager.updateFeature(this.polygonFeature.id,
this.polygonFeature,b,a.edit.EditChangeEvent.SPATIAL_UPDATE),a.notNull(c)&&this.polygonFeature.parentLayer.getUndoManager().addEdit({feature:this.polygonFeature,changeManager:this.polygonFeature.parentLayer.changeManager,editChangeEvent:c,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"split polygon"},undo:function(){this.changeManager.undo(this.editChangeEvent);this.feature.deleteEditingProperties();this.feature.addEditProperties()},redo:function(){this.changeManager.redo(this.editChangeEvent);
this.feature.deleteEditingProperties();this.feature.addEditProperties()}})),this.polygonFeature.deleteEditingProperties(),this.polygonFeature.addEditProperties(),this.polygonFeature.setGeometry(b)),this.reset())}this._map.getToolFeatureLayer().removeFeature(this._points[0])}}});a.tool.VoidPolygonTool=a.tool.RedlineTool.extend({initialize:function B(b,c){B.base.call(this,b,a.tool.RedlineTool.TYPE_POLYGON);a.isNull(c)?(a.util.Logger.alert("MAPVIEWER_9054","OM.tool.VoidPolygonTool.initialize",""),this.clear()):
(this.polygonFeature=c,this.polygonElement=-1,!a.notNull(this.polygonFeature)||"Polygon"!==this.polygonFeature.getGeometry().getType()&&"MultiPolygon"!==this.polygonFeature.getGeometry().getType()?(a.util.Logger.alert("MAPVIEWER_9038","OM.tool.VoidPolygonTool.initialize",""),this.polygonFeature=null,this.clear()):this.polygonFeature.editable=!1)},end:function(){this.polygonElement=-1;if(!a.isNull(this._geometry)&&!a.isNull(this.polygonFeature)){var b=this._geometry.getOrdinates()[0],c=b[0],W=b[1],
da=this.polygonFeature.getGeometry().getDimension();if("Polygon"===this.polygonFeature.getGeometry().getType())this.polygonElement=0;else for(var ka=this.polygonFeature.getGeometry(),ta=ka.getOrdinates().length,Ga=0;Ga<ta;Ga++){var Ja=new a.geometry.Polygon(ka.getOrdinates()[Ga][0],this.polygonFeature.getGeometry().getSRID(),da);if(a.util.GeomUtil.poinInPolygonGeometry(Ja,c,W)){this.polygonElement=Ga;break}}if(-1!==this.polygonElement){ka=a.util.GeomUtil.isClockwise(b);c=this.polygonFeature.getGeometry().clone(!0);
W=null;W="Polygon"===this.polygonFeature.getGeometry().getType()?c.getOrdinates():c.getOrdinates()[this.polygonElement];if((ta=a.util.GeomUtil.isClockwise(W[0],da))&&ka||!ta&&!ka)b=a.util.GeomUtil.reverseCoordinates(b);ka=[];if(2<da){for(ta=0;ta<b.length;ta+=2)for(ka.push(b[ta]),ka.push(b[ta+1]),Ga=2;Ga<da;Ga++)ka.push(0);b=ka}W[W.length]=b;a.notNull(this.polygonFeature.parentLayer.changeManager)&&(b=this.polygonFeature.parentLayer.changeManager.updateFeature(this.polygonFeature.id,this.polygonFeature,
c,a.edit.EditChangeEvent.SPATIAL_UPDATE),a.notNull(b)&&this.polygonFeature.parentLayer.getUndoManager().addEdit({feature:this.polygonFeature,changeManager:this.polygonFeature.parentLayer.changeManager,editChangeEvent:b,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"add void polygon"},undo:function(){this.changeManager.undo(this.editChangeEvent);this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()},redo:function(){this.changeManager.redo(this.editChangeEvent);
this.feature.deleteEditingProperties();this.feature.selected&&this.feature.addEditProperties()}}));this.polygonFeature.editable=!0;this.polygonFeature.deleteEditingProperties();this.polygonFeature.addEditProperties();this.polygonFeature.setGeometry(c);this.polygonFeature.parentLayer.selectFeature(this.polygonFeature)}}}});a.tool.WhiteBoardTool=a.tool.Tool.extend({initialize:function D(b){D.base.call(this,b);var c=b.mapInstanceId;if(!b.$dialog){var ka=a.tool.WhiteBoardTool,ta;if(a.browser.touchSupported||
a.gv.isWin8Touch)ta="\x3ctr\x3e\x3ctd\x3e"+a.gv.getLabel("MAPVIEWER_WB_TEXT")+"\x3c/td\x3e\x3ctd\x3e\x3cinput type\x3d'text' size\x3d'25' id\x3d'_wb_text"+c+"'\x3e\x3c/td\x3e\x3ctd\x3e"+ka.genSizes()+"\x3c/td\x3e\x3c/tr\x3e",b.$dialog=a.$('\x3cdiv id\x3d"_wb_dialog'+b.mapInstanceId+'" title\x3d"'+a.gv.getLabel("MAPVIEWER_WB_TTILE")+'" style\x3d"overflow:visible"\x3e\x3ctable width\x3d100%\x3e'+ta+"\x3c/table\x3e\x3c/div\x3e");else{ta="\x3ctr\x3e\x3ctd\x3e\x3ctable\x3e\x3ctr\x3e\x3ctd\x3e"+a.gv.getLabel("MAPVIEWER_WB_TEXT")+
"\x3c/td\x3e\x3ctd\x3e\x3cinput type\x3d'text' style\x3d'width:400px'  id\x3d'_wb_text"+c+"'\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/td\x3e\x3c/tr\x3e";var Ga="\x3ctr\x3e\x3ctd\x3e\x3ctable\x3e\x3ctr\x3e\x3ctd\x3e"+a.gv.getLabel("MAPVIEWER_WB_X",!0)+"\x3c/td\x3e\x3ctd\x3e\x3cinput type\x3d'text' style\x3d'width:100px' value\x3d'1' id\x3d'_wb_orienx"+c+"'\x3e\x3c/td\x3e\x3ctd\x3e\x26nbsp;\x26nbsp;"+a.gv.getLabel("MAPVIEWER_WB_Y",!0)+"\x3c/td\x3e\x3ctd\x3e\x3cinput type\x3d'text' style\x3d'width:100px' value\x3d'0' id\x3d'_wb_orieny"+
c+"'\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/td\x3e\x3c/tr\x3e";b.weightBut=new a.tool.ImageButton("_wb_weight"+c,{toolTip:a.gv.getLabel("MAPVIEWER_WB_BOLD"),buttonEnableIcon:a.tool.WhiteBoardTool.img_bold_ena,buttonOverIcon:a.tool.WhiteBoardTool.img_bold_ovr,buttonDownIcon:a.tool.WhiteBoardTool.img_bold_dwn});b.styleBut=new a.tool.ImageButton("_wb_style"+c,{toolTip:a.gv.getLabel("MAPVIEWER_WB_ITALIC"),buttonEnableIcon:a.tool.WhiteBoardTool.img_italic_ena,buttonOverIcon:a.tool.WhiteBoardTool.img_italic_ovr,
buttonDownIcon:a.tool.WhiteBoardTool.img_italic_dwn});b.hAlignGroup=new a.tool.ButtonGroup;var Ja=new a.tool.ImageButton("_wb_halign_left"+c,{toolTip:a.gv.getLabel("MAPVIEWER_WB_ALIGN_LEFT"),buttonEnableIcon:a.tool.WhiteBoardTool.img_leftalign_ena,buttonOverIcon:a.tool.WhiteBoardTool.img_leftalign_ovr,buttonDownIcon:a.tool.WhiteBoardTool.img_leftalign_dwn}),La=new a.tool.ImageButton("_wb_halign_center"+c,{toolTip:a.gv.getLabel("MAPVIEWER_WB_ALIGN_CENTER"),buttonEnableIcon:a.tool.WhiteBoardTool.img_centeralign_ena,
buttonOverIcon:a.tool.WhiteBoardTool.img_centeralign_ovr,buttonDownIcon:a.tool.WhiteBoardTool.img_centeralign_dwn,status:a.tool.ImageButton.STATUS_DOWN}),Ra=new a.tool.ImageButton("_wb_halign_right"+c,{toolTip:a.gv.getLabel("MAPVIEWER_WB_ALIGN_RIGHT"),buttonEnableIcon:a.tool.WhiteBoardTool.img_rightalign_ena,buttonOverIcon:a.tool.WhiteBoardTool.img_rightalign_ovr,buttonDownIcon:a.tool.WhiteBoardTool.img_rightalign_dwn});b.hAlignGroup.addButton(Ja);b.hAlignGroup.addButton(La);b.hAlignGroup.addButton(Ra);
b.vAlignGroup=new a.tool.ButtonGroup;Ja=new a.tool.ImageButton("_wb_valign_bottom"+c,{toolTip:a.gv.getLabel("MAPVIEWER_WB_VALIGN_BOTTOM"),buttonEnableIcon:a.tool.WhiteBoardTool.img_bottomalign_ena,buttonOverIcon:a.tool.WhiteBoardTool.img_bottomalign_ovr,buttonDownIcon:a.tool.WhiteBoardTool.img_bottomalign_dwn});La=new a.tool.ImageButton("_wb_valign_center"+c,{toolTip:a.gv.getLabel("MAPVIEWER_WB_VALIGN_CENTER"),buttonEnableIcon:a.tool.WhiteBoardTool.img_centervalign_ena,buttonOverIcon:a.tool.WhiteBoardTool.img_centervalign_ovr,
buttonDownIcon:a.tool.WhiteBoardTool.img_centervalign_dwn,status:a.tool.ImageButton.STATUS_DOWN});Ra=new a.tool.ImageButton("_wb_valign_top"+c,{toolTip:a.gv.getLabel("MAPVIEWER_WB_VALIGN_TOP"),buttonEnableIcon:a.tool.WhiteBoardTool.img_topalign_ena,buttonOverIcon:a.tool.WhiteBoardTool.img_topalign_ovr,buttonDownIcon:a.tool.WhiteBoardTool.img_topalign_dwn});b.vAlignGroup.addButton(Ra);b.vAlignGroup.addButton(La);b.vAlignGroup.addButton(Ja);Ja="\x3ctr\x3e\x3ctd\x3e\x3ctable\x3e\x3ctr\x3e\x3ctd\x3e"+
ka.genColor(c)+"\x3c/td\x3e\x3ctd\x3e";Ja+=b.weightBut.createHTML()+"\x3c/td\x3e\x3ctd\x3e"+b.styleBut.createHTML();Ja+="\x3c/td\x3e\x3ctd\x3e"+b.hAlignGroup.createHTML()+"\x3c/td\x3e\x3ctd\x3e"+b.vAlignGroup.createHTML()+"\x3c/td\x3e\x3ctd\x3e";Ja+=ka.genFontFamily(c)+"\x3c/td\x3e\x3ctd\x3e"+ka.genSizes()+"\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/td\x3e\x3c/tr\x3e";b.$dialog=a.$('\x3cdiv id\x3d"_wb_dialog'+b.mapInstanceId+'" title\x3d"'+a.gv.getLabel("MAPVIEWER_WB_TTILE")+'" style\x3d"overflow:visible"\x3e\x3ctable width\x3d100% cellSpacing\x3d0 borderSpacing\x3d0 style\x3d\'font-size:13px\'\x3e'+
ta+Ga+Ja+"\x3c/table\x3e\x3c/div\x3e")}}var jb=null,gb=null,bb=null,qb=null,$a=this;this.allTextFeatures=[];this.downEventAction=function(b){if(3===b.which)$a.finish();else if("touchstart"===b.type){var c=a.util.DomUtil;1===c.getTouchCount(b)&&(b=c.getTouchesPosition(b),jb=b.x,bb=b.y)}else jb=b.pageX,bb=b.pageY};this.newShapePoint=function(D){var ka=$a._map.getToolFeatureLayer();if(!ka.focusFeature&&$a.status!==a.tool.Tool.STOPPED&&$a._map.currentTool===$a){var ta=null,Ga=null;if("touchend"===D.type)if(ta=
a.util.DomUtil,1===ta.getTouchCount(D))Ga=ta.getChangedTouchesPosition(D),ta=Ga[0].x,Ga=Ga[0].y;else return;else ta=D.pageX,Ga=D.pageY;if(2>Math.abs(ta-jb)&&ta!=gb&&2>Math.abs(Ga-bb)&&Ga!=qb){$a._graphic.getLeftTop($a._map.draggableGroup);$a._$container.offset();$a._$container.offset();D=$a._map.getCursorLocation();$a.currentPoint=null;a.tool.WhiteBoardTool.showDialog(b,$a);var Ja=1,La=0;a.browser.touchSupported||a.gv.isWin8Touch||(Ja=parseFloat(a.$("#_wb_orienx"+c).val()),La=parseFloat(a.$("#_wb_orieny"+
c).val()),isNaN(Ja)&&(Ja=1),isNaN(La)&&(La=0));$a.currentPoint=new a.geometry.Point(D.getX(),D.getY(),D.srid,Ja,La);$a.toolFeature&&ka.removeFeature($a.toolFeature);$a.textFeature&&(D=$a.textFeature,D.saved?(D.editable?D.parentLayer.deselectFeature(D):D.old&&(D.setText(D.old.text),D.setRenderingStyle(D.old.style)),D=null,$a.textFeature=null):ka.removeFeature(D));$a.toolFeature=new a.Feature("_wb_point_"+(new Date).getTime(),$a.currentPoint,{renderingStyle:a.tool.WhiteBoardTool.pointStyle});a.browser.touchSupported||
a.gv.isWin8Touch||($a.toolFeature.addListener(a.event.LayerEvent.FEATURE_ORIENTATION_CHANGING,function(b){var D=b.angle;b=D<=Math.PI/2&&D>=-Math.PI/2?1:-1;D=Math.tan(D)*b;a.$("#_wb_orienx"+c).val(b);a.$("#_wb_orieny"+c).val(D)}),$a.addEventLisenterButtons());ka.addFeature($a.toolFeature);ka.selectFeature($a.toolFeature);$a.toolFeature.tool=$a}gb=ta;qb=Ga}}},start:function(){var b=a.event.ToolEvent;this.clear();a.browser.touchSupported?(this._$container.bind("touchstart",this.downEventAction),this._$container.bind("touchend",
this.newShapePoint)):(this._$container.bind("mousedown",this.downEventAction),this._$container.bind("click",this.newShapePoint));this.status=a.tool.Tool.STARTED;this._map.currentTool=this;b=new b(b.TOOL_START,this);this.fire(b.type,b);return this},clear:function(){this.clearAll()},finish:function(){this._$container.unbind("mousedown",this.downEventAction);this._$container.unbind("click",this.newShapePoint);this._$container.unbind("touchstart",this.downEventAction);this._$container.unbind("touchend",
this.newShapePoint);var a=this._map.getToolFeatureLayer();this.toolFeature&&a.removeFeature(this.toolFeature);this.toolFeature=null;this._map.$dialog.dialog("isOpen")&&this._map.$dialog.dialog("close");for(var a=this.allTextFeatures.length,b=0;b<a;b++)this.allTextFeatures[b].enableEditing=null;return this},clearAll:function(){for(var a=this._map.getToolFeatureLayer(),b=this.allTextFeatures.length-1;0<=b;b--){var c=this.allTextFeatures.pop();a.removeFeature(c);a.refresh()}},getTextStyle:function(){var b;
if(a.browser.touchSupported||a.gv.isWin8Touch)b={fontSize:a.tool.WhiteBoardTool.currentSize};else{var c=this._map.mapInstanceId;b=a.$("#_wb_weight"+c)[0].down?"BOLD":"NORMAL";var da=a.$("#_wb_style"+c)[0].down?"ITALIC":"NORMAL",ka=a.$("#_wb_valign_bottom"+c)[0].down?"BOTTOM":a.$("#_wb_valign_top"+c)[0].down?"TOP":"CENTERV",c=a.$("#_wb_halign_left"+c)[0].down?"LFET":a.$("#_wb_halign_right"+c)[0].down?"RIGHT":"CENTER",ta=a.tool.WhiteBoardTool;b={fontFamily:ta.currentFontFamily,fontSize:ta.currentSize,
fill:ta.currentColor,fontWeight:b,fontStyle:da,vAlign:ka,hAlign:c}}return new a.style.Text(b)},addText:function(b){var c=a.$("#_wb_text"+this._map.mapInstanceId).val(),da=this.getTextStyle(),ka=this._map.getToolFeatureLayer();this.textFeature!==this.toolFeature&&ka.removeFeature(this.toolFeature);if(this.textFeature){var ta=this.textFeature;ta.old||(ta.old={text:this.textFeature.getText(),style:this.textFeature.getRenderingStyle(),point:this.textFeature.getGeometry()});ta.setText(c);ta.setRenderingStyle(da);
ta.screenPoints=null;ta.setGeometry(b);ka.deselectFeature(ta)}else ta="_wb_textfeature_"+(new Date).getTime(),this.toolFeature=new a.TextFeature(ta,b,c,da),this.toolFeature.tool=this,ka.addFeature(this.toolFeature)},addEventLisenterButtons:function(){this._map.hAlignGroup.attachEvents();this._map.vAlignGroup.attachEvents();this._map.weightBut.attachEvents();this._map.styleBut.attachEvents()},getAllTextFeatures:function(){return this.allTextFeatures},saveToLS:function(b){if(!localStorage)a.util.Logger.alert("MAPVIEWER_9041",
"OM.tool.WhiteBoardTool.saveToLS");else if(!a.isNull(b)&&""!==b){var c=this.getAllTextFeatures(),da=c?c.length:0;if(0!==da){for(var ka=[],ta=0;ta<da;ta++)ka.push(c[ta].toJSON());localStorage[b]=JSON.stringify(ka)}}}});a.tool.WhiteBoardTool.pointStyle=new a.style.Marker({width:20,height:20,vectorDef:[{shape:{type:"path",coords:[[0,7,0,13,10,13,10,20,20,10,10,0,10,7,0,7]],width:20,height:20},style:{fill:"#ffffff",stroke:"#0000ff",strokeThickness:1}}]});a.tool.WhiteBoardTool.textFeatureIdSeq=0;a.tool.WhiteBoardTool.fontFamilyArray=
"Arial;Bookman Old Style;Courier New;Garamond;Lucida Console;Symbol;Tahoma;Times New Roman;Verdana".split(";");a.tool.WhiteBoardTool.currentFontFamily="Arial";a.tool.WhiteBoardTool.genFontFamily=function(b){b='\x3cselect id\x3d"_wb_fontfamily'+b+'" onchange\x3d"OM.tool.WhiteBoardTool.setFontFamily('+b+')"\x3e';for(var c="",da=a.tool.WhiteBoardTool.fontFamilyArray.length,ka=0;ka<da;ka++)c=a.tool.WhiteBoardTool.fontFamilyArray[ka]==a.tool.WhiteBoardTool.currentFontFamily?"selected\x3dtrue":"",b+="\x3coption "+
c+' value\x3d"'+a.tool.WhiteBoardTool.fontFamilyArray[ka]+'"\x3e'+a.tool.WhiteBoardTool.fontFamilyArray[ka]+"\x3c/option\x3e";return b+"\x3c/select\x3e"};a.tool.WhiteBoardTool.setFontFamily=function(b){b=a.$("#_wb_fontfamily"+b).val();a.tool.WhiteBoardTool.currentFontFamily=b};a.tool.WhiteBoardTool.addFont=function(b){for(var c=MVAnnotationTool.fontFamilyArray.length-1,da=0;da<c;da++){if(a.tool.WhiteBoardTool.fontFamilyArray[da]==b)return;if(a.tool.WhiteBoardTool.fontFamilyArray[da]<b&&a.tool.WhiteBoardTool.fontFamilyArray[da+
1]>b){a.tool.WhiteBoardTool.fontFamilyArray.splice(da+1,0,b);return}}a.tool.WhiteBoardTool.fontFamilyArray.push(b)};a.tool.WhiteBoardTool.removeFont=function(b){for(var c=a.tool.WhiteBoardTool.fontFamilyArray.length-1,da=0;da<c;da++)if(a.tool.WhiteBoardTool.fontFamilyArray[da]==b){a.tool.WhiteBoardTool.fontFamilyArray.splice(da,1);break}};a.tool.WhiteBoardTool.genSizes=function(b){b='\x3cselect id\x3d"_wb_fontsize'+b+'" onchange\x3d"OM.tool.WhiteBoardTool.setSize('+b+')"\x3e';for(var c="",da=5;50>
da;da++)c=da==a.tool.WhiteBoardTool.currentSize?"selected\x3dtrue":"",b+="\x3coption "+c+' value\x3d"'+da+'px"\x3e'+da+"px\x3c/option\x3e";return b+"\x3c/select\x3e"};a.tool.WhiteBoardTool.setSize=function(b){b=a.$("#_wb_fontsize"+b).val();a.tool.WhiteBoardTool.currentSize=parseInt(b,10)};a.tool.WhiteBoardTool.genColor=function(b){var c=a.tool.WhiteBoardTool;b='\x3cdiv id\x3d"_wb_color'+b+'" style\x3d"background: url(\''+c.color_picker_icon+"') ";return b=b+"repeat scroll center center transparent; height: 16px;left: 4px;top: 4px;width: 16px;background-color: "+
(c.currentColor+'"\x3e\x3c/div\x3e')};a.tool.WhiteBoardTool.showDialog=function(b,c,da){var ka=c._map.getToolFeatureLayer();da&&(c.textFeature=da,da.addListener(a.event.LayerEvent.FEATURE_ORIENTATION_CHANGING,function(b){var D=b.angle;b=D<=Math.PI/2&&D>=-Math.PI/2?1:-1;D=Math.tan(D)*b;a.$("#_wb_orienx"+c._map.mapInstanceId).val(b);a.$("#_wb_orieny"+c._map.mapInstanceId).val(D)}),c.currentPoint=da.getGeometry().clone(),c.textFeature!==c.toolFeature&&ka.removeFeature(c.toolFeature));b.$dialog.dialog({position:{of:b.$oracleMapDiv,
at:"center"},resizable:!1,width:a.browser.touchSupported||a.gv.isWin8Touch?450:510,height:a.browser.touchSupported||a.gv.isWin8Touch?190:230,buttons:[{closeOnEscape:!0,text:a.gv.getLabel("MAPVIEWER_WB_OK"),click:function(){if(da){var ta=a.$("#_wb_text"+b.mapInstanceId).val();da.setText(ta);ta=c.getTextStyle();da.setRenderingStyle(ta);da.screenPoints=null;da.setGeometry(c.currentPoint);ka.deselectFeature(da);da.old=null;c.toolFeature=null;c.textFeature=null}else c.addText(c.currentPoint),c.toolFeature.tool=
c,c.toolFeature.saved=!0,c.allTextFeatures.push(c.toolFeature),c.toolFeature.old=null,c.toolFeature=null;a.$(this).dialog("close")}},{text:a.gv.getLabel("MAPVIEWER_WB_PREVIEW"),click:function(){c.addText(c.currentPoint)}}],close:function(a,b){c.currentEditingFeature=null;c.toolFeature&&ka.removeFeature(c.toolFeature);da&&(da.old&&(da.setText(da.old.text),da.setRenderingStyle(da.old.style),da.setGeometry(da.old.point)),da.parentLayer&&da.parentLayer.deselectFeature(da));c.toolFeature=null;c.textFeature=
null}});a.browser.touchSupported||a.gv.isWin8Touch||(b.$dialog.parent().draggable("option","containment",b.$oracleMapDiv),a.$("#_wb_color"+b.mapInstanceId).ColorPicker({color:"#000000",onShow:function(b){a.$(b).fadeIn(500);return!1},onHide:function(b){a.$(b).fadeOut(500);return!1},onChange:function(c,W,da){a.$("#_wb_color"+b.mapInstanceId).css("backgroundColor","#"+W);a.tool.WhiteBoardTool.currentColor="#"+W},onSubmit:function(b,c,D,W){a.tool.WhiteBoardTool.currentColor="#"+c;a.$(W).ColorPickerHide()}}));
da?a.$("#_wb_text"+b.mapInstanceId).val(da.getText()):a.$("#_wb_text"+b.mapInstanceId).val("")};a.tool.WhiteBoardTool.currentSize=15;a.tool.WhiteBoardTool.currentColor="#000000";a.tool.WhiteBoardTool.setIconsPath=function(){var b=a.gv.resourcePath()+"txt/",c=a.tool.WhiteBoardTool;c.color_picker_icon=b+"func_text_color_16_ena.png";c.img_bold_ena=b+"func_bold_16_ena.png";c.img_bold_ovr=b+"func_bold_16_hov.png";c.img_bold_dwn=b+"func_bold_16_act.png";c.img_italic_ena=b+"func_italic_16_ena.png";c.img_italic_ovr=
b+"func_italic_16_hov.png";c.img_italic_dwn=b+"func_italic_16_act.png";c.img_leftalign_ena=b+"func_leftalign_16_ena.png";c.img_leftalign_ovr=b+"func_leftalign_16_hov.png";c.img_leftalign_dwn=b+"func_leftalign_16_act.png";c.img_centeralign_ena=b+"func_centeralign_16_ena.png";c.img_centeralign_ovr=b+"func_centeralign_16_hov.png";c.img_centeralign_dwn=b+"func_centeralign_16_act.png";c.img_rightalign_ena=b+"func_rightalign_16_ena.png";c.img_rightalign_ovr=b+"func_rightalign_16_hov.png";c.img_rightalign_dwn=
b+"func_rightalign_16_act.png";c.img_bottomalign_ena=b+"bottomalignment_ena.png";c.img_bottomalign_ovr=b+"bottomalignment_ovr.png";c.img_bottomalign_dwn=b+"bottomalignment_dwn.png";c.img_centervalign_ena=b+"centeralignment_ena.png";c.img_centervalign_ovr=b+"centeralignment_ovr.png";c.img_centervalign_dwn=b+"centeralignment_dwn.png";c.img_topalign_ena=b+"topalignment_ena.png";c.img_topalign_ovr=b+"topalignment_ovr.png";c.img_topalign_dwn=b+"topalignment_dwn.png"};a.tool.WhiteBoardTool.setIconsPath();
a.tool.WhiteBoardTool.loadFromLS=function(b){if(!localStorage)a.util.Logger.alert("MAPVIEWER_9041","OM.tool.WhiteBoardTool.loadFromLS");else if(!a.isNull(b)&&""!==b&&(b=localStorage[b],!a.isNull(b)&&""!==b&&(b=a.$.parseJSON(b),b.length))){for(var c=[],da=0,ka=b.length;da<ka;da++){var ta=b[da],Ga=a.geometry.Geometry.createGeometry(ta.geometry,ta.geometry.srid),Ja=new a.style.Text(ta.styleConfig),ta=new a.TextFeature(ta.id,Ga,b[da].text,Ja);c.push(ta)}return c}};a.tool.DuplicateTool=a.tool.Tool.extend({initialize:function W(b,
c){W.base.call(this,b);var ta=this;this.feature=c;a.isNull(c)?(a.util.Logger.alert("MAPVIEWER_9054","OM.tool.DuplicateTool.initialize",""),this.clear()):(this.mouseDown=function(a){a.stopPropagation()},this.mouseUp=function(c){if(!(a.isNull(c)||ta.status==a.tool.Tool.STOPPED||ta.status==a.tool.Tool.FINISHED||a.isNull(ta.feature)||a.isNull(ta.feature.getGeometry())||a.isNull(ta.feature.parentLayer)||a.isNull(ta.feature.parentLayer.changeManager))){c=ta.feature.getGeometry();var W=c.getMBR();if(!a.isNull(W)){var ka=
b.getScreenPointLocation(ta._map.mLocX,ta._map.mLocY),Ra=W.getCenter(),W=ka.coordinates[0]-Ra.coordinates[0],ka=ka.coordinates[1]-Ra.coordinates[1];c=c.clone(!0);a.util.GeomUtil.moveGeometry(c,W,ka);W="dup_"+Math.floor(1E4*Math.random()+1).toString();W=new a.Feature(W,c);c=ta.feature.parentLayer;W=c.changeManager.addFeature(W.id,W);a.notNull(W)&&c.getUndoManager().addEdit({changeManager:c.changeManager,editChangeEvent:W,canUndo:function(){return!0},canRedo:function(){return!0},getPresentationName:function(){return"feature added"},
undo:function(){this.changeManager.undo(this.editChangeEvent)},redo:function(){this.changeManager.redo(this.editChangeEvent)}})}}},this.touchStart=function(b){var c=a.util.DomUtil,W=c.getTouchCount(b);if(1==W)b.button=0,c=c.getTouchesPosition(b),ta.touchPos=c,b.pageX=c.x,b.pageY=c.y;else if(2==W)b.button=2;else return;ta.mouseDown(b)},this.touchEnd=function(a){ta.touchPos&&(a.pageX=ta.touchPos.x,a.pageY=ta.touchPos.y,ta.mouseUp(a))},this.finish=function(){ta.status==a.tool.Tool.STARTED&&(ta._$container.unbind("mouseup",
ta.mouseUp),ta._$container.unbind("mousedown",ta.mouseDown),a.gv.isWin8Touch&&(ta._$container[0].removeEventListener("MSPointerUp",ta.mouseUp),ta._$container[0].removeEventListener("MSPointerDown",ta.mouseDown)),a.browser.touchSupported&&(ta._$container.unbind("touchstart",ta.touchStart),ta._$container.unbind("touchend",ta.touchEnd)),ta.status=a.tool.Tool.FINISHED,ta._map.enableMapAction.dbclick=!0,ta._map.enableMapAction.mouse=!0,ta._map.enableMapDrag(!0))})},start:function(){var b=a.event.ToolEvent;
this.clear();this._map.enableMapAction.dbclick=!1;this._map.enableMapAction.mouse=!1;this._group||(this._group=this._graphic.createGroup(),this._graphic.addGroup(this._group,this._map.draggableGroup));this._map.on(a.event.MapEvent.MAP_BEFORE_ZOOM,this.zoomAction,this);this._$container.bind("mouseup",this.mouseUp);this._$container.bind("mousedown",this.mouseDown);a.gv.isWin8Touch&&(this._$container[0].addEventListener("MSPointerUp",this.mouseUp),this._$container[0].addEventListener("MSPointerDown",
this.mouseDown));a.browser.touchSupported&&(this._$container.bind("touchstart",this.touchStart),this._$container.bind("touchend",this.touchEnd));this.status=a.tool.Tool.STARTED;this.fire(b.type,b);return this},end:function(){},clear:function(){this.finish();this.clear_base()}});c.OM=a})(window);