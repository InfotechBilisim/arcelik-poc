var mapviewGlobal=null;var tmcAnimateArray=new Array();var printCallback=null;var geoCallback=null;var navigationPanelBar=null;var imagesPath="images";var mapConfig={mapTileLayer:"OSM_MERCATOR",format:"PNG",coordSys:{srid:3857,type:"PROJECTED",distConvFactor:1,minX:-20037508,minY:-20037508,maxX:20037508,maxY:20037508},zoomLevels:[{zoomLevel:0,name:"",tileWidth:20037508,tileHeight:20037508,tileImageWidth:256,tileImageHeight:256},{zoomLevel:1,name:"",tileWidth:10018754,tileHeight:10018754,tileImageWidth:256,tileImageHeight:256},{zoomLevel:2,name:"",tileWidth:5009377,tileHeight:5009377,tileImageWidth:256,tileImageHeight:256},{zoomLevel:3,name:"",tileWidth:2504688.5,tileHeight:2504688.5,tileImageWidth:256,tileImageHeight:256},{zoomLevel:4,name:"",tileWidth:1252344.25,tileHeight:1252344.25,tileImageWidth:256,tileImageHeight:256},{zoomLevel:5,name:"",tileWidth:626172.125,tileHeight:626172.125,tileImageWidth:256,tileImageHeight:256},{zoomLevel:6,name:"",tileWidth:313086.0625,tileHeight:313086.0625,tileImageWidth:256,tileImageHeight:256},{zoomLevel:7,name:"",tileWidth:156543.03125,tileHeight:156543.03125,tileImageWidth:256,tileImageHeight:256},{zoomLevel:8,name:"",tileWidth:78271.515625,tileHeight:78271.515625,tileImageWidth:256,tileImageHeight:256},{zoomLevel:9,name:"",tileWidth:39135.7578125,tileHeight:39135.7578125,tileImageWidth:256,tileImageHeight:256},{zoomLevel:10,name:"",tileWidth:19567.87890625,tileHeight:19567.87890625,tileImageWidth:256,tileImageHeight:256},{zoomLevel:11,name:"",tileWidth:9783.939453125,tileHeight:9783.939453125,tileImageWidth:256,tileImageHeight:256},{zoomLevel:12,name:"",tileWidth:4891.9697265625,tileHeight:4891.9697265625,tileImageWidth:256,tileImageHeight:256},{zoomLevel:13,name:"",tileWidth:2445.98486328125,tileHeight:2445.98486328125,tileImageWidth:256,tileImageHeight:256},{zoomLevel:14,name:"",tileWidth:1222.992431640625,tileHeight:1222.992431640625,tileImageWidth:256,tileImageHeight:256},{zoomLevel:15,name:"",tileWidth:611.4962158203125,tileHeight:611.4962158203125,tileImageWidth:256,tileImageHeight:256},{zoomLevel:16,name:"",tileWidth:305.74810791015625,tileHeight:305.74810791015625,tileImageWidth:256,tileImageHeight:256},{zoomLevel:17,name:"",tileWidth:152.87405395507812,tileHeight:152.87405395507812,tileImageWidth:256,tileImageHeight:256},{zoomLevel:18,name:"",tileWidth:76.43702697753906,tileHeight:76.43702697753906,tileImageWidth:256,tileImageHeight:256}]};IMapper.mustTransform=true;IMapper.BASEMAP_TILELAYER="BM1";IMapper.BASEMAP_TILELAYER_NOLOGO="BM2";IMapper.RECENTER="recenter";IMapper.MOUSE_CLICK="mouse_click";IMapper.MOUSE_RIGHT_CLICK="mouse_right_click";IMapper.MOUSE_DOUBLE_CLICK="mouse_double_click";IMapper.MOUSE_DOWN="mouse_down";IMapper.MOUSE_UP="mouse_up";IMapper.MOUSE_MOVE="mouse_move";IMapper.ZOOM_LEVEL_CHANGE="zoom_level_change";IMapper.BEFORE_ZOOM_LEVEL_CHANGE="before_zoom_level_change";IMapper.INITIALIZE="initialize";IMapper.MARKER_MOUSE_CLICK="marker_mouse_click";IMapper.MARKER_MOUSE_OVER="marker_mouse_over";IMapper.MARKER_MOUSE_OUT="marker_mouse_out";IMapper.MARKER_MOUSE_RIGHT_CLICK="marker_mouse_rclick";IMapper.FILTER_EQUALS="equals";IMapper.FILTER_NOTEQUALS="notEquals";IMapper.FILTER_GREATER="greater";IMapper.FILTER_GREATEREQUALS="greaterEquals";IMapper.FILTER_LESS="less";IMapper.FILTER_LESSEQUALS="lessEquals";IMapper.FILTER_ISNULL="isnull";IMapper.FILTER_ISNOTNULL="isnotnull";IMapper.FILTER_IN="in";function IMapper(){this.mapview=null;this.lboxMap=null;this.googleMap=null;this.bingTileLayer=null;this.transTileLayer=null;this.hybridMap=null;this.baseTileLayer=null;this.redlineTool=null;this.measureTool=null;this.circleTool=null;this.rectangleTool=null;this.polygonTool=null;this.toolLayer=null;this.distancetool=null;this.groupArray=new Array();this.mapTraffic=null;this.thmTraffic=null;this.thmTrafficTmc=null;this.thmTrafficTmc_tmcKodList=null;this.thmTrafficTmc_flag=false;this.thmTrafficEvents=null;this.thmSocialEvents=null;this.thmNobetciEczane=null;this.thmWeatherReport=null;this.thmImageLayer=null;this.thmEarthquakes=null;this.thmAnalysis=null;this.marqueeZoomTool=null;this.typ=null;this.objs=new Array();this.me=null}mapper=new IMapper();IMapper.prototype.initMap=function(c,l,e,b,a,m){mapper.keyControl(lboxKey,function(p){if(p==true){console.log("a->"+p)}else{var q=lboxUrl.substring(0,lboxUrl.length-8);window.location=q+"index.html"}});var n=location.protocol;var f=urlBase.split("//");if(f[1]&&n&&(n=="http:"||n=="https:")){urlBase=n+"//"+f[1]}if(b||a){if(a){urlBase=a}if(b){switch(b){case IMapper.BASEMAP_TILELAYER:mapBase="INFOMAP.INFOTECH_TILELAYER";break;case IMapper.BASEMAP_TILELAYER_NOLOGO:mapBase="INFOMAP.INFOTECH_TILELAYER_NOLOGO";break;default:mapBase=b;break}}}var j;var d;var k=mapBase.indexOf(".");if(k>0){j=mapBase.substring(0,k);d=mapBase.substring(k+1)}if(!m){var m="map"}if(Math.abs((new Date()).getTime()-gtm)<86423134){OM.gv.setResourcePath(urlBase+"/jslib/v2/");this.mapview=new OM.Map($("#"+m),{universe:new OM.universe.LatLonUniverse(),mapviewerURL:urlBase});var o=getPointGeometryObject(l,c,this.mapview);this.baseTileLayer=new OM.layer.TileLayer("baseMap",{dataSource:j,tileLayer:d,tileServerURL:urlBase+"/mcserver"});this.mapview.addLayer(this.baseTileLayer);var g=new OM.control.CopyRight({anchorPosition:6,textValue:"&#169;2020 Infotech",fontSize:12,fontFamily:"Arial",fontColor:"black"});this.mapview.setMapCenter(o);this.mapview.setMapZoomLevel(e);this.mapview.addMapDecoration(g);if(mapviewGlobal==null){mapviewGlobal=this.mapview}this.mapview.init()}return this.mapview};IMapper.prototype.keyControl=function(a,d){if(a&&lboxUrl){var b=false;if(window.XMLHttpRequest){b=new XMLHttpRequest()}else{if(window.ActiveXObject){b=new ActiveXObject("Microsoft.XMLHTTP")}}var c=lboxUrl+"?Cmd=KEY&Key="+a;console.log(c);b.open("POST",c,true);b.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.onreadystatechange=function(){if(b.readyState==4){if(b&&b.responseText){var e=JSON.parse(b.responseText);if(e&&e.status==1){d(false)}}}};b.send()}};IMapper.prototype.initMapWithExtent=function(e,n,g,o,c,a,p){var q=location.protocol;var j=urlBase.split("//");if(j[1]&&q&&(q=="http:"||q=="https:")){urlBase=q+"//"+j[1]}if(c||a){if(a){urlBase=a}if(c){switch(c){case IMapper.BASEMAP_TILELAYER:mapBase="INFOMAP.INFOTECH_TILELAYER";break;case IMapper.BASEMAP_TILELAYER_NOLOGO:mapBase="INFOMAP.INFOTECH_TILELAYER_NOLOGO";break;default:mapBase=c;break}}}var l;var f;var m=mapBase.indexOf(".");if(m>0){l=mapBase.substring(0,m);f=mapBase.substring(m+1)}if(!p){var p="map"}if(Math.abs((new Date()).getTime()-gtm)<86423134){OM.gv.setResourcePath(urlBase+"/jslib/v2/");this.mapview=new OM.Map($("#"+p),{universe:new OM.universe.LatLonUniverse(),mapviewerURL:urlBase,disableOverviewMap:false});this.baseTileLayer=new OM.layer.TileLayer("baseMap",{dataSource:l,tileLayer:f,tileServerURL:urlBase+"/mcserver"});var d=this.mapview;var b=new OM.geometry.Rectangle(n,e,o,g,8307);if(d.getMapContext().getUniverse().getSRID()!=8307){b=rectangleGeo.transform(d.getMapContext.getUniverse().getSRID())}this.mapview.addLayer(this.baseTileLayer,function(){d.zoomToExtent(b)});this.mapview=d;var r=getPointGeometryObject(b.getCenter().getX(),b.getCenter().getY(),this.mapview);var k=new OM.control.CopyRight({anchorPosition:6,textValue:"&#169;2020 Infotech",fontSize:12,fontFamily:"Arial",fontColor:"black"});this.mapview.setMapCenter(r);this.mapview.addMapDecoration(k);this.mapview.init()}return this.mapview};IMapper.prototype.addTileLayer=function(a){var d=null;var c=null;var e=a.indexOf(".");if(e>0){d=a.substring(0,e);c=a.substring(e+1)}var b=new OM.layer.TileLayer("baseMap",{dataSource:d,tileLayer:c,tileServerURL:urlBase+"/mcserver"});this.mapview.addLayer(b);return};IMapper.prototype.removeTileLayer=function(a){this.mapview.removeLayer(a);return};IMapper.prototype.createLayerControl=function(g,b,f,c,e,d){if(OM.isNull(g)){g=1}if(OM.isNull(b)){b=50}if(OM.isNull(f)){f=50}if(OM.isNull(c)){c={minWidth:"200",maxHeight:"300",font_family:"Tahoma",font_size:"11px"}}if(OM.isNull(e)){e={font_size:"11px",font_family:"Tahoma"}}if(OM.isNull(d)){d=false}var a=new OM.control.LayerControl({offsetX:b,offsetY:f,anchorPosition:g,layerDeleteEnable:d,contentStyle:c,titleStyle:e});return a};IMapper.prototype.createVariableMarkerStyle=function(f,e,o,j,g,n,l,b,d,c,a,m){if(OM.isNull(f)){f="logarithmic"}if(OM.isNull(e)){e="#ff0000"}if(OM.isNull(o)){o="#ffffff"}if(OM.isNull(j)){j="circle"}if(OM.isNull(n)){n=20}if(OM.isNull(l)){l=5}if(OM.isNull(b)){b=10}if(OM.isNull(d)){d=5}if(OM.isNull(c)){c=5}if(OM.isNull(a)){a=10}if(OM.isNull(m)){m=10}if(OM.isNull(g)){g=new OM.style.Text({styleName:"txt",fill:"#ffffff",fontStyle:OM.Text.FONTSTYLE_NORMAL,fontFamily:"Tahoma",fontSize:12})}var k=new OM.style.VariableMarker({styleName:"vMrk",classification:f,marker:new OM.style.Marker({textStyle:g,vectorDef:[{shape:{type:j,cx:d,cy:c,width:a,height:m},style:{fill:e,stroke:o}}]}),startSize:n,increment:l,numClasses:b});return k};IMapper.prototype.createTextStyle=function(d,c,j,a,f,e,b){if(OM.isNull(d)){d="txt"}if(OM.isNull(c)){c="#ff0000"}if(OM.isNull(j)){j=OM.Text.FONTSTYLE_NORMAL}if(OM.isNull(a)){a=OM.Text.FONTSTYLE_NORMAL}if(OM.isNull(f)){f=50}if(OM.isNull(e)){d="pixel"}if(OM.isNull(b)){b=OM.Text.FONTWEIGHT_NORMAL}var g=new OM.style.Text({styleName:d,fill:c,fontStyle:j,fontFamily:a,fontSize:f,sizeUnit:e,fontWeight:b});return g};IMapper.prototype.createAnimationColorStyle=function(c,b,e,d){if(OM.isNull(c)){c=new OM.style.Color({fill:"#ff0000",strokeThickness:5,stroke:"#ff0000"})}if(OM.isNull(b)){b=new OM.style.Color({fill:"#ffff00",strokeThickness:5,stroke:"#ffff00"})}if(OM.isNull(e)){e=5}if(OM.isNull(d)){d=false}var a=new OM.style.AnimationColor({beginColor:c,endColor:b,duration:e,enableMovingDashLine:d});return a};IMapper.prototype.createGrowStyle=function(c,b,d,a){if(OM.isNull(c)){c=0.5}if(OM.isNull(b)){b="#000000"}if(OM.isNull(d)){d=6}if(OM.isNull(a)){a=12}var e=new OM.visualfilter.Glow({opacity:c,color:b,offset:d,radius:a});return e};IMapper.prototype.createDropShadowStyle=function(c,b,e,a){if(OM.isNull(c)){c=0.5}if(OM.isNull(b)){b="#000000"}if(OM.isNull(e)){e=6}if(OM.isNull(a)){a=10}var d=new OM.visualfilter.DropShadow({opacity:c,color:b,offset:e,radius:a});return d};IMapper.prototype.createLinearGradient=function(f,c,e,b,d,g){if(OM.isNull(f)){f=[{offset:0,color:"#d93624ff"},{offset:1,color:"#782200ff"}]}if(OM.isNull(c)){c=1}if(OM.isNull(e)){e=1}if(OM.isNull(b)){b=0}if(OM.isNull(d)){d=0}if(OM.isNull(g)){g="#ffff00"}var a=new OM.style.LinearGradient({stops:f,x1:c,y1:e,x2:b,y2:d,stroke:g});return a};IMapper.prototype.createRadialGradient=function(c,f,b,a,d){if(OM.isNull(c)){c=[{offset:0,color:"#d93624ff"},{offset:1,color:"#782200ff"}]}if(OM.isNull(f)){f=0.5}if(OM.isNull(b)){b=0.5}if(OM.isNull(a)){a=0.5}if(OM.isNull(d)){d="#ffff00"}var e=new OM.style.RadialGradient({stops:c,cx:b,cy:f,radius:a,stroke:d});return e};IMapper.prototype.createBar=function(c,a){var b=new OM.style.Bar(c,a);return b};IMapper.prototype.createPieSlice=function(c,a){var b=new OM.style.PieSlice(c,a);return b};IMapper.prototype.createPieChartStyle=function(a,j,e,g,f,d,k,b){if(OM.isNull(a)){a="pie"}if(OM.isNull(g)){g=90}if(OM.isNull(f)){f="CW"}if(OM.isNull(d)){d=80}if(OM.isNull(k)){k="kilometer"}if(OM.isNull(b)){b={max:200,min:10}}var c=new OM.style.PieChart({styleName:a,pieSlices:j,enableHighlight:e,startingAngle:g,direction:f,radius:d,lengthUnit:k,radiusPixelRange:b});return c};IMapper.prototype.createBarChartStyle=function(e,d,f,a,c,g,b){if(OM.isNull(e)){e="bar"}if(OM.isNull(f)){f=180}if(OM.isNull(a)){a=210}if(OM.isNull(c)){c="kilometer"}if(OM.isNull(b)){b={min:0,max:120}}var j=new OM.style.BarChart({styleName:e,bars:d,width:f,height:a,lengthUnit:c,enableHighlight:g,lengthPixelRange:b});return j};IMapper.prototype.createBucketStyle=function(b,e,d,g,c,f){if(OM.isNull(b)){b="bucketStyle"}if(OM.isNull(g)){g="equal"}var a=new OM.style.BucketStyle({styleName:b,styles:e,classification:g,buckets:d,numClasses:c,gradient:f});return a};IMapper.prototype.createPulseAnimation=function(d,c,b,e){if(OM.isNull(d)){d="#336699"}if(OM.isNull(c)){c=1}if(OM.isNull(b)){b=8}if(OM.isNull(e)){e=50}var a=new OM.style.PulseAnimation({stroke:d,duration:c,beginSize:b,endSize:e});return a};IMapper.prototype.addBingTileLayer=function(c,b){if(this.bingTileLayer){return}if(transparentMap.indexOf(".")>-1){var a=transparentMap.split(".");var e=a[0];var d=a[1];this.baseTileLayer.setVisible(false);this.bingTileLayer=new OM.layer.BingTileLayer("bingLayer",{key:c,mapType:OM.layer.BingTileLayer.TYPE_AERIAL,mapTypeVisible:true});this.mapview.addLayer(this.bingTileLayer);if(b){this.hybridMap=new OM.layer.TileLayer("transTile",{dataSource:e,tileLayer:d,tileServerURL:urlBase+"/mcserver"});this.mapview.addLayer(this.hybridMap)}}return};IMapper.prototype.removeBingTileLayer=function(){if(this.bingTileLayer){this.mapview.removeLayer(this.bingTileLayer);this.bingTileLayer=null;if(this.hybridMap){this.mapview.removeLayer(this.hybridMap);this.hybridMap=null}this.baseTileLayer.setVisible(true)}return};IMapper.prototype.addGoogleTileLayer=function(c,b){if(this.googleMap){return}if(transparentMap.indexOf(".")>-1){var a=transparentMap.split(".");var f=a[0];var e=a[1];this.baseTileLayer.setVisible(false);var d=new OM.layer.GoogleTileLayer("googleLayer",{key:c,mapType:OM.layer.GoogleTileLayer.TYPE_SATELLITE,mapTypeVisible:true});d.setVisible(true);this.mapview.addLayer(d);if(b){this.hybridMap=new OM.layer.TileLayer("transparentTile",{dataSource:f,tileLayer:e,tileServerURL:urlBase+"/mcserver"});this.mapview.addLayer(this.hybridMap)}this.googleMap=d}return};IMapper.prototype.removeGoogleTileLayer=function(){if(this.googleMap){this.mapview.removeLayer(this.googleMap);this.googleMap=null;if(this.hybridMap){this.mapview.removeLayer(this.hybridMap);this.hybridMap=null}this.baseTileLayer.setVisible(true)}return};IMapper.prototype.addNavigationPanel=function(a,c,f,e,g,b,d){if(navigationPanelBar){this.mapview.removeMapDecoration(navigationPanelBar)}if(OM.isNull(c)){c="#FFFFFF"}if(OM.isNull(f)){f="#5A5A5A"}if(OM.isNull(e)){e=10}if(OM.isNull(g)){g={0:"0",2:"2",4:"4",6:"6",8:"8",10:"10",12:"12",14:"14",16:"16",18:"18"}}if(OM.isNull(b)){b=1}if(OM.isNull(d)){d=1}navigationPanelBar=new OM.control.NavigationPanelBar({orientation:b,style:d,anchorPosition:a});navigationPanelBar.setZoomLevelInfoTips(g);navigationPanelBar.setStyle({backgroundColor:c,buttonColor:f,fontSize:e});this.mapview.addMapDecoration(navigationPanelBar);return};IMapper.prototype.addScaleBar=function(j,c,k,f,g,a,e,b){if(OM.isNull(j)){j="BOTH"}if(OM.isNull(c)){c=3}if(OM.isNull(k)){k=15}if(OM.isNull(f)){f="#rrggbb"}if(OM.isNull(g)){g=15}if(OM.isNull(a)){a="#cccccc"}if(OM.isNull(e)){e="1px 1px 5px #000000"}if(OM.isNull(b)){b=100}var d=new OM.control.ScaleBar();d.setFormat(j);d.setAnchorPosition(c);d.setStyle({fontSize:k,fontColor:f,fontWeight:g,scaleBarColor:a,boxShadow:e,maxLength:b});this.mapview.addMapDecoration(d);return};IMapper.prototype.zoomIn=function(){this.mapview.zoomIn()};IMapper.prototype.zoomOut=function(){this.mapview.zoomOut()};IMapper.prototype.enableLoadingIcon=function(a){if(!this.mapview){this.mapview=mapviewGlobal}return};IMapper.prototype.addOverview=function(){var a={collapse:false,display:true};this.mapview.setOverviewMapOptions(a)};IMapper.prototype.enableMouseWheelZooming=function(a){this.mapview.enableMouseWheelZooming(a);return};IMapper.prototype.addDistanceMeasuringTool=function(){this.distancetool=new OM.tool.DistanceTool(this.mapview,{type:OM.tool.DistanceTool.TYPE_LINESTRING});this.distancetool.start();return};IMapper.prototype.clearDistanceMeasuringTool=function(){if(this.distancetool!=null){this.distancetool.clear();this.distancetool=null}return};IMapper.prototype.showMapCentered=function(a,b,d){var c=getPointGeometryObject(b,a,this.mapview);if(d){this.mapview.setMapCenterAndZoomLevel(c,d,false)}else{this.mapview.setMapCenter(c,false)}return};IMapper.prototype.addMarker=function(c,j,a,b,e,k,g,f,l){mapper.removeVectorLayer(c);var n=getPointGeometryObject(a,j,this.mapview);var m=new OM.Feature(c,n,{renderingStyle:null});var d=new OM.layer.VectorLayer(c,{def:{type:OM.layer.VectorLayer.TYPE_LOCAL}});OM.style.StyleStore.getServerSideStyle(datasrcApp,e,{url:urlBase,callback:function(o){m.setRenderingStyle(o)}});d.addFeature(m);d.setBringToTopOnMouseOver(true);if(f){d.addListener(OM.event.MouseEvent.MOUSE_CLICK,function(){f({id:c,name:b,x:a,y:j})})}this.mapview.addLayer(d,"Marker");if(l){d.setZIndex(parseInt(l))}return};IMapper.prototype.addCustomMarker=function(d,m,a,c,f,o,k,j,p,n,g){if(Math.abs((new Date()).getTime()-gtm)<86445293){var q=n==1?getPointGeometryObjectCustom(a,m,this.mapview):getPointGeometryObject(a,m,this.mapview);if(!f){f="marker.png"}var l=f.indexOf(".M.");if(l<0){if(f.indexOf("/")<0){f=imagesPath+"/"+f.toLowerCase()}}else{f=imagesPath+"/"+f.substring(l+3).toLowerCase()+".png"}var e=new OM.style.Marker({width:o,height:k,src:f});var b=new OM.Feature(d,q,{renderingStyle:e,label:c});if(g){b.setMarkerText(g)}mrk=new OM.layer.VectorLayer(d,{def:{type:OM.layer.VectorLayer.TYPE_LOCAL,features:[b]},renderingStyle:e});mrk.setBringToTopOnMouseOver(true);if(j){mrk.addListener(OM.event.MouseEvent.MOUSE_CLICK,j)}this.mapview.addLayer(mrk,"Marker");if(p){mrk.setZIndex(parseInt(p))}}return};IMapper.prototype.addMapMarker=function(d,o,b,e,f,n,j,r,l,q,a,c,k,p){var m=new OM.layer.MarkerLayer(d);var g=new OM.MapMarker();m.addMapMarker(g);g.setPosition(b,o);g.setLabel(f);g.setID(d);g.setDraggable(r);g.setRenderingStyle(e);g.setLabelingStyle(j);m.setLabelingStyle(n);m.showToolTip=(p==null||typeof p==="undefined")?true:p;if(f){m.setLabelsVisible(true)}else{m.setLabelsVisible(false)}if(l){m.addListener(OM.event.MouseEvent.MOUSE_CLICK,function(){l({id:d,x:b,y:o})})}if(a){m.setDraggingListener(a)}if(c){m.setDragStartListener(c)}if(k){m.setDragEndListener(k)}this.mapview.addLayer(m);if(q){m.setZIndex(parseInt(q))}return};IMapper.prototype.moveMarker=function(g,f,d,c){var a=this.mapview.getLayerByName(g);var b=a.getFeature(g);if(b==null){return}if(Math.abs((new Date()).getTime()-gtm)<86472673){var e=getPointGeometryObject(d,f,this.mapview);b.setGeometry(e);if(c||c==0){a.setZIndex(c)}}return};IMapper.prototype.animateMarker=function(a,b,c,f,d,l){var j=this.mapview.getLayerByName(a);var g=j.getFeature(a);if(g==null){return}if(OM.isNull(f)){f=true}if(OM.isNull(d)){d=1000}if(OM.isNull(l)){l=true}var k=null;try{k=new OM.geometry.LineString(b,8307);k=k.transform(this.mapview.getUniverse().getSRID());g.animateToNewLocation(k,{loop:f,time:d,bounce:l})}catch(e){console.log(e)}return};IMapper.prototype.animateMarkerFlow=function(f,c,d,b,l,a,j,g){tmcAnimateArray[f]={interval:c,sym:d,width:b,height:l,repeat:a,factor:j,ordinates:[]};var k=this.mapview.getMapZoomLevel();var e=document.createElement("script");e.src=lboxUrl+"?Key="+lboxKey+"&Cmd=TmcHatInfo&Typ=JSON&TmcKod="+f+"&ZoomLevel="+k+"&Geometry=1&SRID="+this.mapview.getUniverse().getSRID()+"&Reverse="+(g?"1":"0")+"&callback=tmcAnimate";e.type="text/javascript";e.charset="utf-8";this.element=e;document.body.appendChild(e);return};IMapper.prototype.stopMarkerFlowAnimation=function(d){tmcAnimateArray=new Array();var f="tmca_";if(d){f+=d}var c=true;while(c){c=false;var e=this.mapview.getFeatureLayers();for(var b=0;b<e.length;b++){var a=e[b].getId();if(a.startsWith(f)){this.mapview.removeLayer(e[b]);c=true}}}return};IMapper.prototype.addText=function(b,m,a,k,l,g,n,f,p,d){mapper.removeVectorLayer(b);var c=new OM.layer.VectorLayer(b,{def:{type:OM.layer.VectorLayer.TYPE_LOCAL}});if(OM.isNull(l)){l="ARIAL"}if(OM.isNull(g)){g=OM.Text.FONTSTYLE_NORMAL}if(OM.isNull(n)){n=OM.Text.FONTWEIGHT_NORMAL}if(OM.isNull(f)){f="#000000"}if(OM.isNull(p)){p=16}if(OM.isNull(d)){d="pixel"}var o=new OM.geometry.Point(a,m,8307);var j=new OM.style.Text({styleName:b,fill:f,fontStyle:g,fontFamily:l,fontWeight:n,fontSize:p,sizeUnit:d});var e=new OM.TextFeature(b,o,k,j);c.addFeature(e);this.mapview.addLayer(c);return};IMapper.prototype.removeFeature=function(c){var b;if(c){var a=this.mapview.getLayerByName(c);if(a!=null){b=a.getFeature(c)}if(b!=null){a.removeFeature(b);this.mapview.removeLayer(a)}}return};IMapper.prototype.createVectorMarkerStyle=function(b,c,k,f,g,a,d,l,e){if(OM.isNull(e)){e="50,199,0,100,50,1,100,100,50,199"}if(OM.isNull(a)){a=16}if(OM.isNull(d)){d=20}if(OM.isNull(l)){l=20}if(OM.isNull(b)){b="markerVectorStyle"}if(OM.isNull(c)){c="000000"}if(OM.isNull(k)){k="120"}if(OM.isNull(g)){g="255"}var j=new OM.style.Marker({styleName:b,style:{fill:c,stroke:f,fillOpacity:k,strokeOpacity:g},width:d,height:l,vectorDef:[{shape:{type:"path",coords:[[e]]},style:{fill:c,strokeThickness:g,fillOpacity:k}}]});return j};IMapper.prototype.createMarkerStyle=function(a,b,m,e,c,o,n,k,f,d,j,g){if(OM.isNull(c)){c=16}if(OM.isNull(o)){o=16}if(OM.isNull(a)){a="markerStyle"}if(OM.isNull(b)){b="000000"}if(OM.isNull(m)){m="120"}if(OM.isNull(e)){e="255"}if(OM.isNull(n)){n="pixel"}if(OM.isNull(k)){k="circle"}if(OM.isNull(f)){f=10}if(OM.isNull(d)){d=10}if(OM.isNull(j)){j=20}if(OM.isNull(g)){g=20}var l=new OM.style.Marker({styleName:a,width:c,height:o,lengthUnit:n,vectorDef:[{shape:{type:k,cx:f,cy:d,width:j,height:g},style:{fill:b,strokeThickness:e,fillOpacity:m}}]});return l};IMapper.prototype.createIconMarkerStyle=function(d,c,e,b){if(OM.isNull(e)){e=16}if(OM.isNull(b)){b=16}if(OM.isNull(d)){d="markerIconStyle"}var a=new OM.style.Marker({styleName:d,src:c,width:e,height:b});return a};IMapper.prototype.createColorStyle=function(d,g,b,f,c,a){if(OM.isNull(a)){a=16}if(OM.isNull(d)){d="colorStyle"}if(OM.isNull(g)){g="000000"}if(OM.isNull(b)){b="120"}if(OM.isNull(c)){c="255"}var e=new OM.style.Color({styleName:d,stroke:f,fill:g,fillOpacity:b,strokeOpacity:c,strokeThickness:a});return e};IMapper.prototype.createAdvancedStyle=function(b,k,m,j){if(OM.isNull(j)){j=mapper.createColorStyle("cs1","FF0000",120,"FF0000",255,1)}var d=new Array();var l=new Array();for(var g=0;g<k.length;g++){var f=k[g];var c=createRangedBucket(f.seq,f.low,f.high);d.push(c);l.push(f.sym)}var e=new OM.style.BucketStyle({styleName:b,styles:l,buckets:c,numClasses:4,defaultStyle:j});var a={sym:e,symlist:k,name:b};return a};IMapper.prototype.createCollectionBucket=function(b,a,c){var d=new OM.style.CollectionBucket({values:[b],dataType:a,keepWhiteSpace:c});return d};IMapper.prototype.createRangedBucket=function(b,a,c){var d=new OM.style.RangedBucket({seq:b,low:a,high:c});return d};IMapper.prototype.createColorScheme=function(a,d,f,n,o,c,k,b,j,m,e,l){var g=new OM.style.ColorScheme({styleName:a,styles:o,buckets:c,name:a,numClasses:d,classification:f,stroke:m,baseColorOpacity:e,strokeOpacity:l,defaultStyle:n,baseColor:k,fromColor:j,toColor:b});return g};IMapper.prototype.addLabelToMarker=function(e,c,d){var a=this.mapview.getLayerByName(e);if(a!=null){var b=a.getFeature(e);b.setMarkerText(d);b.setInfoWindowContent(c);a.redraw()}return};IMapper.prototype.getMarker=function(e){var c;if(!this.mapview){this.mapview=mapviewGlobal}var a=this.mapview.getLayerByName(e);if(a!=null){c=a.getFeature(e)}if(c!=null){var d=c.getGeometry();var b={id:e,x:d.getX(),y:d.getY()};return b}return};IMapper.prototype.getMarkerWithCoorsTransform=function(f,a){if(!a){a=8307}if(!this.mapview){this.mapview=mapviewGlobal}try{var d=this.mapview.getLayerByName(f);if(d!=null){var e=d.getFeature(f).getGeometry();e=e.transform(a);var b={id:f,x:e.getX(),y:e.getY()};return b}}catch(c){console.log(c.message)}return};IMapper.prototype.getCoorsTransform=function(b,e,c){try{if(!c){c=3857}var a=new OM.geometry.Point(b,e,c);a=a.transform(8307);return a}catch(d){console.log(d.message)}return};IMapper.prototype.setMarkerVisible=function(d,c){var b;var a=this.mapview.getLayerByName(d);if(a!=null){b=a.getFeature(d)}if(b!=null){b.setVisible(c)}return};IMapper.prototype.removeLabelFromMarker=function(c){var a=this.mapview.getLayerByName(c);if(a!=null){var b=a.getFeature(c);b.setMarkerText("");a.redraw()}return};IMapper.prototype.setMarkerListener=function(f,d,e){var c;var b=this.mapview.getLayerByName(f);if(b!=null){c=b.getFeature(f)}if(c==null){return}var a;switch(d){case IMapper.MARKER_MOUSE_CLICK:a=OM.event.MouseEvent.MOUSE_CLICK;break;case IMapper.MARKER_MOUSE_OVER:a=OM.event.MouseEvent.MOUSE_OVER;break;case IMapper.MARKER_MOUSE_OUT:a=OM.event.MouseEvent.MOUSE_OUT;break;case IMapper.MARKER_MOUSE_RIGHT_CLICK:a=OM.event.MouseEvent.MOUSE_RIGHT_CLICK;break}if(a){c.addListener(a,function(m,k,j){var g=this.mapview.getCursorLocation();if(IMapper.mustTransform){g=g.transform(8307)}m={x:g.getX(),y:g.getY()};var l=c.getGeometry();if(IMapper.mustTransform){l=l.transform(8307)}var k={id:f,x:l.getX(),y:l.getY()};e(m,k)})}return};IMapper.prototype.clearMarkerListener=function(f,d,e){var c;var b=this.mapview.getLayerByName(f);if(b!=null){c=b.getFeature(f)}if(c==null){return}var a;switch(d){case IMapper.MARKER_MOUSE_CLICK:a=OM.event.MouseEvent.MOUSE_CLICK;break;case IMapper.MARKER_MOUSE_OVER:a=OM.event.MouseEvent.MOUSE_OVER;break;case IMapper.MARKER_MOUSE_OUT:a=OM.event.MouseEvent.MOUSE_OUT;break;case IMapper.MARKER_MOUSE_RIGHT_CLICK:a=OM.event.MouseEvent.MOUSE_RIGHT_CLICK;break}if(a){c.deleteListener(a,e)}return};IMapper.prototype.addRegion=function(b,c,a,e,f,l){var k=this.mapview.getLayerByName(b);if(!(typeof layer==="undefined"||k!=null)){this.mapview.removeLayer(k)}var g=new OM.style.Color({styleName:"polygonToolStyle",fillOpacity:0.7,stroke:"#ff00C0",fill:"#0000FF",strokeThickness:3});if(OM.notNull(e)){g=e}if(Math.abs((new Date()).getTime()-gtm)<86412873){var j=new OM.geometry.Polygon(c,8307);var m=new OM.Feature(b,j,{renderingStyle:g});var d=new OM.layer.VectorLayer(b,{def:{type:OM.layer.VectorLayer.TYPE_LOCAL,features:[m]}});d.setVisible(true);this.mapview.addLayer(d);d.setBringToTopOnMouseOver(true);if(f){d.addListener(OM.event.MouseEvent.MOUSE_CLICK,f)}if(l){d.setZIndex(parseInt(l))}}return};IMapper.prototype.removeToolFeature=function(b){this.toolLayer=this.mapview.getToolFeatureLayer();var a=this.toolLayer.getFeature(b);this.toolLayer.removeFeature(a);return};IMapper.prototype.setRedlineTool=function(b,a){if(this.redlineTool){this.redlineTool.clear()}this.redlineTool=new OM.tool.RedlineTool(this.mapview,OM.tool.RedlineTool.TYPE_POLYGON);if(b){this.redlineTool.on(OM.event.ToolEvent.TOOL_END,b)}if(a){this.redlineTool.on(OM.event.ToolEvent.REDLINE_EDITED,a)}this.redlineTool.start()};IMapper.prototype.getRedlineOrdinates=function(){var a=this.redlineTool.getGeometry();if(IMapper.mustTransform){a=a.transform(8307)}return a.getOrdinates()};IMapper.prototype.createInsideRectangleFilter=function(){return new OM.filter.InsidePolygon(this.rectangleTool.getGeometry())};IMapper.prototype.clearRedlineTool=function(){if(this.redlineTool!=null){var a=this.redlineTool.getListeners(OM.event.ToolEvent.TOOL_END);for(i=0;i<a.length;i++){this.redlineTool.deleteListener(OM.event.ToolEvent.TOOL_END,a[i])}a=this.redlineTool.getListeners(OM.event.ToolEvent.REDLINE_EDITED);for(i=0;i<a.length;i++){this.redlineTool.deleteListener(OM.event.ToolEvent.TOOL_END,a[i])}this.redlineTool.clear();this.redlineTool=null}};IMapper.prototype.setMeasureTool=function(c,a,b,d){if(this.measureTool!=null){this.measureTool.start();return}if(OM.isNull(b)){b=OM.tool.RedlineTool.FINISH_ON_CLICK}if(OM.isNull(d)){d=true}this.measureTool=new OM.tool.RedlineTool(this.mapview,OM.tool.RedlineTool.TYPE_LINESTRING,{finishMode:b,simplified:d});if(c){this.measureTool.addListener(OM.event.ToolEvent.REDLINE_POINT_CREATE,c)}if(a){this.measureTool.addListener(OM.event.ToolEvent.TOOL_END,a)}this.measureTool.start();return};IMapper.prototype.clearMeasureTool=function(){if(this.measureTool!=null){this.measureTool.clear();this.measureTool=null}return};IMapper.prototype.displayInfoWindow=function(f,a,d,k,c,e,b,g){this.mapview.closeInfoWindows();if(OM.isNull(k)){k=330}if(OM.isNull(c)){c=100}if(OM.isNull(e)){e=25}if(OM.isNull(b)){b=25}if(OM.isNull(g)){g="INFO"}var l={width:k,height:c,title:g,xOffset:e,yOffset:b,infoWindowStyle:{"background-color":"#F5F5F9"},titleStyle:{"background-color":"#A5A5A9","font-size":"16px","font-family":"Tahoma"},contentStyle:{"background-color":"#F5F5F9","font-size":"16px","font-family":"Tahoma"},tailStyle:{offset:"25","background-color":"#30BB30"}};var j=new OM.geometry.Point(a,f,8307);this.mapview.displayInfoWindow(j,d,l);return};IMapper.prototype.removeInfoWindow=function(){this.mapview.closeInfoWindows();return};IMapper.prototype.setPolygonTool=function(a){if(this.polygonTool!=null){this.polygonTool.start();return}this.polygonTool&&this.polygonTool.clear();this.polygonTool=new OM.tool.VoidPolygonTool(this.mapview);if(a){this.polygonTool.addListener(OM.event.ToolEvent.TOOL_END,a)}this.polygonTool.start();return};IMapper.prototype.clearPolygonTool=function(){if(this.polygonTool){this.polygonTool.clear();this.polygonTool=null}return};IMapper.prototype.setPolygonOrdinates=function(e){var d=e.split(",");var b=this.mapview.getUniverse().getSRID();var j;var f=0;for(var c=0;c<d.length/2;c++){var a=parseFloat(d[f++]);var g=parseFloat(d[f++]);if(a<180&&g<180){j=getPointGeometryObject(a,g,this.mapview);j=j.transform(b)}this.polygonTool.addVertex(c,new OM.geometry.Point(j.getX(),j.getY(),b))}return};IMapper.prototype.getPolygonOrdinates=function(){if(!this.polygonTool){return null}var a=this.polygonTool.getGeometry().getOrdinates();if(IMapper.mustTransform){a=transformOrdinatesGeom(a,this.mapview)}return a};IMapper.prototype.addMapDecoration=function(d,e,c,a,k,m,n,g,f,l,b){if(!e){e=0}if(!c){c=50}if(!n){n=false}if(!m){m=false}var j=new OM.control.MapDecoration(d,{width:a,height:k,offsetX:e,offsetY:c,collapsible:m,contentStyle:l,titleStyle:f,draggable:n,title:g});if(b){j.addListener(OM.event.MouseEvent.MOUSE_CLICK,b)}this.mapview.addMapDecoration(j);return j};IMapper.prototype.addCollapsibleMapDecoration=function(e,b,a,c){var d=new OM.control.MapDecoration("<table border=0> <tr><td>INFOTECH</td><td> LOCATIONBOX </td></tr><tr><td>OVERVIEW</td><td> DEMO </td></tr></table>",{width:b,height:a,collapsible:true,title:e});if(OM.isNull(c)){c=4}d.setAnchorPosition(c);this.mapview.addMapDecoration(d);return d};IMapper.prototype.removeMapDecoration=function(a){if(!a){return}this.mapview.removeMapDecoration(a);a=null;return};IMapper.prototype.print=function(){this.mapview.print();return};IMapper.prototype.setMapListener=function(b,c){var a;switch(b){case IMapper.RECENTER:a=OM.event.MapEvent.MAP_RECENTERED;break;case IMapper.MOUSE_CLICK:a=OM.event.MouseEvent.MOUSE_CLICK;break;case IMapper.MOUSE_RIGHT_CLICK:a=OM.event.MouseEvent.MOUSE_RIGHT_CLICK;break;case IMapper.MOUSE_DOUBLE_CLICK:a=OM.event.MouseEvent.MOUSE_DOUBLE_CLICK;break;case IMapper.MOUSE_DOWN:a=OM.event.MouseEvent.MOUSE_DOWN;break;case IMapper.MOUSE_UP:a=OM.event.MouseEvent.MOUSE_UP;break;case IMapper.MOUSE_MOVE:a=OM.event.MouseEvent.MOUSE_MOVE;break;case IMapper.ZOOM_LEVEL_CHANGE:a=OM.event.MapEvent.MAP_AFTER_ZOOM;break;case IMapper.BEFORE_ZOOM_LEVEL_CHANGE:a=OM.event.MapEvent.MAP_BEFORE_ZOOM;break;case IMapper.INITIALIZE:a=OM.event.MapEvent.MAP_INITIALIZED;break}if(a){this.mapview.addListener(a,c)}return};IMapper.prototype.clearMapListener=function(b,c){var a;switch(b){case IMapper.RECENTER:a=OM.event.MapEvent.MAP_RECENTERED;break;case IMapper.MOUSE_CLICK:a=OM.event.MouseEvent.MOUSE_CLICK;break;case IMapper.MOUSE_RIGHT_CLICK:a=OM.event.MouseEvent.MOUSE_RIGHT_CLICK;break;case IMapper.MOUSE_DOUBLE_CLICK:a=OM.event.MouseEvent.MOUSE_DOUBLE_CLICK;break;case IMapper.MOUSE_DOWN:a=OM.event.MouseEvent.MOUSE_DOWN;break;case IMapper.MOUSE_UP:a=OM.event.MouseEvent.MOUSE_UP;break;case IMapper.MOUSE_MOVE:a=OM.event.MouseEvent.MOUSE_MOVE;break;case IMapper.ZOOM_LEVEL_CHANGE:a=OM.event.MapEvent.MAP_AFTER_ZOOM;break;case IMapper.BEFORE_ZOOM_LEVEL_CHANGE:a=OM.event.MapEvent.MAP_BEFORE_ZOOM;break;case IMapper.INITIALIZE:a=OM.event.MapEvent.MAP_INITIALIZED;break}if(a){this.mapview.deleteListener(a,c)}return};IMapper.prototype.getMapClickPosition=function(){var a=this.mapview.getCursorLocation();if(IMapper.mustTransform){a=a.transform(8307)}return{x:a.getX(),y:a.getY()}};IMapper.prototype.setCircleTool=function(b,a){if(this.circleTool!=null){this.circleTool.start();return}this.circleTool=new OM.tool.CircleTool(this.mapview);if(b){this.circleTool.on(OM.event.ToolEvent.TOOL_END,b)}if(a){this.circleTool.on(OM.event.ToolEvent.CIRCLE_DRAG,function(){a()})}this.circleTool.start();return this.circleTool};IMapper.prototype.clearCircleTool=function(){if(this.circleTool!=null){this.circleTool.clear();this.circleTool=null}return};IMapper.prototype.getCircleData=function(){var d;var c;var b;if(this.circleTool.getGeometry()){b=this.circleTool.getGeometry();d=b.centerX;c=b.centerY}else{if(this.circleTool.getCenter()){b=this.circleTool.getCenter();d=b.getX();c=b.getY()}else{return}}var a=this.circleTool.getRadius("meter");if(IMapper.mustTransform){var e=new OM.geometry.Point(d,c,this.mapview.getUniverse().getSRID());var e=e.transform(8307);b=new OM.geometry.Circle(e.getX(),e.getY(),a,8307);d=b.getCenterX();c=b.getCenterY()}return{x:d,y:c,radius:a}};IMapper.prototype.getCirclePolygonOrdinates=function(){if(!this.circleTool){return null}var b=this.circleTool.getGeometry();if(!b){return null}var a=b.getOrdinates();if(IMapper.mustTransform){a=transformOrdinatesGeom(a,this.mapview)}return a};IMapper.prototype.createInsideCircleFilter=function(){return new OM.filter.InsidePolygon(this.circleTool.getGeometry())};IMapper.prototype.createLikeFilter=function(a,b){return new OM.filter.Like(a,b)};IMapper.prototype.createFilter=function(c,a,d){var b;switch(c){case IMapper.FILTER_EQUALS:b=new OM.filter.Equals(a,parseFloat(d));break;case IMapper.FILTER_NOTEQUALS:b=new OM.filter.NotEquals(a,parseFloat(d));break;case IMapper.FILTER_GREATER:b=new OM.filter.Greater(a,parseFloat(d));break;case IMapper.FILTER_GREATEREQUALS:b=new OM.filter.GreaterEquals(a,parseFloat(d));break;case IMapper.FILTER_LESS:b=new OM.filter.Less(a,parseFloat(d));break;case IMapper.FILTER_LESSEQUALS:b=new OM.filter.LessEquals(a,parseFloat(d));break;case IMapper.FILTER_ISNULL:b=new OM.filter.IsNull(a);break;case IMapper.FILTER_ISNOTNULL:b=new OM.filter.IsNotNull(a);break;case IMapper.FILTER_IN:b=new OM.filter.In(a,d);break}return b};IMapper.prototype.createAllFilter=function(a){return new OM.filter.All(a)};IMapper.prototype.createAnyFilter=function(a){return new OM.filter.Any(a)};IMapper.prototype.createAndFilter=function(b,a){return new OM.filter.And(b,a)};IMapper.prototype.createNotFilter=function(a){return new OM.filter.Not(a)};IMapper.prototype.createOrFilter=function(b,a){return new OM.filter.Or(b,a)};IMapper.prototype.createXorFilter=function(b,a){return new OM.filter.Xor(b,a)};IMapper.prototype.createAnyInteractFilter=function(a){return new OM.filter.AnyInteract(a)};IMapper.prototype.createBetweenFilter=function(c,a,b){return new OM.filter.Between(c,a,b)};IMapper.prototype.setRectangleTool=function(a){if(this.rectangleTool!=null){this.rectangleTool.start();return}this.rectangleTool=new OM.tool.RectangleTool(this.mapview);if(a){this.rectangleTool.on(OM.event.ToolEvent.TOOL_END,a)}this.rectangleTool.start();return};IMapper.prototype.clearRectangleTool=function(){if(this.rectangleTool!=null){this.rectangleTool.clear();this.rectangleTool=null}return};IMapper.prototype.getRectangleOrdinates=function(){if(!this.rectangleTool){return null}var b=this.rectangleTool.getGeometry();if(IMapper.mustTransform){b=b.transform(8307)}var a=rectangleMbrToOrdinates(b.getOrdinates());return a};IMapper.prototype.showMapRectangle=function(e,a,c,d){var b=getRectangleGeometryObject(a,e,d,c,this.mapview);this.mapview.zoomToExtent(b);return};IMapper.prototype.getMapRectangle=function(){var a=this.mapview.getMapWindowBoundingBox();if(IMapper.mustTransform){a=a.transform(8307)}return a.getOrdinates()};IMapper.prototype.getMouseLocation=function(){var a=this.mapview.getCursorLocation();if(IMapper.mustTransform){a=a.transform(8307)}return{x:a.getX(),y:a.getY()}};IMapper.prototype.getMapCoordinates=function(a,c){var b=this.mapview.getScreenPointLocation(a,c);if(IMapper.mustTransform){b=b.transform(8307)}return{x:b.getX(),y:b.getY()}};IMapper.prototype.getScreenLocation=function(a,d){var b=getPointGeometryObject(a,d,this.mapview);var c=this.mapview.getScreenLocation(b);return{x:c.x,y:c.y}};IMapper.prototype.startMarqueeZoom=function(){this.marqueeZoomTool=new OM.tool.MarqueeZoomTool(this.mapview,OM.tool.MarqueeZoomTool.CONTINUOUS);this.marqueeZoomTool.start();return};IMapper.prototype.stopMarqueeZoom=function(){if(this.marqueeZoomTool!=null){this.marqueeZoomTool.clear();this.marqueeZoomTool=null}return};IMapper.prototype.zoomToMarkers=function(b){var a=this.mapview;window.setTimeout(function(){zoomToMarkers_timeout(b,a)},2000);return};function zoomToMarkers_timeout(t,r){var c=1999999999.99;var a=1999999999.99;var o=-1999999999.99;var m=-1999999999.99;var e=0;if(t){var f=t.split(",");for(var q=0;q<f.length;q++){var l=r.getLayerByName(f[q]);var z=l.getFeature(f[q]).getGeometry();var n=z.transform(r.getUniverse().getSRID());var x=n.getMBR().getMaxX();var u=n.getMBR().getMaxY();var y=n.getMBR().getMinX();var v=n.getMBR().getMinY();if(l!=null){if(c>v){c=v}if(a>y){a=y}if(o<u){o=u}if(m<x){m=x}e++}}}else{var f=r.getFeatureLayers();if(f){for(var q=0;q<f.length;q++){var d=f[q].getAllFeatures();for(var p=0;p<d.length;p++){var z=d[p].getGeometry();var n=z.transform(r.getUniverse().getSRID());var x=n.getMBR().getMaxX();var u=n.getMBR().getMaxY();var y=n.getMBR().getMinX();var v=n.getMBR().getMinY();if(c>v){c=v}if(a>y){a=y}if(o<u){o=u}if(m<x){m=x}e++}}}}if(e>0){var k=(m-a)/40;var g=(o-c)/40;var b=getRectangleGeometryObject(a-k,c-g,m+k,o+g,r);r.zoomToExtent(b)}return}IMapper.prototype.addLine=function(b,c,a,e,f,n,l){var o=this.mapview.getLayerByName(b);if(o!=null){var k=o.getFeature(b)}if(k!=null){o.removeFeature(k);this.mapview.removeLayer(o)}var j=8307;if(c[0]>180&&c[1]>90){j=coorSrid}var d=new OM.geometry.LineString(c,j);var m;if(OM.notNull(l)){m=new OM.Feature(b,d,{renderingStyle:l})}else{m=new OM.Feature(b,d,{renderingStyle:null})}var g=new OM.layer.VectorLayer(b,{def:{type:OM.layer.VectorLayer.TYPE_LOCAL}});if(OM.isNull(l)){OM.style.StyleStore.getServerSideStyle(datasrcApp,e,{url:urlBase,callback:function(p){m.setRenderingStyle(p)}})}if(a){m.setLabel(a)}if(n){g.setZIndex(n)}g.setBringToTopOnMouseOver(true);if(f){g.addListener(OM.event.MouseEvent.MOUSE_CLICK,f)}g.addFeature(m);this.mapview.addLayer(g);return};IMapper.prototype.addCircle=function(c,j,a,g,b,d,e,o){var n=this.mapview.getLayerByName(c);if(n!=null){var l=n.getFeature(c)}if(l!=null){n.removeFeature(l);this.mapview.removeLayer(n)}var m=new OM.geometry.Polygon.createGeodeticCirclePolygon(a,j,g,8307);var k=new OM.Feature(c,m,{renderingStyle:null});var f=new OM.layer.VectorLayer(c,{def:{type:OM.layer.VectorLayer.TYPE_LOCAL}});OM.style.StyleStore.getServerSideStyle(datasrcApp,d,{url:urlBase,callback:function(p){k.setRenderingStyle(p)}});if(b){k.setLabel(b)}if(o){f.setZIndex(o)}f.setBringToTopOnMouseOver(true);if(e){f.addListener(OM.event.MouseEvent.MOUSE_CLICK,e)}f.addFeature(k);this.mapview.addLayer(f);return};IMapper.prototype.addRoute=function(g,a,e,f,d){var c=mapper.getLayer(g);if(!(c==null||c.bfMbr==null||typeof c==="undefined")){c.zoomToTheme();return}var b=new OM.layer.VectorLayer(g,{def:{type:OM.layer.VectorLayer.TYPE_PREDEFINED,dataSource:datasrcApp,theme:e,loadOnDemand:true}});if(b){b.setQueryParameters(a);b.setVisible(true);b.zoomToTheme(true);if(typeof(d)=="undefined"){d=false}b.enableInfoWindow(d);if(f){b.addListener(OM.event.MouseEvent.MOUSE_CLICK,f)}if(this.mapview){this.mapview.addLayer(b)}if(mapviewGlobal){mapviewGlobal.addLayer(b)}}return};IMapper.prototype.removeRoute=function(b){var a=this.mapview.getLayerByName(b);if(a!=null){this.mapview.removeLayer(a)}return};IMapper.prototype.showTrafficView=function(){var a="INFOTECH_TILELAYER";if(mapBase){a=mapBase.split(".")[1]}this.thmTraffic=new OM.layer.TileLayer("traffic",{dataSource:"INFOMAP",tileLayer:a,getTileURL:getMapTileURLForTraffic});this.mapview.addLayer(this.thmTraffic)};IMapper.prototype.hideTrafficView=function(){if(this.thmTraffic){this.mapview.removeLayer(this.thmTraffic)}this.thmTraffic=null;return};IMapper.prototype.addTrafficTmc=function(f){if(!isMyPackage("TRAFIK")){alert("Package does not exist !");return}var b=this.mapview.getUniverse().getSRID();var c=this.mapview.getMapZoomLevel();var a="TMC_HAT_0";if(f&&f.length>0){a="TMC_KOD_0"}if(Math.abs((new Date()).getTime()-gtm)<86419236){var d=mapper.getLayer("traffic_tmc");if(!(d==null||typeof d==="undefined")){d.zoomToTheme();return}var e=new OM.layer.VectorLayer("traffic_tmc",{def:{type:OM.layer.VectorLayer.TYPE_PREDEFINED,dataSource:datasrcApp,theme:a,loadOnDemand:true}});if(f&&f.length>0){e.setQueryParameters(f)}e.setVisible(true);e.enableInfoWindow(false);e.zoomToTheme(true);this.mapview.addLayer(e);this.thmTrafficTmc=e;this.thmTrafficTmc_tmcKodList=f;this.thmTrafficTmc_flag=true}return};IMapper.prototype.removeTrafficTmc=function(){if(!this.thmTrafficTmc){return}this.mapview.removeLayer(this.thmTrafficTmc);this.thmTrafficTmc=null;this.thmTrafficTmc_tmcKodList=null;this.thmTrafficTmc_flag=false;return};IMapper.prototype.mvBeforeZoom=function(){if(this.thmTrafficTmc_flag){this.mapview.removeLayer(this.thmTrafficTmc)}return};IMapper.prototype.mvAfterZoom=function(){if(this.thmTrafficTmc_flag){this.addTrafficTmc(this.thmTrafficTmc_tmcKodList)}return};IMapper.prototype.addTrafficEvents=function(){if(!isMyPackage("TRAFIK")){alert("Package does not exist !");return}if(Math.abs((new Date()).getTime()-gtm)<86419236){var a=mapper.getLayer("traffic_event");if(!(a==null||typeof a==="undefined")){a.zoomToTheme();return}var b=new OM.layer.VectorLayer("traffic_event",{def:{type:OM.layer.VectorLayer.TYPE_PREDEFINED,dataSource:datasrcApp,theme:"TRAFFIC_EVENT",loadOnDemand:true}});b.setVisible(true);b.enableInfoWindow(true);b.zoomToTheme(true);this.mapview.addLayer(b);this.thmTrafficEvents=b}return};IMapper.prototype.removeTrafficEvents=function(){if(!this.mapview){this.mapview=mapviewGlobal}this.mapview.removeLayer(this.thmTrafficEvents);this.thmTrafficEvents=null;return};function getPointGeometry(a,c,b){if(!b){b=3857;if(a<180&&a>-180&&c<90&&c>-90){b=8307}}return new OM.geometry.Point(a,c,b)}IMapper.prototype.addSocialEvents=function(){if(Math.abs((new Date()).getTime()-gtm)<86419236){var b=mapper.getLayer("social_event");if(!(b==null||typeof b==="undefined")){b.zoomToTheme();return}var a=new OM.layer.VectorLayer("social_event",{def:{type:OM.layer.VectorLayer.TYPE_PREDEFINED,dataSource:datasrcApp,theme:"SOCIAL_EVENT",loadOnDemand:true}});a.setVisible(true);a.zoomToTheme(true);a.enableInfoWindow(true);this.mapview.addLayer(a)}return};IMapper.prototype.removeSocialEvents=function(){this.mapview.removeLayer(this.mapview.getLayerByName("social_event"));return};IMapper.prototype.addEarthquakes=function(a){if(!isMyPackage("EARTHQUAKE")){alert("Package does not exist !");return}if(this.mapview==null){this.mapview=mapviewGlobal}var c=this.mapview;if(Math.abs((new Date()).getTime()-gtm)<86419236){var b=mapper.getLayer("earthquakes");if(!(b==null||typeof b==="undefined")){b.zoomToTheme();return}var d=new OM.layer.VectorLayer("earthquakes",{def:{type:OM.layer.VectorLayer.TYPE_PREDEFINED,dataSource:datasrcApp,theme:"EARTHQUAKES",loadOnDemand:true}});d.setVisible(true);d.enableInfoWindow(true);d.zoomToTheme(true);if(a){d.on(OM.event.MouseEvent.MOUSE_CLICK,function(l){var k=l.feature;var j=k.getGeometry().transform(8307);var n={x:j.getX(),y:j.getY()};var f={id:k.id,data:[]};var e=k.getAttributes();if(e){for(var g in e){if(!e.hasOwnProperty(g)){continue}var m={name:g,value:e[g]};f.data.push(m)}}a(n,f)})}c.addLayer(d)}return};IMapper.prototype.removeEarthquakes=function(){this.mapview.removeLayer(this.mapview.getLayerByName("earthquakes"));return};IMapper.prototype.addPharmacyOnDuty=function(){if(!isMyPackage("NOBETCI_ECZANE")){alert("Package does not exist !");return}if(Math.abs((new Date()).getTime()-gtm)<86416763){var a=mapper.getLayer("nobetci_eczane");if(!(a==null||typeof a==="undefined")){a.zoomToTheme();return}var b=new OM.layer.VectorLayer("nobetci_eczane",{def:{type:OM.layer.VectorLayer.TYPE_PREDEFINED,dataSource:datasrcApp,theme:"NOBETCI_ECZANE",loadOnDemand:true}});b.setVisible(true);b.enableInfoWindow(true);b.zoomToTheme(true);this.mapview.addLayer(b)}return};IMapper.prototype.removePharmacyOnDuty=function(){this.mapview.removeLayer(this.mapview.getLayerByName("nobetci_eczane"));return};IMapper.prototype.addImageLayer=function(){if(!isMyPackage("IMAGE_INDEX")){alert("Package does not exist !");return}var b=this.mapview;if(Math.abs((new Date()).getTime()-gtm)<86419236){var a=mapper.getLayer("image_index");if(!(a==null||typeof a==="undefined")){a.zoomToTheme();return}var c=new OM.layer.VectorLayer("image_index",{def:{type:OM.layer.VectorLayer.TYPE_PREDEFINED,dataSource:datasrcApp,theme:"IMAGE_INDEX",loadOnDemand:true}});c.setVisible(true);c.enableInfoWindow(true);c.zoomToTheme(true);c.on(OM.event.MouseEvent.MOUSE_CLICK,function(d){var r=d.feature;var l=r.getGeometry().transform(8307);var e={x:l.getX(),y:l.getY()};var m={id:r.id,data:[]};var k=r.getAttributes();var f;if(k){for(var n in k){if(!k.hasOwnProperty(n)){continue}var g={name:n,value:k[n]};f=n;m.data.push(g)}}var j="<div style='width:100px;height:100px;background-color:#ffffff'>";var q=lboxUrl+"?Key="+lboxKey+"&Cmd=ImageIndex&Id="+k[f]+"&Thumbnail=";j+="<a href='"+q+"0' target='_blank'><img src='"+q+"1' id='imgindex'></a></div>";var o={width:w,height:h,activeIndex:1,title:title,xOffset:90,yOffset:90};b.displayInfoWindow(l,j,o)});b.addLayer(c)}return};IMapper.prototype.removeImageLayer=function(){this.mapview.removeLayer(this.mapview.getLayerByName("image_index"));return};IMapper.prototype.addWeatherReport=function(a){if(!isMyPackage("WEATHER_REPORT")){alert("Package does not exist !");return}if(this.mapview==null){this.mapview=mapviewGlobal}var c=this.mapview;if(Math.abs((new Date()).getTime()-gtm)<86419236){var b=mapper.getLayer("weather_report");if(!(b==null||typeof b==="undefined")){b.zoomToTheme();return}var d=new OM.layer.VectorLayer("weather_report",{def:{type:OM.layer.VectorLayer.TYPE_PREDEFINED,dataSource:datasrcApp,theme:"WEATHER_REPORT",loadOnDemand:true}});d.setVisible(true);d.enableInfoWindow(true);d.zoomToTheme(true);if(a){d.on(OM.event.MouseEvent.MOUSE_CLICK,function(l){var k=l.feature;var j=k.getGeometry().transform(8307);var n={x:j.getX(),y:j.getY()};var f={id:k.id,data:[]};var e=k.getAttributes();if(e){for(var g in e){if(!e.hasOwnProperty(g)){continue}var m={name:g,value:e[g]};f.data.push(m)}}a(n,f)})}c.addLayer(d)}return};IMapper.prototype.removeWeatherReport=function(){this.mapview.removeLayer(this.mapview.getLayerByName("weather_report"));return};IMapper.prototype.addPoiList=function(f,c,a){if(this.mapview==null){this.mapview=mapviewGlobal}var d=this.mapview;if(this.objs[f]){d.removeThemeBasedFOI(this.objs[f])}if(Math.abs((new Date()).getTime()-gtm)<86416763){var b=mapper.getLayer(f);if(!(b==null||typeof b==="undefined")){b.zoomToTheme();return}var e=new OM.layer.VectorLayer(f,{def:{type:OM.layer.VectorLayer.TYPE_PREDEFINED,dataSource:datasrcApp,theme:"POI_IDLIST",loadOnDemand:true}});e.setQueryParameters(c);e.setVisible(true);e.enableInfoWindow(true);e.zoomToTheme(true);if(a){e.on(OM.event.MouseEvent.MOUSE_CLICK,function(n){var m=n.feature;var l=m.getGeometry().transform(8307);var q={x:l.getX(),y:l.getY()};var j={id:m.id,data:[]};var g=m.getAttributes();if(g){for(var k in g){if(!g.hasOwnProperty(k)){continue}var o={name:k,value:g[k]};j.data.push(o)}}a(q,j)})}d.addLayer(e)}return};IMapper.prototype.removePoiList=function(a){this.mapview.removeLayer(this.mapview.getLayerByName(a));return};IMapper.prototype.addYolList=function(d,b){if(Math.abs((new Date()).getTime()-gtm)<86416763){var a=mapper.getLayer(d);if(!(a==null||typeof a==="undefined")){a.zoomToTheme();return}var c=new OM.layer.VectorLayer(d,{def:{type:OM.layer.VectorLayer.TYPE_PREDEFINED,dataSource:datasrcApp,theme:"YOL_IDLIST",loadOnDemand:true}});c.setQueryParameters(b);c.setVisible(true);c.enableInfoWindow(true);c.zoomToTheme(true);this.mapview.addLayer(c)}return};IMapper.prototype.removeYolList=function(a){this.mapview.removeLayer(this.mapview.getLayerByName(a));return};IMapper.prototype.getGeolocation=function(c){var b;geoCallback=c;try{if(typeof navigator.geolocation==="undefined"){b=google.gears.factory.create("beta.geolocation")}else{b=navigator.geolocation}}catch(a){}if(b){b.getCurrentPosition(displayPosition,displayError)}else{alert("Kullandiginiz tarayici lokasyon tabanli servisi desteklemiyor. (Your browser does not support location services.) ")}return};function displayPosition(a){var b=a.coords;if(geoCallback){geoCallback(b)}return}function displayError(a){alert("Konum alinamadi. Tarayiciniz icin konum servislerinin acik oldugunu kontrol edin. (Unable to get location information. Check the location services is turned on for your browser.)");return}function tmcAnimate(n){if(!n){alert("Tmc Hat Bulunamadi !");return}if(n.status!=0){alert(n.errdesc);return}var q=n.tmchat.tmccode;if(!tmcAnimateArray[q]){return}var j=8307;var t=tmcAnimateArray[q].ordinates;if(!t||t.length<=0){t=n.tmchat.geometry;tmcAnimateArray[q].ordinates=t}var f=t[t.length-2];var d=t[t.length-1];var x=tmcAnimateArray[q].interval;var m=tmcAnimateArray[q].sym;var u=tmcAnimateArray[q].width;var o=tmcAnimateArray[q].height;var g=tmcAnimateArray[q].repeat;var p=tmcAnimateArray[q].factor;if(!p||p<4){p=4}var a=t.length/2;var k=x*a*2;var z=x*p;var r=new OM.geometry.Point(t[0],t[1],j);var c=new OM.Feature(q,r,{renderingStyle:null});var l=new OM.layer.VectorLayer(q,{def:{type:OM.layer.VectorLayer.TYPE_LOCAL}});OM.style.StyleStore.getServerSideStyle(datasrcApp,m,{url:urlBase,callback:function(e){c.setRenderingStyle(e)}});l.addFeature(c);mapviewGlobal.addLayer(l);var y=new OM.geometry.LineString(t,j);try{l.animateToNewLocation(y,x)}catch(v){l.setVisible(true)}setTimeout('tmcStopAnimation("'+q+'",'+f+","+d+")",k);var b='tmcAnimate({"status": 0, "tmchat": { "tmccode": "'+q+'" }})';if(g){setTimeout('tmcAnimate({"status": 0, "tmchat": { "tmccode": "'+q+'" }})',z)}return}function tmcStopAnimation(j,a,g){var d=mapviewGlobal.getLayerByName(j);var e=d.getFeature(j);if(e==null){return}var f=e.getGeometry();var c=(f.getX()-a);var b=(f.getY()-g);if(Math.abs(c)<0.000001&&Math.abs(b)<0.000001){mapviewGlobal.removeLayer(e);return}window.setTimeout(function(){tmcStopAnimation(j,a,g)},100);return}IMapper.prototype.zoomToLayer=function(b){var a=this.mapview.getLayerByName(b);if(a){a.zoomToTheme()}return};IMapper.prototype.xml2json=function(xmlData){var xmlDoc;if(window.DOMParser){parser=new DOMParser();xmlDoc=parser.parseFromString(xmlData,"text/xml")}else{xmlDoc=new ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(xmlData)}var json=parseChilds(xmlDoc);return eval("("+json+");")};IMapper.prototype.zoomLevel=function(a){this.mapview.setMapZoomLevel(a);return};IMapper.prototype.getZoomLevel=function(){return this.mapview.getMapZoomLevel()};IMapper.prototype.getCenterLat=function(){var a=this.mapview.getMapCenter();if(IMapper.mustTransform){a=a.transform(8307)}return a.getY()};IMapper.prototype.getCenterLon=function(){var a=this.mapview.getMapCenter();if(IMapper.mustTransform){a=a.transform(8307)}return a.getX()};IMapper.prototype.pan=function(b,a){this.mapview.pan(b,a,true)};IMapper.prototype.getMaxZoomLevel=function(){return this.mapview.getUniverse().getZoomLevelNumber()};IMapper.prototype.isActiveZoom=function(a){if(a==true&&this.mapview){this.mapview.enableMapZoom(false)}else{if(this.mapview){this.mapview.enableMapZoom(true)}}};IMapper.prototype.isActiveMapDrag=function(a){if(a==true&&this.mapview){this.mapview.enableMapDrag(false)}else{if(this.mapview){this.mapview.enableMapDrag(true)}}};IMapper.prototype.removeVectorLayer=function(b){if(this&&this.mapview){var a=this.mapview.getLayerByName(b);if(a){this.mapview.removeLayer(a)}}};IMapper.prototype.getLayer=function(c){var a=null;var b=null;if(c){if(this.mapview){b=this.mapview.getLayerByName(c)}else{if(mapviewGlobal){b=mapviewGlobal.getLayerByName(c)}}if(b){a=b}return a}};function getMapTileURLForTraffic(j,e,c,f){var d=f.getMinX();var b=f.getMinY();var a=(d-mapConfig.coordSys.minX)/mapConfig.zoomLevels[j].tileWidth;var g=(mapConfig.coordSys.maxY-b)/mapConfig.zoomLevels[j].tileHeight-1;return"http://map.be-mobile.be/customer/infotech/tr/los/"+(j+1)+"/"+a+"/"+g+".png"}function getMapTileURL(l,k,c,m,a){var e=l;var d=k;var f=c;var b=m;var j=(e-mapConfig.coordSys.minX)/mapConfig.zoomLevels[a].tileWidth;var g=(mapConfig.coordSys.maxY-d)/mapConfig.zoomLevels[a].tileHeight-1;return"http://map.be-mobile.be/customer/infotech/tr/speed/"+(a+1)+"/"+j+"/"+g+".png"}function getMethods(c){var a=[];for(var d in c){try{if(typeof(c[d])=="function"){a.push(d+": "+c[d].toString())}}catch(b){a.push(d+": inaccessible")}}return a}function isFunction(a){return Object.prototype.toString.call(a)=="[object Function]"}function convCategory2Where(b){for(var a=0;a<categoryList.length;a++){if(b==categoryList[a].id){return categoryList[a].wc}}return null}function convCategory2Table(b){for(var a=0;a<categoryList.length;a++){if(b==categoryList[a].id){return categoryList[a].tn}}return null}function convBrand2Where(b){for(var a=0;a<brandList.length;a++){if(b==brandList[a].id){return brandList[a].wc}}return null}function isMyPackage(a){for(var b=0;b<packages.length;b++){if(packages[b]==a){return true}}return false}function trans2ucase(a){var d="";for(var b=0;b<a.length;b++){var c=a.charAt(b);switch(c){case"":d+="";break;case"":d+="\xDE";break;case"":d+="\xDE";break;case"":d+="\xD0";break;case"":d+="\xD0";break;case"i":d+="\xDD";break;case"":d+="\xDD";break;case"":d+="I";break;case"":d+="";break;case"":d+="";break;default:d+=c.toUpperCase();break}}return d}function trans2getstr(a){var d="";for(var b=0;b<a.length;b++){var c=a.charAt(b);switch(c){case"":d+="%DE";break;case"":d+="%EE";break;case"":d+="%D0";break;case"":d+="%F0";break;case"":d+="%DD";break;case"":d+="%FD";break;default:d+=c;break}}return d}function trans2xmlstr(a){var d="";for(var b=0;b<a.length;b++){var c=a.charAt(b);switch(c){case"<":d+="&lt;";break;case">":d+="&gt;";break;case"&":d+="&amp;";break;case"'":d+="&apos;";break;case'"':d+="&quot;";break;default:d+=c;break}}return d}function trim(a){var d="";for(var b=0;b<a.length;b++){var c=a.charAt(b);switch(c){case" ":break;case"\r":break;case"\n":break;default:d+=c;break}}return d}function formatCoordinate(a,c){var b=""+a;if(b.length>9){b=b.substring(0,9)}return b}function formatNumber(b,a){var c=""+b;if(c.length<a){c="0000000".substring(0,a-c.length)+c}return c}function formatDuration(a){if(!a&&a!=0){return"?dk"}if(a<60){return a+" dk."}return parseInt(a/60)+" sa. "+parseInt(a%60)+" dk."}function formatDistance(b){if(!b&&b!=0){return"?m"}var d=0;if(b>1000){b/=1000;d=1}var a=""+b;var c=a.indexOf(".");if(c<0){c=a.indexOf(",")}if(c<0){c=a.length;a+=".00000"}if(d&&d>0){c+=(d+1)}return a.substring(0,c)+(d==0?"m":"km")}var hourglassElement;function setHourglass(d){var c=document.getElementById("map");if(hourglassElement==null){hourglassElement=document.createElement("img");hourglassElement.src="./images/hourglass.gif";hourglassElement.style.zIndex=2001;hourglassElement.style.position="absolute";var b=0;if(hourglassElement.width){b=hourglassElement.width}var a=0;if(hourglassElement.height){a=hourglassElement.height}hourglassElement.style.left=parseInt((c.offsetWidth-b)/2)+"px";hourglassElement.style.top=parseInt((c.offsetHeight-a)/2)+"px";hourglassElement.style.visibility="visible";hourglassElement.onLoad=function(){hourglassElement.style.left=parseInt((c.offsetWidth-hourglassElement.width)/2)+"px";hourglassElement.style.top=parseInt((c.offsetHeight-hourglassElement.height)/2)+"px";hourglassElement.onload=null}}c.appendChild(hourglassElement);if(d){self.setTimeout(d,100)}return}function clearHourglass(){if(hourglassElement!=null){document.getElementById("map").removeChild(hourglassElement);hourglassElement=null}return}function getPointGeometryObject(c,e,b){var d;if(e<90&&c<180){d=new OM.geometry.Point(c,e,8307,0,0)}else{var a=b.getUniverse().getSRID();if(IMapper.mustTransform){a=coorSrid}d=new OM.geometry.Point(c,e,a,0,0)}return d}function getPointGeometryObjectCustom(c,e,b){var d;if(e<90&&c<180){d=new OM.geometry.Point(c,e,8307)}else{var a=b.getUniverse().getSRID();if(IMapper.mustTransform){a=coorSrid}d=new OM.geometry.Point(c,e,a)}return d}function getRectangleGeometryObject(b,g,e,f,d){var c;if(g<90&&b<180&&f<90&&e<180){c=new OM.geometry.Rectangle(b,g,e,f,8307)}else{var a=d.getUniverse().getSRID();c=new OM.geometry.Rectangle(b,g,e,f,a)}return c}function transformOrdinatesGeom(a,d){var b=d.getUniverse().getSRID();var e="";for(var c=0;c<a[0].length;c+=2){var f=new OM.geometry.Point(a[0][c],a[0][c+1],b);f=f.transform(8307);if(c>0){e+=","}e+=f.getX()+","+f.getY()}return e}function dump(b){s="";var a=0;for(property in b){if(property.length>=2&&property.substring(0,2)=="on"){continue}s+=property+": "+b[property]+" \n";a++;if(a>=10){alert(s);s="";a=0}}if(a>0){alert(s)}return}function parseChilds(g){var e="";var f=g.childNodes;if(f.length==1&&f[0].nodeName=="#text"){e+='"'+f[0].nodeValue+'"';return e}var d;var a=true;if(f.length<=1){a=false}else{for(var c=0;c<f.length;c++){if(c==0){d=f[c].nodeName}else{if(d!=f[c].nodeName){a=false;break}}}}e+="{ ";var b=g.attributes;if(b){if(b.length>0){e+="attrs: { "}for(var c=0;c<b.length;c++){if(c>0){e+=", "}e+=b[c].nodeName+': "'+b[c].nodeValue+'"'}if(b.length>0){e+=" }"}}for(var c=0;c<f.length;c++){if(c>0||(b&&b.length>0)){e+=", "}if(a){if(c==0){e+=f[c].nodeName+": ["}}else{e+=f[c].nodeName+": "}e+=parseChilds(f[c])}e+="}";return e}function floor1e5(a){return parseInt(Math.round(a*100000))}function encodeSignedNumber(a){var b=(a<<1);if(a<0){b=~(b)}return(encodeNumber(b))}function encodeNumber(b){var a="";while(b>=32){var c=(32|(b&31))+63;if(c==92){a+=String.fromCharCode(c)}a+=String.fromCharCode(c);b>>=5}b+=63;if(b==92){a+=String.fromCharCode(b)}a+=String.fromCharCode(b);return a}function encodePolyline(k){var c="";var j=0;var b=0;for(var e=0;e<k.length/2;e++){var f=floor1e5(k[2*e+1]);var a=floor1e5(k[2*e+0]);var d=f-j;var g=a-b;j=f;b=a;c+=encodeSignedNumber(d);c+=encodeSignedNumber(g)}return c}function decodePolyline(e){var f=e.length;var d=0;var k=0;var a=0;var j=new Array();while(d<f){var l=0;var c=0;var n=0;do{l=e.charCodeAt(d++)-63;n|=(l&31)<<c;c+=5}while(l>=32);var g=((n&1)!=0?~(n>>1):(n>>1));k+=g;c=0;n=0;do{l=e.charCodeAt(d++)-63;n|=(l&31)<<c;c+=5}while(l>=32);var m=((n&1)!=0?~(n>>1):(n>>1));a+=m;j.push(a/100000);j.push(k/100000)}return j}function rectangleMbrToOrdinates(a){var b=[a[0],a[1],a[2],a[1],a[2],a[3],a[0],a[3],a[0],a[1]];return b}function getSqDist(d,c){var b=d.x-c.x,a=d.y-c.y;return b*b+a*a}function getSqSegDist(f,g,e){var a=g.x,j=g.y,c=e.x-a,b=e.y-j;if(c!==0||b!==0){var d=((f.x-a)*c+(f.y-j)*b)/(c*c+b*b);if(d>1){a=e.x;j=e.y}else{if(d>0){a+=c*d;j+=b*d}}}c=f.x-a;b=f.y-j;return c*c+b*b}function simplifyRadialDist(f,d){var c=f[0],g=[c],b;for(var e=1,a=f.length;e<a;e++){b=f[e];if(getSqDist(b,c)>d){g.push(b);c=b}}if(c!==b){g.push(b)}return g}function simplifyDPStep(k,e,j,a,g){var b=a,f;for(var c=e+1;c<j;c++){var d=getSqSegDist(k[c],k[e],k[j]);if(d>b){f=c;b=d}}if(b>a){if(f-e>1){simplifyDPStep(k,e,f,a,g)}g.push(k[f]);if(j-f>1){simplifyDPStep(k,f,j,a,g)}}}function simplifyDouglasPeucker(b,a){var c=b.length-1;var d=[b[0]];simplifyDPStep(b,0,c,a,d);d.push(b[c]);return d}function simplify(c,a,d){if(c.length<=2){return c}var b=a!==undefined?a*a:1;c=d?c:simplifyRadialDist(c,b);c=simplifyDouglasPeucker(c,b);return c}ILayer.MAP_BOLGE="MAP_BOLGE";ILayer.MAP_IL="MAP_IL";ILayer.MAP_ILCE="MAP_ILCE";ILayer.MAP_MAHALLE="MAP_MAHALLE";ILayer.USER_POINT="USER_POINT";ILayer.USER_REGION="USER_REGION";ILayer.CAMP_CATEGORY="CAMP_CATEGORY";ILayer.CAMP_CAMPAIGN="CAMP_CAMPAIGN";ILayer.DEAL_CATEGORY="DEAL_CATEGORY";ILayer.DEAL_DEAL="DEAL_DEAL";ILayer.PREDEFINED_THEME="PREDEFINED THEME";ILayer.MAP_ROUTE="MAP_ROUTE";ILayer.MAP_YOL="MAP_YOL";ILayer.HEATMAP_ULKE="HEATMAP_ULKE";ILayer.HEATMAP_IL="HEATMAP_IL";ILayer.HEATMAP_ILCE="HEATMAP_ILCE";ILayer.HEATMAP_MAHALLE="HEATMAP_MAHALLE";ILayer.DEMOGRAFIK_YAS_DURUMU="YAS_DURUMU";ILayer.DEMOGRAFIK_NUFUS="NUFUS";ILayer.DEMOGRAFIK_EGITIM="EGITIM";ILayer.DEMOGRAFIK_KONUT_SAYISI="KONUT_SAYISI";ILayer.DEMOGRAFIK_ARAC_SAYISI="ARAC_SAYISI";var iJdbcSrid=3857;function ILayer(a){if(OM.isNull(a)){this.mapview=mapviewGlobal}else{this.mapview=a.mapview}this.typ=null;this.thmtyp=null;this.id=null;this.keyColumn=null;this.styleColumn=null;this.labelColumn=null;this.labelStyle=null;this.tableName=null;this.where=null;this.thmLayer=null;this.thmUserPoints=null}ILayer.prototype.createLayer=function(v,p,j,a,m,c,n,u,o,q,g,f,b,d,l){this.typ=v;this.id=p;this.where=j;this.labelColumn=u;this.labelStyle=o;if(OM.isNull(this.labelStyle)){this.labelStyle="T.LABEL"}if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}var t=this.mapview;switch(v){case ILayer.MAP_BOLGE:this.keyColumn="BOLGE_ID";this.styleColumn="BOLGE_ID";if(OM.notNull(a)){this.styleColumn=a}this.tableName="BOLGE";this.hiddenColumn="BOLGE_ADI";break;case ILayer.MAP_IL:this.keyColumn="IL_ID";this.tableName="IL";this.styleColumn="IL_ID";if(OM.notNull(a)){this.styleColumn=a}if(OM.isNull(this.where)||this.where.length<=0){this.where="IL_ID <> 100"}else{this.where="IL_ID <> 100 AND "+this.where}this.hiddenColumn="IL_ADI";break;case ILayer.MAP_ILCE:this.keyColumn="ILCE_ID";this.styleColumn="ILCE_ID";if(OM.notNull(a)){this.styleColumn=a}this.tableName="ILCE";this.hiddenColumn="ILCE_ADI";break;case ILayer.MAP_MAHALLE:this.keyColumn="MAHALLE_ID";this.styleColumn="MAHALLE_ID";if(OM.notNull(a)){this.styleColumn=a}this.tableName="MAHALLE";if(OM.isNull(this.where)||this.where.length<=0){this.where="TYPE=3"}else{this.where=this.where+" AND TYPE=3"}this.hiddenColumn="MAHALLE_ADI";break;case ILayer.USER_POINT:this.keyColumn="POINT_ID";this.tableName="LBS_USER_POINT";this.styleColumn="TYP";if(OM.notNull(a)){this.styleColumn=a}if(OM.isNull(this.where)||this.where.length<=0){this.where="KEY='"+lboxKey+"'"}else{this.where="KEY='"+lboxKey+"' AND "+this.where}if(OM.isNull(m)){m=new OM.style.Color({fill:"#ff2244",fillOpacity:0.5,stroke:"#ff2244"})}this.hiddenColumn="POINT_NAME";if(OM.notNull(q)){for(var r=0;r<q.length;r++){this.hiddenColumn+=","+q[r]}}break;case ILayer.USER_REGION:this.keyColumn="REGION_ID";this.styleColumn="REGION_ID";if(OM.notNull(a)){this.styleColumn=a}this.tableName="LBS_USER_REGION";if(OM.isNull(this.where)||this.where.length<=0){this.where="KEY='"+lboxKey+"'"}else{this.where="KEY='"+lboxKey+"' AND "+this.where}this.hiddenColumn="REGION_NAME";if(OM.notNull(q)){for(var r=0;r<q.length;r++){this.hiddenColumn+=","+q[r]}}break;case ILayer.USER_LINE:this.keyColumn="LINE_ID";this.styleColumn="LINE_ID";if(OM.notNull(a)){this.styleColumn=a}if(OM.isNull(m)){m="L.UM_ROTA_1"}this.tableName="LBS_USER_LINE";if(OM.isNull(this.where)||this.where.length<=0){this.where="KEY='"+lboxKey+"'"}else{this.where="KEY='"+lboxKey+"' AND "+this.where}this.hiddenColumn="LINE_NAME";if(OM.notNull(q)){for(var r=0;r<q.length;r++){this.hiddenColumn+=","+q[r]}}break;case ILayer.CAMP_CATEGORY:this.keyColumn="ID";this.styleColumn="BRAND_SEMBOL_NO";if(OM.notNull(a)){this.styleColumn=a}this.tableName="POI P, CAMP_CATEGORY CG, CAMP_CAMPAIGN CC, CAMP_CAMPAIGN_POI CCP";this.where="(CG.CATEGORY = CC.CATEGORY) AND (CC.CAMPAIGN_ID = CCP.CAMPAIGN_ID) AND (CCP.POI_ID = P.ID) AND CG.KEY='"+lboxKey+"'"+(this.where&&this.where.length>0?" AND CG."+this.where:"");this.hiddenColumn="STANDARD_NAME";break;case ILayer.CAMP_CAMPAIGN:this.keyColumn="ID";this.styleColumn="BRAND_SEMBOL_NO";if(OM.notNull(a)){this.styleColumn=a}this.tableName="POI P, CAMP_CATEGORY CG, CAMP_CAMPAIGN CC, CAMP_CAMPAIGN_POI CCP";this.where="(CG.CATEGORY = CC.CATEGORY) AND (CC.CAMPAIGN_ID = CCP.CAMPAIGN_ID) AND (CCP.POI_ID = P.ID) AND CG.KEY='"+lboxKey+"'"+(this.where&&this.where.length>0?" AND CC."+this.where:"");this.hiddenColumn="STANDARD_NAME";break;case ILayer.DEAL_CATEGORY:this.keyColumn="DP.DEAL_ID";this.styleColumn=null;if(OM.notNull(a)){this.styleColumn=a}this.tableName="DEAL_PROVIDER DP, DEAL_CATEGORY DC";this.where="(DP.DEAL_ID = DC.DEAL_ID)"+(this.where&&this.where.length>0?" AND DC."+this.where:"");this.hiddenColumn="NAME";break;case ILayer.DEAL_DEAL:this.keyColumn="DEAL_ID";this.styleColumn=null;if(OM.notNull(a)){this.styleColumn=a}this.tableName="DEAL_PROVIDER";this.where=(this.where&&this.where.length>0?this.where:"DEAL_ID = 0");this.hiddenColumn="NAME";break;case ILayer.MAP_ROUTE:this.keyColumn="PATH_ID";this.styleColumn="PATH_ID";if(OM.notNull(a)){this.styleColumn=a}this.tableName="NET_PATHS";this.where=(this.where&&this.where.length>0?this.where:"PATH_ID = 0");this.hiddenColumn="";break;case ILayer.MAP_YOL:this.keyColumn="YOL_ID";this.styleColumn="YOL_ID";if(OM.notNull(a)){this.styleColumn=a}this.tableName="YOL";this.where=(this.where&&this.where.length>0?this.where:"YOL_ID = 0");this.hiddenColumn="YOL_ADI";break;default:return}if(OM.notNull(this.thmLayer)){this.mapview.removeLayer(this.thmLayer);this.thmLayer=null}if(OM.notNull(f)){f=new OM.style.Text({styleName:"txt",fill:"#ff0000",fontStyle:OM.style.Text.FONTSTYLE_ITALIC,fontSize:50,sizeUnit:"kilometer"})}if(Math.abs((new Date()).getTime()-gtm)<86403236){var k;if(this.typ==ILayer.CAMP_CATEGORY||this.typ==ILayer.CAMP_CAMPAIGN){k="SELECT GEOLOC,"+this.keyColumn+" AS ID ,"+this.styleColumn+" STY"+(this.labelColumn?","+this.labelColumn+" AS LABEL":"")+(this.hiddenColumn?","+this.hiddenColumn:"")+" FROM POI WHERE ID IN (SELECT DISTINCT ID FROM "+this.tableName+(!this.where||this.where.length<=0?"":" WHERE "+this.where)+")"}else{k="SELECT GEOLOC, "+this.keyColumn+" AS ID ,"+this.styleColumn+" STY"+(this.labelColumn?","+this.labelColumn+" AS LABEL":"")+(this.hiddenColumn?","+this.hiddenColumn:"")+" FROM "+this.tableName+(!this.where||this.where.length<=0?"":" WHERE "+this.where)}if(typeof(l)=="undefined"){l=false}var e=new OM.layer.VectorLayer(this.id,{def:{type:OM.layer.VectorLayer.TYPE_JDBC,dataSource:datasrcApp,sql:k,url:urlBase,labelColumn:this.labelColumn,geometryColumn:"GEOLOC",loadOnDemand:false,infoWindow:l}});if(OM.isNull(m)){if(this.styleColumn=="BRAND_SEMBOL_NO"){e.setRenderingStyle({dataSource:datasrcApp,name:"V.MAP_POI_BRAND"})}}else{if(typeof m==="string"){e.setRenderingStyle({dataSource:datasrcApp,name:m})}else{e.setRenderingStyle(m,[this.styleColumn])}}if(!OM.isNull(g)){e.setHoverStyle(g);e.enableFeatureHover(true)}e.enableFeatureSelection(false);e.setBringToTopOnMouseOver(true);e.setToolTipCustomizer(this.hiddenColumn);e.setLabelsVisible(true);e.setLabelingStyle(f);e.setVisible(c);e.enableInfoWindow(l);if(d){e.setToolTipCustomizer(vectorLayerTooltip)}if(OM.notNull(b)){e.setSelectStyle(b)}if(OM.notNull(n)){e.addListener(OM.event.MouseEvent.MOUSE_CLICK,function(C){var E=t.getCursorLocation();E=E.transform(8307);var B={x:E.getX(),y:E.getY()};var y={data:[]};var D=C.feature.attributes;for(var z in D){if(D.hasOwnProperty(z)){var A={name:z,value:D[z]};y.data.push(A)}}return n(B,y)})}t.addLayer(e);this.thmLayer=e}return};ILayer.prototype.createVectorLayer=function(u,o,j,a,l,c,m,t,n,p,g,f,b,d){this.typ=u;this.id=o;this.where=j;this.labelColumn=t;this.labelStyle=n;if(OM.isNull(this.labelStyle)){this.labelStyle="T.LABEL"}if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}var r=this.mapview;switch(u){case ILayer.MAP_BOLGE:this.keyColumn="BOLGE_ID";this.styleColumn="BOLGE_ID";if(OM.notNull(a)){this.styleColumn=a}this.tableName="BOLGE";this.hiddenColumn="BOLGE_ADI";break;case ILayer.MAP_IL:this.keyColumn="IL_ID";this.tableName="IL";this.styleColumn="IL_ID";if(OM.notNull(a)){this.styleColumn=a}if(OM.isNull(this.where)||this.where.length<=0){this.where="IL_ID <> 100"}else{this.where="IL_ID <> 100 AND "+this.where}this.hiddenColumn="IL_ADI";break;case ILayer.MAP_ILCE:this.keyColumn="ILCE_ID";this.styleColumn="ILCE_ID";if(OM.notNull(a)){this.styleColumn=a}this.tableName="ILCE";this.hiddenColumn="ILCE_ADI";break;case ILayer.MAP_MAHALLE:this.keyColumn="MAHALLE_ID";this.styleColumn="MAHALLE_ID";if(OM.notNull(a)){this.styleColumn=a}this.tableName="MAHALLE";if(OM.isNull(this.where)||this.where.length<=0){this.where="TYPE=3"}else{this.where=this.where+" AND TYPE=3"}this.hiddenColumn="MAHALLE_ADI";break;case ILayer.USER_POINT:this.keyColumn="POINT_ID";this.tableName="LBS_USER_POINT";this.styleColumn="TYP";if(OM.notNull(a)){this.styleColumn=a}if(OM.isNull(this.where)||this.where.length<=0){this.where="KEY='"+lboxKey+"'"}else{this.where="KEY='"+lboxKey+"' AND "+this.where}if(OM.isNull(l)){l=new OM.style.Color({fill:"#ff2244",fillOpacity:0.5,stroke:"#ff2244"})}this.hiddenColumn="POINT_NAME";if(OM.notNull(p)){for(var q=0;q<p.length;q++){this.hiddenColumn+=","+p[q]}}break;case ILayer.USER_REGION:this.keyColumn="REGION_ID";this.styleColumn="REGION_ID";if(OM.notNull(a)){this.styleColumn=a}this.tableName="LBS_USER_REGION";if(OM.isNull(this.where)||this.where.length<=0){this.where="KEY='"+lboxKey+"'"}else{this.where="KEY='"+lboxKey+"' AND "+this.where}this.hiddenColumn="REGION_NAME";if(OM.notNull(p)){for(var q=0;q<p.length;q++){this.hiddenColumn+=","+p[q]}}break;case ILayer.USER_LINE:this.keyColumn="LINE_ID";this.styleColumn="LINE_ID";if(OM.notNull(a)){this.styleColumn=a}if(OM.isNull(l)){l="L.UM_ROTA_1"}this.tableName="LBS_USER_LINE";if(OM.isNull(this.where)||this.where.length<=0){this.where="KEY='"+lboxKey+"'"}else{this.where="KEY='"+lboxKey+"' AND "+this.where}this.hiddenColumn="LINE_NAME";if(OM.notNull(p)){for(var q=0;q<p.length;q++){this.hiddenColumn+=","+p[q]}}break;case ILayer.CAMP_CATEGORY:this.keyColumn="ID";this.styleColumn="BRAND_SEMBOL_NO";if(OM.notNull(a)){this.styleColumn=a}this.tableName="POI P, CAMP_CATEGORY CG, CAMP_CAMPAIGN CC, CAMP_CAMPAIGN_POI CCP";this.where="(CG.CATEGORY = CC.CATEGORY) AND (CC.CAMPAIGN_ID = CCP.CAMPAIGN_ID) AND (CCP.POI_ID = P.ID) AND CG.KEY='"+lboxKey+"'"+(this.where&&this.where.length>0?" AND CG."+this.where:"");this.hiddenColumn="STANDARD_NAME";break;case ILayer.CAMP_CAMPAIGN:this.keyColumn="ID";this.styleColumn="BRAND_SEMBOL_NO";if(OM.notNull(a)){this.styleColumn=a}this.tableName="POI P, CAMP_CATEGORY CG, CAMP_CAMPAIGN CC, CAMP_CAMPAIGN_POI CCP";this.where="(CG.CATEGORY = CC.CATEGORY) AND (CC.CAMPAIGN_ID = CCP.CAMPAIGN_ID) AND (CCP.POI_ID = P.ID) AND CG.KEY='"+lboxKey+"'"+(this.where&&this.where.length>0?" AND CC."+this.where:"");this.hiddenColumn="STANDARD_NAME";break;case ILayer.DEAL_CATEGORY:this.keyColumn="DP.DEAL_ID";this.styleColumn=null;if(OM.notNull(a)){this.styleColumn=a}this.tableName="DEAL_PROVIDER DP, DEAL_CATEGORY DC";this.where="(DP.DEAL_ID = DC.DEAL_ID)"+(this.where&&this.where.length>0?" AND DC."+this.where:"");this.hiddenColumn="NAME";break;case ILayer.DEAL_DEAL:this.keyColumn="DEAL_ID";this.styleColumn=null;if(OM.notNull(a)){this.styleColumn=a}this.tableName="DEAL_PROVIDER";this.where=(this.where&&this.where.length>0?this.where:"DEAL_ID = 0");this.hiddenColumn="NAME";break;case ILayer.MAP_ROUTE:this.keyColumn="PATH_ID";this.styleColumn="PATH_ID";if(OM.notNull(a)){this.styleColumn=a}this.tableName="NET_PATHS";this.where=(this.where&&this.where.length>0?this.where:"PATH_ID = 0");this.hiddenColumn="";break;case ILayer.MAP_YOL:this.keyColumn="YOL_ID";this.styleColumn="YOL_ID";if(OM.notNull(a)){this.styleColumn=a}this.tableName="YOL";this.where=(this.where&&this.where.length>0?this.where:"YOL_ID = 0");this.hiddenColumn="YOL_ADI";break;default:return}if(OM.notNull(this.thmLayer)){this.mapview.removeLayer(this.thmLayer);this.thmLayer=null}if(OM.notNull(f)){f=new OM.style.Text({styleName:"txt",fill:"#ff0000",fontStyle:OM.style.Text.FONTSTYLE_ITALIC,fontSize:50,sizeUnit:"kilometer"})}if(Math.abs((new Date()).getTime()-gtm)<86403236){var k;if(this.typ==ILayer.CAMP_CATEGORY||this.typ==ILayer.CAMP_CAMPAIGN){k="SELECT GEOLOC,"+this.keyColumn+" AS ID ,"+this.styleColumn+" STY"+(this.labelColumn?","+this.labelColumn+" AS LABEL":"")+(this.hiddenColumn?","+this.hiddenColumn:"")+" FROM POI WHERE ID IN (SELECT DISTINCT ID FROM "+this.tableName+(!this.where||this.where.length<=0?"":" WHERE "+this.where)+")"}else{k="SELECT GEOLOC, "+this.keyColumn+" AS ID ,"+this.styleColumn+" STY"+(this.labelColumn?","+this.labelColumn+" AS LABEL":"")+(this.hiddenColumn?","+this.hiddenColumn:"")+" FROM "+this.tableName+(!this.where||this.where.length<=0?"":" WHERE "+this.where)}var e=new OM.layer.VectorLayer(this.id,{def:{type:OM.layer.VectorLayer.TYPE_JDBC,dataSource:datasrcApp,sql:k,url:urlBase,labelColumn:this.labelColumn,geometryColumn:"GEOLOC",loadOnDemand:false}});if(OM.isNull(l)){if(this.styleColumn=="BRAND_SEMBOL_NO"){e.setRenderingStyle({dataSource:datasrcApp,name:"V.MAP_POI_BRAND"})}}else{if(typeof l==="string"){e.setRenderingStyle({dataSource:datasrcApp,name:l})}else{e.setRenderingStyle(l,[this.styleColumn])}}if(!OM.isNull(g)){e.setHoverStyle(g);e.enableFeatureHover(true)}e.enableFeatureSelection(false);e.setBringToTopOnMouseOver(true);e.setToolTipCustomizer(this.hiddenColumn);e.setLabelsVisible(true);e.setLabelingStyle(f);e.setVisible(c);if(d){e.setToolTipCustomizer(vectorLayerTooltip)}if(OM.notNull(b)){e.setSelectStyle(b)}if(OM.notNull(m)){e.addListener(OM.event.MouseEvent.MOUSE_CLICK,function(B){var D=r.getCursorLocation();D=D.transform(8307);var A={x:D.getX(),y:D.getY()};var v={data:[]};var C=B.feature.attributes;for(var y in C){if(C.hasOwnProperty(y)){var z={name:y,value:C[y]};v.data.push(z)}}return m(A,v)})}r.addLayer(e);this.thmLayer=e}return};ILayer.prototype.createDynamicLayer=function(v,o,g,c,k,e,l,u,n,p){this.typ=v;this.id=o;this.where=g;this.labelColumn=u;this.labelStyle=n;if(OM.isNull(this.labelStyle)){this.labelStyle="T.LABEL"}if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}var r=this.mapview;switch(v){case ILayer.MAP_BOLGE:this.keyColumn="BOLGE_ID";this.styleColumn="BOLGE_ID";if(OM.notNull(c)){this.styleColumn=c}this.tableName="BOLGE";this.hiddenColumn="BOLGE_ADI";break;case ILayer.MAP_IL:this.keyColumn="IL_ID";this.styleColumn="IL_ID";if(OM.notNull(c)){this.styleColumn=c}this.tableName="IL";if(OM.isNull(this.where)||this.where.length<=0){this.where="IL_ID <> 100"}else{this.where="IL_ID <> 100 AND "+this.where}this.hiddenColumn="IL_ADI";break;case ILayer.MAP_ILCE:this.keyColumn="ILCE_ID";this.styleColumn="ILCE_ID";if(OM.notNull(c)){this.styleColumn=c}this.tableName="ILCE";this.hiddenColumn="ILCE_ADI";break;case ILayer.MAP_MAHALLE:this.keyColumn="MAHALLE_ID";this.styleColumn="MAHALLE_ID";if(OM.notNull(c)){this.styleColumn=c}this.tableName="MAHALLE";if(OM.isNull(this.where)||this.where.length<=0){this.where="TYPE=3"}else{this.where=this.where+" AND TYPE=3"}this.hiddenColumn="MAHALLE_ADI";break;case ILayer.USER_POINT:this.keyColumn="POINT_ID";this.styleColumn="TYP";if(OM.notNull(c)){this.styleColumn=c}this.tableName="LBS_USER_POINT";if(OM.isNull(this.where)||this.where.length<=0){this.where="KEY='"+lboxKey+"'"}else{this.where="KEY='"+lboxKey+"' AND "+this.where}if(OM.isNull(k)){k="M.RED_PIN"}this.hiddenColumn="POINT_NAME";if(OM.notNull(p)){for(var q=0;q<p.length;q++){this.hiddenColumn+=","+p[q]}}break;case ILayer.USER_REGION:this.keyColumn="REGION_ID";this.styleColumn="REGION_ID";if(OM.notNull(c)){this.styleColumn=c}this.tableName="LBS_USER_REGION";if(OM.isNull(this.where)||this.where.length<=0){this.where="KEY='"+lboxKey+"'"}else{this.where="KEY='"+lboxKey+"' AND "+this.where}this.hiddenColumn="REGION_NAME";if(OM.notNull(p)){for(var q=0;q<p.length;q++){this.hiddenColumn+=","+p[q]}}break;case ILayer.USER_LINE:this.keyColumn="LINE_ID";this.styleColumn="LINE_ID";if(OM.notNull(c)){this.styleColumn=c}if(OM.isNull(k)){k="L.UM_ROTA_1"}this.tableName="LBS_USER_LINE";if(OM.isNull(this.where)||this.where.length<=0){this.where="KEY='"+lboxKey+"'"}else{this.where="KEY='"+lboxKey+"' AND "+this.where}this.hiddenColumn="LINE_NAME";if(OM.notNull(p)){for(var q=0;q<p.length;q++){this.hiddenColumn+=","+p[q]}}break;case ILayer.CAMP_CATEGORY:this.keyColumn="ID";this.styleColumn="BRAND_SEMBOL_NO";if(OM.notNull(c)){this.styleColumn=c}this.tableName="POI P, CAMP_CATEGORY CG, CAMP_CAMPAIGN CC, CAMP_CAMPAIGN_POI CCP";this.where="(CG.CATEGORY = CC.CATEGORY) AND (CC.CAMPAIGN_ID = CCP.CAMPAIGN_ID) AND (CCP.POI_ID = P.ID) AND CG.KEY='"+lboxKey+"'"+(this.where&&this.where.length>0?" AND CG."+this.where:"");this.hiddenColumn="STANDARD_NAME";break;case ILayer.CAMP_CAMPAIGN:this.keyColumn="ID";this.styleColumn="BRAND_SEMBOL_NO";if(OM.notNull(c)){this.styleColumn=c}this.tableName="POI P, CAMP_CATEGORY CG, CAMP_CAMPAIGN CC, CAMP_CAMPAIGN_POI CCP";this.where="(CG.CATEGORY = CC.CATEGORY) AND (CC.CAMPAIGN_ID = CCP.CAMPAIGN_ID) AND (CCP.POI_ID = P.ID) AND CG.KEY='"+lboxKey+"'"+(this.where&&this.where.length>0?" AND CC."+this.where:"");this.hiddenColumn="STANDARD_NAME";break;case ILayer.DEAL_CATEGORY:this.keyColumn="DP.DEAL_ID";this.styleColumn=null;if(OM.notNull(c)){this.styleColumn=c}this.tableName="DEAL_PROVIDER DP, DEAL_CATEGORY DC";this.where="(DP.DEAL_ID = DC.DEAL_ID)"+(this.where&&this.where.length>0?" AND DC."+this.where:"");this.hiddenColumn="NAME";break;case ILayer.DEAL_DEAL:this.keyColumn="DEAL_ID";this.styleColumn=null;if(OM.notNull(c)){this.styleColumn=c}this.tableName="DEAL_PROVIDER";this.where=(this.where&&this.where.length>0?this.where:"DEAL_ID = 0");this.hiddenColumn="NAME";break;case ILayer.MAP_ROUTE:this.keyColumn="PATH_ID";this.styleColumn="PATH_ID";if(OM.notNull(c)){this.styleColumn=c}this.tableName="NET_PATHS";this.where=(this.where&&this.where.length>0?this.where:"PATH_ID = 0");this.hiddenColumn="";break;case ILayer.MAP_YOL:this.keyColumn="YOL_ID";this.styleColumn="YOL_ID";if(OM.notNull(c)){this.styleColumn=c}this.tableName="YOL";this.where=(this.where&&this.where.length>0?this.where:"YOL_ID = 0");this.hiddenColumn="YOL_ADI";break;default:return}if(OM.notNull(this.thmLayer)){r.removeLayer(this.thmLayer);this.thmLayer=null}var m=r.getUniverse();var d=new OM.layer.TileLayerConfig({tileImageWidth:256,tileImageHeight:256});if(Math.abs((new Date()).getTime()-gtm)<86403236){var j;if(this.typ==ILayer.CAMP_CATEGORY||this.typ==ILayer.CAMP_CAMPAIGN){j="SELECT GEOLOC,"+this.keyColumn+","+this.styleColumn+" STY"+(this.labelColumn?","+this.labelColumn+" AS LABEL":"")+(this.hiddenColumn?","+this.hiddenColumn:"")+" FROM POI WHERE ID IN (SELECT DISTINCT ID FROM "+this.tableName+(!this.where||this.where.length<=0?"":" WHERE "+trans2xmlstr(this.where))+")"}else{j="SELECT GEOLOC, "+this.keyColumn+","+this.styleColumn+" STY"+(this.labelColumn?","+this.labelColumn+" AS LABEL":"")+(this.hiddenColumn?","+this.hiddenColumn:"")+" FROM "+this.tableName+(!this.where||this.where.length<=0?"":" WHERE "+trans2xmlstr(this.where))}var b=new OM.server.ServerJDBCTheme(o);if(OM.isNull(k)){if(this.styleColumn=="BRAND_SEMBOL_NO"){k="V.MAP_POI_BRAND"}}b.setQuery(j);b.setSRID("8307");b.setGeometryColumnName("GEOLOC");if(OM.notNull(k)&&OM.notNull(k.sym)){b.setRenderingStyleName(k.name)}else{if(k instanceof Object){b.setRenderingStyleName(k.getStyleName())}else{b.setRenderingStyleName(k)}}b.setDataSourceName(datasrcApp);b.setRenderingStyleValueColumns(this.keyColumn);b.addInfoColumn({column:this.keyColumn,name:this.keyColumn});b.addInfoColumn({column:this.hiddenColumn,name:this.hiddenColumn});var a=new OM.server.ServerMapRequest(urlBase);a.setProperties({dataSource:datasrcApp,transparent:true,antialiase:"false"});a.addTheme(b);if(OM.notNull(k)&&OM.notNull(k.sym)){a.addStyle(k.sym)}else{if(k instanceof Object){a.addStyle(k)}}var t={dataSource:datasrcApp,universe:m,tileLayerConfig:d,tileServerURL:urlBase+"/omserver",enableUTFGrid:true,enableUTFGridInfoWindow:true,utfGridResolution:4};var f=new OM.layer.DynamicTileLayer(o,t,a);if(OM.notNull(l)){f.addListener(OM.event.MouseEvent.MOUSE_CLICK,function(D){var F=r.getCursorLocation();F=F.transform(8307);var C={x:F.getX(),y:F.getY()};var y={data:[]};var E=f.getFeatureInfo();var z=E[Object.keys(E)[0]];for(var A in z){if(z.hasOwnProperty(A)){var B={name:A,value:z[A]};y.data.push(B)}}return l(C,y)})}r.addLayer(f);this.thmLayer=f}return};ILayer.prototype.createVectorCategoryLayer=function(e,a,c,d,b,j,k){this.typ=e;this.id=a;this.tableName=convCategory2Table(e);if(OM.isNull(this.tableName)){this.tableName="POI"}this.keyColumn="ID";this.where=convCategory2Where(e);this.hiddenColumn="STANDARD_NAME";if(OM.isNull(this.where)){alert("Category not found !");return}if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}var f=this.mapview;if(OM.notNull(this.thmLayer)){f.removeLayer(this.thmLayer);this.thmLayer=null}this.styleColumn=null;if(this.where.indexOf("TUR")>=0){this.styleColumn="TUR"}else{if(this.where.indexOf("BRAND_ID")>=0||this.where.indexOf("BRAND_NAME")>=0){this.styleColumn="BRAND_SEMBOL_NO"}else{if(this.where.indexOf("SUB_TYPE")>=0){this.styleColumn="BRAND_SEMBOL_NO"}else{}}}if(OM.isNull(c)){c=new OM.style.Color({fill:"#ff2244",fillOpacity:0.5,stroke:"#ff2244"})}if(Math.abs((new Date()).getTime()-gtm)<86402336){var l="SELECT GEOLOC,"+this.hiddenColumn+","+this.keyColumn+(this.styleColumn?","+this.styleColumn:"")+" FROM "+this.tableName+(!this.where||this.where.length<=0?"":" WHERE "+this.where);var g=new OM.layer.VectorLayer(this.id,{renderingStyle:c,def:{type:OM.layer.VectorLayer.TYPE_JDBC,dataSource:datasrcApp,sql:l,url:urlBase,geometryColumn:"GEOLOC",loadOnDemand:true}});if(OM.isNull(j)){j=new OM.style.Marker({vectorDef:[{shape:{type:"circle",cx:5,cy:5,width:10,height:10},style:{fill:"#ff2244",stroke:"#ff2244",fillOpacity:0.5}}],width:30,height:30})}g.setHoverStyle(j);if(k){g.setToolTipCustomizer(vectorLayerTooltip)}g.setVisible(d);f.addLayer(g);if(OM.notNull(b)){g.addListener(OM.event.MouseEvent.MOUSE_CLICK,function(r){var u=f.getCursorLocation();u=u.transform(8307);var q={x:u.getX(),y:u.getY()};var m={data:[]};var t=r.feature.attributes;for(var n in t){if(t.hasOwnProperty(n)){var o={name:n,value:t[n]};m.data.push(o)}}return b(q,m)})}this.thmLayer=g}return};ILayer.prototype.setJDBCRenderingStyle=function(c,a){if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}var b=this.mapview.getLayerByName(c);b.setRenderingStyle(a,["ID"]);b.redraw();return};ILayer.prototype.addSecondaryStyle=function(c,a){if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}var b=this.mapview.getLayerByName(c);b.addSecondaryStyle(a);b.redraw();return};ILayer.prototype.createBrandLayer=function(f,a,d,e,b){this.typ=f;this.id=a;this.tableName="POI";this.keyColumn="ID";this.hiddenColumn="STANDARD_NAME";this.where=convBrand2Where(f);if(OM.isNull(this.where)){alert("Brand not found !");return}if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}var g=this.mapview;this.styleColumn=null;if(this.where.indexOf("TUR")>=0){this.styleColumn="TUR"}else{if(this.where.indexOf("BRAND_ID")>=0||this.where.indexOf("BRAND_NAME")>=0){this.styleColumn="BRAND_SEMBOL_NO"}else{if(this.where.indexOf("SUB_TYPE")>=0){this.styleColumn="BRAND_SEMBOL_NO"}else{}}}var c=new OM.layer.TileLayerConfig({tileImageWidth:256,tileImageHeight:256});var k=this.mapview.getUniverse();if(OM.notNull(this.thmLayer)){this.mapview.removeLayer(this.thmLayer);this.thmLayer=null}if(OM.isNull(d)){if(this.styleColumn=="TUR"){d="V.MAP_POI_CATEGORY"}else{if(this.styleColumn=="BRAND_SEMBOL_NO"){d="V.MAP_POI_BRAND"}else{}}}if(Math.abs((new Date()).getTime()-gtm)<86413436){var p="SELECT GEOLOC,"+this.hiddenColumn+","+this.keyColumn+(this.styleColumn?","+this.styleColumn:"")+" FROM "+this.tableName+(!this.where||this.where.length<=0?"":" WHERE "+trans2xmlstr(this.where));var l=new OM.server.ServerJDBCTheme(a);l.setQuery(p);l.setSRID("8307");l.setGeometryColumnName("GEOLOC");var o=d?(d.name?d.name:(d.sym?(d.sym.name?d.sym.name:d.sym):d)):"M.PIN_1";l.setRenderingStyleName(o);l.setDataSourceName(datasrcApp);l.setRenderingStyleValueColumns(this.styleColumn);l.addInfoColumn({column:this.keyColumn,name:this.keyColumn});l.addInfoColumn({column:this.hiddenColumn,name:this.hiddenColumn});var n=new OM.server.ServerMapRequest(urlBase);n.setProperties({dataSource:datasrcApp,transparent:true,antialiase:"false"});n.addTheme(l);var m={dataSource:datasrcApp,universe:k,tileLayerConfig:c,tileServerURL:urlBase+"/omserver",enableUTFGrid:true,enableUTFGridInfoWindow:true,utfGridResolution:12};var j=new OM.layer.DynamicTileLayer(a+"_LayerBrand",m,n);if(OM.notNull(b)){j.addListener(OM.event.MouseEvent.MOUSE_CLICK,function(y){var A=g.getCursorLocation();A=A.transform(8307);var v={x:A.getX(),y:A.getY()};var q={data:[]};var z=j.getFeatureInfo();var r=z[Object.keys(z)[0]];for(var t in r){if(r.hasOwnProperty(t)){var u={name:t,value:r[t]};q.data.push(u)}}return b(v,q)})}j.setVisible(e);this.mapview.addLayer(j);this.thmLayer=j}return};ILayer.prototype.createClusterBrandLayer=function(f,c,d,e,o,q,n,l,b){this.typ=f;this.id=c;this.tableName="POI";this.keyColumn="ID";this.where=convBrand2Where(f);if(OM.isNull(this.where)){alert("Brand not found !");return}if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}this.styleColumn=null;if(this.where.indexOf("TUR")>=0){this.styleColumn="TUR"}else{if(this.where.indexOf("BRAND_ID")>=0||this.where.indexOf("BRAND_NAME")>=0){this.styleColumn="BRAND_SEMBOL_NO"}else{if(this.where.indexOf("SUB_TYPE")>=0){this.styleColumn="BRAND_SEMBOL_NO"}else{}}}if(OM.notNull(this.thmLayer)){this.mapview.removeLayer(this.thmLayer);this.thmLayer=null}var a=new OM.style.Color({fill:"#ff2244",fillOpacity:0.5,stroke:"#ff2244"});if(Math.abs((new Date()).getTime()-gtm)<86413436){var p="SELECT GEOLOC,"+this.keyColumn+(this.styleColumn?","+this.styleColumn:"")+" FROM "+this.tableName+(!this.where||this.where.length<=0?"":" WHERE "+trans2xmlstr(this.where));var j=new OM.layer.VectorLayer(this.id,{renderingStyle:a,def:{type:OM.layer.VectorLayer.TYPE_JDBC,dataSource:datasrcApp,sql:p,url:urlBase,geometryColumn:"GEOLOC",loadOnDemand:true,keyColumn:this.keyColumn}});var g=new OM.style.Marker({vectorDef:[{shape:{type:"circle",cx:5,cy:5,width:10,height:10},style:{fill:"#ff2244",stroke:"#ff2244",fillOpacity:0.5}}],width:30,height:30});j.setHoverStyle(g);j.setVisible(e);var k=new OM.style.Text({styleName:"textStyle",fill:"#ffffff"});if(OM.isNull(o)){o=new OM.style.VariableMarker({classification:"logarithmic",marker:new OM.style.Marker({textStyle:k,vectorDef:[{shape:{type:"circle",cx:5,cy:5,width:10,height:10},style:{fill:"#ff0000 ",stroke:"#ffffff"}}]}),startSize:20,increment:5,numClasses:10})}this.mapview.addLayer(j);var m=this.mapview.getLayerByName(this.id);if(OM.isNull(q)){q=3}if(OM.isNull(n)){n=12}if(OM.isNull(l)){l=40}m.enableClustering(true,{clusterStyle:o,minPointCount:q,maxClusteringLevel:n,threshold:l});if(OM.notNull(b)){j.addListener(OM.event.MouseEvent.MOUSE_CLICK,b)}this.thmLayer=j}return};ILayer.prototype.createCategoryLayer=function(f,a,d,e,b){this.typ=f;this.id=a;this.tableName=convCategory2Table(f);if(OM.isNull(this.tableName)){this.tableName="POI"}this.keyColumn="ID";this.hiddenColumn="STANDARD_NAME";this.where=convCategory2Where(f);if(OM.isNull(this.where)){alert("Category not found !");return}if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}var g=this.mapview;var c=new OM.layer.TileLayerConfig({tileImageWidth:256,tileImageHeight:256});var k=this.mapview.getUniverse();this.styleColumn=null;if(this.where.indexOf("TUR")>=0){this.styleColumn="TUR"}else{if(this.where.indexOf("BRAND_ID")>=0||this.where.indexOf("BRAND_NAME")>=0){this.styleColumn="BRAND_SEMBOL_NO"}else{if(this.where.indexOf("SUB_TYPE")>=0){this.styleColumn="BRAND_SEMBOL_NO"}else{}}}if(OM.notNull(this.thmLayer)){g.removeLayer(this.thmLayer);this.thmLayer=null}if(OM.isNull(d)){if(this.styleColumn=="TUR"){d="V.MAP_POI_CATEGORY"}else{if(this.styleColumn=="BRAND_SEMBOL_NO"){d="V.MAP_POI_BRAND"}else{}}}if(Math.abs((new Date()).getTime()-gtm)<86402336){var p="SELECT GEOLOC,"+this.hiddenColumn+","+this.keyColumn+(this.styleColumn?","+this.styleColumn:"")+" FROM "+this.tableName+(!this.where||this.where.length<=0?"":" WHERE "+this.where);var l=new OM.server.ServerJDBCTheme(a+"_THEME");l.setQuery(p);l.setSRID("8307");l.setGeometryColumnName("GEOLOC");var o=d?(d.name?d.name:(d.sym?(d.sym.name?d.sym.name:d.sym):d)):"M.RED_PIN";l.setRenderingStyleName(o);l.setDataSourceName(datasrcApp);l.setRenderingStyleValueColumns(this.styleColumn);l.addInfoColumn({column:this.keyColumn,name:this.keyColumn});l.addInfoColumn({column:this.hiddenColumn,name:this.hiddenColumn});var n=new OM.server.ServerMapRequest(urlBase);n.setProperties({dataSource:datasrcApp,transparent:true,antialiase:"false"});n.addTheme(l);n.addStyle(d);var m={dataSource:datasrcApp,universe:k,tileLayerConfig:c,tileServerURL:urlBase+"/omserver",enableUTFGrid:true,enableUTFGridInfoWindow:true,utfGridResolution:4};var j=new OM.layer.DynamicTileLayer(a+"_LyerCategory",m,n);if(OM.notNull(b)){j.addListener(OM.event.MouseEvent.MOUSE_CLICK,function(y){var A=g.getCursorLocation();A=A.transform(8307);var v={x:A.getX(),y:A.getY()};var q={data:[]};var z=j.getFeatureInfo();var r=z[Object.keys(z)[0]];for(var t in r){if(r.hasOwnProperty(t)){var u={name:t,value:r[t]};q.data.push(u)}}return b(v,q)})}j.setVisible(e);g.addLayer(j);this.thmLayer=j}return};ILayer.prototype.createClusterCategoryLayer=function(g,c,d,f,o,q,n,l,b){this.typ=g;this.id=c;if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}var e=this.mapview;this.tableName=convCategory2Table(g);if(OM.isNull(this.tableName)){this.tableName="POI"}this.keyColumn="ID";this.where=convCategory2Where(g);if(OM.isNull(this.where)){alert("Category not found !");return}this.styleColumn=null;if(this.where.indexOf("TUR")>=0){this.styleColumn="TUR"}else{if(this.where.indexOf("BRAND_ID")>=0||this.where.indexOf("BRAND_NAME")>=0){this.styleColumn="BRAND_SEMBOL_NO"}else{if(this.where.indexOf("SUB_TYPE")>=0){this.styleColumn="BRAND_SEMBOL_NO"}else{}}}if(OM.notNull(this.thmLayer)){e.removeLayer(this.thmLayer);this.thmLayer=null}var a=new OM.style.Color({fill:"#ff2244",fillOpacity:0.5,stroke:"#ff2244"});if(Math.abs((new Date()).getTime()-gtm)<86402336){var p="SELECT GEOLOC,"+this.keyColumn+(this.styleColumn?","+this.styleColumn:"")+" FROM "+this.tableName+(!this.where||this.where.length<=0?"":" WHERE "+this.where);var k=new OM.layer.VectorLayer(this.id,{renderingStyle:a,def:{type:OM.layer.VectorLayer.TYPE_JDBC,dataSource:datasrcApp,sql:p,url:urlBase,geometryColumn:"GEOLOC",loadOnDemand:true,keyColumn:this.keyColumn}});var j=new OM.style.Marker({vectorDef:[{shape:{type:"circle",cx:5,cy:5,width:10,height:10},style:{fill:"#ff2244",stroke:"#ff2244",fillOpacity:0.5}}],width:30,height:30});k.setHoverStyle(j);if(OM.isNull(o)){o=new OM.style.VariableMarker({classification:"logarithmic",marker:new OM.style.Marker({vectorDef:[{shape:{type:"circle",cx:5,cy:5,width:10,height:10},style:{fill:"#ff0000 ",stroke:"#ffffff"}}]}),textStyle:"#ffffff",startSize:20,increment:5,numClasses:10})}k.setVisible(f);this.mapview.addLayer(k);var m=this.mapview.getLayerByName(this.id);if(OM.isNull(q)){q=3}if(OM.isNull(n)){n=19}if(OM.isNull(l)){l=40}m.enableClustering(true,{clusterStyle:o,minPointCount:q,maxClusteringLevel:n,threshold:l});if(OM.notNull(b)){k.addListener(OM.event.MouseEvent.MOUSE_CLICK,b)}this.thmLayer=k}return};ILayer.prototype.createHeatmapLayer=function(d,a,g,j,c,b){this.typ=d;this.thmtyp=g;this.id=a;this.where=j;if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}var e=this.mapview;switch(g){case ILayer.USER_POINT:this.keyColumn="POINT_ID";this.tableName="LBS_USER_POINT";if(OM.isNull(this.where)||this.where.length<=0){this.where="KEY='"+lboxKey+"'"}else{this.where="KEY='"+lboxKey+"' AND "+this.where}break;case ILayer.CAMP_CATEGORY:this.keyColumn="ID";this.tableName="POI P, CAMP_CATEGORY CG, CAMP_CAMPAIGN CC, CAMP_CAMPAIGN_POI CCP";this.where="(CG.CATEGORY = CC.CATEGORY) AND (CC.CAMPAIGN_ID = CCP.CAMPAIGN_ID) AND (CCP.POI_ID = P.ID) AND CG.KEY='"+lboxKey+"'"+(this.where&&this.where.length>0?" AND CG."+this.where:"");break;case ILayer.CAMP_CAMPAIGN:this.keyColumn="ID";this.tableName="POI P, CAMP_CATEGORY CG, CAMP_CAMPAIGN CC, CAMP_CAMPAIGN_POI CCP";this.where="(CG.CATEGORY = CC.CATEGORY) AND (CC.CAMPAIGN_ID = CCP.CAMPAIGN_ID) AND (CCP.POI_ID = P.ID) AND CG.KEY='"+lboxKey+"'"+(this.where&&this.where.length>0?" AND CC."+this.where:"");break;case ILayer.DEAL_CATEGORY:this.keyColumn="DP.DEAL_ID";this.tableName="DEAL_PROVIDER DP, DEAL_CATEGORY DC";this.where="(DP.DEAL_ID = DC.DEAL_ID)"+(this.where&&this.where.length>0?" AND DC."+this.where:"");break;case ILayer.DEAL_DEAL:this.keyColumn="DEAL_ID";this.tableName="DEAL_PROVIDER";this.where=(this.where&&this.where.length>0?this.where:"DEAL_ID = 0");break;default:return}if(OM.notNull(this.thmLayer)){e.removeLayer(this.thmLayer);this.thmLayer=null}if(Math.abs((new Date()).getTime()-gtm)<86403236){var l;if(this.typ==ILayer.CAMP_CATEGORY||this.typ==ILayer.CAMP_CAMPAIGN){l="SELECT GEOLOC,"+this.keyColumn+" FROM POI WHERE ID IN (SELECT DISTINCT ID FROM "+this.tableName+(!this.where||this.where.length<=0?"":" WHERE "+this.where)+")"}else{l="SELECT GEOLOC,"+this.keyColumn+" FROM "+this.tableName+(!this.where||this.where.length<=0?"":" WHERE "+this.where)}var f=new OM.layer.VectorLayer(this.id+"_THEME",{def:{type:OM.layer.VectorLayer.TYPE_JDBC,dataSource:datasrcApp,sql:l,url:urlBase,geometryColumn:"GEOLOC",loadOnDemand:false,keyColumn:this.keyColumn}});if(OM.isNull(b)){b=["#009900","#FFFFCC","#FFFF66","#FFFF33","#FF9933","#FF6600","#FF3333","#FF0000"]}var k=new OM.style.HeatMap({styleName:this.id,spotlightRadius:10,colorStops:b,opacity:0.5,lengthUnit:"kilometer",sampleFactor:1,loadOnDemand:true});f.setRenderingStyle(k);f.setVisible(c);f.setLabelsVisible(true);e.addLayer(f);this.thmLayer=f}return};ILayer.prototype.createBrandHeatmapLayer=function(e,a,c,d,b){this.typ=e;this.id=a;this.tableName="POI";this.keyColumn="ID";this.where=convBrand2Where(c);if(OM.isNull(this.where)){alert("Brand not found !");return}if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}var f=this.mapview;if(OM.notNull(this.thmLayer)){f.removeLayer(this.thmLayer);this.thmLayer=null}if(Math.abs((new Date()).getTime()-gtm)<86413436){var k="SELECT GEOLOC,"+this.keyColumn+" FROM "+this.tableName+(!this.where||this.where.length<=0?"":" WHERE "+this.where);var g=new OM.layer.VectorLayer(this.id+"_THEME",{def:{type:OM.layer.VectorLayer.TYPE_JDBC,dataSource:datasrcApp,sql:k,url:urlBase,geometryColumn:"GEOLOC",loadOnDemand:false,keyColumn:this.keyColumn}});if(OM.isNull(b)){b=["#009900","#FFFFCC","#FFFF66","#FFFF33","#FF9933","#FF6600","#FF3333","#FF0000"]}var j=new OM.style.HeatMap({styleName:this.id,spotlightRadius:50,colorStops:b,opacity:0.8,lengthUnit:"pixel",sampleFactor:4,containerVectorLayer:new OM.layer.VectorLayer(this.id+"heatmap container",{def:{type:OM.layer.VectorLayer.TYPE_JDBC,dataSource:datasrcApp,sql:"SELECT GEOLOC FROM IL",loadOnDemand:true}})});g.setRenderingStyle(j);g.setVisible(d);f.addLayer(g);this.thmLayer=g}return};ILayer.prototype.createCategoryHeatmapLayer=function(e,a,b,d,c){this.typ=e;this.id=a;this.tableName="POI";this.keyColumn="ID";this.where=convCategory2Where(b);if(OM.isNull(this.where)){alert("Category not found !");return}if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}var f=this.mapview;if(OM.notNull(this.thmLayer)){f.removeLayer(this.thmLayer);this.thmLayer=null}if(Math.abs((new Date()).getTime()-gtm)<86402336){var k="SELECT GEOLOC,"+this.keyColumn+" FROM "+this.tableName+(!this.where||this.where.length<=0?"":" WHERE "+this.where);var g=new OM.layer.VectorLayer(this.id+"_THEME",{def:{type:OM.layer.VectorLayer.TYPE_JDBC,dataSource:datasrcApp,sql:k,url:urlBase,geometryColumn:"GEOLOC",loadOnDemand:false,keyColumn:this.keyColumn}});if(OM.isNull(c)){c=["#009900","#FFFFCC","#FFFF66","#FFFF33","#FF9933","#FF6600","#FF3333","#FF0000"]}var j=new OM.style.HeatMap({styleName:this.id,spotlightRadius:50,colorStops:c,opacity:0.8,lengthUnit:"pixel",sampleFactor:4,containerVectorLayer:new OM.layer.VectorLayer(this.id+"heatmap container",{def:{type:OM.layer.VectorLayer.TYPE_JDBC,dataSource:datasrcApp,sql:"SELECT GEOLOC FROM IL",loadOnDemand:true}})});g.setRenderingStyle(j);g.setVisible(d);f.addLayer(g);this.thmLayer=g}return};ILayer.prototype.enableClusterVectorLayer=function(f,b,c,e,a){if(OM.isNull(c)){c=5}if(OM.isNull(e)){e=8}if(OM.isNull(a)){a=60}if(OM.isNull(b)){b=new OM.style.VariableMarker({classification:"logarithmic",marker:new OM.style.Marker({vectorDef:[{shape:{type:"circle",cx:5,cy:5,width:10,height:10},style:{fill:"#A5DF00",stroke:"#000000"}}]}),startSize:20,increment:5,numClasses:10})}if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}var d=this.mapview.getLayerByName(f);d.enableClustering(true,{clusterStyle:b,minPointCount:c,maxClusteringLevel:e,threshold:a});d.redraw();return};ILayer.prototype.enableClusterLayer=function(f,b,c,e,a){if(OM.isNull(c)){c=5}if(OM.isNull(e)){e=8}if(OM.isNull(a)){a=60}if(OM.isNull(b)){b=new OM.style.VariableMarker({classification:"logarithmic",marker:new OM.style.Marker({vectorDef:[{shape:{type:"circle",cx:5,cy:5,width:10,height:10},style:{fill:"#A5DF00",stroke:"#000000"}}]}),startSize:20,increment:5,numClasses:10})}if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}var d=this.mapview.getLayerByName(f);d.enableClustering(true,{clusterStyle:b,minPointCount:c,maxClusteringLevel:e,threshold:a});d.redraw();return};ILayer.prototype.setHeatMapStyle=function(a,k,b,d,g,e){var j="SELECT GEOLOC FROM IL";if(OM.isNull(k)){k=100}if(OM.isNull(b)){b=["#FFFFFF","#ffff00","#ff8800","#ff0000"]}if(OM.isNull(d)){d=0.5}if(OM.isNull(g)){g="mile"}if(OM.isNull(e)){e=8}var f=new OM.style.HeatMap({styleName:a,spotlightRadius:k,colorStops:b,opacity:d,lengthUnit:g,sampleFactor:e,containerVectorLayer:new OM.layer.VectorLayer(this.id,{def:{type:OM.layer.VectorLayer.TYPE_JDBC,dataSource:datasrcApp,sql:j,loadOnDemand:true}})});if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}var c=this.mapview.getLayerByName(this.id);c.setRenderingStyle(f);c.redraw();return};ILayer.prototype.setNSDP=function(d,a,b){if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}var c=this.mapview.getLayerByName(d);c.setNSDP({keyColumn:a,xml:b});c.redraw();return};ILayer.prototype.setVisualFilter=function(c,a){if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}var b=this.mapview.getLayerByName(c);b.setVisualFilter(a);b.redraw();return};ILayer.prototype.setPreDefRenderingStyle=function(c,a){if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}var b=this.mapview.getLayerByName(c);b.setRenderingStyle(a);b.redraw();return};ILayer.prototype.selectFeatureByFilter=function(c,a){if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}var b=this.mapview.getLayerByName(c);b.selectFeatureByFilter(a);return};ILayer.prototype.clearSelectedFeatures=function(b){if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}var a=this.mapview.getLayerByName(b);a.clearSelectedFeatures();return};ILayer.prototype.setSelectStyle=function(c,a){if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}var b=this.mapview.getLayerByName(c);b.setSelectStyle(a);return};ILayer.prototype.createDemographicLayer=function(e,a,d,b){this.typ=e;this.id=a;this.tableName=null;switch(e){case ILayer.DEMOGRAFIK_YAS_DURUMU:this.tableName="DEMOGRAFIK_YAS_DURUMU";break;case ILayer.DEMOGRAFIK_NUFUS:this.tableName="DEMOGRAFIK_NUFUS";break;case ILayer.DEMOGRAFIK_EGITIM:this.tableName="DEMOGRAFIK_EGITIM";break;case ILayer.DEMOGRAFIK_KONUT_SAYISI:this.tableName="DEMOGRAFIK_KONUT_SAYISI";break;case ILayer.DEMOGRAFIK_ARAC_SAYISI:this.tableName="DEMOGRAFIK_ARAC_SAYISI";break;break}if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}if(OM.notNull(this.thmLayer)){this.mapview.removeLayer(this.thmLayer);this.thmLayer=null}var c=new OM.layer.TileLayerConfig({tileImageWidth:256,tileImageHeight:256});var j=this.mapview.getUniverse();if(Math.abs((new Date()).getTime()-gtm)<86402336){var g=new OM.server.ServerPredefinedTheme(this.tableName);var l=new OM.server.ServerMapRequest(urlBase);l.setProperties({dataSource:datasrcApp,transparent:true,antialiase:"false"});l.addTheme(g);var k={universe:j,tileLayerConfig:c,tileServerURL:urlBase+"/omserver",enableUTFGrid:true,enableUTFGridInfoWindow:true,utfGridResolution:12};var f=new OM.layer.DynamicTileLayer(this.id+"layerPredefined",k,l);this.mapview.addListener(OM.event.MouseEvent.MOUSE_CLICK,dynLayerClick);f.setVisible(d);this.mapview.addLayer(f);this.thmLayer=f}return};ILayer.prototype.createThemeLayer=function(c,g,f,e,b,a){if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}var d=new OM.layer.VectorLayer(g,{def:{type:OM.layer.VectorLayer.TYPE_PREDEFINED,dataSource:datasrcApp,theme:c,loadOnDemand:true,jdbcSrid:iJdbcSrid}});d.enableInfoWindow(!b);d.setVisible(e);if(f){switch(f.length){case 1:d.setQueryParameters(f[0]);break;case 2:d.setQueryParameters(f[0],f[1]);break;case 3:d.setQueryParameters(f[0],f[1],f[2]);break;case 4:d.setQueryParameters(f[0],f[1],f[2],f[3]);break;case 5:d.setQueryParameters(f[0],f[1],f[2],f[3],f[4]);break;case 6:d.setQueryParameters(f[0],f[1],f[2],f[3],f[4],f[5]);break;case 7:d.setQueryParameters(f[0],f[1],f[2],f[3],f[4],f[5],f[6]);break;case 8:d.setQueryParameters(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7]);break;case 9:d.setQueryParameters(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8]);break;case 10:d.setQueryParameters(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9]);break;case 11:d.setQueryParameters(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9],f[10]);break;case 12:d.setQueryParameters(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9],f[10],f[11]);break;case 13:d.setQueryParameters(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9],f[10],f[11],f[12]);break;case 14:d.setQueryParameters(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9],f[10],f[11],f[12],f[13]);break;case 15:d.setQueryParameters(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9],f[10],f[11],f[12],f[13],f[14]);break;case 16:d.setQueryParameters(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9],f[10],f[11],f[12],f[13],f[14],f[15]);break;case 17:d.setQueryParameters(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9],f[10],f[11],f[12],f[13],f[14],f[15],f[16]);break;case 18:d.setQueryParameters(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9],f[10],f[11],f[12],f[13],f[14],f[15],f[16],f[17]);break;case 19:d.setQueryParameters(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9],f[10],f[11],f[12],f[13],f[14],f[15],f[16],f[17],f[18]);break;case 20:d.setQueryParameters(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8],f[9],f[10],f[11],f[12],f[13],f[14],f[15],f[16],f[17],f[18],f[19]);break}}d.setLabelsVisible(true);if(b){d.addListener(OM.event.MouseEvent.MOUSE_CLICK,b)}if(a){d.addListener(OM.event.MouseEvent.MOUSE_RIGHT_CLICK,b)}this.mapview.addLayer(d);this.thmLayer=d;return};function dynLayerClick(a){var e=a.target.divLayers;var d=null;if(e){for(var b=e.length-1;b>0;b--){if(e[b].visible){d=e[b];break}}}if(d!=null){var c=d.getFeatureInfo();if(OM.notNull(c)&&JSON.stringify(c)!="{}"){showInfoWindow(c)}}return}function showInfoWindow(n){var c="";for(var b in n){if(n.hasOwnProperty(b)){c=b;break}}state=n[c];var k=OM.isNull(state)?"":JSON.stringify(state);if(this.mapview==undefined||this.mapview==null){this.mapview=mapviewGlobal}var f="";var e=0;if(OM.notNull(k)&&k.length>0){if(f===""){f="<table align='left' cellspacing='4' style='margin: auto;border-collapse: separate;'>"}var g=JSON.parse(k);var m=[];var b=[];for(var j in g){m.push(g[j]);b.push(j)}for(var d=0;m.length>d;d++){var a=m[d];if(!a||a==null||a=="null"){a="-"}else{a=noExponents(a)}f+="<tr bgcolor='#dddddd'><td align='left'>"+b[d]+"</td><td align='left'>"+a+"</td></tr>"}e++}var o={width:330,height:40+(e*90),title:"INFO",infoWindowStyle:{"background-color":"#F5F5F9"},titleStyle:{"background-color":"#A5A5A9","font-size":"16px","font-family":"Tahoma"},contentStyle:{"background-color":"#F5F5F9","font-size":"16px","font-family":"Tahoma"},tailStyle:{offset:"25","background-color":"#30BB30"}};f+="</table>";var l=this.mapview.getCursorLocation();this.mapview.displayInfoWindow(l,f,o);return}function noExponents(e){var c=e+"";if(c.length<=1){return e}var b=c.split(/[eE]/);if(b.length==1||isNaN(b[0])){return e}var g="",a=this<0?"-":"",f=b[0].replace(".",""),d=Number(b[1])+1;if(d<0){g=a+"0.";while(d++){g+="0"}return g+f.replace(/^\-/,"")}d-=f.length;while(d--){g+="0"}return f+g}ILayer.prototype.removeLayer=function(){if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}if(OM.notNull(this.thmLayer)){this.mapview.removeLayer(this.thmLayer)}return};ILayer.prototype.removeUserPointHeatMap=function(){if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}if(OM.notNull(this.thmLayer)){this.mapview.removeLayer(this.thmLayer);this.mapview.removeLayer(this.thmUserPoints)}};ILayer.prototype.setVisible=function(a){if(this.thmLayer){this.thmLayer.setVisible(a)}return};ILayer.prototype.refresh=function(){if(this.thmLayer){this.thmLayer.refresh()}return};ILayer.prototype.zoomToLayer=function(){if(this.thmLayer){this.thmLayer.zoomToTheme()}return};function vectorLayerTooltip(a){var c="";for(var b in a.attributes){if(a.attributes.hasOwnProperty(b)){c+=b+":"+a.attributes[b]+"\n"}}return c}function IAnalysis(a){if(!a){this.mapview=mapviewGlobal}else{this.mapview=a.mapview}this.typ=null;this.thmAnalysis=null;this.pieStyle=null}IAnalysis.prototype.createColoringAnalysis=function(c,b,j,a,e){if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}this.typ=c;if(this.thmAnalysis!=null){this.mapview.removeLayer(this.thmAnalysis)}if(Math.abs((new Date()).getTime()-gtm)<86498263){var k="SELECT SDO_UTIL.SIMPLIFY(GEOLOC, 100) AS GEOLOC,to_char("+this.typ+"_ID) "+this.typ+"_ID FROM "+(this.typ!="REGION"?this.typ:"LBS_USER_REGION WHERE KEY = '"+lboxKey+"'");var d=new OM.layer.VectorLayer(this.typ+"COLORJDBCTHEME",{def:{dataSource:datasrcApp,geometryColumn:"GEOLOC",type:OM.layer.VectorLayer.TYPE_JDBC,sql:k,url:urlBase,loadOnDemand:false}});d.setBringToTopOnMouseOver(true);if(b){if(b.name){b=b}else{if(b.sym){for(var g=0;g<b.symlist.length;g++){var f=b.symlist[g];if(f.sym.name){b=f.sym}}OM.style.StyleStore.getServerSideStyle(datasrcApp,b,{url:urlBase,callback:function(l){d.setRenderingStyle(l)}})}}}if(OM.notNull(j)){d.setRenderingStyle(j,[this.typ+"_ID"])}else{if(!b){var b="V.ANALIZ_COLORS";OM.style.StyleStore.getServerSideStyle(datasrcApp,b,{url:urlBase,callback:function(l){d.setRenderingStyle(l)}})}}d.enableInfoWindow(true);d.enableFeatureHover(true);if(OM.isNull(e)){e=new OM.style.Color({stroke:"#f6f3ca",strokeThickness:1.5})}d.setHoverStyle(e);this.mapview.addLayer(d);if(a){this.mapview.addListener(OM.event.MouseEvent.MOUSE_CLICK,a)}this.thmAnalysis=d}return};IAnalysis.prototype.createBarAnalysis=function(c,a){if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}this.typ=c;if(this.thmAnalysis){this.mapview.removeLayer(this.thmAnalysis)}if(Math.abs((new Date()).getTime()-gtm)<86447562){var b="SELECT SDO_GEOM.SDO_CENTROID(GEOLOC, 0.5) AS GEOLOC,"+this.typ+"_ID FROM "+(this.typ!="REGION"?this.typ:"LBS_USER_REGION WHERE KEY = '"+lboxKey+"'");var d=new OM.layer.VectorLayer(this.typ+"_BAR_JDBC_THEME",{def:{dataSource:datasrcApp,jdbcSrid:8307,geometryColumn:"GEOLOC",type:OM.layer.VectorLayer.TYPE_JDBC,sql:b,url:urlBase,loadOnDemand:false}});d.setBringToTopOnMouseOver(true);this.mapview.addLayer(d);if(a){this.mapview.addListener(OM.event.MouseEvent.MOUSE_CLICK,a)}this.thmAnalysis=d}return};IAnalysis.prototype.createPieAnalysis=function(c,a){if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}this.typ=c;if(this.thmAnalysis){this.mapview.removeLayer(this.thmAnalysis)}if(Math.abs((new Date()).getTime()-gtm)<86447562){var b="SELECT SDO_GEOM.SDO_CENTROID(GEOLOC, 0.5) AS GEOLOC,"+this.typ+"_ID FROM "+(this.typ!="REGION"?this.typ:"LBS_USER_REGION WHERE KEY = '"+lboxKey+"'");var d=new OM.layer.VectorLayer(this.typ+"_PIE_JDBC_THEME",{def:{dataSource:datasrcApp,jdbcSrid:8307,geometryColumn:"GEOLOC",type:OM.layer.VectorLayer.TYPE_JDBC,sql:b,url:urlBase,loadOnDemand:false}});d.setBringToTopOnMouseOver(true);this.mapview.addLayer(d);if(a){this.mapview.addListener(OM.event.MouseEvent.MOUSE_CLICK,a)}this.thmAnalysis=d}return};IAnalysis.prototype.setAnalysisPieStyle=function(b,c){var e=new Array(b.pies.length);var d=this.thmAnalysis;for(var a=0;a<b.pies.length;a++){e[a]=new OM.style.PieSlice(b.pies[a].name,b.pies[a].color)}if(OM.isNull(c)){c=new OM.style.PieChart({styleName:"pie",pieSlices:e,radius:b.radius,enableHighlight:true,lengthUnit:"kilometer",radiusPixelRange:{max:200,min:10}})}d.setRenderingStyle(c);return};IAnalysis.prototype.setAnalysisPieData=function(b,a){var c=this.thmAnalysis;var d="<nsdp_xml>"+a+"</nsdp_xml>";c.setNSDP({keyColumn:b+"_ID",xml:d});c.redraw();return};IAnalysis.prototype.setAnalysisBarStyle=function(b,e){var c=new Array(b.bars.length);var d=this.thmAnalysis;for(var a=0;a<b.bars.length;a++){c[a]=new OM.style.Bar(b.bars[a].name,b.bars[a].color)}if(OM.isNull(e)){e=new OM.style.BarChart({styleName:"bar",bars:c,width:30,height:40,lengthUnit:"kilometer",enableHighlight:true,lengthPixelRange:{min:0,max:120}})}d.setRenderingStyle(e);return};IAnalysis.prototype.setAnalysisBarData=function(b,a){var c=this.thmAnalysis;var d="<nsdp_xml>"+a+"</nsdp_xml>";c.setNSDP({keyColumn:"to_char("+b+"_ID) "+b+"_ID",xml:d});c.redraw();return};IAnalysis.prototype.removeAnalysis=function(){if(OM.isNull(this.mapview)){this.mapview=mapviewGlobal}if(this.thmAnalysis){this.mapview.removeLayer(this.thmAnalysis)}return};IAnalysis.prototype.setAnalysisColoringData=function(b,a){var c=this.thmAnalysis;var d="<nsdp_xml>"+a+"</nsdp_xml>";c.setNSDP({keyColumn:b+"_ID",xml:d});c.setToolTipCustomizer(analysisTooltip);c.redraw();return};function analysisTooltip(a){var c="";for(var b in a.attributes){if(a.attributes.hasOwnProperty(b)){c+=b+":"+a.attributes[b]+"\n"}}return c}function ITrafficLayer(){if(!mapper){this.mapview=mapviewGlobal}else{this.mapview=mapper.mapview}this.id=null;this.idList=null;this.sym=null;this.visible=null;this.thmLayer=null;this.tableIndex=0}ITrafficLayer.prototype.createLayer=function(a,g,b,c){if(this.mapview==null){this.mapview=mapviewGlobal}this.id=a;this.idList=g;this.sym=b;if(this.thmLayer){this.mapview.deleteListener("zoom_level_change",this.afterZoom);this.mapview.removeLayer(this.thmLayer);this.thmLayer=null}var j=this.mapview.getMapZoomLevel();this.tableIndex=getTmcHatTableIndex(j);if(Math.abs((new Date()).getTime()-gtm)<86403236){var k="SELECT GEOLOC,TMC_KOD,TMC_KOD STY FROM TMC_HAT_"+this.tableIndex+" WHERE TMC_KOD IN ("+this.idList+")";var d=new OM.layer.VectorLayer("TMC_HAT_IDLIST_"+this.id+"_THEME",{def:{dataSource:datasrcApp,jdbcSrid:8307,geometryColumn:"GEOLOC",type:OM.layer.VectorLayer.TYPE_JDBC,sql:k,url:urlBase,keyColumn:"TMC_KOD",loadOnDemand:false}});d.setBringToTopOnMouseOver(true);if(b){if(b.name){d.setRenderingStyle(b)}else{if(b.sym){for(var f=0;f<b.symlist.length;f++){var e=b.symlist[f];if(e.sym.name){d.setRenderingStyle(e.sym)}}d.setRenderingStyle(b.sym)}}}if(!b){var b="V.ANALIZ_COLORS";OM.style.StyleStore.getServerSideStyle(datasrcApp,b,{url:urlBase,callback:function(l){d.setRenderingStyle(l)}})}this.visible=c;d.setVisible(c);this.mapview.addLayer(d);this.thmLayer=d}return};ITrafficLayer.prototype.removeLayer=function(){if(this.mapview==null){this.mapview=mapviewGlobal}if(this.thmLayer){this.mapview.deleteListener("zoom_level_change",this.afterZoom);this.mapview.removeLayer(this.thmLayer);this.thmLayer=null}return};ITrafficLayer.prototype.setVisible=function(a){if(this.thmLayer){this.visible=a;this.thmLayer.setVisible(a)}return};ITrafficLayer.prototype.refresh=function(){if(this.thmLayer){this.thmLayer.refresh()}return};ITrafficLayer.prototype.zoomToLayer=function(){if(this.thmLayer){this.thmLayer.zoomToTheme()}return};function getTmcHatTableIndex(b){if(this.mapview==null){this.mapview=mapviewGlobal}var a=this.mapview.getMapContext().getUniverse().getSRID();if(a==8307){if(b>=0&&b<=6){return 4}if(b>=7&&b<=8){return 3}if(b==9){return 2}if(b>=10&&b<=15){return 1}return 1}else{if(b>=0&&b<=8){return 4}if(b>=9&&b<=10){return 3}if(b==11){return 2}if(b>=12&&b<=18){return 1}return 1}};